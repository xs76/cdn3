"use strict";Phaser.Plugin.Juicy=function(e){Phaser.Plugin.call(this,e),this._boundsCache=Phaser.Utils.extend(!1,{},this.game.world.bounds),this._shakeWorldMax=20,this._shakeWorldTime=0,this._trailCounter=0,this._overScales={},this._overScalesCounter=0},Phaser.Plugin.Juicy.prototype=Object.create(Phaser.Plugin.prototype),Phaser.Plugin.Juicy.prototype.constructor=Phaser.Plugin.Juicy,Phaser.Plugin.Juicy.ScreenFlash=function(e,t){t=t||"white";var s=e.add.bitmapData(e.width,e.height);s.ctx.fillStyle=t,s.ctx.fillRect(0,0,e.width,e.height),Phaser.Sprite.call(this,e,0,0,s),this.alpha=0},Phaser.Plugin.Juicy.ScreenFlash.prototype=Object.create(Phaser.Sprite.prototype),Phaser.Plugin.Juicy.ScreenFlash.prototype.constructor=Phaser.Plugin.Juicy.ScreenFlash,Phaser.Plugin.Juicy.ScreenFlash.prototype.flash=function(e,t){e=e||1,t=t||100,this.game.add.tween(this).to({alpha:e},100,Phaser.Easing.Bounce.InOut,!0,0,0,!0).onComplete.add(function(){this.alpha=0},this)},Phaser.Plugin.Juicy.Trail=function(e,t,s){Phaser.Graphics.call(this,e,0,0),this.target=null,this.trailLength=t||100,this.trailWidth=15,this.trailScaling=!1,this.trailColor=s||16777215,this._segments=[],this._verts=[],this._indices=[]},Phaser.Plugin.Juicy.Trail.prototype=Object.create(Phaser.Graphics.prototype),Phaser.Plugin.Juicy.Trail.prototype.constructor=Phaser.Plugin.Juicy.Trail,Phaser.Plugin.Juicy.Trail.prototype.update=function(){this.target&&(this.x=this.target.x,this.y=this.target.y,this.addSegment(this.target.x,this.target.y),this.redrawSegments(this.target.x,this.target.y))},Phaser.Plugin.Juicy.Trail.prototype.addSegment=function(e,t){for(var s;this._segments.length>this.trailLength;)s=this._segments.shift();s||(s=new Phaser.Point),s.x=e,s.y=t,this._segments.push(s)},Phaser.Plugin.Juicy.Trail.prototype.redrawSegments=function(e,t){this.clear();var s,i,a,h,r=0,n=0,o=0;this._verts.length!==4*(this._segments.length-1)&&(this._verts=[]);for(var l=0;l<this._segments.length;++l){if(s=this._segments[l],i){h=Math.atan2(s.y-i.y,s.x-i.x)+Math.PI/2,n=Math.sin(h),o=Math.cos(h);for(var c=0;c<2;++c)a=(c/1-.5)*this.trailWidth,this.trailScaling&&(a*=l/this._segments.length),this._verts[r++]=s.x+o*a-e,this._verts[r++]=s.y+n*a-t}i=s.copyTo({})}if(8<=this._verts.length){for(var u=0;u<this._verts.length;u++)this._indices[6*u+0]=2*u+0,this._indices[6*u+1]=2*u+1,this._indices[6*u+2]=2*u+2,this._indices[6*u+3]=2*u+1,this._indices[6*u+4]=2*u+2,this._indices[6*u+5]=2*u+3;this.beginFill(this.trailColor),this.drawTriangles(this._verts,this._indices),this.endFill()}},Phaser.Plugin.Juicy.prototype.shake=function(e,t){this._shakeWorldTime=e||20,this._shakeWorldMax=t||20,this.game.world.setBounds(this._boundsCache.x-this._shakeWorldMax,this._boundsCache.y-this._shakeWorldMax,this._boundsCache.width+this._shakeWorldMax,this._boundsCache.height+this._shakeWorldMax)},Phaser.Plugin.Juicy.prototype.createScreenFlash=function(e){return new Phaser.Plugin.Juicy.ScreenFlash(this.game,e)},Phaser.Plugin.Juicy.prototype.createTrail=function(e,t){return new Phaser.Plugin.Juicy.Trail(this.game,e,t)},Phaser.Plugin.Juicy.prototype.overScale=function(e,t,s){t=t||1.5;var i=this._overScalesCounter++;s=s||new Phaser.Point(1,1);var a=this._overScales[i];a||(a={object:e,cache:s.copyTo({})}),a.scale=t,this._overScales[i]=a},Phaser.Plugin.Juicy.prototype.jelly=function(e,t,s,i){t=t||.2,s=s||0,i=i||new Phaser.Point(1,1),this.game.add.tween(e.scale).to({x:i.x+i.x*t},50,Phaser.Easing.Quadratic.InOut,!0,s).to({x:i.x},600,Phaser.Easing.Elastic.Out,!0),this.game.add.tween(e.scale).to({y:i.y+i.y*t},50,Phaser.Easing.Quadratic.InOut,!0,s+50).to({y:i.y},600,Phaser.Easing.Elastic.Out,!0)},Phaser.Plugin.Juicy.prototype.mouseStretch=function(e,t,s){t=t||.5,s=s||new Phaser.Point(1,1),e.scale.x=s.x+Math.abs(e.x-this.game.input.activePointer.x)/100*t,e.scale.y=s.y+s.y*t-e.scale.x*t},Phaser.Plugin.Juicy.prototype.update=function(){var e;if(0<this._shakeWorldTime){var t=this._shakeWorldTime/this._shakeWorldMax*this._shakeWorldMax,s=this.game.rnd.integerInRange(-t,t),i=this.game.rnd.integerInRange(-t,t);this.game.camera.x=s,this.game.camera.y=i,this._shakeWorldTime--,this._shakeWorldTime<=0&&this.game.world.setBounds(this._boundsCache.x,this._boundsCache.x,this._boundsCache.width,this._boundsCache.height)}for(var a in this._overScales)this._overScales.hasOwnProperty(a)&&(.01<(e=this._overScales[a]).scale?(e.object.scale.x=e.scale*e.cache.x,e.object.scale.y=e.scale*e.cache.y,e.scale-=this.game.time.elapsed*e.scale*.35):(e.object.scale.x=e.cache.x,e.object.scale.y=e.cache.y,delete this._overScales[a]))},"object"==typeof module&&module.exports&&(module.exports=Phaser.Plugin.Juicy),Phaser.Graphics.prototype.drawTriangle||(Phaser.Graphics.prototype.drawTriangle=function(e,t){var s=new Phaser.Polygon(e);if(t){var i=new Phaser.Point(this.game.camera.x-e[0].x,this.game.camera.y-e[0].y),a=new Phaser.Point(e[1].x-e[0].x,e[1].y-e[0].y),h=new Phaser.Point(e[1].x-e[2].x,e[1].y-e[2].y).cross(a);0<i.dot(h)&&this.drawPolygon(s)}else this.drawPolygon(s)},Phaser.Graphics.prototype.drawTriangles=function(e,t,s){var i,a=new Phaser.Point,h=new Phaser.Point,r=new Phaser.Point,n=[];if(t)if(e[0]instanceof Phaser.Point)for(i=0;i<t.length/3;i++)n.push(e[t[3*i]]),n.push(e[t[3*i+1]]),n.push(e[t[3*i+2]]),3===n.length&&(this.drawTriangle(n,s),n=[]);else for(i=0;i<t.length;i++)a.x=e[2*t[i]],a.y=e[2*t[i]+1],n.push(a.copyTo({})),3===n.length&&(this.drawTriangle(n,s),n=[]);else if(e[0]instanceof Phaser.Point)for(i=0;i<e.length/3;i++)this.drawTriangle([e[3*i],e[3*i+1],e[3*i+2]],s);else for(i=0;i<e.length/6;i++)a.x=e[6*i+0],a.y=e[6*i+1],h.x=e[6*i+2],h.y=e[6*i+3],r.x=e[6*i+4],r.y=e[6*i+5],this.drawTriangle([a,h,r],s)});