var COMPILED=!1,goog=goog||{};goog.global=this,goog.global.CLOSURE_UNCOMPILED_DEFINES,goog.global.CLOSURE_DEFINES,goog.isDef=function(o){return void 0!==o},goog.exportPath_=function(o,t,e){var i,n=o.split("."),s=e||goog.global;n[0]in s||!s.execScript||s.execScript("var "+n[0]);for(;n.length&&(i=n.shift());)!n.length&&goog.isDef(t)?s[i]=t:s=s[i]?s[i]:s[i]={}},goog.define=function(o,t){var e=t;COMPILED||(goog.global.CLOSURE_UNCOMPILED_DEFINES&&Object.prototype.hasOwnProperty.call(goog.global.CLOSURE_UNCOMPILED_DEFINES,o)?e=goog.global.CLOSURE_UNCOMPILED_DEFINES[o]:goog.global.CLOSURE_DEFINES&&Object.prototype.hasOwnProperty.call(goog.global.CLOSURE_DEFINES,o)&&(e=goog.global.CLOSURE_DEFINES[o])),goog.exportPath_(o,e)},goog.DEBUG=!0,goog.define("goog.LOCALE","en"),goog.define("goog.TRUSTED_SITE",!0),goog.define("goog.STRICT_MODE_COMPATIBLE",!1),goog.provide=function(o){if(!COMPILED){if(goog.isProvided_(o))throw Error('Namespace "'+o+'" already declared.');delete goog.implicitNamespaces_[o];for(var t=o;(t=t.substring(0,t.lastIndexOf(".")))&&!goog.getObjectByName(t);)goog.implicitNamespaces_[t]=!0}goog.exportPath_(o)},goog.setTestOnly=function(o){if(COMPILED&&!goog.DEBUG)throw o=o||"",Error("Importing test-only code into non-debug environment"+(o?": "+o:"."))},goog.forwardDeclare=function(o){},COMPILED||(goog.isProvided_=function(o){return!goog.implicitNamespaces_[o]&&goog.isDefAndNotNull(goog.getObjectByName(o))},goog.implicitNamespaces_={}),goog.getObjectByName=function(o,t){for(var e,i=o.split("."),n=t||goog.global;e=i.shift();){if(!goog.isDefAndNotNull(n[e]))return null;n=n[e]}return n},goog.globalize=function(o,t){var e=t||goog.global;for(var i in o)e[i]=o[i]},goog.addDependency=function(o,t,e){if(goog.DEPENDENCIES_ENABLED){for(var i,n,s=o.replace(/\\/g,"/"),r=goog.dependencies_,b=0;i=t[b];b++)(r.nameToPath[i]=s)in r.pathToNames||(r.pathToNames[s]={}),r.pathToNames[s][i]=!0;for(var a=0;n=e[a];a++)s in r.requires||(r.requires[s]={}),r.requires[s][n]=!0}},goog.define("goog.ENABLE_DEBUG_LOADER",!0),goog.require=function(o){if(!COMPILED){if(goog.isProvided_(o))return;if(goog.ENABLE_DEBUG_LOADER){var t=goog.getPathFromDeps_(o);if(t)return goog.included_[t]=!0,void goog.writeScripts_()}var e="goog.require could not find: "+o;throw goog.global.console&&goog.global.console.error(e),Error(e)}},goog.basePath="",goog.global.CLOSURE_BASE_PATH,goog.global.CLOSURE_NO_DEPS,goog.global.CLOSURE_IMPORT_SCRIPT,goog.nullFunction=function(){},goog.identityFunction=function(o,t){return o},goog.abstractMethod=function(){throw Error("unimplemented abstract method")},goog.addSingletonGetter=function(o){o.getInstance=function(){return o.instance_?o.instance_:(goog.DEBUG&&(goog.instantiatedSingletons_[goog.instantiatedSingletons_.length]=o),o.instance_=new o)}},goog.instantiatedSingletons_=[],goog.DEPENDENCIES_ENABLED=!COMPILED&&goog.ENABLE_DEBUG_LOADER,goog.DEPENDENCIES_ENABLED&&(goog.included_={},goog.dependencies_={pathToNames:{},nameToPath:{},requires:{},visited:{},written:{}},goog.inHtmlDocument_=function(){var o=goog.global.document;return void 0!==o&&"write"in o},goog.findBasePath_=function(){if(goog.global.CLOSURE_BASE_PATH)goog.basePath=goog.global.CLOSURE_BASE_PATH;else if(goog.inHtmlDocument_())for(var o=goog.global.document.getElementsByTagName("script"),t=o.length-1;0<=t;--t){var e=o[t].src,i=e.lastIndexOf("?"),n=-1==i?e.length:i;if("base.js"==e.substr(n-7,7))return void(goog.basePath=e.substr(0,n-7))}},goog.importScript_=function(o){var t=goog.global.CLOSURE_IMPORT_SCRIPT||goog.writeScriptTag_;!goog.dependencies_.written[o]&&t(o)&&(goog.dependencies_.written[o]=!0)},goog.writeScriptTag_=function(o){if(goog.inHtmlDocument_()){var t=goog.global.document;if("complete"!=t.readyState)return t.write('<script type="text/javascript" src="'+o+'"><\/script>'),!0;if(/\bdeps.js$/.test(o))return!1;throw Error('Cannot write "'+o+'" after document load')}return!1},goog.writeScripts_=function(){var e=[],i={},n=goog.dependencies_;function s(o){if(!(o in n.written))if(o in n.visited)o in i||(i[o]=!0,e.push(o));else{if(n.visited[o]=!0,o in n.requires)for(var t in n.requires[o])if(!goog.isProvided_(t)){if(!(t in n.nameToPath))throw Error("Undefined nameToPath for "+t);s(n.nameToPath[t])}o in i||(i[o]=!0,e.push(o))}}for(var o in goog.included_)n.written[o]||s(o);for(var t=0;t<e.length;t++){if(!e[t])throw Error("Undefined script input");goog.importScript_(goog.basePath+e[t])}},goog.getPathFromDeps_=function(o){return o in goog.dependencies_.nameToPath?goog.dependencies_.nameToPath[o]:null},goog.findBasePath_()),goog.typeOf=function(o){var t=typeof o;if("object"==t){if(!o)return"null";if(o instanceof Array)return"array";if(o instanceof Object)return t;var e=Object.prototype.toString.call(o);if("[object Window]"==e)return"object";if("[object Array]"==e||"number"==typeof o.length&&void 0!==o.splice&&void 0!==o.propertyIsEnumerable&&!o.propertyIsEnumerable("splice"))return"array";if("[object Function]"==e||void 0!==o.call&&void 0!==o.propertyIsEnumerable&&!o.propertyIsEnumerable("call"))return"function"}else if("function"==t&&void 0===o.call)return"object";return t},goog.isNull=function(o){return null===o},goog.isDefAndNotNull=function(o){return null!=o},goog.isArray=function(o){return"array"==goog.typeOf(o)},goog.isArrayLike=function(o){var t=goog.typeOf(o);return"array"==t||"object"==t&&"number"==typeof o.length},goog.isDateLike=function(o){return goog.isObject(o)&&"function"==typeof o.getFullYear},goog.isString=function(o){return"string"==typeof o},goog.isBoolean=function(o){return"boolean"==typeof o},goog.isNumber=function(o){return"number"==typeof o},goog.isFunction=function(o){return"function"==goog.typeOf(o)},goog.isObject=function(o){var t=typeof o;return"object"==t&&null!=o||"function"==t},goog.getUid=function(o){return o[goog.UID_PROPERTY_]||(o[goog.UID_PROPERTY_]=++goog.uidCounter_)},goog.hasUid=function(o){return!!o[goog.UID_PROPERTY_]},goog.removeUid=function(o){"removeAttribute"in o&&o.removeAttribute(goog.UID_PROPERTY_);try{delete o[goog.UID_PROPERTY_]}catch(o){}},goog.UID_PROPERTY_="closure_uid_"+(1e9*Math.random()>>>0),goog.uidCounter_=0,goog.getHashCode=goog.getUid,goog.removeHashCode=goog.removeUid,goog.cloneObject=function(o){var t=goog.typeOf(o);if("object"!=t&&"array"!=t)return o;if(o.clone)return o.clone();var e="array"==t?[]:{};for(var i in o)e[i]=goog.cloneObject(o[i]);return e},goog.bindNative_=function(o,t,e){return o.call.apply(o.bind,arguments)},goog.bindJs_=function(t,e,o){if(!t)throw new Error;if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var o=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(o,i),t.apply(e,o)}}return function(){return t.apply(e,arguments)}},goog.bind=function(o,t,e){return Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?goog.bind=goog.bindNative_:goog.bind=goog.bindJs_,goog.bind.apply(null,arguments)},goog.partial=function(t,o){var e=Array.prototype.slice.call(arguments,1);return function(){var o=e.slice();return o.push.apply(o,arguments),t.apply(this,o)}},goog.mixin=function(o,t){for(var e in t)o[e]=t[e]},goog.now=goog.TRUSTED_SITE&&Date.now||function(){return+new Date},goog.globalEval=function(o){if(goog.global.execScript)goog.global.execScript(o,"JavaScript");else{if(!goog.global.eval)throw Error("goog.globalEval not available");if(null==goog.evalWorksForGlobals_&&(goog.global.eval("var _et_ = 1;"),void 0!==goog.global._et_?(delete goog.global._et_,goog.evalWorksForGlobals_=!0):goog.evalWorksForGlobals_=!1),goog.evalWorksForGlobals_)goog.global.eval(o);else{var t=goog.global.document,e=t.createElement("script");e.type="text/javascript",e.defer=!1,e.appendChild(t.createTextNode(o)),t.body.appendChild(e),t.body.removeChild(e)}}},goog.evalWorksForGlobals_=null,goog.cssNameMapping_,goog.cssNameMappingStyle_,goog.getCssName=function(o,t){var e,n=function(o){return goog.cssNameMapping_[o]||o};return e=goog.cssNameMapping_?"BY_WHOLE"==goog.cssNameMappingStyle_?n:function(o){for(var t=o.split("-"),e=[],i=0;i<t.length;i++)e.push(n(t[i]));return e.join("-")}:function(o){return o},t?o+"-"+e(t):e(o)},goog.setCssNameMapping=function(o,t){goog.cssNameMapping_=o,goog.cssNameMappingStyle_=t},goog.global.CLOSURE_CSS_NAME_MAPPING,!COMPILED&&goog.global.CLOSURE_CSS_NAME_MAPPING&&(goog.cssNameMapping_=goog.global.CLOSURE_CSS_NAME_MAPPING),goog.getMsg=function(o,e){return e&&(o=o.replace(/\{\$([^}]+)}/g,function(o,t){return t in e?e[t]:o})),o},goog.getMsgWithFallback=function(o,t){return o},goog.exportSymbol=function(o,t,e){goog.exportPath_(o,t,e)},goog.exportProperty=function(o,t,e){o[t]=e},goog.inherits=function(o,n){function t(){}t.prototype=n.prototype,o.superClass_=n.prototype,o.prototype=new t,(o.prototype.constructor=o).base=function(o,t,e){var i=Array.prototype.slice.call(arguments,2);return n.prototype[t].apply(o,i)}},goog.base=function(o,t,e){var i=arguments.callee.caller;if(goog.STRICT_MODE_COMPATIBLE||goog.DEBUG&&!i)throw Error("arguments.caller not defined.  goog.base() cannot be used with strict mode code. See http://www.ecma-international.org/ecma-262/5.1/#sec-C");if(i.superClass_)return i.superClass_.constructor.apply(o,Array.prototype.slice.call(arguments,1));for(var n=Array.prototype.slice.call(arguments,2),s=!1,r=o.constructor;r;r=r.superClass_&&r.superClass_.constructor)if(r.prototype[t]===i)s=!0;else if(s)return r.prototype[t].apply(o,n);if(o[t]===i)return o.constructor.prototype[t].apply(o,n);throw Error("goog.base called from a method of one name to a method of a different name")},goog.scope=function(o){o.call(goog.global)},COMPILED||(goog.global.COMPILED=COMPILED),goog.defineClass=function(o,t){var e=t.constructor,i=t.statics;e&&e!=Object.prototype.constructor||(e=function(){throw Error("cannot instantiate an interface (no constructor defined).")});var n=goog.defineClass.createSealingConstructor_(e,o);return o&&goog.inherits(n,o),delete t.constructor,delete t.statics,goog.defineClass.applyProperties_(n.prototype,t),null!=i&&(i instanceof Function?i(n):goog.defineClass.applyProperties_(n,i)),n},goog.defineClass.ClassDescriptor,goog.define("goog.defineClass.SEAL_CLASS_INSTANCES",goog.DEBUG),goog.defineClass.createSealingConstructor_=function(t,o){if(goog.defineClass.SEAL_CLASS_INSTANCES&&Object.seal instanceof Function){if(o&&o.prototype&&o.prototype[goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_])return t;var e=function(){var o=t.apply(this,arguments)||this;return this.constructor===e&&Object.seal(o),o};return e}return t},goog.defineClass.OBJECT_PROTOTYPE_FIELDS_=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],goog.defineClass.applyProperties_=function(o,t){var e;for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&(o[e]=t[e]);for(var i=0;i<goog.defineClass.OBJECT_PROTOTYPE_FIELDS_.length;i++)e=goog.defineClass.OBJECT_PROTOTYPE_FIELDS_[i],Object.prototype.hasOwnProperty.call(t,e)&&(o[e]=t[e])},goog.tagUnsealableClass=function(o){!COMPILED&&goog.defineClass.SEAL_CLASS_INSTANCES&&(o.prototype[goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_]=!0)},goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_="goog_defineClass_legacy_unsealable",goog.provide("box2d.b2Settings"),Object.defineProperty||(Object.defineProperty=function(o,t,e){Object.__defineGetter__&&("get"in e?o.__defineGetter__(t,e.get):"value"in e&&o.__defineGetter__(t,e.value)),Object.__defineSetter__&&("set"in e?o.__defineSetter__(t,e.set):"value"in e&&o.__defineSetter__(t,e.value))}),box2d.DEBUG=!1,box2d.ENABLE_ASSERTS=box2d.DEBUG,box2d.b2Assert=function(o,t,e){box2d.DEBUG},box2d.b2_maxFloat=1e37,box2d.b2_epsilon=1e-5,box2d.b2_epsilon_sq=box2d.b2_epsilon*box2d.b2_epsilon,box2d.b2_pi=Math.PI,box2d.b2_maxManifoldPoints=2,box2d.b2_maxPolygonVertices=8,box2d.b2_aabbExtension=.1,box2d.b2_aabbMultiplier=2,box2d.b2_linearSlop=.008,box2d.b2_angularSlop=2/180*box2d.b2_pi,box2d.b2_polygonRadius=2*box2d.b2_linearSlop,box2d.b2_maxSubSteps=8,box2d.b2_maxTOIContacts=32,box2d.b2_velocityThreshold=1,box2d.b2_maxLinearCorrection=.2,box2d.b2_maxAngularCorrection=8/180*box2d.b2_pi,box2d.b2_maxTranslation=2,box2d.b2_maxTranslationSquared=box2d.b2_maxTranslation*box2d.b2_maxTranslation,box2d.b2_maxRotation=.5*box2d.b2_pi,box2d.b2_maxRotationSquared=box2d.b2_maxRotation*box2d.b2_maxRotation,box2d.b2_baumgarte=.2,box2d.b2_toiBaumgarte=.75,box2d.b2_timeToSleep=.5,box2d.b2_linearSleepTolerance=.01,box2d.b2_angularSleepTolerance=2/180*box2d.b2_pi,box2d.b2Alloc=function(o){return null},box2d.b2Free=function(o){},box2d.b2Log=function(o){goog.global.console.log.apply(null,arguments)},box2d.b2Version=function(o,t,e){this.major=o||0,this.minor=t||0,this.revision=e||0},box2d.b2Version.prototype.major=0,box2d.b2Version.prototype.minor=0,box2d.b2Version.prototype.revision=0,box2d.b2Version.prototype.toString=function(){return this.major+"."+this.minor+"."+this.revision},box2d.b2_version=new box2d.b2Version(2,3,0),box2d.b2_changelist=278,box2d.b2ParseInt=function(o){return parseInt(o,10)},box2d.b2ParseUInt=function(o){return box2d.b2Abs(parseInt(o,10))},box2d.b2MakeArray=function(o,t){void 0===o&&(o=0);var e=new Array(o);if(void 0!==t)for(var i=0;i<o;++i)e[i]=t(i);return e},box2d.b2MakeNumberArray=function(o){return box2d.b2MakeArray(o,function(o){return 0})},goog.provide("box2d.b2Math"),goog.require("box2d.b2Settings"),box2d.b2_pi_over_180=box2d.b2_pi/180,box2d.b2_180_over_pi=180/box2d.b2_pi,box2d.b2_two_pi=2*box2d.b2_pi,box2d.b2Abs=function(o){return o<0?-o:o},box2d.b2Min=function(o,t){return o<t?o:t},box2d.b2Max=function(o,t){return t<o?o:t},box2d.b2Clamp=function(o,t,e){return o<t?t:e<o?e:o},box2d.b2Swap=function(o,t){box2d.ENABLE_ASSERTS&&box2d.b2Assert(!1);var e=o[0];o[0]=t[0],t[0]=e},box2d.b2IsValid=function(o){return isFinite(o)},box2d.b2Sq=function(o){return o*o},box2d.b2InvSqrt=function(o){return 1/Math.sqrt(o)},box2d.b2Sqrt=function(o){return Math.sqrt(o)},box2d.b2Pow=function(o,t){return Math.pow(o,t)},box2d.b2DegToRad=function(o){return o*box2d.b2_pi_over_180},box2d.b2RadToDeg=function(o){return o*box2d.b2_180_over_pi},box2d.b2Cos=function(o){return Math.cos(o)},box2d.b2Sin=function(o){return Math.sin(o)},box2d.b2Acos=function(o){return Math.acos(o)},box2d.b2Asin=function(o){return Math.asin(o)},box2d.b2Atan2=function(o,t){return Math.atan2(o,t)},box2d.b2NextPowerOfTwo=function(o){return o|=o>>1&2147483647,o|=o>>2&1073741823,o|=o>>4&268435455,o|=o>>8&16777215,(o|=o>>16&65535)+1},box2d.b2IsPowerOfTwo=function(o){return 0<o&&0==(o&o-1)},box2d.b2Random=function(){return 2*Math.random()-1},box2d.b2RandomRange=function(o,t){return(t-o)*Math.random()+o},box2d.b2Vec2=function(o,t){this.x=o||0,this.y=t||0},box2d.b2Vec2.prototype.x=0,box2d.b2Vec2.prototype.y=0,box2d.b2Vec2_zero=new box2d.b2Vec2,box2d.b2Vec2.ZERO=new box2d.b2Vec2,box2d.b2Vec2.UNITX=new box2d.b2Vec2(1,0),box2d.b2Vec2.UNITY=new box2d.b2Vec2(0,1),box2d.b2Vec2.s_t0=new box2d.b2Vec2,box2d.b2Vec2.s_t1=new box2d.b2Vec2,box2d.b2Vec2.s_t2=new box2d.b2Vec2,box2d.b2Vec2.s_t3=new box2d.b2Vec2,box2d.b2Vec2.MakeArray=function(o){return box2d.b2MakeArray(o,function(o){return new box2d.b2Vec2})},box2d.b2Vec2.prototype.Clone=function(){return new box2d.b2Vec2(this.x,this.y)},box2d.b2Vec2.prototype.SetZero=function(){return this.x=0,this.y=0,this},box2d.b2Vec2.prototype.SetXY=function(o,t){return this.x=o,this.y=t,this},box2d.b2Vec2.prototype.Copy=function(o){return this.x=o.x,this.y=o.y,this},box2d.b2Vec2.prototype.SelfAdd=function(o){return this.x+=o.x,this.y+=o.y,this},box2d.b2Vec2.prototype.SelfAddXY=function(o,t){return this.x+=o,this.y+=t,this},box2d.b2Vec2.prototype.SelfSub=function(o){return this.x-=o.x,this.y-=o.y,this},box2d.b2Vec2.prototype.SelfSubXY=function(o,t){return this.x-=o,this.y-=t,this},box2d.b2Vec2.prototype.SelfMul=function(o){return this.x*=o,this.y*=o,this},box2d.b2Vec2.prototype.SelfMulAdd=function(o,t){return this.x+=o*t.x,this.y+=o*t.y,this},box2d.b2Vec2.prototype.SelfMulSub=function(o,t){return this.x-=o*t.x,this.y-=o*t.y,this},box2d.b2Vec2.prototype.Dot=function(o){return this.x*o.x+this.y*o.y},box2d.b2Vec2.prototype.Cross=function(o){return this.x*o.y-this.y*o.x},box2d.b2Vec2.prototype.Length=function(){var o=this.x,t=this.y;return Math.sqrt(o*o+t*t)},box2d.b2Vec2.prototype.GetLength=box2d.b2Vec2.prototype.Length,box2d.b2Vec2.prototype.LengthSquared=function(){var o=this.x,t=this.y;return o*o+t*t},box2d.b2Vec2.prototype.GetLengthSquared=box2d.b2Vec2.prototype.LengthSquared,box2d.b2Vec2.prototype.Normalize=function(){var o=this.GetLength();if(o>=box2d.b2_epsilon){var t=1/o;this.x*=t,this.y*=t}return o},box2d.b2Vec2.prototype.SelfNormalize=function(){var o=this.GetLength();if(o>=box2d.b2_epsilon){var t=1/o;this.x*=t,this.y*=t}return this},box2d.b2Vec2.prototype.SelfRotate=function(o,t){var e=this.x,i=this.y;return this.x=o*e-t*i,this.y=t*e+o*i,this},box2d.b2Vec2.prototype.SelfRotateRadians=function(o){return this.SelfRotate(Math.cos(o),Math.sin(o))},box2d.b2Vec2.prototype.SelfRotateDegrees=function(o){return this.SelfRotateRadians(box2d.b2DegToRad(o))},box2d.b2Vec2.prototype.IsValid=function(){return isFinite(this.x)&&isFinite(this.y)},box2d.b2Vec2.prototype.SelfCrossVS=function(o){var t=this.x;return this.x=o*this.y,this.y=-o*t,this},box2d.b2Vec2.prototype.SelfCrossSV=function(o){var t=this.x;return this.x=-o*this.y,this.y=o*t,this},box2d.b2Vec2.prototype.SelfMinV=function(o){return this.x=box2d.b2Min(this.x,o.x),this.y=box2d.b2Min(this.y,o.y),this},box2d.b2Vec2.prototype.SelfMaxV=function(o){return this.x=box2d.b2Max(this.x,o.x),this.y=box2d.b2Max(this.y,o.y),this},box2d.b2Vec2.prototype.SelfAbs=function(){return this.x=box2d.b2Abs(this.x),this.y=box2d.b2Abs(this.y),this},box2d.b2Vec2.prototype.SelfNeg=function(){return this.x=-this.x,this.y=-this.y,this},box2d.b2Vec2.prototype.SelfSkew=function(){var o=this.x;return this.x=-this.y,this.y=o,this},box2d.b2AbsV=function(o,t){return t.x=box2d.b2Abs(o.x),t.y=box2d.b2Abs(o.y),t},box2d.b2MinV=function(o,t,e){return e.x=box2d.b2Min(o.x,t.x),e.y=box2d.b2Min(o.y,t.y),e},box2d.b2MaxV=function(o,t,e){return e.x=box2d.b2Max(o.x,t.x),e.y=box2d.b2Max(o.y,t.y),e},box2d.b2ClampV=function(o,t,e,i){return i.x=box2d.b2Clamp(o.x,t.x,e.x),i.y=box2d.b2Clamp(o.y,t.y,e.y),i},box2d.b2RotateV=function(o,t,e,i){var n=o.x,s=o.y;return i.x=t*n-e*s,i.y=e*n+t*s,i},box2d.b2RotateRadiansV=function(o,t,e){return box2d.b2RotateV(o,Math.cos(t),Math.sin(t),e)},box2d.b2RotateDegreesV=function(o,t,e){return box2d.b2RotateRadiansV(o,box2d.b2DegToRad(t),e)},box2d.b2DotVV=function(o,t){return o.x*t.x+o.y*t.y},box2d.b2CrossVV=function(o,t){return o.x*t.y-o.y*t.x},box2d.b2CrossVS=function(o,t,e){var i=o.x;return e.x=t*o.y,e.y=-t*i,e},box2d.b2CrossVOne=function(o,t){var e=o.x;return t.x=o.y,t.y=-e,t},box2d.b2CrossSV=function(o,t,e){var i=t.x;return e.x=-o*t.y,e.y=o*i,e},box2d.b2CrossOneV=function(o,t){var e=o.x;return t.x=-o.y,t.y=e,t},box2d.b2AddVV=function(o,t,e){return e.x=o.x+t.x,e.y=o.y+t.y,e},box2d.b2SubVV=function(o,t,e){return e.x=o.x-t.x,e.y=o.y-t.y,e},box2d.b2MulSV=function(o,t,e){return e.x=t.x*o,e.y=t.y*o,e},box2d.b2AddVMulSV=function(o,t,e,i){return i.x=o.x+t*e.x,i.y=o.y+t*e.y,i},box2d.b2SubVMulSV=function(o,t,e,i){return i.x=o.x-t*e.x,i.y=o.y-t*e.y,i},box2d.b2AddVCrossSV=function(o,t,e,i){var n=e.x;return i.x=o.x-t*e.y,i.y=o.y+t*n,i},box2d.b2MidVV=function(o,t,e){return e.x=.5*(o.x+t.x),e.y=.5*(o.y+t.y),e},box2d.b2ExtVV=function(o,t,e){return e.x=.5*(t.x-o.x),e.y=.5*(t.y-o.y),e},box2d.b2IsEqualToV=function(o,t){return o.x===t.x&&o.y===t.y},box2d.b2DistanceVV=function(o,t){var e=o.x-t.x,i=o.y-t.y;return Math.sqrt(e*e+i*i)},box2d.b2DistanceSquaredVV=function(o,t){var e=o.x-t.x,i=o.y-t.y;return e*e+i*i},box2d.b2NegV=function(o,t){return t.x=-o.x,t.y=-o.y,t},box2d.b2Vec3=function(o,t,e){this.x=o||0,this.y=t||0,this.z=e||0},box2d.b2Vec3.prototype.x=0,box2d.b2Vec3.prototype.y=0,box2d.b2Vec3.prototype.z=0,box2d.b2Vec3.ZERO=new box2d.b2Vec3,box2d.b2Vec3.s_t0=new box2d.b2Vec3,box2d.b2Vec3.prototype.Clone=function(){return new box2d.b2Vec3(this.x,this.y,this.z)},box2d.b2Vec3.prototype.SetZero=function(){return this.x=0,this.y=0,this.z=0,this},box2d.b2Vec3.prototype.SetXYZ=function(o,t,e){return this.x=o,this.y=t,this.z=e,this},box2d.b2Vec3.prototype.Copy=function(o){return this.x=o.x,this.y=o.y,this.z=o.z,this},box2d.b2Vec3.prototype.SelfNeg=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},box2d.b2Vec3.prototype.SelfAdd=function(o){return this.x+=o.x,this.y+=o.y,this.z+=o.z,this},box2d.b2Vec3.prototype.SelfAddXYZ=function(o,t,e){return this.x+=o,this.y+=t,this.z+=e,this},box2d.b2Vec3.prototype.SelfSub=function(o){return this.x-=o.x,this.y-=o.y,this.z-=o.z,this},box2d.b2Vec3.prototype.SelfSubXYZ=function(o,t,e){return this.x-=o,this.y-=t,this.z-=e,this},box2d.b2Vec3.prototype.SelfMul=function(o){return this.x*=o,this.y*=o,this.z*=o,this},box2d.b2DotV3V3=function(o,t){return o.x*t.x+o.y*t.y+o.z*t.z},box2d.b2CrossV3V3=function(o,t,e){var i=o.x,n=o.y,s=o.z,r=t.x,b=t.y,a=t.z;return e.x=n*a-s*b,e.y=s*r-i*a,e.z=i*b-n*r,e},box2d.b2Mat22=function(){this.ex=new box2d.b2Vec2(1,0),this.ey=new box2d.b2Vec2(0,1)},box2d.b2Mat22.prototype.ex=null,box2d.b2Mat22.prototype.ey=null,box2d.b2Mat22.IDENTITY=new box2d.b2Mat22,box2d.b2Mat22.prototype.Clone=function(){return(new box2d.b2Mat22).Copy(this)},box2d.b2Mat22.FromVV=function(o,t){return(new box2d.b2Mat22).SetVV(o,t)},box2d.b2Mat22.FromSSSS=function(o,t,e,i){return(new box2d.b2Mat22).SetSSSS(o,t,e,i)},box2d.b2Mat22.FromAngleRadians=function(o){return(new box2d.b2Mat22).SetAngleRadians(o)},box2d.b2Mat22.prototype.SetSSSS=function(o,t,e,i){return this.ex.SetXY(o,e),this.ey.SetXY(t,i),this},box2d.b2Mat22.prototype.SetVV=function(o,t){return this.ex.Copy(o),this.ey.Copy(t),this},box2d.b2Mat22.prototype.SetAngle=function(o){var t=Math.cos(o),e=Math.sin(o);return this.ex.SetXY(t,e),this.ey.SetXY(-e,t),this},box2d.b2Mat22.prototype.SetAngleRadians=box2d.b2Mat22.prototype.SetAngle,box2d.b2Mat22.prototype.SetAngleDegrees=function(o){return this.SetAngle(box2d.b2DegToRad(o))},box2d.b2Mat22.prototype.Copy=function(o){return this.ex.Copy(o.ex),this.ey.Copy(o.ey),this},box2d.b2Mat22.prototype.SetIdentity=function(){return this.ex.SetXY(1,0),this.ey.SetXY(0,1),this},box2d.b2Mat22.prototype.SetZero=function(){return this.ex.SetZero(),this.ey.SetZero(),this},box2d.b2Mat22.prototype.GetAngle=function(){return Math.atan2(this.ex.y,this.ex.x)},box2d.b2Mat22.prototype.GetAngleRadians=box2d.b2Mat22.prototype.GetAngle,box2d.b2Mat22.prototype.GetInverse=function(o){var t=this.ex.x,e=this.ey.x,i=this.ex.y,n=this.ey.y,s=t*n-e*i;return 0!==s&&(s=1/s),o.ex.x=s*n,o.ey.x=-s*e,o.ex.y=-s*i,o.ey.y=s*t,o},box2d.b2Mat22.prototype.Solve=function(o,t,e){var i=this.ex.x,n=this.ey.x,s=this.ex.y,r=this.ey.y,b=i*r-n*s;return 0!==b&&(b=1/b),e.x=b*(r*o-n*t),e.y=b*(i*t-s*o),e},box2d.b2Mat22.prototype.SelfAbs=function(){return this.ex.SelfAbs(),this.ey.SelfAbs(),this},box2d.b2Mat22.prototype.SelfInv=function(){return this.GetInverse(this)},box2d.b2Mat22.prototype.SelfAddM=function(o){return this.ex.SelfAdd(o.ex),this.ey.SelfAdd(o.ey),this},box2d.b2Mat22.prototype.SelfSubM=function(o){return this.ex.SelfSub(o.ex),this.ey.SelfSub(o.ey),this},box2d.b2AbsM=function(o,t){var e=o.ex,i=o.ey;return t.ex.x=box2d.b2Abs(e.x),t.ex.y=box2d.b2Abs(e.y),t.ey.x=box2d.b2Abs(i.x),t.ey.y=box2d.b2Abs(i.y),t},box2d.b2MulMV=function(o,t,e){var i=o.ex,n=o.ey,s=t.x,r=t.y;return e.x=i.x*s+n.x*r,e.y=i.y*s+n.y*r,e},box2d.b2MulTMV=function(o,t,e){var i=o.ex,n=o.ey,s=t.x,r=t.y;return e.x=i.x*s+i.y*r,e.y=n.x*s+n.y*r,e},box2d.b2AddMM=function(o,t,e){var i=o.ex,n=o.ey,s=t.ex,r=t.ey;return e.ex.x=i.x+s.x,e.ex.y=i.y+s.y,e.ey.x=n.x+r.x,e.ey.y=n.y+r.y,e},box2d.b2MulMM=function(o,t,e){var i=o.ex.x,n=o.ex.y,s=o.ey.x,r=o.ey.y,b=t.ex.x,a=t.ex.y,d=t.ey.x,l=t.ey.y;return e.ex.x=i*b+s*a,e.ex.y=n*b+r*a,e.ey.x=i*d+s*l,e.ey.y=n*d+r*l,e},box2d.b2MulTMM=function(o,t,e){var i=o.ex.x,n=o.ex.y,s=o.ey.x,r=o.ey.y,b=t.ex.x,a=t.ex.y,d=t.ey.x,l=t.ey.y;return e.ex.x=i*b+n*a,e.ex.y=s*b+r*a,e.ey.x=i*d+n*l,e.ey.y=s*d+r*l,e},box2d.b2Mat33=function(){this.ex=new box2d.b2Vec3(1,0,0),this.ey=new box2d.b2Vec3(0,1,0),this.ez=new box2d.b2Vec3(0,0,1)},box2d.b2Mat33.prototype.ex=null,box2d.b2Mat33.prototype.ey=null,box2d.b2Mat33.prototype.ez=null,box2d.b2Mat33.IDENTITY=new box2d.b2Mat33,box2d.b2Mat33.prototype.Clone=function(){return(new box2d.b2Mat33).Copy(this)},box2d.b2Mat33.prototype.SetVVV=function(o,t,e){return this.ex.Copy(o),this.ey.Copy(t),this.ez.Copy(e),this},box2d.b2Mat33.prototype.Copy=function(o){return this.ex.Copy(o.ex),this.ey.Copy(o.ey),this.ez.Copy(o.ez),this},box2d.b2Mat33.prototype.SetIdentity=function(){return this.ex.SetXYZ(1,0,0),this.ey.SetXYZ(0,1,0),this.ez.SetXYZ(0,0,1),this},box2d.b2Mat33.prototype.SetZero=function(){return this.ex.SetZero(),this.ey.SetZero(),this.ez.SetZero(),this},box2d.b2Mat33.prototype.SelfAddM=function(o){return this.ex.SelfAdd(o.ex),this.ey.SelfAdd(o.ey),this.ez.SelfAdd(o.ez),this},box2d.b2Mat33.prototype.Solve33=function(o,t,e,i){var n=this.ex.x,s=this.ex.y,r=this.ex.z,b=this.ey.x,a=this.ey.y,d=this.ey.z,l=this.ez.x,x=this.ez.y,p=this.ez.z,m=n*(a*p-d*x)+s*(d*l-b*p)+r*(b*x-a*l);return 0!==m&&(m=1/m),i.x=m*(o*(a*p-d*x)+t*(d*l-b*p)+e*(b*x-a*l)),i.y=m*(n*(t*p-e*x)+s*(e*l-o*p)+r*(o*x-t*l)),i.z=m*(n*(a*e-d*t)+s*(d*o-b*e)+r*(b*t-a*o)),i},box2d.b2Mat33.prototype.Solve22=function(o,t,e){var i=this.ex.x,n=this.ey.x,s=this.ex.y,r=this.ey.y,b=i*r-n*s;return 0!==b&&(b=1/b),e.x=b*(r*o-n*t),e.y=b*(i*t-s*o),e},box2d.b2Mat33.prototype.GetInverse22=function(o){var t=this.ex.x,e=this.ey.x,i=this.ex.y,n=this.ey.y,s=t*n-e*i;0!==s&&(s=1/s),o.ex.x=s*n,o.ey.x=-s*e,o.ex.z=0,o.ex.y=-s*i,o.ey.y=s*t,o.ey.z=0,o.ez.x=0,o.ez.y=0,o.ez.z=0},box2d.b2Mat33.prototype.GetSymInverse33=function(o){var t=box2d.b2DotV3V3(this.ex,box2d.b2CrossV3V3(this.ey,this.ez,box2d.b2Vec3.s_t0));0!==t&&(t=1/t);var e=this.ex.x,i=this.ey.x,n=this.ez.x,s=this.ey.y,r=this.ez.y,b=this.ez.z;o.ex.x=t*(s*b-r*r),o.ex.y=t*(n*r-i*b),o.ex.z=t*(i*r-n*s),o.ey.x=o.ex.y,o.ey.y=t*(e*b-n*n),o.ey.z=t*(n*i-e*r),o.ez.x=o.ex.z,o.ez.y=o.ey.z,o.ez.z=t*(e*s-i*i)},box2d.b2MulM33V3=function(o,t,e){var i=t.x,n=t.y,s=t.z;return e.x=o.ex.x*i+o.ey.x*n+o.ez.x*s,e.y=o.ex.y*i+o.ey.y*n+o.ez.y*s,e.z=o.ex.z*i+o.ey.z*n+o.ez.z*s,e},box2d.b2MulM33XYZ=function(o,t,e,i,n){return n.x=o.ex.x*t+o.ey.x*e+o.ez.x*i,n.y=o.ex.y*t+o.ey.y*e+o.ez.y*i,n.z=o.ex.z*t+o.ey.z*e+o.ez.z*i,n},box2d.b2MulM33V2=function(o,t,e){var i=t.x,n=t.y;return e.x=o.ex.x*i+o.ey.x*n,e.y=o.ex.y*i+o.ey.y*n,e},box2d.b2MulM33XY=function(o,t,e,i){return i.x=o.ex.x*t+o.ey.x*e,i.y=o.ex.y*t+o.ey.y*e,i},box2d.b2Rot=function(o){o&&(this.angle=o,this.s=Math.sin(o),this.c=Math.cos(o))},box2d.b2Rot.prototype.angle=0,box2d.b2Rot.prototype.s=0,box2d.b2Rot.prototype.c=1,box2d.b2Rot.IDENTITY=new box2d.b2Rot,box2d.b2Rot.prototype.Clone=function(){return(new box2d.b2Rot).Copy(this)},box2d.b2Rot.prototype.Copy=function(o){return this.angle=o.angle,this.s=o.s,this.c=o.c,this},box2d.b2Rot.prototype.SetAngle=function(o){return this.angle!==o&&(this.angle=o,this.s=Math.sin(o),this.c=Math.cos(o)),this},box2d.b2Rot.prototype.SetAngleRadians=box2d.b2Rot.prototype.SetAngle,box2d.b2Rot.prototype.SetAngleDegrees=function(o){return this.SetAngle(box2d.b2DegToRad(o))},box2d.b2Rot.prototype.SetIdentity=function(){return this.angle=0,this.s=0,this.c=1,this},box2d.b2Rot.prototype.GetAngle=function(){return this.angle},box2d.b2Rot.prototype.GetAngleRadians=box2d.b2Rot.prototype.GetAngle,box2d.b2Rot.prototype.GetAngleDegrees=function(){return box2d.b2RadToDeg(this.GetAngle())},box2d.b2Rot.prototype.GetXAxis=function(o){return o.x=this.c,o.y=this.s,o},box2d.b2Rot.prototype.GetYAxis=function(o){return o.x=-this.s,o.y=this.c,o},box2d.b2MulRR=function(o,t,e){var i=o.c,n=o.s,s=t.c,r=t.s;for(e.s=n*s+i*r,e.c=i*s-n*r,e.angle=o.angle+t.angle;e.angle<-box2d.b2_pi;)e.angle+=box2d.b2_two_pi;for(;e.angle>=box2d.b2_pi;)e.angle-=box2d.b2_two_pi;return e},box2d.b2MulTRR=function(o,t,e){var i=o.c,n=o.s,s=t.c,r=t.s;for(e.s=i*r-n*s,e.c=i*s+n*r,e.angle=o.angle-t.angle;e.angle<-box2d.b2_pi;)e.angle+=box2d.b2_two_pi;for(;e.angle>=box2d.b2_pi;)e.angle-=box2d.b2_two_pi;return e},box2d.b2MulRV=function(o,t,e){var i=o.c,n=o.s,s=t.x,r=t.y;return e.x=i*s-n*r,e.y=n*s+i*r,e},box2d.b2MulTRV=function(o,t,e){var i=o.c,n=o.s,s=t.x,r=t.y;return e.x=i*s+n*r,e.y=-n*s+i*r,e},box2d.b2Transform=function(){this.p=new box2d.b2Vec2,this.q=new box2d.b2Rot},box2d.b2Transform.prototype.p=null,box2d.b2Transform.prototype.q=null,box2d.b2Transform.IDENTITY=new box2d.b2Transform,box2d.b2Transform.prototype.Clone=function(){return(new box2d.b2Transform).Copy(this)},box2d.b2Transform.prototype.Copy=function(o){return this.p.Copy(o.p),this.q.Copy(o.q),this},box2d.b2Transform.prototype.SetIdentity=function(){return this.p.SetZero(),this.q.SetIdentity(),this},box2d.b2Transform.prototype.SetPositionRotation=function(o,t){return this.p.Copy(o),this.q.Copy(t),this},box2d.b2Transform.prototype.SetPositionAngleRadians=function(o,t){return this.p.Copy(o),this.q.SetAngleRadians(t),this},box2d.b2Transform.prototype.SetPosition=function(o){return this.p.Copy(o),this},box2d.b2Transform.prototype.SetPositionXY=function(o,t){return this.p.SetXY(o,t),this},box2d.b2Transform.prototype.SetRotation=function(o){return this.q.Copy(o),this},box2d.b2Transform.prototype.SetRotationAngleRadians=function(o){return this.q.SetAngleRadians(o),this},box2d.b2Transform.prototype.GetPosition=function(){return this.p},box2d.b2Transform.prototype.GetRotation=function(){return this.q},box2d.b2Transform.prototype.GetRotationAngle=function(){return this.q.GetAngle()},box2d.b2Transform.prototype.GetRotationAngleRadians=box2d.b2Transform.prototype.GetRotationAngle,box2d.b2Transform.prototype.GetAngle=function(){return this.q.GetAngle()},box2d.b2Transform.prototype.GetAngleRadians=box2d.b2Transform.prototype.GetAngle,box2d.b2MulXV=function(o,t,e){var i=o.q.c,n=o.q.s,s=t.x,r=t.y;return e.x=i*s-n*r+o.p.x,e.y=n*s+i*r+o.p.y,e},box2d.b2MulTXV=function(o,t,e){var i=o.q.c,n=o.q.s,s=t.x-o.p.x,r=t.y-o.p.y;return e.x=i*s+n*r,e.y=-n*s+i*r,e},box2d.b2MulXX=function(o,t,e){return box2d.b2MulRR(o.q,t.q,e.q),box2d.b2AddVV(box2d.b2MulRV(o.q,t.p,e.p),o.p,e.p),e},box2d.b2MulTXX=function(o,t,e){return box2d.b2MulTRR(o.q,t.q,e.q),box2d.b2MulTRV(o.q,box2d.b2SubVV(t.p,o.p,e.p),e.p),e},box2d.b2Sweep=function(){this.localCenter=new box2d.b2Vec2,this.c0=new box2d.b2Vec2,this.c=new box2d.b2Vec2},box2d.b2Sweep.prototype.localCenter=null,box2d.b2Sweep.prototype.c0=null,box2d.b2Sweep.prototype.c=null,box2d.b2Sweep.prototype.a0=0,box2d.b2Sweep.prototype.a=0,box2d.b2Sweep.prototype.alpha0=0,box2d.b2Sweep.prototype.Clone=function(){return(new box2d.b2Sweep).Copy(this)},box2d.b2Sweep.prototype.Copy=function(o){return this.localCenter.Copy(o.localCenter),this.c0.Copy(o.c0),this.c.Copy(o.c),this.a0=o.a0,this.a=o.a,this.alpha0=o.alpha0,this},box2d.b2Sweep.prototype.GetTransform=function(o,t){var e=1-t;o.p.x=e*this.c0.x+t*this.c.x,o.p.y=e*this.c0.y+t*this.c.y;var i=e*this.a0+t*this.a;return o.q.SetAngleRadians(i),o.p.SelfSub(box2d.b2MulRV(o.q,this.localCenter,box2d.b2Vec2.s_t0)),o},box2d.b2Sweep.prototype.Advance=function(o){box2d.ENABLE_ASSERTS&&box2d.b2Assert(this.alpha0<1);var t=(o-this.alpha0)/(1-this.alpha0);this.c0.x+=t*(this.c.x-this.c0.x),this.c0.y+=t*(this.c.y-this.c0.y),this.a0+=t*(this.a-this.a0),this.alpha0=o},box2d.b2Sweep.prototype.Normalize=function(){var o=box2d.b2_two_pi*Math.floor(this.a0/box2d.b2_two_pi);this.a0-=o,this.a-=o},goog.provide("box2d.b2Controller"),goog.require("box2d.b2Settings"),box2d.b2ControllerEdge=function(){},box2d.b2ControllerEdge.prototype.controller=null,box2d.b2ControllerEdge.prototype.body=null,box2d.b2ControllerEdge.prototype.prevBody=null,box2d.b2ControllerEdge.prototype.nextBody=null,box2d.b2ControllerEdge.prototype.prevController=null,box2d.b2ControllerEdge.prototype.nextController=null,box2d.b2Controller=function(){},box2d.b2Controller.prototype.m_world=null,box2d.b2Controller.prototype.m_bodyList=null,box2d.b2Controller.prototype.m_bodyCount=0,box2d.b2Controller.prototype.m_prev=null,box2d.b2Controller.prototype.m_next=null,box2d.b2Controller.prototype.Step=function(o){},box2d.b2Controller.prototype.Draw=function(o){},box2d.b2Controller.prototype.GetNext=function(){return this.m_next},box2d.b2Controller.prototype.GetPrev=function(){return this.m_prev},box2d.b2Controller.prototype.GetWorld=function(){return this.m_world},box2d.b2Controller.prototype.GetBodyList=function(){return this.m_bodyList},box2d.b2Controller.prototype.AddBody=function(o){var t=new box2d.b2ControllerEdge;t.body=o,t.controller=this,t.nextBody=this.m_bodyList,t.prevBody=null,this.m_bodyList&&(this.m_bodyList.prevBody=t),this.m_bodyList=t,++this.m_bodyCount,t.nextController=o.m_controllerList,t.prevController=null,o.m_controllerList&&(o.m_controllerList.prevController=t),o.m_controllerList=t,++o.m_controllerCount},box2d.b2Controller.prototype.RemoveBody=function(o){box2d.ENABLE_ASSERTS&&box2d.b2Assert(0<this.m_bodyCount);for(var t=this.m_bodyList;t&&t.body!==o;)t=t.nextBody;box2d.ENABLE_ASSERTS&&box2d.b2Assert(null!==t),t.prevBody&&(t.prevBody.nextBody=t.nextBody),t.nextBody&&(t.nextBody.prevBody=t.prevBody),this.m_bodyList===t&&(this.m_bodyList=t.nextBody),--this.m_bodyCount,t.nextController&&(t.nextController.prevController=t.prevController),t.prevController&&(t.prevController.nextController=t.nextController),o.m_controllerList===t&&(o.m_controllerList=t.nextController),--o.m_controllerCount},box2d.b2Controller.prototype.Clear=function(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body);this.m_bodyCount=0},goog.provide("box2d.b2ConstantAccelController"),goog.require("box2d.b2Settings"),goog.require("box2d.b2Controller"),goog.require("box2d.b2Math"),box2d.b2ConstantAccelController=function(){goog.base(this),this.A=new box2d.b2Vec2(0,0)},goog.inherits(box2d.b2ConstantAccelController,box2d.b2Controller),box2d.b2ConstantAccelController.prototype.A=null,box2d.b2ConstantAccelController.prototype.Step=function(o){for(var t=box2d.b2MulSV(o.dt,this.A,box2d.b2ConstantAccelController.prototype.Step.s_dtA),e=this.m_bodyList;e;e=e.nextBody){var i=e.body;i.IsAwake()&&i.SetLinearVelocity(box2d.b2AddVV(i.GetLinearVelocity(),t,box2d.b2Vec2.s_t0))}},box2d.b2ConstantAccelController.prototype.Step.s_dtA=new box2d.b2Vec2,goog.provide("box2d.b2Joint"),goog.require("box2d.b2Settings"),goog.require("box2d.b2Math"),box2d.b2JointType={e_unknownJoint:0,e_revoluteJoint:1,e_prismaticJoint:2,e_distanceJoint:3,e_pulleyJoint:4,e_mouseJoint:5,e_gearJoint:6,e_wheelJoint:7,e_weldJoint:8,e_frictionJoint:9,e_ropeJoint:10,e_motorJoint:11,e_areaJoint:12},goog.exportProperty(box2d.b2JointType,"e_unknownJoint",box2d.b2JointType.e_unknownJoint),goog.exportProperty(box2d.b2JointType,"e_revoluteJoint",box2d.b2JointType.e_revoluteJoint),goog.exportProperty(box2d.b2JointType,"e_prismaticJoint",box2d.b2JointType.e_prismaticJoint),goog.exportProperty(box2d.b2JointType,"e_distanceJoint",box2d.b2JointType.e_distanceJoint),goog.exportProperty(box2d.b2JointType,"e_pulleyJoint",box2d.b2JointType.e_pulleyJoint),goog.exportProperty(box2d.b2JointType,"e_mouseJoint",box2d.b2JointType.e_mouseJoint),goog.exportProperty(box2d.b2JointType,"e_gearJoint",box2d.b2JointType.e_gearJoint),goog.exportProperty(box2d.b2JointType,"e_wheelJoint",box2d.b2JointType.e_wheelJoint),goog.exportProperty(box2d.b2JointType,"e_weldJoint",box2d.b2JointType.e_weldJoint),goog.exportProperty(box2d.b2JointType,"e_frictionJoint",box2d.b2JointType.e_frictionJoint),goog.exportProperty(box2d.b2JointType,"e_ropeJoint",box2d.b2JointType.e_ropeJoint),goog.exportProperty(box2d.b2JointType,"e_motorJoint",box2d.b2JointType.e_motorJoint),goog.exportProperty(box2d.b2JointType,"e_areaJoint",box2d.b2JointType.e_areaJoint),box2d.b2LimitState={e_inactiveLimit:0,e_atLowerLimit:1,e_atUpperLimit:2,e_equalLimits:3},goog.exportProperty(box2d.b2LimitState,"e_inactiveLimit",box2d.b2LimitState.e_inactiveLimit),goog.exportProperty(box2d.b2LimitState,"e_atLowerLimit",box2d.b2LimitState.e_atLowerLimit),goog.exportProperty(box2d.b2LimitState,"e_atUpperLimit",box2d.b2LimitState.e_atUpperLimit),goog.exportProperty(box2d.b2LimitState,"e_equalLimits",box2d.b2LimitState.e_equalLimits),box2d.b2Jacobian=function(){this.linear=new box2d.b2Vec2},box2d.b2Jacobian.prototype.linear=null,box2d.b2Jacobian.prototype.angularA=0,box2d.b2Jacobian.prototype.angularB=0,box2d.b2Jacobian.prototype.SetZero=function(){return this.linear.SetZero(),this.angularA=0,this.angularB=0,this},box2d.b2Jacobian.prototype.Set=function(o,t,e){return this.linear.Copy(o),this.angularA=t,this.angularB=e,this},box2d.b2JointEdge=function(){},box2d.b2JointEdge.prototype.other=null,box2d.b2JointEdge.prototype.joint=null,box2d.b2JointEdge.prototype.prev=null,box2d.b2JointEdge.prototype.next=null,box2d.b2JointDef=function(o){this.type=o},box2d.b2JointDef.prototype.type=box2d.b2JointType.e_unknownJoint,box2d.b2JointDef.prototype.userData=null,box2d.b2JointDef.prototype.bodyA=null,box2d.b2JointDef.prototype.bodyB=null,box2d.b2JointDef.prototype.collideConnected=!1,box2d.b2Joint=function(o){box2d.ENABLE_ASSERTS&&box2d.b2Assert(o.bodyA!==o.bodyB),this.m_type=o.type,this.m_edgeA=new box2d.b2JointEdge,this.m_edgeB=new box2d.b2JointEdge,this.m_bodyA=o.bodyA,this.m_bodyB=o.bodyB,this.m_collideConnected=o.collideConnected,this.m_userData=o.userData},box2d.b2Joint.prototype.m_type=box2d.b2JointType.e_unknownJoint,box2d.b2Joint.prototype.m_prev=null,box2d.b2Joint.prototype.m_next=null,box2d.b2Joint.prototype.m_edgeA=null,box2d.b2Joint.prototype.m_edgeB=null,box2d.b2Joint.prototype.m_bodyA=null,box2d.b2Joint.prototype.m_bodyB=null,box2d.b2Joint.prototype.m_index=0,box2d.b2Joint.prototype.m_islandFlag=!1,box2d.b2Joint.prototype.m_collideConnected=!1,box2d.b2Joint.prototype.m_userData=null,box2d.b2Joint.prototype.GetAnchorA=function(o){return o.SetZero()},box2d.b2Joint.prototype.GetAnchorB=function(o){return o.SetZero()},box2d.b2Joint.prototype.GetReactionForce=function(o,t){return t.SetZero()},box2d.b2Joint.prototype.GetReactionTorque=function(o){return 0},box2d.b2Joint.prototype.InitVelocityConstraints=function(o){},box2d.b2Joint.prototype.SolveVelocityConstraints=function(o){},box2d.b2Joint.prototype.SolvePositionConstraints=function(o){return!1},box2d.b2Joint.prototype.GetType=function(){return this.m_type},box2d.b2Joint.prototype.GetBodyA=function(){return this.m_bodyA},box2d.b2Joint.prototype.GetBodyB=function(){return this.m_bodyB},box2d.b2Joint.prototype.GetNext=function(){return this.m_next},box2d.b2Joint.prototype.GetUserData=function(){return this.m_userData},box2d.b2Joint.prototype.SetUserData=function(o){this.m_userData=o},box2d.b2Joint.prototype.GetCollideConnected=function(){return this.m_collideConnected},box2d.b2Joint.prototype.Dump=function(){box2d.DEBUG&&box2d.b2Log("// Dump is not supported for this joint type.\n")},box2d.b2Joint.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()},box2d.b2Joint.prototype.ShiftOrigin=function(o){},goog.provide("box2d.b2RevoluteJoint"),goog.require("box2d.b2Settings"),goog.require("box2d.b2Joint"),goog.require("box2d.b2Math"),box2d.b2RevoluteJointDef=function(){goog.base(this,box2d.b2JointType.e_revoluteJoint),this.localAnchorA=new box2d.b2Vec2(0,0),this.localAnchorB=new box2d.b2Vec2(0,0)},goog.inherits(box2d.b2RevoluteJointDef,box2d.b2JointDef),box2d.b2RevoluteJointDef.prototype.localAnchorA=null,box2d.b2RevoluteJointDef.prototype.localAnchorB=null,box2d.b2RevoluteJointDef.prototype.referenceAngle=0,box2d.b2RevoluteJointDef.prototype.enableLimit=!1,box2d.b2RevoluteJointDef.prototype.lowerAngle=0,box2d.b2RevoluteJointDef.prototype.upperAngle=0,box2d.b2RevoluteJointDef.prototype.enableMotor=!1,box2d.b2RevoluteJointDef.prototype.motorSpeed=0,box2d.b2RevoluteJointDef.prototype.maxMotorTorque=0,box2d.b2RevoluteJointDef.prototype.Initialize=function(o,t,e){this.bodyA=o,this.bodyB=t,this.bodyA.GetLocalPoint(e,this.localAnchorA),this.bodyB.GetLocalPoint(e,this.localAnchorB),this.referenceAngle=this.bodyB.GetAngleRadians()-this.bodyA.GetAngleRadians()},box2d.b2RevoluteJoint=function(o){goog.base(this,o),this.m_localAnchorA=new box2d.b2Vec2,this.m_localAnchorB=new box2d.b2Vec2,this.m_impulse=new box2d.b2Vec3,this.m_rA=new box2d.b2Vec2,this.m_rB=new box2d.b2Vec2,this.m_localCenterA=new box2d.b2Vec2,this.m_localCenterB=new box2d.b2Vec2,this.m_mass=new box2d.b2Mat33,this.m_qA=new box2d.b2Rot,this.m_qB=new box2d.b2Rot,this.m_lalcA=new box2d.b2Vec2,this.m_lalcB=new box2d.b2Vec2,this.m_K=new box2d.b2Mat22,this.m_localAnchorA.Copy(o.localAnchorA),this.m_localAnchorB.Copy(o.localAnchorB),this.m_referenceAngle=o.referenceAngle,this.m_impulse.SetZero(),this.m_motorImpulse=0,this.m_lowerAngle=o.lowerAngle,this.m_upperAngle=o.upperAngle,this.m_maxMotorTorque=o.maxMotorTorque,this.m_motorSpeed=o.motorSpeed,this.m_enableLimit=o.enableLimit,this.m_enableMotor=o.enableMotor,this.m_limitState=box2d.b2LimitState.e_inactiveLimit},goog.inherits(box2d.b2RevoluteJoint,box2d.b2Joint),box2d.b2RevoluteJoint.prototype.m_localAnchorA=null,box2d.b2RevoluteJoint.prototype.m_localAnchorB=null,box2d.b2RevoluteJoint.prototype.m_impulse=null,box2d.b2RevoluteJoint.prototype.m_motorImpulse=0,box2d.b2RevoluteJoint.prototype.m_enableMotor=!1,box2d.b2RevoluteJoint.prototype.m_maxMotorTorque=0,box2d.b2RevoluteJoint.prototype.m_motorSpeed=0,box2d.b2RevoluteJoint.prototype.m_enableLimit=!1,box2d.b2RevoluteJoint.prototype.m_referenceAngle=0,box2d.b2RevoluteJoint.prototype.m_lowerAngle=0,box2d.b2RevoluteJoint.prototype.m_upperAngle=0,box2d.b2RevoluteJoint.prototype.m_indexA=0,box2d.b2RevoluteJoint.prototype.m_indexB=0,box2d.b2RevoluteJoint.prototype.m_rA=null,box2d.b2RevoluteJoint.prototype.m_rB=null,box2d.b2RevoluteJoint.prototype.m_localCenterA=null,box2d.b2RevoluteJoint.prototype.m_localCenterB=null,box2d.b2RevoluteJoint.prototype.m_invMassA=0,box2d.b2RevoluteJoint.prototype.m_invMassB=0,box2d.b2RevoluteJoint.prototype.m_invIA=0,box2d.b2RevoluteJoint.prototype.m_invIB=0,box2d.b2RevoluteJoint.prototype.m_mass=null,box2d.b2RevoluteJoint.prototype.m_motorMass=0,box2d.b2RevoluteJoint.prototype.m_limitState=box2d.b2LimitState.e_inactiveLimit,box2d.b2RevoluteJoint.prototype.m_qA=null,box2d.b2RevoluteJoint.prototype.m_qB=null,box2d.b2RevoluteJoint.prototype.m_lalcA=null,box2d.b2RevoluteJoint.prototype.m_lalcB=null,box2d.b2RevoluteJoint.prototype.m_K=null,box2d.b2RevoluteJoint.prototype.InitVelocityConstraints=function(o){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var t=o.positions[this.m_indexA].a,e=o.velocities[this.m_indexA].v,i=o.velocities[this.m_indexA].w,n=o.positions[this.m_indexB].a,s=o.velocities[this.m_indexB].v,r=o.velocities[this.m_indexB].w,b=this.m_qA.SetAngleRadians(t),a=this.m_qB.SetAngleRadians(n);box2d.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),box2d.b2MulRV(b,this.m_lalcA,this.m_rA),box2d.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),box2d.b2MulRV(a,this.m_lalcB,this.m_rB);var d=this.m_invMassA,l=this.m_invMassB,x=this.m_invIA,p=this.m_invIB,m=x+p===0;if(this.m_mass.ex.x=d+l+this.m_rA.y*this.m_rA.y*x+this.m_rB.y*this.m_rB.y*p,this.m_mass.ey.x=-this.m_rA.y*this.m_rA.x*x-this.m_rB.y*this.m_rB.x*p,this.m_mass.ez.x=-this.m_rA.y*x-this.m_rB.y*p,this.m_mass.ex.y=this.m_mass.ey.x,this.m_mass.ey.y=d+l+this.m_rA.x*this.m_rA.x*x+this.m_rB.x*this.m_rB.x*p,this.m_mass.ez.y=this.m_rA.x*x+this.m_rB.x*p,this.m_mass.ex.z=this.m_mass.ez.x,this.m_mass.ey.z=this.m_mass.ez.y,this.m_mass.ez.z=x+p,this.m_motorMass=x+p,0<this.m_motorMass&&(this.m_motorMass=1/this.m_motorMass),(!1===this.m_enableMotor||m)&&(this.m_motorImpulse=0),this.m_enableLimit&&!1===m){var h=n-t-this.m_referenceAngle;box2d.b2Abs(this.m_upperAngle-this.m_lowerAngle)<2*box2d.b2_angularSlop?this.m_limitState=box2d.b2LimitState.e_equalLimits:h<=this.m_lowerAngle?(this.m_limitState!==box2d.b2LimitState.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=box2d.b2LimitState.e_atLowerLimit):h>=this.m_upperAngle?(this.m_limitState!==box2d.b2LimitState.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=box2d.b2LimitState.e_atUpperLimit):(this.m_limitState=box2d.b2LimitState.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=box2d.b2LimitState.e_inactiveLimit;if(o.step.warmStarting){this.m_impulse.SelfMul(o.step.dtRatio),this.m_motorImpulse*=o.step.dtRatio;var _=box2d.b2RevoluteJoint.prototype.InitVelocityConstraints.s_P.SetXY(this.m_impulse.x,this.m_impulse.y);e.SelfMulSub(d,_),i-=x*(box2d.b2CrossVV(this.m_rA,_)+this.m_motorImpulse+this.m_impulse.z),s.SelfMulAdd(l,_),r+=p*(box2d.b2CrossVV(this.m_rB,_)+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.SetZero(),this.m_motorImpulse=0;o.velocities[this.m_indexA].w=i,o.velocities[this.m_indexB].w=r},box2d.b2RevoluteJoint.prototype.InitVelocityConstraints.s_P=new box2d.b2Vec2,box2d.b2RevoluteJoint.prototype.SolveVelocityConstraints=function(o){var t=o.velocities[this.m_indexA].v,e=o.velocities[this.m_indexA].w,i=o.velocities[this.m_indexB].v,n=o.velocities[this.m_indexB].w,s=this.m_invMassA,r=this.m_invMassB,b=this.m_invIA,a=this.m_invIB,d=b+a===0;if(this.m_enableMotor&&this.m_limitState!==box2d.b2LimitState.e_equalLimits&&!1===d){var l=n-e-this.m_motorSpeed,x=-this.m_motorMass*l,p=this.m_motorImpulse,m=o.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=box2d.b2Clamp(this.m_motorImpulse+x,-m,m),e-=b*(x=this.m_motorImpulse-p),n+=a*x}if(this.m_enableLimit&&this.m_limitState!==box2d.b2LimitState.e_inactiveLimit&&!1===d){var h=box2d.b2SubVV(box2d.b2AddVCrossSV(i,n,this.m_rB,box2d.b2Vec2.s_t0),box2d.b2AddVCrossSV(t,e,this.m_rA,box2d.b2Vec2.s_t1),box2d.b2RevoluteJoint.prototype.SolveVelocityConstraints.s_Cdot1),_=n-e;x=this.m_mass.Solve33(h.x,h.y,_,box2d.b2RevoluteJoint.prototype.SolveVelocityConstraints.s_impulse3).SelfNeg();if(this.m_limitState===box2d.b2LimitState.e_equalLimits)this.m_impulse.SelfAdd(x);else if(this.m_limitState===box2d.b2LimitState.e_atLowerLimit){if(this.m_impulse.z+x.z<0){var c=-h.x+this.m_impulse.z*this.m_mass.ez.x,y=-h.y+this.m_impulse.z*this.m_mass.ez.y,u=this.m_mass.Solve22(c,y,box2d.b2RevoluteJoint.prototype.SolveVelocityConstraints.s_reduced);x.x=u.x,x.y=u.y,x.z=-this.m_impulse.z,this.m_impulse.x+=u.x,this.m_impulse.y+=u.y,this.m_impulse.z=0}else this.m_impulse.SelfAdd(x)}else if(this.m_limitState===box2d.b2LimitState.e_atUpperLimit){if(0<this.m_impulse.z+x.z){c=-h.x+this.m_impulse.z*this.m_mass.ez.x,y=-h.y+this.m_impulse.z*this.m_mass.ez.y,u=this.m_mass.Solve22(c,y,box2d.b2RevoluteJoint.prototype.SolveVelocityConstraints.s_reduced);x.x=u.x,x.y=u.y,x.z=-this.m_impulse.z,this.m_impulse.x+=u.x,this.m_impulse.y+=u.y,this.m_impulse.z=0}else this.m_impulse.SelfAdd(x)}var g=box2d.b2RevoluteJoint.prototype.SolveVelocityConstraints.s_P.SetXY(x.x,x.y);t.SelfMulSub(s,g),e-=b*(box2d.b2CrossVV(this.m_rA,g)+x.z),i.SelfMulAdd(r,g),n+=a*(box2d.b2CrossVV(this.m_rB,g)+x.z)}else{l=box2d.b2SubVV(box2d.b2AddVCrossSV(i,n,this.m_rB,box2d.b2Vec2.s_t0),box2d.b2AddVCrossSV(t,e,this.m_rA,box2d.b2Vec2.s_t1),box2d.b2RevoluteJoint.prototype.SolveVelocityConstraints.s_Cdot),x=this.m_mass.Solve22(-l.x,-l.y,box2d.b2RevoluteJoint.prototype.SolveVelocityConstraints.s_impulse2);this.m_impulse.x+=x.x,this.m_impulse.y+=x.y,t.SelfMulSub(s,x),e-=b*box2d.b2CrossVV(this.m_rA,x),i.SelfMulAdd(r,x),n+=a*box2d.b2CrossVV(this.m_rB,x)}o.velocities[this.m_indexA].w=e,o.velocities[this.m_indexB].w=n},box2d.b2RevoluteJoint.prototype.SolveVelocityConstraints.s_P=new box2d.b2Vec2,box2d.b2RevoluteJoint.prototype.SolveVelocityConstraints.s_Cdot=new box2d.b2Vec2,box2d.b2RevoluteJoint.prototype.SolveVelocityConstraints.s_Cdot1=new box2d.b2Vec2,box2d.b2RevoluteJoint.prototype.SolveVelocityConstraints.s_impulse3=new box2d.b2Vec3,box2d.b2RevoluteJoint.prototype.SolveVelocityConstraints.s_reduced=new box2d.b2Vec2,box2d.b2RevoluteJoint.prototype.SolveVelocityConstraints.s_impulse2=new box2d.b2Vec2,box2d.b2RevoluteJoint.prototype.SolvePositionConstraints=function(o){var t,e=o.positions[this.m_indexA].c,i=o.positions[this.m_indexA].a,n=o.positions[this.m_indexB].c,s=o.positions[this.m_indexB].a,r=this.m_qA.SetAngleRadians(i),b=this.m_qB.SetAngleRadians(s),a=0,d=this.m_invIA+this.m_invIB===0;if(this.m_enableLimit&&this.m_limitState!==box2d.b2LimitState.e_inactiveLimit&&!1===d){var l=s-i-this.m_referenceAngle,x=0;if(this.m_limitState===box2d.b2LimitState.e_equalLimits){var p=box2d.b2Clamp(l-this.m_lowerAngle,-box2d.b2_maxAngularCorrection,box2d.b2_maxAngularCorrection);x=-this.m_motorMass*p,a=box2d.b2Abs(p)}else if(this.m_limitState===box2d.b2LimitState.e_atLowerLimit){a=-(p=l-this.m_lowerAngle),p=box2d.b2Clamp(p+box2d.b2_angularSlop,-box2d.b2_maxAngularCorrection,0),x=-this.m_motorMass*p}else if(this.m_limitState===box2d.b2LimitState.e_atUpperLimit){a=p=l-this.m_upperAngle,p=box2d.b2Clamp(p-box2d.b2_angularSlop,0,box2d.b2_maxAngularCorrection),x=-this.m_motorMass*p}i-=this.m_invIA*x,s+=this.m_invIB*x}r.SetAngleRadians(i),b.SetAngleRadians(s),box2d.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var m=box2d.b2MulRV(r,this.m_lalcA,this.m_rA);box2d.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var h=box2d.b2MulRV(b,this.m_lalcB,this.m_rB);t=(p=box2d.b2SubVV(box2d.b2AddVV(n,h,box2d.b2Vec2.s_t0),box2d.b2AddVV(e,m,box2d.b2Vec2.s_t1),box2d.b2RevoluteJoint.prototype.SolvePositionConstraints.s_C)).GetLength();var _=this.m_invMassA,c=this.m_invMassB,y=this.m_invIA,u=this.m_invIB,g=this.m_K;g.ex.x=_+c+y*m.y*m.y+u*h.y*h.y,g.ex.y=-y*m.x*m.y-u*h.x*h.y,g.ey.x=g.ex.y,g.ey.y=_+c+y*m.x*m.x+u*h.x*h.x;var f=g.Solve(p.x,p.y,box2d.b2RevoluteJoint.prototype.SolvePositionConstraints.s_impulse).SelfNeg();return e.SelfMulSub(_,f),i-=y*box2d.b2CrossVV(m,f),n.SelfMulAdd(c,f),s+=u*box2d.b2CrossVV(h,f),o.positions[this.m_indexA].a=i,o.positions[this.m_indexB].a=s,t<=box2d.b2_linearSlop&&a<=box2d.b2_angularSlop},box2d.b2RevoluteJoint.prototype.SolvePositionConstraints.s_C=new box2d.b2Vec2,box2d.b2RevoluteJoint.prototype.SolvePositionConstraints.s_impulse=new box2d.b2Vec2,box2d.b2RevoluteJoint.prototype.GetAnchorA=function(o){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,o)},box2d.b2RevoluteJoint.prototype.GetAnchorB=function(o){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,o)},box2d.b2RevoluteJoint.prototype.GetReactionForce=function(o,t){return t.SetXY(o*this.m_impulse.x,o*this.m_impulse.y)},box2d.b2RevoluteJoint.prototype.GetReactionTorque=function(o){return o*this.m_impulse.z},box2d.b2RevoluteJoint.prototype.GetLocalAnchorA=function(o){return o.Copy(this.m_localAnchorA)},box2d.b2RevoluteJoint.prototype.GetLocalAnchorB=function(o){return o.Copy(this.m_localAnchorB)},box2d.b2RevoluteJoint.prototype.GetReferenceAngle=function(){return this.m_referenceAngle},box2d.b2RevoluteJoint.prototype.GetJointAngleRadians=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle},box2d.b2RevoluteJoint.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity},box2d.b2RevoluteJoint.prototype.IsMotorEnabled=function(){return this.m_enableMotor},box2d.b2RevoluteJoint.prototype.EnableMotor=function(o){this.m_enableMotor!==o&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=o)},box2d.b2RevoluteJoint.prototype.GetMotorTorque=function(o){return o*this.m_motorImpulse},box2d.b2RevoluteJoint.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},box2d.b2RevoluteJoint.prototype.SetMaxMotorTorque=function(o){this.m_maxMotorTorque=o},box2d.b2RevoluteJoint.prototype.GetMaxMotorTorque=function(){return this.m_maxMotorTorque},box2d.b2RevoluteJoint.prototype.IsLimitEnabled=function(){return this.m_enableLimit},box2d.b2RevoluteJoint.prototype.EnableLimit=function(o){o!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=o,this.m_impulse.z=0)},box2d.b2RevoluteJoint.prototype.GetLowerLimit=function(){return this.m_lowerAngle},box2d.b2RevoluteJoint.prototype.GetUpperLimit=function(){return this.m_upperAngle},box2d.b2RevoluteJoint.prototype.SetLimits=function(o,t){o===this.m_lowerAngle&&t===this.m_upperAngle||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_impulse.z=0,this.m_lowerAngle=o,this.m_upperAngle=t)},box2d.b2RevoluteJoint.prototype.SetMotorSpeed=function(o){this.m_motorSpeed!==o&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=o)},box2d.b2RevoluteJoint.prototype.Dump=function(){if(box2d.DEBUG){var o=this.m_bodyA.m_islandIndex,t=this.m_bodyB.m_islandIndex;box2d.b2Log("  /*box2d.b2RevoluteJointDef*/ var jd = new box2d.b2RevoluteJointDef();\n"),box2d.b2Log("  jd.bodyA = bodies[%d];\n",o),box2d.b2Log("  jd.bodyB = bodies[%d];\n",t),box2d.b2Log("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),box2d.b2Log("  jd.localAnchorA.SetXY(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),box2d.b2Log("  jd.localAnchorB.SetXY(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),box2d.b2Log("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),box2d.b2Log("  jd.enableLimit = %s;\n",this.m_enableLimit?"true":"false"),box2d.b2Log("  jd.lowerAngle = %.15f;\n",this.m_lowerAngle),box2d.b2Log("  jd.upperAngle = %.15f;\n",this.m_upperAngle),box2d.b2Log("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),box2d.b2Log("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),box2d.b2Log("  jd.maxMotorTorque = %.15f;\n",this.m_maxMotorTorque),box2d.b2Log("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}},goog.provide("box2d.b2PrismaticJoint"),goog.require("box2d.b2Settings"),goog.require("box2d.b2Joint"),goog.require("box2d.b2Math"),box2d.b2PrismaticJointDef=function(){goog.base(this,box2d.b2JointType.e_prismaticJoint),this.localAnchorA=new box2d.b2Vec2,this.localAnchorB=new box2d.b2Vec2,this.localAxisA=new box2d.b2Vec2(1,0)},goog.inherits(box2d.b2PrismaticJointDef,box2d.b2JointDef),box2d.b2PrismaticJointDef.prototype.localAnchorA=null,box2d.b2PrismaticJointDef.prototype.localAnchorB=null,box2d.b2PrismaticJointDef.prototype.localAxisA=null,box2d.b2PrismaticJointDef.prototype.referenceAngle=0,box2d.b2PrismaticJointDef.prototype.enableLimit=!1,box2d.b2PrismaticJointDef.prototype.lowerTranslation=0,box2d.b2PrismaticJointDef.prototype.upperTranslation=0,box2d.b2PrismaticJointDef.prototype.enableMotor=!1,box2d.b2PrismaticJointDef.prototype.maxMotorForce=0,box2d.b2PrismaticJointDef.prototype.motorSpeed=0,box2d.b2PrismaticJointDef.prototype.Initialize=function(o,t,e,i){this.bodyA=o,this.bodyB=t,this.bodyA.GetLocalPoint(e,this.localAnchorA),this.bodyB.GetLocalPoint(e,this.localAnchorB),this.bodyA.GetLocalVector(i,this.localAxisA),this.referenceAngle=this.bodyB.GetAngleRadians()-this.bodyA.GetAngleRadians()},box2d.b2PrismaticJoint=function(o){goog.base(this,o),this.m_localAnchorA=o.localAnchorA.Clone(),this.m_localAnchorB=o.localAnchorB.Clone(),this.m_localXAxisA=o.localAxisA.Clone().SelfNormalize(),this.m_localYAxisA=box2d.b2CrossOneV(this.m_localXAxisA,new box2d.b2Vec2),this.m_referenceAngle=o.referenceAngle,this.m_impulse=new box2d.b2Vec3(0,0,0),this.m_lowerTranslation=o.lowerTranslation,this.m_upperTranslation=o.upperTranslation,this.m_maxMotorForce=o.maxMotorForce,this.m_motorSpeed=o.motorSpeed,this.m_enableLimit=o.enableLimit,this.m_enableMotor=o.enableMotor,this.m_localCenterA=new box2d.b2Vec2,this.m_localCenterB=new box2d.b2Vec2,this.m_axis=new box2d.b2Vec2(0,0),this.m_perp=new box2d.b2Vec2(0,0),this.m_K=new box2d.b2Mat33,this.m_K3=new box2d.b2Mat33,this.m_K2=new box2d.b2Mat22,this.m_qA=new box2d.b2Rot,this.m_qB=new box2d.b2Rot,this.m_lalcA=new box2d.b2Vec2,this.m_lalcB=new box2d.b2Vec2,this.m_rA=new box2d.b2Vec2,this.m_rB=new box2d.b2Vec2},goog.inherits(box2d.b2PrismaticJoint,box2d.b2Joint),box2d.b2PrismaticJoint.prototype.m_localAnchorA=null,box2d.b2PrismaticJoint.prototype.m_localAnchorB=null,box2d.b2PrismaticJoint.prototype.m_localXAxisA=null,box2d.b2PrismaticJoint.prototype.m_localYAxisA=null,box2d.b2PrismaticJoint.prototype.m_referenceAngle=0,box2d.b2PrismaticJoint.prototype.m_impulse=null,box2d.b2PrismaticJoint.prototype.m_motorImpulse=0,box2d.b2PrismaticJoint.prototype.m_lowerTranslation=0,box2d.b2PrismaticJoint.prototype.m_upperTranslation=0,box2d.b2PrismaticJoint.prototype.m_maxMotorForce=0,box2d.b2PrismaticJoint.prototype.m_motorSpeed=0,box2d.b2PrismaticJoint.prototype.m_enableLimit=!1,box2d.b2PrismaticJoint.prototype.m_enableMotor=!1,box2d.b2PrismaticJoint.prototype.m_limitState=box2d.b2LimitState.e_inactiveLimit,box2d.b2PrismaticJoint.prototype.m_indexA=0,box2d.b2PrismaticJoint.prototype.m_indexB=0,box2d.b2PrismaticJoint.prototype.m_localCenterA=null,box2d.b2PrismaticJoint.prototype.m_localCenterB=null,box2d.b2PrismaticJoint.prototype.m_invMassA=0,box2d.b2PrismaticJoint.prototype.m_invMassB=0,box2d.b2PrismaticJoint.prototype.m_invIA=0,box2d.b2PrismaticJoint.prototype.m_invIB=0,box2d.b2PrismaticJoint.prototype.m_axis=null,box2d.b2PrismaticJoint.prototype.m_perp=null,box2d.b2PrismaticJoint.prototype.m_s1=0,box2d.b2PrismaticJoint.prototype.m_s2=0,box2d.b2PrismaticJoint.prototype.m_a1=0,box2d.b2PrismaticJoint.prototype.m_a2=0,box2d.b2PrismaticJoint.prototype.m_K=null,box2d.b2PrismaticJoint.prototype.m_K3=null,box2d.b2PrismaticJoint.prototype.m_K2=null,box2d.b2PrismaticJoint.prototype.m_motorMass=0,box2d.b2PrismaticJoint.prototype.m_qA=null,box2d.b2PrismaticJoint.prototype.m_qB=null,box2d.b2PrismaticJoint.prototype.m_lalcA=null,box2d.b2PrismaticJoint.prototype.m_lalcB=null,box2d.b2PrismaticJoint.prototype.m_rA=null,box2d.b2PrismaticJoint.prototype.m_rB=null,box2d.b2PrismaticJoint.prototype.InitVelocityConstraints=function(o){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var t=o.positions[this.m_indexA].c,e=o.positions[this.m_indexA].a,i=o.velocities[this.m_indexA].v,n=o.velocities[this.m_indexA].w,s=o.positions[this.m_indexB].c,r=o.positions[this.m_indexB].a,b=o.velocities[this.m_indexB].v,a=o.velocities[this.m_indexB].w,d=this.m_qA.SetAngleRadians(e),l=this.m_qB.SetAngleRadians(r);box2d.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var x=box2d.b2MulRV(d,this.m_lalcA,this.m_rA);box2d.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var p=box2d.b2MulRV(l,this.m_lalcB,this.m_rB),m=box2d.b2AddVV(box2d.b2SubVV(s,t,box2d.b2Vec2.s_t0),box2d.b2SubVV(p,x,box2d.b2Vec2.s_t1),box2d.b2PrismaticJoint.prototype.InitVelocityConstraints.s_d),h=this.m_invMassA,_=this.m_invMassB,c=this.m_invIA,y=this.m_invIB;if(box2d.b2MulRV(d,this.m_localXAxisA,this.m_axis),this.m_a1=box2d.b2CrossVV(box2d.b2AddVV(m,x,box2d.b2Vec2.s_t0),this.m_axis),this.m_a2=box2d.b2CrossVV(p,this.m_axis),this.m_motorMass=h+_+c*this.m_a1*this.m_a1+y*this.m_a2*this.m_a2,0<this.m_motorMass&&(this.m_motorMass=1/this.m_motorMass),box2d.b2MulRV(d,this.m_localYAxisA,this.m_perp),this.m_s1=box2d.b2CrossVV(box2d.b2AddVV(m,x,box2d.b2Vec2.s_t0),this.m_perp),this.m_s2=box2d.b2CrossVV(p,this.m_perp),this.m_K.ex.x=h+_+c*this.m_s1*this.m_s1+y*this.m_s2*this.m_s2,this.m_K.ex.y=c*this.m_s1+y*this.m_s2,this.m_K.ex.z=c*this.m_s1*this.m_a1+y*this.m_s2*this.m_a2,this.m_K.ey.x=this.m_K.ex.y,this.m_K.ey.y=c+y,0===this.m_K.ey.y&&(this.m_K.ey.y=1),this.m_K.ey.z=c*this.m_a1+y*this.m_a2,this.m_K.ez.x=this.m_K.ex.z,this.m_K.ez.y=this.m_K.ey.z,this.m_K.ez.z=h+_+c*this.m_a1*this.m_a1+y*this.m_a2*this.m_a2,this.m_enableLimit){var u=box2d.b2DotVV(this.m_axis,m);box2d.b2Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*box2d.b2_linearSlop?this.m_limitState=box2d.b2LimitState.e_equalLimits:u<=this.m_lowerTranslation?this.m_limitState!==box2d.b2LimitState.e_atLowerLimit&&(this.m_limitState=box2d.b2LimitState.e_atLowerLimit,this.m_impulse.z=0):u>=this.m_upperTranslation?this.m_limitState!==box2d.b2LimitState.e_atUpperLimit&&(this.m_limitState=box2d.b2LimitState.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=box2d.b2LimitState.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=box2d.b2LimitState.e_inactiveLimit,this.m_impulse.z=0;if(!1===this.m_enableMotor&&(this.m_motorImpulse=0),o.step.warmStarting){this.m_impulse.SelfMul(o.step.dtRatio),this.m_motorImpulse*=o.step.dtRatio;var g=box2d.b2AddVV(box2d.b2MulSV(this.m_impulse.x,this.m_perp,box2d.b2Vec2.s_t0),box2d.b2MulSV(this.m_motorImpulse+this.m_impulse.z,this.m_axis,box2d.b2Vec2.s_t1),box2d.b2PrismaticJoint.prototype.InitVelocityConstraints.s_P),f=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,S=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;i.SelfMulSub(h,g),n-=c*f,b.SelfMulAdd(_,g),a+=y*S}else this.m_impulse.SetZero(),this.m_motorImpulse=0;o.velocities[this.m_indexA].w=n,o.velocities[this.m_indexB].w=a},box2d.b2PrismaticJoint.prototype.InitVelocityConstraints.s_d=new box2d.b2Vec2,box2d.b2PrismaticJoint.prototype.InitVelocityConstraints.s_P=new box2d.b2Vec2,box2d.b2PrismaticJoint.prototype.SolveVelocityConstraints=function(o){var t=o.velocities[this.m_indexA].v,e=o.velocities[this.m_indexA].w,i=o.velocities[this.m_indexB].v,n=o.velocities[this.m_indexB].w,s=this.m_invMassA,r=this.m_invMassB,b=this.m_invIA,a=this.m_invIB;if(this.m_enableMotor&&this.m_limitState!==box2d.b2LimitState.e_equalLimits){var d=box2d.b2DotVV(this.m_axis,box2d.b2SubVV(i,t,box2d.b2Vec2.s_t0))+this.m_a2*n-this.m_a1*e,l=this.m_motorMass*(this.m_motorSpeed-d),x=this.m_motorImpulse,p=o.step.dt*this.m_maxMotorForce;this.m_motorImpulse=box2d.b2Clamp(this.m_motorImpulse+l,-p,p),l=this.m_motorImpulse-x;var m=box2d.b2MulSV(l,this.m_axis,box2d.b2PrismaticJoint.prototype.SolveVelocityConstraints.s_P),h=l*this.m_a1,_=l*this.m_a2;t.SelfMulSub(s,m),e-=b*h,i.SelfMulAdd(r,m),n+=a*_}var c=box2d.b2DotVV(this.m_perp,box2d.b2SubVV(i,t,box2d.b2Vec2.s_t0))+this.m_s2*n-this.m_s1*e,y=n-e;if(this.m_enableLimit&&this.m_limitState!==box2d.b2LimitState.e_inactiveLimit){var u=box2d.b2DotVV(this.m_axis,box2d.b2SubVV(i,t,box2d.b2Vec2.s_t0))+this.m_a2*n-this.m_a1*e,g=box2d.b2PrismaticJoint.prototype.SolveVelocityConstraints.s_f1.Copy(this.m_impulse),f=this.m_K.Solve33(-c,-y,-u,box2d.b2PrismaticJoint.prototype.SolveVelocityConstraints.s_df3);this.m_impulse.SelfAdd(f),this.m_limitState===box2d.b2LimitState.e_atLowerLimit?this.m_impulse.z=box2d.b2Max(this.m_impulse.z,0):this.m_limitState===box2d.b2LimitState.e_atUpperLimit&&(this.m_impulse.z=box2d.b2Min(this.m_impulse.z,0));var S=-c-(this.m_impulse.z-g.z)*this.m_K.ez.x,A=-y-(this.m_impulse.z-g.z)*this.m_K.ez.y,C=this.m_K.Solve22(S,A,box2d.b2PrismaticJoint.prototype.SolveVelocityConstraints.s_f2r);C.x+=g.x,C.y+=g.y,this.m_impulse.x=C.x,this.m_impulse.y=C.y,f.x=this.m_impulse.x-g.x,f.y=this.m_impulse.y-g.y,f.z=this.m_impulse.z-g.z;m=box2d.b2AddVV(box2d.b2MulSV(f.x,this.m_perp,box2d.b2Vec2.s_t0),box2d.b2MulSV(f.z,this.m_axis,box2d.b2Vec2.s_t1),box2d.b2PrismaticJoint.prototype.SolveVelocityConstraints.s_P),h=f.x*this.m_s1+f.y+f.z*this.m_a1,_=f.x*this.m_s2+f.y+f.z*this.m_a2;t.SelfMulSub(s,m),e-=b*h,i.SelfMulAdd(r,m),n+=a*_}else{f=this.m_K.Solve22(-c,-y,box2d.b2PrismaticJoint.prototype.SolveVelocityConstraints.s_df2);this.m_impulse.x+=f.x,this.m_impulse.y+=f.y;m=box2d.b2MulSV(f.x,this.m_perp,box2d.b2PrismaticJoint.prototype.SolveVelocityConstraints.s_P),h=f.x*this.m_s1+f.y,_=f.x*this.m_s2+f.y;t.SelfMulSub(s,m),e-=b*h,i.SelfMulAdd(r,m),n+=a*_}o.velocities[this.m_indexA].w=e,o.velocities[this.m_indexB].w=n},box2d.b2PrismaticJoint.prototype.SolveVelocityConstraints.s_P=new box2d.b2Vec2,box2d.b2PrismaticJoint.prototype.SolveVelocityConstraints.s_f2r=new box2d.b2Vec2,box2d.b2PrismaticJoint.prototype.SolveVelocityConstraints.s_f1=new box2d.b2Vec3,box2d.b2PrismaticJoint.prototype.SolveVelocityConstraints.s_df3=new box2d.b2Vec3,box2d.b2PrismaticJoint.prototype.SolveVelocityConstraints.s_df2=new box2d.b2Vec2,box2d.b2PrismaticJoint.prototype.SolvePositionConstraints=function(o){var t=o.positions[this.m_indexA].c,e=o.positions[this.m_indexA].a,i=o.positions[this.m_indexB].c,n=o.positions[this.m_indexB].a,s=this.m_qA.SetAngleRadians(e),r=this.m_qB.SetAngleRadians(n),b=this.m_invMassA,a=this.m_invMassB,d=this.m_invIA,l=this.m_invIB,x=box2d.b2MulRV(s,this.m_lalcA,this.m_rA),p=box2d.b2MulRV(r,this.m_lalcB,this.m_rB),m=box2d.b2SubVV(box2d.b2AddVV(i,p,box2d.b2Vec2.s_t0),box2d.b2AddVV(t,x,box2d.b2Vec2.s_t1),box2d.b2PrismaticJoint.prototype.SolvePositionConstraints.s_d),h=box2d.b2MulRV(s,this.m_localXAxisA,this.m_axis),_=box2d.b2CrossVV(box2d.b2AddVV(m,x,box2d.b2Vec2.s_t0),h),c=box2d.b2CrossVV(p,h),y=box2d.b2MulRV(s,this.m_localYAxisA,this.m_perp),u=box2d.b2CrossVV(box2d.b2AddVV(m,x,box2d.b2Vec2.s_t0),y),g=box2d.b2CrossVV(p,y),f=box2d.b2PrismaticJoint.prototype.SolvePositionConstraints.s_impulse,S=box2d.b2DotVV(y,m),A=n-e-this.m_referenceAngle,C=box2d.b2Abs(S),v=box2d.b2Abs(A),V=!1,B=0;if(this.m_enableLimit){var w=box2d.b2DotVV(h,m);box2d.b2Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*box2d.b2_linearSlop?(B=box2d.b2Clamp(w,-box2d.b2_maxLinearCorrection,box2d.b2_maxLinearCorrection),C=box2d.b2Max(C,box2d.b2Abs(w)),V=!0):w<=this.m_lowerTranslation?(B=box2d.b2Clamp(w-this.m_lowerTranslation+box2d.b2_linearSlop,-box2d.b2_maxLinearCorrection,0),C=box2d.b2Max(C,this.m_lowerTranslation-w),V=!0):w>=this.m_upperTranslation&&(B=box2d.b2Clamp(w-this.m_upperTranslation-box2d.b2_linearSlop,0,box2d.b2_maxLinearCorrection),C=box2d.b2Max(C,w-this.m_upperTranslation),V=!0)}if(V){var P=b+a+d*u*u+l*g*g,M=d*u+l*g,D=d*u*_+l*g*c;0===(I=d+l)&&(I=1);var J=d*_+l*c,T=b+a+d*_*_+l*c*c,R=this.m_K3;R.ex.SetXYZ(P,M,D),R.ey.SetXYZ(M,I,J),R.ez.SetXYZ(D,J,T),f=R.Solve33(-S,-A,-B,f)}else{var I;P=b+a+d*u*u+l*g*g,M=d*u+l*g;0===(I=d+l)&&(I=1);var L=this.m_K2;L.ex.SetXY(P,M),L.ey.SetXY(M,I);var E=L.Solve(-S,-A,box2d.b2PrismaticJoint.prototype.SolvePositionConstraints.s_impulse1);f.x=E.x,f.y=E.y,f.z=0}var F=box2d.b2AddVV(box2d.b2MulSV(f.x,y,box2d.b2Vec2.s_t0),box2d.b2MulSV(f.z,h,box2d.b2Vec2.s_t1),box2d.b2PrismaticJoint.prototype.SolvePositionConstraints.s_P),G=f.x*u+f.y+f.z*_,k=f.x*g+f.y+f.z*c;return t.SelfMulSub(b,F),e-=d*G,i.SelfMulAdd(a,F),n+=l*k,o.positions[this.m_indexA].a=e,o.positions[this.m_indexB].a=n,C<=box2d.b2_linearSlop&&v<=box2d.b2_angularSlop},box2d.b2PrismaticJoint.prototype.SolvePositionConstraints.s_d=new box2d.b2Vec2,box2d.b2PrismaticJoint.prototype.SolvePositionConstraints.s_impulse=new box2d.b2Vec3,box2d.b2PrismaticJoint.prototype.SolvePositionConstraints.s_impulse1=new box2d.b2Vec2,box2d.b2PrismaticJoint.prototype.SolvePositionConstraints.s_P=new box2d.b2Vec2,box2d.b2PrismaticJoint.prototype.GetAnchorA=function(o){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,o)},box2d.b2PrismaticJoint.prototype.GetAnchorB=function(o){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,o)},box2d.b2PrismaticJoint.prototype.GetReactionForce=function(o,t){return t.SetXY(o*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),o*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))},box2d.b2PrismaticJoint.prototype.GetReactionTorque=function(o){return o*this.m_impulse.y},box2d.b2PrismaticJoint.prototype.GetLocalAnchorA=function(o){return o.Copy(this.m_localAnchorA)},box2d.b2PrismaticJoint.prototype.GetLocalAnchorB=function(o){return o.Copy(this.m_localAnchorB)},box2d.b2PrismaticJoint.prototype.GetLocalAxisA=function(o){return o.Copy(this.m_localXAxisA)},box2d.b2PrismaticJoint.prototype.GetReferenceAngle=function(){return this.m_referenceAngle},box2d.b2PrismaticJoint.prototype.GetJointTranslation=function(){var o=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,box2d.b2PrismaticJoint.prototype.GetJointTranslation.s_pA),t=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,box2d.b2PrismaticJoint.prototype.GetJointTranslation.s_pB),e=box2d.b2SubVV(t,o,box2d.b2PrismaticJoint.prototype.GetJointTranslation.s_d),i=this.m_bodyA.GetWorldVector(this.m_localXAxisA,box2d.b2PrismaticJoint.prototype.GetJointTranslation.s_axis);return box2d.b2DotVV(e,i)},box2d.b2PrismaticJoint.prototype.GetJointTranslation.s_pA=new box2d.b2Vec2,box2d.b2PrismaticJoint.prototype.GetJointTranslation.s_pB=new box2d.b2Vec2,box2d.b2PrismaticJoint.prototype.GetJointTranslation.s_d=new box2d.b2Vec2,box2d.b2PrismaticJoint.prototype.GetJointTranslation.s_axis=new box2d.b2Vec2,box2d.b2PrismaticJoint.prototype.GetJointSpeed=function(){var o=this.m_bodyA,t=this.m_bodyB;box2d.b2SubVV(this.m_localAnchorA,o.m_sweep.localCenter,this.m_lalcA);var e=box2d.b2MulRV(o.m_xf.q,this.m_lalcA,this.m_rA);box2d.b2SubVV(this.m_localAnchorB,t.m_sweep.localCenter,this.m_lalcB);var i=box2d.b2MulRV(t.m_xf.q,this.m_lalcB,this.m_rB),n=box2d.b2AddVV(o.m_sweep.c,e,box2d.b2Vec2.s_t0),s=box2d.b2AddVV(t.m_sweep.c,i,box2d.b2Vec2.s_t1),r=box2d.b2SubVV(s,n,box2d.b2Vec2.s_t2),b=o.GetWorldVector(this.m_localXAxisA,this.m_axis),a=o.m_linearVelocity,d=t.m_linearVelocity,l=o.m_angularVelocity,x=t.m_angularVelocity;return box2d.b2DotVV(r,box2d.b2CrossSV(l,b,box2d.b2Vec2.s_t0))+box2d.b2DotVV(b,box2d.b2SubVV(box2d.b2AddVCrossSV(d,x,i,box2d.b2Vec2.s_t0),box2d.b2AddVCrossSV(a,l,e,box2d.b2Vec2.s_t1),box2d.b2Vec2.s_t0))},box2d.b2PrismaticJoint.prototype.IsLimitEnabled=function(){return this.m_enableLimit},box2d.b2PrismaticJoint.prototype.EnableLimit=function(o){o!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=o,this.m_impulse.z=0)},box2d.b2PrismaticJoint.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},box2d.b2PrismaticJoint.prototype.GetUpperLimit=function(){return this.m_upperTranslation},box2d.b2PrismaticJoint.prototype.SetLimits=function(o,t){o===this.m_lowerTranslation&&t===this.m_upperTranslation||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=o,this.m_upperTranslation=t,this.m_impulse.z=0)},box2d.b2PrismaticJoint.prototype.IsMotorEnabled=function(){return this.m_enableMotor},box2d.b2PrismaticJoint.prototype.EnableMotor=function(o){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=o},box2d.b2PrismaticJoint.prototype.SetMotorSpeed=function(o){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=o},box2d.b2PrismaticJoint.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},box2d.b2PrismaticJoint.prototype.SetMaxMotorForce=function(o){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=o},box2d.b2PrismaticJoint.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce},box2d.b2PrismaticJoint.prototype.GetMotorForce=function(o){return o*this.m_motorImpulse},box2d.b2PrismaticJoint.prototype.Dump=function(){if(box2d.DEBUG){var o=this.m_bodyA.m_islandIndex,t=this.m_bodyB.m_islandIndex;box2d.b2Log("  /*box2d.b2PrismaticJointDef*/ var jd = new box2d.b2PrismaticJointDef();\n"),box2d.b2Log("  jd.bodyA = bodies[%d];\n",o),box2d.b2Log("  jd.bodyB = bodies[%d];\n",t),box2d.b2Log("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),box2d.b2Log("  jd.localAnchorA.SetXY(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),box2d.b2Log("  jd.localAnchorB.SetXY(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),box2d.b2Log("  jd.localAxisA.SetXY(%.15f, %.15f);\n",this.m_localXAxisA.x,this.m_localXAxisA.y),box2d.b2Log("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),box2d.b2Log("  jd.enableLimit = %s;\n",this.m_enableLimit?"true":"false"),box2d.b2Log("  jd.lowerTranslation = %.15f;\n",this.m_lowerTranslation),box2d.b2Log("  jd.upperTranslation = %.15f;\n",this.m_upperTranslation),box2d.b2Log("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),box2d.b2Log("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),box2d.b2Log("  jd.maxMotorForce = %.15f;\n",this.m_maxMotorForce),box2d.b2Log("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}},goog.provide("box2d.b2GearJoint"),goog.require("box2d.b2Settings"),goog.require("box2d.b2Joint"),goog.require("box2d.b2Math"),goog.require("box2d.b2RevoluteJoint"),goog.require("box2d.b2PrismaticJoint"),box2d.b2GearJointDef=function(){goog.base(this,box2d.b2JointType.e_gearJoint)},goog.inherits(box2d.b2GearJointDef,box2d.b2JointDef),box2d.b2GearJointDef.prototype.joint1=null,box2d.b2GearJointDef.prototype.joint2=null,box2d.b2GearJointDef.prototype.ratio=1,box2d.b2GearJoint=function(o){var t,e;goog.base(this,o),this.m_joint1=o.joint1,this.m_joint2=o.joint2,this.m_localAnchorA=new box2d.b2Vec2,this.m_localAnchorB=new box2d.b2Vec2,this.m_localAnchorC=new box2d.b2Vec2,this.m_localAnchorD=new box2d.b2Vec2,this.m_localAxisC=new box2d.b2Vec2,this.m_localAxisD=new box2d.b2Vec2,this.m_lcA=new box2d.b2Vec2,this.m_lcB=new box2d.b2Vec2,this.m_lcC=new box2d.b2Vec2,this.m_lcD=new box2d.b2Vec2,this.m_JvAC=new box2d.b2Vec2,this.m_JvBD=new box2d.b2Vec2,this.m_qA=new box2d.b2Rot,this.m_qB=new box2d.b2Rot,this.m_qC=new box2d.b2Rot,this.m_qD=new box2d.b2Rot,this.m_lalcA=new box2d.b2Vec2,this.m_lalcB=new box2d.b2Vec2,this.m_lalcC=new box2d.b2Vec2,this.m_lalcD=new box2d.b2Vec2,this.m_typeA=this.m_joint1.GetType(),this.m_typeB=this.m_joint2.GetType(),box2d.ENABLE_ASSERTS&&box2d.b2Assert(this.m_typeA===box2d.b2JointType.e_revoluteJoint||this.m_typeA===box2d.b2JointType.e_prismaticJoint),box2d.ENABLE_ASSERTS&&box2d.b2Assert(this.m_typeB===box2d.b2JointType.e_revoluteJoint||this.m_typeB===box2d.b2JointType.e_prismaticJoint),this.m_bodyC=this.m_joint1.GetBodyA(),this.m_bodyA=this.m_joint1.GetBodyB();var i=this.m_bodyA.m_xf,n=this.m_bodyA.m_sweep.a,s=this.m_bodyC.m_xf,r=this.m_bodyC.m_sweep.a;if(this.m_typeA===box2d.b2JointType.e_revoluteJoint){var b=o.joint1;this.m_localAnchorC.Copy(b.m_localAnchorA),this.m_localAnchorA.Copy(b.m_localAnchorB),this.m_referenceAngleA=b.m_referenceAngle,this.m_localAxisC.SetZero(),t=n-r-this.m_referenceAngleA}else{var a=o.joint1;this.m_localAnchorC.Copy(a.m_localAnchorA),this.m_localAnchorA.Copy(a.m_localAnchorB),this.m_referenceAngleA=a.m_referenceAngle,this.m_localAxisC.Copy(a.m_localXAxisA);var d=this.m_localAnchorC,l=box2d.b2MulTRV(s.q,box2d.b2AddVV(box2d.b2MulRV(i.q,this.m_localAnchorA,box2d.b2Vec2.s_t0),box2d.b2SubVV(i.p,s.p,box2d.b2Vec2.s_t1),box2d.b2Vec2.s_t0),box2d.b2Vec2.s_t0);t=box2d.b2DotVV(box2d.b2SubVV(l,d,box2d.b2Vec2.s_t0),this.m_localAxisC)}this.m_bodyD=this.m_joint2.GetBodyA(),this.m_bodyB=this.m_joint2.GetBodyB();var x=this.m_bodyB.m_xf,p=this.m_bodyB.m_sweep.a,m=this.m_bodyD.m_xf,h=this.m_bodyD.m_sweep.a;if(this.m_typeB===box2d.b2JointType.e_revoluteJoint){b=o.joint2;this.m_localAnchorD.Copy(b.m_localAnchorA),this.m_localAnchorB.Copy(b.m_localAnchorB),this.m_referenceAngleB=b.m_referenceAngle,this.m_localAxisD.SetZero(),e=p-h-this.m_referenceAngleB}else{a=o.joint2;this.m_localAnchorD.Copy(a.m_localAnchorA),this.m_localAnchorB.Copy(a.m_localAnchorB),this.m_referenceAngleB=a.m_referenceAngle,this.m_localAxisD.Copy(a.m_localXAxisA);var _=this.m_localAnchorD,c=box2d.b2MulTRV(m.q,box2d.b2AddVV(box2d.b2MulRV(x.q,this.m_localAnchorB,box2d.b2Vec2.s_t0),box2d.b2SubVV(x.p,m.p,box2d.b2Vec2.s_t1),box2d.b2Vec2.s_t0),box2d.b2Vec2.s_t0);e=box2d.b2DotVV(box2d.b2SubVV(c,_,box2d.b2Vec2.s_t0),this.m_localAxisD)}this.m_ratio=o.ratio,this.m_constant=t+this.m_ratio*e,this.m_impulse=0},goog.inherits(box2d.b2GearJoint,box2d.b2Joint),box2d.b2GearJoint.prototype.m_joint1=null,box2d.b2GearJoint.prototype.m_joint2=null,box2d.b2GearJoint.prototype.m_typeA=box2d.b2JointType.e_unknownJoint,box2d.b2GearJoint.prototype.m_typeB=box2d.b2JointType.e_unknownJoint,box2d.b2GearJoint.prototype.m_bodyC=null,box2d.b2GearJoint.prototype.m_bodyD=null,box2d.b2GearJoint.prototype.m_localAnchorA=null,box2d.b2GearJoint.prototype.m_localAnchorB=null,box2d.b2GearJoint.prototype.m_localAnchorC=null,box2d.b2GearJoint.prototype.m_localAnchorD=null,box2d.b2GearJoint.prototype.m_localAxisC=null,box2d.b2GearJoint.prototype.m_localAxisD=null,box2d.b2GearJoint.prototype.m_referenceAngleA=0,box2d.b2GearJoint.prototype.m_referenceAngleB=0,box2d.b2GearJoint.prototype.m_constant=0,box2d.b2GearJoint.prototype.m_ratio=0,box2d.b2GearJoint.prototype.m_impulse=0,box2d.b2GearJoint.prototype.m_indexA=0,box2d.b2GearJoint.prototype.m_indexB=0,box2d.b2GearJoint.prototype.m_indexC=0,box2d.b2GearJoint.prototype.m_indexD=0,box2d.b2GearJoint.prototype.m_lcA=null,box2d.b2GearJoint.prototype.m_lcB=null,box2d.b2GearJoint.prototype.m_lcC=null,box2d.b2GearJoint.prototype.m_lcD=null,box2d.b2GearJoint.prototype.m_mA=0,box2d.b2GearJoint.prototype.m_mB=0,box2d.b2GearJoint.prototype.m_mC=0,box2d.b2GearJoint.prototype.m_mD=0,box2d.b2GearJoint.prototype.m_iA=0,box2d.b2GearJoint.prototype.m_iB=0,box2d.b2GearJoint.prototype.m_iC=0,box2d.b2GearJoint.prototype.m_iD=0,box2d.b2GearJoint.prototype.m_JvAC=null,box2d.b2GearJoint.prototype.m_JvBD=null,box2d.b2GearJoint.prototype.m_JwA=0,box2d.b2GearJoint.prototype.m_JwB=0,box2d.b2GearJoint.prototype.m_JwC=0,box2d.b2GearJoint.prototype.m_JwD=0,box2d.b2GearJoint.prototype.m_mass=0,box2d.b2GearJoint.prototype.m_qA=null,box2d.b2GearJoint.prototype.m_qB=null,box2d.b2GearJoint.prototype.m_qC=null,box2d.b2GearJoint.prototype.m_qD=null,box2d.b2GearJoint.prototype.m_lalcA=null,box2d.b2GearJoint.prototype.m_lalcB=null,box2d.b2GearJoint.prototype.m_lalcC=null,box2d.b2GearJoint.prototype.m_lalcD=null,box2d.b2GearJoint.prototype.InitVelocityConstraints=function(o){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_indexC=this.m_bodyC.m_islandIndex,this.m_indexD=this.m_bodyD.m_islandIndex,this.m_lcA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_lcB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_lcC.Copy(this.m_bodyC.m_sweep.localCenter),this.m_lcD.Copy(this.m_bodyD.m_sweep.localCenter),this.m_mA=this.m_bodyA.m_invMass,this.m_mB=this.m_bodyB.m_invMass,this.m_mC=this.m_bodyC.m_invMass,this.m_mD=this.m_bodyD.m_invMass,this.m_iA=this.m_bodyA.m_invI,this.m_iB=this.m_bodyB.m_invI,this.m_iC=this.m_bodyC.m_invI,this.m_iD=this.m_bodyD.m_invI;var t=o.positions[this.m_indexA].a,e=o.velocities[this.m_indexA].v,i=o.velocities[this.m_indexA].w,n=o.positions[this.m_indexB].a,s=o.velocities[this.m_indexB].v,r=o.velocities[this.m_indexB].w,b=o.positions[this.m_indexC].a,a=o.velocities[this.m_indexC].v,d=o.velocities[this.m_indexC].w,l=o.positions[this.m_indexD].a,x=o.velocities[this.m_indexD].v,p=o.velocities[this.m_indexD].w,m=this.m_qA.SetAngleRadians(t),h=this.m_qB.SetAngleRadians(n),_=this.m_qC.SetAngleRadians(b),c=this.m_qD.SetAngleRadians(l);if(this.m_mass=0,this.m_typeA===box2d.b2JointType.e_revoluteJoint)this.m_JvAC.SetZero(),this.m_JwA=1,this.m_JwC=1,this.m_mass+=this.m_iA+this.m_iC;else{var y=box2d.b2MulRV(_,this.m_localAxisC,box2d.b2GearJoint.prototype.InitVelocityConstraints.s_u);box2d.b2SubVV(this.m_localAnchorC,this.m_lcC,this.m_lalcC);var u=box2d.b2MulRV(_,this.m_lalcC,box2d.b2GearJoint.prototype.InitVelocityConstraints.s_rC);box2d.b2SubVV(this.m_localAnchorA,this.m_lcA,this.m_lalcA);var g=box2d.b2MulRV(m,this.m_lalcA,box2d.b2GearJoint.prototype.InitVelocityConstraints.s_rA);this.m_JvAC.Copy(y),this.m_JwC=box2d.b2CrossVV(u,y),this.m_JwA=box2d.b2CrossVV(g,y),this.m_mass+=this.m_mC+this.m_mA+this.m_iC*this.m_JwC*this.m_JwC+this.m_iA*this.m_JwA*this.m_JwA}if(this.m_typeB===box2d.b2JointType.e_revoluteJoint)this.m_JvBD.SetZero(),this.m_JwB=this.m_ratio,this.m_JwD=this.m_ratio,this.m_mass+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD);else{y=box2d.b2MulRV(c,this.m_localAxisD,box2d.b2GearJoint.prototype.InitVelocityConstraints.s_u);box2d.b2SubVV(this.m_localAnchorD,this.m_lcD,this.m_lalcD);var f=box2d.b2MulRV(c,this.m_lalcD,box2d.b2GearJoint.prototype.InitVelocityConstraints.s_rD);box2d.b2SubVV(this.m_localAnchorB,this.m_lcB,this.m_lalcB);var S=box2d.b2MulRV(h,this.m_lalcB,box2d.b2GearJoint.prototype.InitVelocityConstraints.s_rB);box2d.b2MulSV(this.m_ratio,y,this.m_JvBD),this.m_JwD=this.m_ratio*box2d.b2CrossVV(f,y),this.m_JwB=this.m_ratio*box2d.b2CrossVV(S,y),this.m_mass+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*this.m_JwD*this.m_JwD+this.m_iB*this.m_JwB*this.m_JwB}this.m_mass=0<this.m_mass?1/this.m_mass:0,o.step.warmStarting?(e.SelfMulAdd(this.m_mA*this.m_impulse,this.m_JvAC),i+=this.m_iA*this.m_impulse*this.m_JwA,s.SelfMulAdd(this.m_mB*this.m_impulse,this.m_JvBD),r+=this.m_iB*this.m_impulse*this.m_JwB,a.SelfMulSub(this.m_mC*this.m_impulse,this.m_JvAC),d-=this.m_iC*this.m_impulse*this.m_JwC,x.SelfMulSub(this.m_mD*this.m_impulse,this.m_JvBD),p-=this.m_iD*this.m_impulse*this.m_JwD):this.m_impulse=0,o.velocities[this.m_indexA].w=i,o.velocities[this.m_indexB].w=r,o.velocities[this.m_indexC].w=d,o.velocities[this.m_indexD].w=p},box2d.b2GearJoint.prototype.InitVelocityConstraints.s_u=new box2d.b2Vec2,box2d.b2GearJoint.prototype.InitVelocityConstraints.s_rA=new box2d.b2Vec2,box2d.b2GearJoint.prototype.InitVelocityConstraints.s_rB=new box2d.b2Vec2,box2d.b2GearJoint.prototype.InitVelocityConstraints.s_rC=new box2d.b2Vec2,box2d.b2GearJoint.prototype.InitVelocityConstraints.s_rD=new box2d.b2Vec2,box2d.b2GearJoint.prototype.SolveVelocityConstraints=function(o){var t=o.velocities[this.m_indexA].v,e=o.velocities[this.m_indexA].w,i=o.velocities[this.m_indexB].v,n=o.velocities[this.m_indexB].w,s=o.velocities[this.m_indexC].v,r=o.velocities[this.m_indexC].w,b=o.velocities[this.m_indexD].v,a=o.velocities[this.m_indexD].w,d=box2d.b2DotVV(this.m_JvAC,box2d.b2SubVV(t,s,box2d.b2Vec2.s_t0))+box2d.b2DotVV(this.m_JvBD,box2d.b2SubVV(i,b,box2d.b2Vec2.s_t0));d+=this.m_JwA*e-this.m_JwC*r+(this.m_JwB*n-this.m_JwD*a);var l=-this.m_mass*d;this.m_impulse+=l,t.SelfMulAdd(this.m_mA*l,this.m_JvAC),e+=this.m_iA*l*this.m_JwA,i.SelfMulAdd(this.m_mB*l,this.m_JvBD),n+=this.m_iB*l*this.m_JwB,s.SelfMulSub(this.m_mC*l,this.m_JvAC),r-=this.m_iC*l*this.m_JwC,b.SelfMulSub(this.m_mD*l,this.m_JvBD),a-=this.m_iD*l*this.m_JwD,o.velocities[this.m_indexA].w=e,o.velocities[this.m_indexB].w=n,o.velocities[this.m_indexC].w=r,o.velocities[this.m_indexD].w=a},box2d.b2GearJoint.prototype.SolvePositionConstraints=function(o){var t,e,i,n,s,r,b=o.positions[this.m_indexA].c,a=o.positions[this.m_indexA].a,d=o.positions[this.m_indexB].c,l=o.positions[this.m_indexB].a,x=o.positions[this.m_indexC].c,p=o.positions[this.m_indexC].a,m=o.positions[this.m_indexD].c,h=o.positions[this.m_indexD].a,_=this.m_qA.SetAngleRadians(a),c=this.m_qB.SetAngleRadians(l),y=this.m_qC.SetAngleRadians(p),u=this.m_qD.SetAngleRadians(h),g=this.m_JvAC,f=this.m_JvBD,S=0;if(this.m_typeA===box2d.b2JointType.e_revoluteJoint)g.SetZero(),s=i=1,S+=this.m_iA+this.m_iC,t=a-p-this.m_referenceAngleA;else{var A=box2d.b2MulRV(y,this.m_localAxisC,box2d.b2GearJoint.prototype.SolvePositionConstraints.s_u),C=box2d.b2MulRV(y,this.m_lalcC,box2d.b2GearJoint.prototype.SolvePositionConstraints.s_rC),v=box2d.b2MulRV(_,this.m_lalcA,box2d.b2GearJoint.prototype.SolvePositionConstraints.s_rA);g.Copy(A),s=box2d.b2CrossVV(C,A),i=box2d.b2CrossVV(v,A),S+=this.m_mC+this.m_mA+this.m_iC*s*s+this.m_iA*i*i;var V=this.m_lalcC,B=box2d.b2MulTRV(y,box2d.b2AddVV(v,box2d.b2SubVV(b,x,box2d.b2Vec2.s_t0),box2d.b2Vec2.s_t0),box2d.b2Vec2.s_t0);t=box2d.b2DotVV(box2d.b2SubVV(B,V,box2d.b2Vec2.s_t0),this.m_localAxisC)}if(this.m_typeB===box2d.b2JointType.e_revoluteJoint)f.SetZero(),n=this.m_ratio,r=this.m_ratio,S+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD),e=l-h-this.m_referenceAngleB;else{A=box2d.b2MulRV(u,this.m_localAxisD,box2d.b2GearJoint.prototype.SolvePositionConstraints.s_u);var w=box2d.b2MulRV(u,this.m_lalcD,box2d.b2GearJoint.prototype.SolvePositionConstraints.s_rD),P=box2d.b2MulRV(c,this.m_lalcB,box2d.b2GearJoint.prototype.SolvePositionConstraints.s_rB);box2d.b2MulSV(this.m_ratio,A,f),r=this.m_ratio*box2d.b2CrossVV(w,A),n=this.m_ratio*box2d.b2CrossVV(P,A),S+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*r*r+this.m_iB*n*n;var M=this.m_lalcD,D=box2d.b2MulTRV(u,box2d.b2AddVV(P,box2d.b2SubVV(d,m,box2d.b2Vec2.s_t0),box2d.b2Vec2.s_t0),box2d.b2Vec2.s_t0);e=box2d.b2DotVV(box2d.b2SubVV(D,M,box2d.b2Vec2.s_t0),this.m_localAxisD)}var J=t+this.m_ratio*e-this.m_constant,T=0;return 0<S&&(T=-J/S),b.SelfMulAdd(this.m_mA*T,g),a+=this.m_iA*T*i,d.SelfMulAdd(this.m_mB*T,f),l+=this.m_iB*T*n,x.SelfMulSub(this.m_mC*T,g),p-=this.m_iC*T*s,m.SelfMulSub(this.m_mD*T,f),h-=this.m_iD*T*r,o.positions[this.m_indexA].a=a,o.positions[this.m_indexB].a=l,o.positions[this.m_indexC].a=p,o.positions[this.m_indexD].a=h,0<box2d.b2_linearSlop},box2d.b2GearJoint.prototype.SolvePositionConstraints.s_u=new box2d.b2Vec2,box2d.b2GearJoint.prototype.SolvePositionConstraints.s_rA=new box2d.b2Vec2,box2d.b2GearJoint.prototype.SolvePositionConstraints.s_rB=new box2d.b2Vec2,box2d.b2GearJoint.prototype.SolvePositionConstraints.s_rC=new box2d.b2Vec2,box2d.b2GearJoint.prototype.SolvePositionConstraints.s_rD=new box2d.b2Vec2,box2d.b2GearJoint.prototype.GetAnchorA=function(o){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,o)},box2d.b2GearJoint.prototype.GetAnchorB=function(o){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,o)},box2d.b2GearJoint.prototype.GetReactionForce=function(o,t){return box2d.b2MulSV(o*this.m_impulse,this.m_JvAC,t)},box2d.b2GearJoint.prototype.GetReactionTorque=function(o){return o*this.m_impulse*this.m_JwA},box2d.b2GearJoint.prototype.GetJoint1=function(){return this.m_joint1},box2d.b2GearJoint.prototype.GetJoint2=function(){return this.m_joint2},box2d.b2GearJoint.prototype.GetRatio=function(){return this.m_ratio},box2d.b2GearJoint.prototype.SetRatio=function(o){box2d.ENABLE_ASSERTS&&box2d.b2Assert(box2d.b2IsValid(o)),this.m_ratio=o},box2d.b2GearJoint.prototype.Dump=function(){if(box2d.DEBUG){var o=this.m_bodyA.m_islandIndex,t=this.m_bodyB.m_islandIndex,e=this.m_joint1.m_index,i=this.m_joint2.m_index;box2d.b2Log("  /*box2d.b2GearJointDef*/ var jd = new box2d.b2GearJointDef();\n"),box2d.b2Log("  jd.bodyA = bodies[%d];\n",o),box2d.b2Log("  jd.bodyB = bodies[%d];\n",t),box2d.b2Log("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),box2d.b2Log("  jd.joint1 = joints[%d];\n",e),box2d.b2Log("  jd.joint2 = joints[%d];\n",i),box2d.b2Log("  jd.ratio = %.15f;\n",this.m_ratio),box2d.b2Log("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}},goog.provide("box2d.b2Distance"),goog.require("box2d.b2Settings"),goog.require("box2d.b2Math"),box2d.b2DistanceProxy=function(){this.m_buffer=box2d.b2Vec2.MakeArray(2)},box2d.b2DistanceProxy.prototype.m_buffer=null,box2d.b2DistanceProxy.prototype.m_vertices=null,box2d.b2DistanceProxy.prototype.m_count=0,box2d.b2DistanceProxy.prototype.m_radius=0,box2d.b2DistanceProxy.prototype.Reset=function(){return this.m_vertices=null,this.m_count=0,this.m_radius=0,this},box2d.b2DistanceProxy.prototype.SetShape=function(o,t){o.SetupDistanceProxy(this,t)},box2d.b2DistanceProxy.prototype.GetSupport=function(o){for(var t=0,e=box2d.b2DotVV(this.m_vertices[0],o),i=1;i<this.m_count;++i){var n=box2d.b2DotVV(this.m_vertices[i],o);e<n&&(t=i,e=n)}return t},box2d.b2DistanceProxy.prototype.GetSupportVertex=function(o,t){for(var e=0,i=box2d.b2DotVV(this.m_vertices[0],o),n=1;n<this.m_count;++n){var s=box2d.b2DotVV(this.m_vertices[n],o);i<s&&(e=n,i=s)}return t.Copy(this.m_vertices[e])},box2d.b2DistanceProxy.prototype.GetVertexCount=function(){return this.m_count},box2d.b2DistanceProxy.prototype.GetVertex=function(o){return box2d.ENABLE_ASSERTS&&box2d.b2Assert(0<=o&&o<this.m_count),this.m_vertices[o]},box2d.b2SimplexCache=function(){this.indexA=box2d.b2MakeNumberArray(3),this.indexB=box2d.b2MakeNumberArray(3)},box2d.b2SimplexCache.prototype.metric=0,box2d.b2SimplexCache.prototype.count=0,box2d.b2SimplexCache.prototype.indexA=null,box2d.b2SimplexCache.prototype.indexB=null,box2d.b2SimplexCache.prototype.Reset=function(){return this.metric=0,this.count=0,this},box2d.b2DistanceInput=function(){this.proxyA=new box2d.b2DistanceProxy,this.proxyB=new box2d.b2DistanceProxy,this.transformA=new box2d.b2Transform,this.transformB=new box2d.b2Transform},box2d.b2DistanceInput.prototype.proxyA=null,box2d.b2DistanceInput.prototype.proxyB=null,box2d.b2DistanceInput.prototype.transformA=null,box2d.b2DistanceInput.prototype.transformB=null,box2d.b2DistanceInput.prototype.useRadii=!1,box2d.b2DistanceInput.prototype.Reset=function(){return this.proxyA.Reset(),this.proxyB.Reset(),this.transformA.SetIdentity(),this.transformB.SetIdentity(),this.useRadii=!1,this},box2d.b2DistanceOutput=function(){this.pointA=new box2d.b2Vec2,this.pointB=new box2d.b2Vec2},box2d.b2DistanceOutput.prototype.pointA=null,box2d.b2DistanceOutput.prototype.pointB=null,box2d.b2DistanceOutput.prototype.distance=0,box2d.b2DistanceOutput.prototype.iterations=0,box2d.b2DistanceOutput.prototype.Reset=function(){return this.pointA.SetZero(),this.pointB.SetZero(),this.distance=0,this.iterations=0,this},box2d.b2_gjkCalls=0,box2d.b2_gjkIters=0,box2d.b2_gjkMaxIters=0,box2d.b2SimplexVertex=function(){this.wA=new box2d.b2Vec2,this.wB=new box2d.b2Vec2,this.w=new box2d.b2Vec2},box2d.b2SimplexVertex.prototype.wA=null,box2d.b2SimplexVertex.prototype.wB=null,box2d.b2SimplexVertex.prototype.w=null,box2d.b2SimplexVertex.prototype.a=0,box2d.b2SimplexVertex.prototype.indexA=0,box2d.b2SimplexVertex.prototype.indexB=0,box2d.b2SimplexVertex.prototype.Copy=function(o){return this.wA.Copy(o.wA),this.wB.Copy(o.wB),this.w.Copy(o.w),this.a=o.a,this.indexA=o.indexA,this.indexB=o.indexB,this},box2d.b2Simplex=function(){this.m_v1=new box2d.b2SimplexVertex,this.m_v2=new box2d.b2SimplexVertex,this.m_v3=new box2d.b2SimplexVertex,this.m_vertices=new Array(3),this.m_vertices[0]=this.m_v1,this.m_vertices[1]=this.m_v2,this.m_vertices[2]=this.m_v3},box2d.b2Simplex.prototype.m_v1=null,box2d.b2Simplex.prototype.m_v2=null,box2d.b2Simplex.prototype.m_v3=null,box2d.b2Simplex.prototype.m_vertices=null,box2d.b2Simplex.prototype.m_count=0,box2d.b2Simplex.prototype.ReadCache=function(o,t,e,i,n){box2d.ENABLE_ASSERTS&&box2d.b2Assert(0<=o.count&&o.count<=3),this.m_count=o.count;for(var s=this.m_vertices,r=0;r<this.m_count;++r){(x=s[r]).indexA=o.indexA[r],x.indexB=o.indexB[r];var b=t.GetVertex(x.indexA),a=i.GetVertex(x.indexB);box2d.b2MulXV(e,b,x.wA),box2d.b2MulXV(n,a,x.wB),box2d.b2SubVV(x.wB,x.wA,x.w),x.a=0}if(1<this.m_count){var d=o.metric,l=this.GetMetric();(l<.5*d||2*d<l||l<box2d.b2_epsilon)&&(this.m_count=0)}if(0===this.m_count){var x;(x=s[0]).indexA=0,x.indexB=0;b=t.GetVertex(0),a=i.GetVertex(0);box2d.b2MulXV(e,b,x.wA),box2d.b2MulXV(n,a,x.wB),box2d.b2SubVV(x.wB,x.wA,x.w),x.a=1,this.m_count=1}},box2d.b2Simplex.prototype.WriteCache=function(o){o.metric=this.GetMetric(),o.count=this.m_count;for(var t=this.m_vertices,e=0;e<this.m_count;++e)o.indexA[e]=t[e].indexA,o.indexB[e]=t[e].indexB},box2d.b2Simplex.prototype.GetSearchDirection=function(o){switch(this.m_count){case 1:return box2d.b2NegV(this.m_v1.w,o);case 2:var t=box2d.b2SubVV(this.m_v2.w,this.m_v1.w,o);return 0<box2d.b2CrossVV(t,box2d.b2NegV(this.m_v1.w,box2d.b2Vec2.s_t0))?box2d.b2CrossOneV(t,o):box2d.b2CrossVOne(t,o);default:return box2d.ENABLE_ASSERTS&&box2d.b2Assert(!1),o.SetZero()}},box2d.b2Simplex.prototype.GetClosestPoint=function(o){switch(this.m_count){case 0:return box2d.ENABLE_ASSERTS&&box2d.b2Assert(!1),o.SetZero();case 1:return o.Copy(this.m_v1.w);case 2:return o.SetXY(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);case 3:return o.SetZero();default:return box2d.ENABLE_ASSERTS&&box2d.b2Assert(!1),o.SetZero()}},box2d.b2Simplex.prototype.GetWitnessPoints=function(o,t){switch(this.m_count){case 0:box2d.ENABLE_ASSERTS&&box2d.b2Assert(!1);break;case 1:o.Copy(this.m_v1.wA),t.Copy(this.m_v1.wB);break;case 2:o.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,o.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,t.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,t.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:t.x=o.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,t.y=o.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;break;default:box2d.ENABLE_ASSERTS&&box2d.b2Assert(!1)}},box2d.b2Simplex.prototype.GetMetric=function(){switch(this.m_count){case 0:return box2d.ENABLE_ASSERTS&&box2d.b2Assert(!1),0;case 1:return 0;case 2:return box2d.b2DistanceVV(this.m_v1.w,this.m_v2.w);case 3:return box2d.b2CrossVV(box2d.b2SubVV(this.m_v2.w,this.m_v1.w,box2d.b2Vec2.s_t0),box2d.b2SubVV(this.m_v3.w,this.m_v1.w,box2d.b2Vec2.s_t1));default:return box2d.ENABLE_ASSERTS&&box2d.b2Assert(!1),0}},box2d.b2Simplex.prototype.Solve2=function(){var o=this.m_v1.w,t=this.m_v2.w,e=box2d.b2SubVV(t,o,box2d.b2Simplex.s_e12),i=-box2d.b2DotVV(o,e);if(i<=0)return this.m_v1.a=1,void(this.m_count=1);var n=box2d.b2DotVV(t,e);if(n<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v2);var s=1/(n+i);this.m_v1.a=n*s,this.m_v2.a=i*s,this.m_count=2},box2d.b2Simplex.prototype.Solve3=function(){var o=this.m_v1.w,t=this.m_v2.w,e=this.m_v3.w,i=box2d.b2SubVV(t,o,box2d.b2Simplex.s_e12),n=box2d.b2DotVV(o,i),s=box2d.b2DotVV(t,i),r=-n,b=box2d.b2SubVV(e,o,box2d.b2Simplex.s_e13),a=box2d.b2DotVV(o,b),d=box2d.b2DotVV(e,b),l=-a,x=box2d.b2SubVV(e,t,box2d.b2Simplex.s_e23),p=box2d.b2DotVV(t,x),m=box2d.b2DotVV(e,x),h=-p,_=box2d.b2CrossVV(i,b),c=_*box2d.b2CrossVV(t,e),y=_*box2d.b2CrossVV(e,o),u=_*box2d.b2CrossVV(o,t);if(r<=0&&l<=0)return this.m_v1.a=1,void(this.m_count=1);if(0<s&&0<r&&u<=0){var g=1/(s+r);return this.m_v1.a=s*g,this.m_v2.a=r*g,void(this.m_count=2)}if(0<d&&0<l&&y<=0){var f=1/(d+l);return this.m_v1.a=d*f,this.m_v3.a=l*f,this.m_count=2,void this.m_v2.Copy(this.m_v3)}if(s<=0&&h<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v2);if(d<=0&&m<=0)return this.m_v3.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v3);if(0<m&&0<h&&c<=0){var S=1/(m+h);return this.m_v2.a=m*S,this.m_v3.a=h*S,this.m_count=2,void this.m_v1.Copy(this.m_v3)}var A=1/(c+y+u);this.m_v1.a=c*A,this.m_v2.a=y*A,this.m_v3.a=u*A,this.m_count=3},box2d.b2Simplex.s_e12=new box2d.b2Vec2,box2d.b2Simplex.s_e13=new box2d.b2Vec2,box2d.b2Simplex.s_e23=new box2d.b2Vec2,box2d.b2Distance=function(o,t,e){++box2d.b2_gjkCalls;var i=e.proxyA,n=e.proxyB,s=e.transformA,r=e.transformB,b=box2d.b2Distance.s_simplex;b.ReadCache(t,i,s,n,r);for(var a=b.m_vertices,d=box2d.b2Distance.s_saveA,l=box2d.b2Distance.s_saveB,x=0,p=(box2d.b2_maxFloat,0);p<20;){x=b.m_count;for(var m=0;m<x;++m)d[m]=a[m].indexA,l[m]=a[m].indexB;switch(b.m_count){case 1:break;case 2:b.Solve2();break;case 3:b.Solve3();break;default:box2d.ENABLE_ASSERTS&&box2d.b2Assert(!1)}if(3===b.m_count)break;(f=b.GetClosestPoint(box2d.b2Distance.s_p)).GetLengthSquared();var h=b.GetSearchDirection(box2d.b2Distance.s_d);if(h.GetLengthSquared()<box2d.b2_epsilon_sq)break;var _=a[b.m_count];_.indexA=i.GetSupport(box2d.b2MulTRV(s.q,box2d.b2NegV(h,box2d.b2Vec2.s_t0),box2d.b2Distance.s_supportA)),box2d.b2MulXV(s,i.GetVertex(_.indexA),_.wA),_.indexB=n.GetSupport(box2d.b2MulTRV(r.q,h,box2d.b2Distance.s_supportB)),box2d.b2MulXV(r,n.GetVertex(_.indexB),_.wB),box2d.b2SubVV(_.wB,_.wA,_.w),++p,++box2d.b2_gjkIters;var c=!1;for(m=0;m<x;++m)if(_.indexA===d[m]&&_.indexB===l[m]){c=!0;break}if(c)break;++b.m_count}if(box2d.b2_gjkMaxIters=box2d.b2Max(box2d.b2_gjkMaxIters,p),b.GetWitnessPoints(o.pointA,o.pointB),o.distance=box2d.b2DistanceVV(o.pointA,o.pointB),o.iterations=p,b.WriteCache(t),e.useRadii){var y=i.m_radius,u=n.m_radius;if(o.distance>y+u&&o.distance>box2d.b2_epsilon){o.distance-=y+u;var g=box2d.b2SubVV(o.pointB,o.pointA,box2d.b2Distance.s_normal);g.Normalize(),o.pointA.SelfMulAdd(y,g),o.pointB.SelfMulSub(u,g)}else{var f=box2d.b2MidVV(o.pointA,o.pointB,box2d.b2Distance.s_p);o.pointA.Copy(f),o.pointB.Copy(f),o.distance=0}}},box2d.b2Distance.s_simplex=new box2d.b2Simplex,box2d.b2Distance.s_saveA=box2d.b2MakeNumberArray(3),box2d.b2Distance.s_saveB=box2d.b2MakeNumberArray(3),box2d.b2Distance.s_p=new box2d.b2Vec2,box2d.b2Distance.s_d=new box2d.b2Vec2,box2d.b2Distance.s_normal=new box2d.b2Vec2,box2d.b2Distance.s_supportA=new box2d.b2Vec2,box2d.b2Distance.s_supportB=new box2d.b2Vec2,goog.provide("box2d.b2WeldJoint"),goog.require("box2d.b2Settings"),goog.require("box2d.b2Joint"),goog.require("box2d.b2Math"),box2d.b2WeldJointDef=function(){goog.base(this,box2d.b2JointType.e_weldJoint),this.localAnchorA=new box2d.b2Vec2,this.localAnchorB=new box2d.b2Vec2},goog.inherits(box2d.b2WeldJointDef,box2d.b2JointDef),box2d.b2WeldJointDef.prototype.localAnchorA=null,box2d.b2WeldJointDef.prototype.localAnchorB=null,box2d.b2WeldJointDef.prototype.referenceAngle=0,box2d.b2WeldJointDef.prototype.frequencyHz=0,box2d.b2WeldJointDef.prototype.dampingRatio=0,box2d.b2WeldJointDef.prototype.Initialize=function(o,t,e){this.bodyA=o,this.bodyB=t,this.bodyA.GetLocalPoint(e,this.localAnchorA),this.bodyB.GetLocalPoint(e,this.localAnchorB),this.referenceAngle=this.bodyB.GetAngleRadians()-this.bodyA.GetAngleRadians()},box2d.b2WeldJoint=function(o){goog.base(this,o),this.m_frequencyHz=o.frequencyHz,this.m_dampingRatio=o.dampingRatio,this.m_localAnchorA=o.localAnchorA.Clone(),this.m_localAnchorB=o.localAnchorB.Clone(),this.m_referenceAngle=o.referenceAngle,this.m_impulse=new box2d.b2Vec3(0,0,0),this.m_rA=new box2d.b2Vec2,this.m_rB=new box2d.b2Vec2,this.m_localCenterA=new box2d.b2Vec2,this.m_localCenterB=new box2d.b2Vec2,this.m_mass=new box2d.b2Mat33,this.m_qA=new box2d.b2Rot,this.m_qB=new box2d.b2Rot,this.m_lalcA=new box2d.b2Vec2,this.m_lalcB=new box2d.b2Vec2,this.m_K=new box2d.b2Mat33},goog.inherits(box2d.b2WeldJoint,box2d.b2Joint),box2d.b2WeldJoint.prototype.m_frequencyHz=0,box2d.b2WeldJoint.prototype.m_dampingRatio=0,box2d.b2WeldJoint.prototype.m_bias=0,box2d.b2WeldJoint.prototype.m_localAnchorA=null,box2d.b2WeldJoint.prototype.m_localAnchorB=null,box2d.b2WeldJoint.prototype.m_referenceAngle=0,box2d.b2WeldJoint.prototype.m_gamma=0,box2d.b2WeldJoint.prototype.m_impulse=null,box2d.b2WeldJoint.prototype.m_indexA=0,box2d.b2WeldJoint.prototype.m_indexB=0,box2d.b2WeldJoint.prototype.m_rA=null,box2d.b2WeldJoint.prototype.m_rB=null,box2d.b2WeldJoint.prototype.m_localCenterA=null,box2d.b2WeldJoint.prototype.m_localCenterB=null,box2d.b2WeldJoint.prototype.m_invMassA=0;box2d.b2WeldJoint.prototype.m_invMassB=0,box2d.b2WeldJoint.prototype.m_invIA=0,box2d.b2WeldJoint.prototype.m_invIB=0,box2d.b2WeldJoint.prototype.m_mass=null,box2d.b2WeldJoint.prototype.m_qA=null,box2d.b2WeldJoint.prototype.m_qB=null,box2d.b2WeldJoint.prototype.m_lalcA=null,box2d.b2WeldJoint.prototype.m_lalcB=null,box2d.b2WeldJoint.prototype.m_K=null,box2d.b2WeldJoint.prototype.InitVelocityConstraints=function(o){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var t=o.positions[this.m_indexA].a,e=o.velocities[this.m_indexA].v,i=o.velocities[this.m_indexA].w,n=o.positions[this.m_indexB].a,s=o.velocities[this.m_indexB].v,r=o.velocities[this.m_indexB].w,b=this.m_qA.SetAngleRadians(t),a=this.m_qB.SetAngleRadians(n);box2d.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),box2d.b2MulRV(b,this.m_lalcA,this.m_rA),box2d.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),box2d.b2MulRV(a,this.m_lalcB,this.m_rB);var d=this.m_invMassA,l=this.m_invMassB,x=this.m_invIA,p=this.m_invIB,m=this.m_K;if(m.ex.x=d+l+this.m_rA.y*this.m_rA.y*x+this.m_rB.y*this.m_rB.y*p,m.ey.x=-this.m_rA.y*this.m_rA.x*x-this.m_rB.y*this.m_rB.x*p,m.ez.x=-this.m_rA.y*x-this.m_rB.y*p,m.ex.y=m.ey.x,m.ey.y=d+l+this.m_rA.x*this.m_rA.x*x+this.m_rB.x*this.m_rB.x*p,m.ez.y=this.m_rA.x*x+this.m_rB.x*p,m.ex.z=m.ez.x,m.ey.z=m.ez.y,m.ez.z=x+p,0<this.m_frequencyHz){m.GetInverse22(this.m_mass);var h=x+p,_=0<h?1/h:0,c=n-t-this.m_referenceAngle,y=2*box2d.b2_pi*this.m_frequencyHz,u=2*_*this.m_dampingRatio*y,g=_*y*y,f=o.step.dt;this.m_gamma=f*(u+f*g),this.m_gamma=0!==this.m_gamma?1/this.m_gamma:0,this.m_bias=c*f*g*this.m_gamma,h+=this.m_gamma,this.m_mass.ez.z=0!==h?1/h:0}else m.GetSymInverse33(this.m_mass),this.m_gamma=0,this.m_bias=0;if(o.step.warmStarting){this.m_impulse.SelfMul(o.step.dtRatio);var S=box2d.b2WeldJoint.prototype.InitVelocityConstraints.s_P.SetXY(this.m_impulse.x,this.m_impulse.y);e.SelfMulSub(d,S),i-=x*(box2d.b2CrossVV(this.m_rA,S)+this.m_impulse.z),s.SelfMulAdd(l,S),r+=p*(box2d.b2CrossVV(this.m_rB,S)+this.m_impulse.z)}else this.m_impulse.SetZero();o.velocities[this.m_indexA].w=i,o.velocities[this.m_indexB].w=r},box2d.b2WeldJoint.prototype.InitVelocityConstraints.s_P=new box2d.b2Vec2,box2d.b2WeldJoint.prototype.SolveVelocityConstraints=function(o){var t=o.velocities[this.m_indexA].v,e=o.velocities[this.m_indexA].w,i=o.velocities[this.m_indexB].v,n=o.velocities[this.m_indexB].w,s=this.m_invMassA,r=this.m_invMassB,b=this.m_invIA,a=this.m_invIB;if(0<this.m_frequencyHz){var d=n-e,l=-this.m_mass.ez.z*(d+this.m_bias+this.m_gamma*this.m_impulse.z);this.m_impulse.z+=l,e-=b*l,n+=a*l;var x=box2d.b2SubVV(box2d.b2AddVCrossSV(i,n,this.m_rB,box2d.b2Vec2.s_t0),box2d.b2AddVCrossSV(t,e,this.m_rA,box2d.b2Vec2.s_t1),box2d.b2WeldJoint.prototype.SolveVelocityConstraints.s_Cdot1),p=box2d.b2MulM33XY(this.m_mass,x.x,x.y,box2d.b2WeldJoint.prototype.SolveVelocityConstraints.s_impulse1).SelfNeg();this.m_impulse.x+=p.x,this.m_impulse.y+=p.y;var m=p;t.SelfMulSub(s,m),e-=b*box2d.b2CrossVV(this.m_rA,m),i.SelfMulAdd(r,m),n+=a*box2d.b2CrossVV(this.m_rB,m)}else{x=box2d.b2SubVV(box2d.b2AddVCrossSV(i,n,this.m_rB,box2d.b2Vec2.s_t0),box2d.b2AddVCrossSV(t,e,this.m_rA,box2d.b2Vec2.s_t1),box2d.b2WeldJoint.prototype.SolveVelocityConstraints.s_Cdot1),d=n-e;var h=box2d.b2MulM33XYZ(this.m_mass,x.x,x.y,d,box2d.b2WeldJoint.prototype.SolveVelocityConstraints.s_impulse).SelfNeg();this.m_impulse.SelfAdd(h);m=box2d.b2WeldJoint.prototype.SolveVelocityConstraints.s_P.SetXY(h.x,h.y);t.SelfMulSub(s,m),e-=b*(box2d.b2CrossVV(this.m_rA,m)+h.z),i.SelfMulAdd(r,m),n+=a*(box2d.b2CrossVV(this.m_rB,m)+h.z)}o.velocities[this.m_indexA].w=e,o.velocities[this.m_indexB].w=n},box2d.b2WeldJoint.prototype.SolveVelocityConstraints.s_Cdot1=new box2d.b2Vec2,box2d.b2WeldJoint.prototype.SolveVelocityConstraints.s_impulse1=new box2d.b2Vec2,box2d.b2WeldJoint.prototype.SolveVelocityConstraints.s_impulse=new box2d.b2Vec3,box2d.b2WeldJoint.prototype.SolveVelocityConstraints.s_P=new box2d.b2Vec2,box2d.b2WeldJoint.prototype.SolvePositionConstraints=function(o){var t=o.positions[this.m_indexA].c,e=o.positions[this.m_indexA].a,i=o.positions[this.m_indexB].c,n=o.positions[this.m_indexB].a,s=this.m_qA.SetAngleRadians(e),r=this.m_qB.SetAngleRadians(n),b=this.m_invMassA,a=this.m_invMassB,d=this.m_invIA,l=this.m_invIB;box2d.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var x=box2d.b2MulRV(s,this.m_lalcA,this.m_rA);box2d.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var p,m,h=box2d.b2MulRV(r,this.m_lalcB,this.m_rB),_=this.m_K;if(_.ex.x=b+a+x.y*x.y*d+h.y*h.y*l,_.ey.x=-x.y*x.x*d-h.y*h.x*l,_.ez.x=-x.y*d-h.y*l,_.ex.y=_.ey.x,_.ey.y=b+a+x.x*x.x*d+h.x*h.x*l,_.ez.y=x.x*d+h.x*l,_.ex.z=_.ez.x,_.ey.z=_.ez.y,_.ez.z=d+l,0<this.m_frequencyHz){p=(y=box2d.b2SubVV(box2d.b2AddVV(i,h,box2d.b2Vec2.s_t0),box2d.b2AddVV(t,x,box2d.b2Vec2.s_t1),box2d.b2WeldJoint.prototype.SolvePositionConstraints.s_C1)).GetLength(),m=0;var c=_.Solve22(y.x,y.y,box2d.b2WeldJoint.prototype.SolvePositionConstraints.s_P).SelfNeg();t.SelfMulSub(b,c),e-=d*box2d.b2CrossVV(x,c),i.SelfMulAdd(a,c),n+=l*box2d.b2CrossVV(h,c)}else{var y=box2d.b2SubVV(box2d.b2AddVV(i,h,box2d.b2Vec2.s_t0),box2d.b2AddVV(t,x,box2d.b2Vec2.s_t1),box2d.b2WeldJoint.prototype.SolvePositionConstraints.s_C1),u=n-e-this.m_referenceAngle;p=y.GetLength(),m=box2d.b2Abs(u);var g=_.Solve33(y.x,y.y,u,box2d.b2WeldJoint.prototype.SolvePositionConstraints.s_impulse).SelfNeg();c=box2d.b2WeldJoint.prototype.SolvePositionConstraints.s_P.SetXY(g.x,g.y);t.SelfMulSub(b,c),e-=d*(box2d.b2CrossVV(this.m_rA,c)+g.z),i.SelfMulAdd(a,c),n+=l*(box2d.b2CrossVV(this.m_rB,c)+g.z)}return o.positions[this.m_indexA].a=e,o.positions[this.m_indexB].a=n,p<=box2d.b2_linearSlop&&m<=box2d.b2_angularSlop},box2d.b2WeldJoint.prototype.SolvePositionConstraints.s_C1=new box2d.b2Vec2,box2d.b2WeldJoint.prototype.SolvePositionConstraints.s_P=new box2d.b2Vec2,box2d.b2WeldJoint.prototype.SolvePositionConstraints.s_impulse=new box2d.b2Vec3,box2d.b2WeldJoint.prototype.GetAnchorA=function(o){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,o)},box2d.b2WeldJoint.prototype.GetAnchorB=function(o){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,o)},box2d.b2WeldJoint.prototype.GetReactionForce=function(o,t){return t.SetXY(o*this.m_impulse.x,o*this.m_impulse.y)},box2d.b2WeldJoint.prototype.GetReactionTorque=function(o){return o*this.m_impulse.z},box2d.b2WeldJoint.prototype.GetLocalAnchorA=function(o){return o.Copy(this.m_localAnchorA)},box2d.b2WeldJoint.prototype.GetLocalAnchorB=function(o){return o.Copy(this.m_localAnchorB)},box2d.b2WeldJoint.prototype.GetReferenceAngle=function(){return this.m_referenceAngle},box2d.b2WeldJoint.prototype.SetFrequency=function(o){this.m_frequencyHz=o},box2d.b2WeldJoint.prototype.GetFrequency=function(){return this.m_frequencyHz},box2d.b2WeldJoint.prototype.SetDampingRatio=function(o){this.m_dampingRatio=o},box2d.b2WeldJoint.prototype.GetDampingRatio=function(){return this.m_dampingRatio},box2d.b2WeldJoint.prototype.Dump=function(){if(box2d.DEBUG){var o=this.m_bodyA.m_islandIndex,t=this.m_bodyB.m_islandIndex;box2d.b2Log("  /*box2d.b2WeldJointDef*/ var jd = new box2d.b2WeldJointDef();\n"),box2d.b2Log("  jd.bodyA = bodies[%d];\n",o),box2d.b2Log("  jd.bodyB = bodies[%d];\n",t),box2d.b2Log("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),box2d.b2Log("  jd.localAnchorA.SetXY(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),box2d.b2Log("  jd.localAnchorB.SetXY(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),box2d.b2Log("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),box2d.b2Log("  jd.frequencyHz = %.15f;\n",this.m_frequencyHz),box2d.b2Log("  jd.dampingRatio = %.15f;\n",this.m_dampingRatio),box2d.b2Log("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}},goog.provide("box2d.b2RopeJoint"),goog.require("box2d.b2Settings"),goog.require("box2d.b2Joint"),goog.require("box2d.b2Math"),box2d.b2RopeJointDef=function(){goog.base(this,box2d.b2JointType.e_ropeJoint),this.localAnchorA=new box2d.b2Vec2(-1,0),this.localAnchorB=new box2d.b2Vec2(1,0)},goog.inherits(box2d.b2RopeJointDef,box2d.b2JointDef),box2d.b2RopeJointDef.prototype.localAnchorA=null,box2d.b2RopeJointDef.prototype.localAnchorB=null,box2d.b2RopeJointDef.prototype.maxLength=0,box2d.b2RopeJoint=function(o){goog.base(this,o),this.m_localAnchorA=o.localAnchorA.Clone(),this.m_localAnchorB=o.localAnchorB.Clone(),this.m_maxLength=o.maxLength,this.m_u=new box2d.b2Vec2,this.m_rA=new box2d.b2Vec2,this.m_rB=new box2d.b2Vec2,this.m_localCenterA=new box2d.b2Vec2,this.m_localCenterB=new box2d.b2Vec2,this.m_qA=new box2d.b2Rot,this.m_qB=new box2d.b2Rot,this.m_lalcA=new box2d.b2Vec2,this.m_lalcB=new box2d.b2Vec2},goog.inherits(box2d.b2RopeJoint,box2d.b2Joint),box2d.b2RopeJoint.prototype.m_localAnchorA=null,box2d.b2RopeJoint.prototype.m_localAnchorB=null,box2d.b2RopeJoint.prototype.m_maxLength=0,box2d.b2RopeJoint.prototype.m_length=0,box2d.b2RopeJoint.prototype.m_impulse=0,box2d.b2RopeJoint.prototype.m_indexA=0,box2d.b2RopeJoint.prototype.m_indexB=0,box2d.b2RopeJoint.prototype.m_u=null,box2d.b2RopeJoint.prototype.m_rA=null,box2d.b2RopeJoint.prototype.m_rB=null,box2d.b2RopeJoint.prototype.m_localCenterA=null,box2d.b2RopeJoint.prototype.m_localCenterB=null,box2d.b2RopeJoint.prototype.m_invMassA=0,box2d.b2RopeJoint.prototype.m_invMassB=0,box2d.b2RopeJoint.prototype.m_invIA=0,box2d.b2RopeJoint.prototype.m_invIB=0,box2d.b2RopeJoint.prototype.m_mass=0,box2d.b2RopeJoint.prototype.m_state=box2d.b2LimitState.e_inactiveLimit,box2d.b2RopeJoint.prototype.m_qA=null,box2d.b2RopeJoint.prototype.m_qB=null,box2d.b2RopeJoint.prototype.m_lalcA=null,box2d.b2RopeJoint.prototype.m_lalcB=null,box2d.b2RopeJoint.prototype.InitVelocityConstraints=function(o){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var t=o.positions[this.m_indexA].c,e=o.positions[this.m_indexA].a,i=o.velocities[this.m_indexA].v,n=o.velocities[this.m_indexA].w,s=o.positions[this.m_indexB].c,r=o.positions[this.m_indexB].a,b=o.velocities[this.m_indexB].v,a=o.velocities[this.m_indexB].w,d=this.m_qA.SetAngleRadians(e),l=this.m_qB.SetAngleRadians(r);box2d.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),box2d.b2MulRV(d,this.m_lalcA,this.m_rA),box2d.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),box2d.b2MulRV(l,this.m_lalcB,this.m_rB),this.m_u.Copy(s).SelfAdd(this.m_rB).SelfSub(t).SelfSub(this.m_rA),this.m_length=this.m_u.GetLength();var x=this.m_length-this.m_maxLength;if(this.m_state=0<x?box2d.b2LimitState.e_atUpperLimit:box2d.b2LimitState.e_inactiveLimit,!(this.m_length>box2d.b2_linearSlop))return this.m_u.SetZero(),this.m_mass=0,void(this.m_impulse=0);this.m_u.SelfMul(1/this.m_length);var p=box2d.b2CrossVV(this.m_rA,this.m_u),m=box2d.b2CrossVV(this.m_rB,this.m_u),h=this.m_invMassA+this.m_invIA*p*p+this.m_invMassB+this.m_invIB*m*m;if(this.m_mass=0!==h?1/h:0,o.step.warmStarting){this.m_impulse*=o.step.dtRatio;var _=box2d.b2MulSV(this.m_impulse,this.m_u,box2d.b2RopeJoint.prototype.InitVelocityConstraints.s_P);i.SelfMulSub(this.m_invMassA,_),n-=this.m_invIA*box2d.b2CrossVV(this.m_rA,_),b.SelfMulAdd(this.m_invMassB,_),a+=this.m_invIB*box2d.b2CrossVV(this.m_rB,_)}else this.m_impulse=0;o.velocities[this.m_indexA].w=n,o.velocities[this.m_indexB].w=a},box2d.b2RopeJoint.prototype.InitVelocityConstraints.s_P=new box2d.b2Vec2,box2d.b2RopeJoint.prototype.SolveVelocityConstraints=function(o){var t=o.velocities[this.m_indexA].v,e=o.velocities[this.m_indexA].w,i=o.velocities[this.m_indexB].v,n=o.velocities[this.m_indexB].w,s=box2d.b2AddVCrossSV(t,e,this.m_rA,box2d.b2RopeJoint.prototype.SolveVelocityConstraints.s_vpA),r=box2d.b2AddVCrossSV(i,n,this.m_rB,box2d.b2RopeJoint.prototype.SolveVelocityConstraints.s_vpB),b=this.m_length-this.m_maxLength,a=box2d.b2DotVV(this.m_u,box2d.b2SubVV(r,s,box2d.b2Vec2.s_t0));b<0&&(a+=o.step.inv_dt*b);var d=-this.m_mass*a,l=this.m_impulse;this.m_impulse=box2d.b2Min(0,this.m_impulse+d),d=this.m_impulse-l;var x=box2d.b2MulSV(d,this.m_u,box2d.b2RopeJoint.prototype.SolveVelocityConstraints.s_P);t.SelfMulSub(this.m_invMassA,x),e-=this.m_invIA*box2d.b2CrossVV(this.m_rA,x),i.SelfMulAdd(this.m_invMassB,x),n+=this.m_invIB*box2d.b2CrossVV(this.m_rB,x),o.velocities[this.m_indexA].w=e,o.velocities[this.m_indexB].w=n},box2d.b2RopeJoint.prototype.SolveVelocityConstraints.s_vpA=new box2d.b2Vec2,box2d.b2RopeJoint.prototype.SolveVelocityConstraints.s_vpB=new box2d.b2Vec2,box2d.b2RopeJoint.prototype.SolveVelocityConstraints.s_P=new box2d.b2Vec2,box2d.b2RopeJoint.prototype.SolvePositionConstraints=function(o){var t=o.positions[this.m_indexA].c,e=o.positions[this.m_indexA].a,i=o.positions[this.m_indexB].c,n=o.positions[this.m_indexB].a,s=this.m_qA.SetAngleRadians(e),r=this.m_qB.SetAngleRadians(n);box2d.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var b=box2d.b2MulRV(s,this.m_lalcA,this.m_rA);box2d.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var a=box2d.b2MulRV(r,this.m_lalcB,this.m_rB),d=this.m_u.Copy(i).SelfAdd(a).SelfSub(t).SelfSub(b),l=d.Normalize(),x=l-this.m_maxLength;x=box2d.b2Clamp(x,0,box2d.b2_maxLinearCorrection);var p=-this.m_mass*x,m=box2d.b2MulSV(p,d,box2d.b2RopeJoint.prototype.SolvePositionConstraints.s_P);return t.SelfMulSub(this.m_invMassA,m),e-=this.m_invIA*box2d.b2CrossVV(b,m),i.SelfMulAdd(this.m_invMassB,m),n+=this.m_invIB*box2d.b2CrossVV(a,m),o.positions[this.m_indexA].a=e,o.positions[this.m_indexB].a=n,l-this.m_maxLength<box2d.b2_linearSlop},box2d.b2RopeJoint.prototype.SolvePositionConstraints.s_P=new box2d.b2Vec2,box2d.b2RopeJoint.prototype.GetAnchorA=function(o){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,o)},box2d.b2RopeJoint.prototype.GetAnchorB=function(o){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,o)},box2d.b2RopeJoint.prototype.GetReactionForce=function(o,t){return box2d.b2MulSV(o*this.m_impulse,this.m_u,t)},box2d.b2RopeJoint.prototype.GetReactionTorque=function(o){return 0},box2d.b2RopeJoint.prototype.GetLocalAnchorA=function(o){return o.Copy(this.m_localAnchorA)},box2d.b2RopeJoint.prototype.GetLocalAnchorB=function(o){return o.Copy(this.m_localAnchorB)},box2d.b2RopeJoint.prototype.SetMaxLength=function(o){this.m_maxLength=o},box2d.b2RopeJoint.prototype.GetMaxLength=function(){return this.m_maxLength},box2d.b2RopeJoint.prototype.GetLimitState=function(){return this.m_state},box2d.b2RopeJoint.prototype.Dump=function(){if(box2d.DEBUG){var o=this.m_bodyA.m_islandIndex,t=this.m_bodyB.m_islandIndex;box2d.b2Log("  /*box2d.b2RopeJointDef*/ var jd = new box2d.b2RopeJointDef();\n"),box2d.b2Log("  jd.bodyA = bodies[%d];\n",o),box2d.b2Log("  jd.bodyB = bodies[%d];\n",t),box2d.b2Log("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),box2d.b2Log("  jd.localAnchorA.SetXY(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),box2d.b2Log("  jd.localAnchorB.SetXY(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),box2d.b2Log("  jd.maxLength = %.15f;\n",this.m_maxLength),box2d.b2Log("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}},goog.provide("box2d.b2GravityController"),goog.require("box2d.b2Settings"),goog.require("box2d.b2Controller"),goog.require("box2d.b2Math"),box2d.b2GravityController=function(){goog.base(this)},goog.inherits(box2d.b2GravityController,box2d.b2Controller),box2d.b2GravityController.prototype.G=1,box2d.b2GravityController.prototype.invSqr=!0,box2d.b2GravityController.prototype.Step=function(o){if(this.invSqr)for(var t=this.m_bodyList;t;t=t.nextBody)for(var e=(b=t.body).GetWorldCenter(),i=b.GetMass(),n=this.m_bodyList;n!==t;n=n.nextBody){var s=(a=n.body).GetWorldCenter(),r=a.GetMass();if(!((x=(d=s.x-e.x)*d+(l=s.y-e.y)*l)<box2d.b2_epsilon))(p=box2d.b2GravityController.prototype.Step.s_f.SetXY(d,l)).SelfMul(this.G/x/box2d.b2Sqrt(x)*i*r),b.IsAwake()&&b.ApplyForce(p,e),a.IsAwake()&&a.ApplyForce(p.SelfMul(-1),s)}else for(t=this.m_bodyList;t;t=t.nextBody){var b;for(e=(b=t.body).GetWorldCenter(),i=b.GetMass(),n=this.m_bodyList;n!==t;n=n.nextBody){var a,d,l,x,p;s=(a=n.body).GetWorldCenter(),r=a.GetMass();if(!((x=(d=s.x-e.x)*d+(l=s.y-e.y)*l)<box2d.b2_epsilon))(p=box2d.b2GravityController.prototype.Step.s_f.SetXY(d,l)).SelfMul(this.G/x*i*r),b.IsAwake()&&b.ApplyForce(p,e),a.IsAwake()&&a.ApplyForce(p.SelfMul(-1),s)}}},box2d.b2GravityController.prototype.Step.s_f=new box2d.b2Vec2,goog.provide("box2d.b2TimeStep"),goog.require("box2d.b2Settings"),box2d.b2Profile=function(){},box2d.b2Profile.prototype.step=0,box2d.b2Profile.prototype.collide=0,box2d.b2Profile.prototype.solve=0,box2d.b2Profile.prototype.solveInit=0,box2d.b2Profile.prototype.solveVelocity=0,box2d.b2Profile.prototype.solvePosition=0,box2d.b2Profile.prototype.broadphase=0,box2d.b2Profile.prototype.solveTOI=0,box2d.b2Profile.prototype.Reset=function(){return this.step=0,this.collide=0,this.solve=0,this.solveInit=0,this.solveVelocity=0,this.solvePosition=0,this.broadphase=0,this.solveTOI=0,this},box2d.b2TimeStep=function(){},box2d.b2TimeStep.prototype.dt=0,box2d.b2TimeStep.prototype.inv_dt=0,box2d.b2TimeStep.prototype.dtRatio=0,box2d.b2TimeStep.prototype.velocityIterations=0,box2d.b2TimeStep.prototype.positionIterations=0,box2d.b2TimeStep.prototype.warmStarting=!1,box2d.b2TimeStep.prototype.Copy=function(o){return this.dt=o.dt,this.inv_dt=o.inv_dt,this.dtRatio=o.dtRatio,this.positionIterations=o.positionIterations,this.velocityIterations=o.velocityIterations,this.warmStarting=o.warmStarting,this},box2d.b2Position=function(){this.c=new box2d.b2Vec2},box2d.b2Position.prototype.c=null,box2d.b2Position.prototype.a=0,box2d.b2Position.MakeArray=function(o){return box2d.b2MakeArray(o,function(o){return new box2d.b2Position})},box2d.b2Velocity=function(){this.v=new box2d.b2Vec2},box2d.b2Velocity.prototype.v=null,box2d.b2Velocity.prototype.w=0,box2d.b2Velocity.MakeArray=function(o){return box2d.b2MakeArray(o,function(o){return new box2d.b2Velocity})},box2d.b2SolverData=function(){this.step=new box2d.b2TimeStep},box2d.b2SolverData.prototype.step=null,box2d.b2SolverData.prototype.positions=null,box2d.b2SolverData.prototype.velocities=null,goog.provide("box2d.b2Collision"),goog.require("box2d.b2Settings"),goog.require("box2d.b2Math"),goog.require("box2d.b2Distance"),box2d.b2ContactFeatureType={e_vertex:0,e_face:1},goog.exportProperty(box2d.b2ContactFeatureType,"e_vertex",box2d.b2ContactFeatureType.e_vertex),goog.exportProperty(box2d.b2ContactFeatureType,"e_face",box2d.b2ContactFeatureType.e_face),box2d.b2ContactFeature=function(o){this._id=o},box2d.b2ContactFeature.prototype._id=null,box2d.b2ContactFeature.prototype._indexA=0,box2d.b2ContactFeature.prototype._indexB=0,box2d.b2ContactFeature.prototype._typeA=0,box2d.b2ContactFeature.prototype._typeB=0,Object.defineProperty(box2d.b2ContactFeature.prototype,"indexA",{enumerable:!1,configurable:!0,get:function(){return this._indexA},set:function(o){this._indexA=o,this._id._key=4294967040&this._id._key|255&this._indexA}}),Object.defineProperty(box2d.b2ContactFeature.prototype,"indexB",{enumerable:!1,configurable:!0,get:function(){return this._indexB},set:function(o){this._indexB=o,this._id._key=4294902015&this._id._key|this._indexB<<8&65280}}),Object.defineProperty(box2d.b2ContactFeature.prototype,"typeA",{enumerable:!1,configurable:!0,get:function(){return this._typeA},set:function(o){this._typeA=o,this._id._key=4278255615&this._id._key|this._typeA<<16&16711680}}),Object.defineProperty(box2d.b2ContactFeature.prototype,"typeB",{enumerable:!1,configurable:!0,get:function(){return this._typeB},set:function(o){this._typeB=o,this._id._key=16777215&this._id._key|this._typeB<<24&4278190080}}),box2d.b2ContactID=function(){this.cf=new box2d.b2ContactFeature(this)},box2d.b2ContactID.prototype.cf=null,box2d.b2ContactID.prototype.key=0,box2d.b2ContactID.prototype.Copy=function(o){return this.key=o.key,this},box2d.b2ContactID.prototype.Clone=function(){return(new box2d.b2ContactID).Copy(this)},Object.defineProperty(box2d.b2ContactID.prototype,"key",{enumerable:!1,configurable:!0,get:function(){return this._key},set:function(o){this._key=o,this.cf._indexA=255&this._key,this.cf._indexB=this._key>>8&255,this.cf._typeA=this._key>>16&255,this.cf._typeB=this._key>>24&255}}),box2d.b2ManifoldPoint=function(){this.localPoint=new box2d.b2Vec2,this.id=new box2d.b2ContactID},box2d.b2ManifoldPoint.prototype.localPoint=null,box2d.b2ManifoldPoint.prototype.normalImpulse=0,box2d.b2ManifoldPoint.prototype.tangentImpulse=0,box2d.b2ManifoldPoint.prototype.id=null,box2d.b2ManifoldPoint.MakeArray=function(o){return box2d.b2MakeArray(o,function(o){return new box2d.b2ManifoldPoint})},box2d.b2ManifoldPoint.prototype.Reset=function(){this.localPoint.SetZero(),this.normalImpulse=0,this.tangentImpulse=0,this.id.key=0},box2d.b2ManifoldPoint.prototype.Copy=function(o){return this.localPoint.Copy(o.localPoint),this.normalImpulse=o.normalImpulse,this.tangentImpulse=o.tangentImpulse,this.id.Copy(o.id),this},box2d.b2ManifoldType={e_unknown:-1,e_circles:0,e_faceA:1,e_faceB:2},goog.exportProperty(box2d.b2ManifoldType,"e_unknown",box2d.b2ManifoldType.e_unknown),goog.exportProperty(box2d.b2ManifoldType,"e_circles",box2d.b2ManifoldType.e_circles),goog.exportProperty(box2d.b2ManifoldType,"e_faceA",box2d.b2ManifoldType.e_faceA),goog.exportProperty(box2d.b2ManifoldType,"e_faceB",box2d.b2ManifoldType.e_faceB),box2d.b2Manifold=function(){this.points=box2d.b2ManifoldPoint.MakeArray(box2d.b2_maxManifoldPoints),this.localNormal=new box2d.b2Vec2,this.localPoint=new box2d.b2Vec2,this.type=box2d.b2ManifoldType.e_unknown,this.pointCount=0},box2d.b2Manifold.prototype.points=null,box2d.b2Manifold.prototype.localNormal=null,box2d.b2Manifold.prototype.localPoint=null,box2d.b2Manifold.prototype.type=box2d.b2ManifoldType.e_unknown,box2d.b2Manifold.prototype.pointCount=0,box2d.b2Manifold.prototype.Reset=function(){for(var o=0,t=box2d.b2_maxManifoldPoints;o<t;++o)this.points[o].Reset();this.localNormal.SetZero(),this.localPoint.SetZero(),this.type=box2d.b2ManifoldType.e_unknown,this.pointCount=0},box2d.b2Manifold.prototype.Copy=function(o){this.pointCount=o.pointCount;for(var t=0,e=box2d.b2_maxManifoldPoints;t<e;++t)this.points[t].Copy(o.points[t]);return this.localNormal.Copy(o.localNormal),this.localPoint.Copy(o.localPoint),this.type=o.type,this},box2d.b2Manifold.prototype.Clone=function(){return(new box2d.b2Manifold).Copy(this)},box2d.b2WorldManifold=function(){this.normal=new box2d.b2Vec2,this.points=box2d.b2Vec2.MakeArray(box2d.b2_maxManifoldPoints),this.separations=box2d.b2MakeNumberArray(box2d.b2_maxManifoldPoints)},box2d.b2WorldManifold.prototype.normal=null,box2d.b2WorldManifold.prototype.points=null,box2d.b2WorldManifold.prototype.separations=null,box2d.b2WorldManifold.prototype.Initialize=function(o,t,e,i,n){if(0!==o.pointCount)switch(o.type){case box2d.b2ManifoldType.e_circles:this.normal.SetXY(1,0);var s=box2d.b2MulXV(t,o.localPoint,box2d.b2WorldManifold.prototype.Initialize.s_pointA),r=box2d.b2MulXV(i,o.points[0].localPoint,box2d.b2WorldManifold.prototype.Initialize.s_pointB);box2d.b2DistanceSquaredVV(s,r)>box2d.b2_epsilon_sq&&box2d.b2SubVV(r,s,this.normal).SelfNormalize();var b=box2d.b2AddVMulSV(s,e,this.normal,box2d.b2WorldManifold.prototype.Initialize.s_cA),a=box2d.b2SubVMulSV(r,n,this.normal,box2d.b2WorldManifold.prototype.Initialize.s_cB);box2d.b2MidVV(b,a,this.points[0]),this.separations[0]=box2d.b2DotVV(box2d.b2SubVV(a,b,box2d.b2Vec2.s_t0),this.normal);break;case box2d.b2ManifoldType.e_faceA:box2d.b2MulRV(t.q,o.localNormal,this.normal);for(var d=box2d.b2MulXV(t,o.localPoint,box2d.b2WorldManifold.prototype.Initialize.s_planePoint),l=0,x=o.pointCount;l<x;++l){var p=box2d.b2MulXV(i,o.points[l].localPoint,box2d.b2WorldManifold.prototype.Initialize.s_clipPoint),m=e-box2d.b2DotVV(box2d.b2SubVV(p,d,box2d.b2Vec2.s_t0),this.normal);b=box2d.b2AddVMulSV(p,m,this.normal,box2d.b2WorldManifold.prototype.Initialize.s_cA),a=box2d.b2SubVMulSV(p,n,this.normal,box2d.b2WorldManifold.prototype.Initialize.s_cB);box2d.b2MidVV(b,a,this.points[l]),this.separations[l]=box2d.b2DotVV(box2d.b2SubVV(a,b,box2d.b2Vec2.s_t0),this.normal)}break;case box2d.b2ManifoldType.e_faceB:box2d.b2MulRV(i.q,o.localNormal,this.normal);for(d=box2d.b2MulXV(i,o.localPoint,box2d.b2WorldManifold.prototype.Initialize.s_planePoint),l=0,x=o.pointCount;l<x;++l){p=box2d.b2MulXV(t,o.points[l].localPoint,box2d.b2WorldManifold.prototype.Initialize.s_clipPoint),m=n-box2d.b2DotVV(box2d.b2SubVV(p,d,box2d.b2Vec2.s_t0),this.normal),a=box2d.b2AddVMulSV(p,m,this.normal,box2d.b2WorldManifold.prototype.Initialize.s_cB),b=box2d.b2SubVMulSV(p,e,this.normal,box2d.b2WorldManifold.prototype.Initialize.s_cA);box2d.b2MidVV(b,a,this.points[l]),this.separations[l]=box2d.b2DotVV(box2d.b2SubVV(b,a,box2d.b2Vec2.s_t0),this.normal)}this.normal.SelfNeg()}},box2d.b2WorldManifold.prototype.Initialize.s_pointA=new box2d.b2Vec2,box2d.b2WorldManifold.prototype.Initialize.s_pointB=new box2d.b2Vec2,box2d.b2WorldManifold.prototype.Initialize.s_cA=new box2d.b2Vec2,box2d.b2WorldManifold.prototype.Initialize.s_cB=new box2d.b2Vec2,box2d.b2WorldManifold.prototype.Initialize.s_planePoint=new box2d.b2Vec2,box2d.b2WorldManifold.prototype.Initialize.s_clipPoint=new box2d.b2Vec2,box2d.b2PointState={b2_nullState:0,b2_addState:1,b2_persistState:2,b2_removeState:3},goog.exportProperty(box2d.b2PointState,"b2_nullState   ",box2d.b2PointState.b2_nullState),goog.exportProperty(box2d.b2PointState,"b2_addState    ",box2d.b2PointState.b2_addState),goog.exportProperty(box2d.b2PointState,"b2_persistState",box2d.b2PointState.b2_persistState),goog.exportProperty(box2d.b2PointState,"b2_removeState ",box2d.b2PointState.b2_removeState),box2d.b2GetPointStates=function(o,t,e,i){for(var n=0,s=e.pointCount;n<s;++n){var r=e.points[n].id.key;o[n]=box2d.b2PointState.b2_removeState;for(var b=0,a=i.pointCount;b<a;++b)if(i.points[b].id.key===r){o[n]=box2d.b2PointState.b2_persistState;break}}for(s=box2d.b2_maxManifoldPoints;n<s;++n)o[n]=box2d.b2PointState.b2_nullState;for(n=0,s=i.pointCount;n<s;++n){r=i.points[n].id.key;t[n]=box2d.b2PointState.b2_addState;for(b=0,a=e.pointCount;b<a;++b)if(e.points[b].id.key===r){t[n]=box2d.b2PointState.b2_persistState;break}}for(s=box2d.b2_maxManifoldPoints;n<s;++n)t[n]=box2d.b2PointState.b2_nullState},box2d.b2ClipVertex=function(){this.v=new box2d.b2Vec2,this.id=new box2d.b2ContactID},box2d.b2ClipVertex.prototype.v=null,box2d.b2ClipVertex.prototype.id=null,box2d.b2ClipVertex.MakeArray=function(o){return box2d.b2MakeArray(o,function(o){return new box2d.b2ClipVertex})},box2d.b2ClipVertex.prototype.Copy=function(o){return this.v.Copy(o.v),this.id.Copy(o.id),this},box2d.b2RayCastInput=function(){this.p1=new box2d.b2Vec2,this.p2=new box2d.b2Vec2,this.maxFraction=1},box2d.b2RayCastInput.prototype.p1=null,box2d.b2RayCastInput.prototype.p2=null,box2d.b2RayCastInput.prototype.maxFraction=1,box2d.b2RayCastInput.prototype.Copy=function(o){return this.p1.Copy(o.p1),this.p2.Copy(o.p2),this.maxFraction=o.maxFraction,this},box2d.b2RayCastOutput=function(){this.normal=new box2d.b2Vec2,this.fraction=0},box2d.b2RayCastOutput.prototype.normal=null,box2d.b2RayCastOutput.prototype.fraction=0,box2d.b2RayCastOutput.prototype.Copy=function(o){return this.normal.Copy(o.normal),this.fraction=o.fraction,this},box2d.b2AABB=function(){this.lowerBound=new box2d.b2Vec2,this.upperBound=new box2d.b2Vec2,this.m_out_center=new box2d.b2Vec2,this.m_out_extent=new box2d.b2Vec2},box2d.b2AABB.prototype.lowerBound=null,box2d.b2AABB.prototype.upperBound=null,box2d.b2AABB.prototype.m_out_center=null,box2d.b2AABB.prototype.m_out_extent=null,box2d.b2AABB.prototype.Copy=function(o){return this.lowerBound.Copy(o.lowerBound),this.upperBound.Copy(o.upperBound),this},box2d.b2AABB.prototype.IsValid=function(){var o=this.upperBound.x-this.lowerBound.x,t=this.upperBound.y-this.lowerBound.y,e=0<=o&&0<=t;return e=e&&this.lowerBound.IsValid()&&this.upperBound.IsValid()},box2d.b2AABB.prototype.GetCenter=function(){return box2d.b2MidVV(this.lowerBound,this.upperBound,this.m_out_center)},box2d.b2AABB.prototype.GetExtents=function(){return box2d.b2ExtVV(this.lowerBound,this.upperBound,this.m_out_extent)},box2d.b2AABB.prototype.GetPerimeter=function(){return 2*(this.upperBound.x-this.lowerBound.x+(this.upperBound.y-this.lowerBound.y))},box2d.b2AABB.prototype.Combine1=function(o){return this.lowerBound.x=box2d.b2Min(this.lowerBound.x,o.lowerBound.x),this.lowerBound.y=box2d.b2Min(this.lowerBound.y,o.lowerBound.y),this.upperBound.x=box2d.b2Max(this.upperBound.x,o.upperBound.x),this.upperBound.y=box2d.b2Max(this.upperBound.y,o.upperBound.y),this},box2d.b2AABB.prototype.Combine2=function(o,t){return this.lowerBound.x=box2d.b2Min(o.lowerBound.x,t.lowerBound.x),this.lowerBound.y=box2d.b2Min(o.lowerBound.y,t.lowerBound.y),this.upperBound.x=box2d.b2Max(o.upperBound.x,t.upperBound.x),this.upperBound.y=box2d.b2Max(o.upperBound.y,t.upperBound.y),this},box2d.b2AABB.Combine=function(o,t,e){return e.Combine2(o,t),e},box2d.b2AABB.prototype.Contains=function(o){var t=!0;return t=(t=(t=(t=t&&this.lowerBound.x<=o.lowerBound.x)&&this.lowerBound.y<=o.lowerBound.y)&&o.upperBound.x<=this.upperBound.x)&&o.upperBound.y<=this.upperBound.y},box2d.b2AABB.prototype.RayCast=function(o,t){var e=-box2d.b2_maxFloat,i=box2d.b2_maxFloat,n=t.p1.x,s=t.p1.y,r=t.p2.x-t.p1.x,b=t.p2.y-t.p1.y,a=box2d.b2Abs(r),d=box2d.b2Abs(b),l=o.normal;if(a<box2d.b2_epsilon){if(n<this.lowerBound.x||this.upperBound.x<n)return!1}else{var x=1/r,p=(this.lowerBound.x-n)*x,m=-1;if((_=(this.upperBound.x-n)*x)<p){var h=p;p=_,_=h,m=1}if(e<p&&(l.x=m,l.y=0,e=p),(i=box2d.b2Min(i,_))<e)return!1}if(d<box2d.b2_epsilon){if(s<this.lowerBound.y||this.upperBound.y<s)return!1}else{var _;x=1/b,p=(this.lowerBound.y-s)*x,m=-1;if((_=(this.upperBound.y-s)*x)<p){h=p;p=_,_=h,m=1}if(e<p&&(l.x=0,l.y=m,e=p),(i=box2d.b2Min(i,_))<e)return!1}return!(e<0||t.maxFraction<e)&&(o.fraction=e,!0)},box2d.b2AABB.prototype.TestOverlap=function(o){var t=o.lowerBound.x-this.upperBound.x,e=o.lowerBound.y-this.upperBound.y,i=this.lowerBound.x-o.upperBound.x,n=this.lowerBound.y-o.upperBound.y;return!(0<t||0<e)&&!(0<i||0<n)},box2d.b2TestOverlapAABB=function(o,t){var e=t.lowerBound.x-o.upperBound.x,i=t.lowerBound.y-o.upperBound.y,n=o.lowerBound.x-t.upperBound.x,s=o.lowerBound.y-t.upperBound.y;return!(0<e||0<i)&&!(0<n||0<s)},box2d.b2ClipSegmentToLine=function(o,t,e,i,n){var s=0,r=t[0],b=t[1],a=box2d.b2DotVV(e,r.v)-i,d=box2d.b2DotVV(e,b.v)-i;if(a<=0&&o[s++].Copy(r),d<=0&&o[s++].Copy(b),a*d<0){var l=a/(a-d),x=o[s].v;x.x=r.v.x+l*(b.v.x-r.v.x),x.y=r.v.y+l*(b.v.y-r.v.y);var p=o[s].id;p.cf.indexA=n,p.cf.indexB=r.id.cf.indexB,p.cf.typeA=box2d.b2ContactFeatureType.e_vertex,p.cf.typeB=box2d.b2ContactFeatureType.e_face,++s}return s},box2d.b2TestOverlapShape=function(o,t,e,i,n,s){var r=box2d.b2TestOverlapShape.s_input.Reset();r.proxyA.SetShape(o,t),r.proxyB.SetShape(e,i),r.transformA.Copy(n),r.transformB.Copy(s),r.useRadii=!0;var b=box2d.b2TestOverlapShape.s_simplexCache.Reset();b.count=0;var a=box2d.b2TestOverlapShape.s_output.Reset();return box2d.b2Distance(a,b,r),a.distance<10*box2d.b2_epsilon},box2d.b2TestOverlapShape.s_input=new box2d.b2DistanceInput,box2d.b2TestOverlapShape.s_simplexCache=new box2d.b2SimplexCache,box2d.b2TestOverlapShape.s_output=new box2d.b2DistanceOutput,goog.provide("box2d.b2Timer"),goog.require("box2d.b2Settings"),box2d.b2Timer=function(){this.m_start=(new Date).getTime()},box2d.b2Timer.prototype.m_start=0,box2d.b2Timer.prototype.Reset=function(){return this.m_start=(new Date).getTime(),this},box2d.b2Timer.prototype.GetMilliseconds=function(){return(new Date).getTime()-this.m_start},box2d.b2Counter=function(){},box2d.b2Counter.prototype.m_count=0,box2d.b2Counter.prototype.m_min_count=0,box2d.b2Counter.prototype.m_max_count=0,box2d.b2Counter.prototype.GetCount=function(){return this.m_count},box2d.b2Counter.prototype.GetMinCount=function(){return this.m_min_count},box2d.b2Counter.prototype.GetMaxCount=function(){return this.m_max_count},box2d.b2Counter.prototype.ResetCount=function(){var o=this.m_count;return this.m_count=0,o},box2d.b2Counter.prototype.ResetMinCount=function(){this.m_min_count=0},box2d.b2Counter.prototype.ResetMaxCount=function(){this.m_max_count=0},box2d.b2Counter.prototype.Increment=function(){this.m_count++,this.m_max_count<this.m_count&&(this.m_max_count=this.m_count)},box2d.b2Counter.prototype.Decrement=function(){this.m_count--,this.m_min_count>this.m_count&&(this.m_min_count=this.m_count)},goog.provide("box2d.b2TimeOfImpact"),goog.require("box2d.b2Settings"),goog.require("box2d.b2Distance"),goog.require("box2d.b2Math"),goog.require("box2d.b2Timer"),box2d.b2_toiTime=0,box2d.b2_toiMaxTime=0,box2d.b2_toiCalls=0,box2d.b2_toiIters=0,box2d.b2_toiMaxIters=0,box2d.b2_toiRootIters=0,box2d.b2_toiMaxRootIters=0,box2d.b2TOIInput=function(){this.proxyA=new box2d.b2DistanceProxy,this.proxyB=new box2d.b2DistanceProxy,this.sweepA=new box2d.b2Sweep,this.sweepB=new box2d.b2Sweep},box2d.b2TOIInput.prototype.proxyA=null,box2d.b2TOIInput.prototype.proxyB=null,box2d.b2TOIInput.prototype.sweepA=null,box2d.b2TOIInput.prototype.sweepB=null,box2d.b2TOIInput.prototype.tMax=0,box2d.b2TOIOutputState={e_unknown:0,e_failed:1,e_overlapped:2,e_touching:3,e_separated:4},goog.exportProperty(box2d.b2TOIOutputState,"e_unknown",box2d.b2TOIOutputState.e_unknown),goog.exportProperty(box2d.b2TOIOutputState,"e_failed",box2d.b2TOIOutputState.e_failed),goog.exportProperty(box2d.b2TOIOutputState,"e_overlapped",box2d.b2TOIOutputState.e_overlapped),goog.exportProperty(box2d.b2TOIOutputState,"e_touching",box2d.b2TOIOutputState.e_touching),goog.exportProperty(box2d.b2TOIOutputState,"e_separated",box2d.b2TOIOutputState.e_separated),box2d.b2TOIOutput=function(){},box2d.b2TOIOutput.prototype.state=box2d.b2TOIOutputState.e_unknown,box2d.b2TOIOutput.prototype.t=0,box2d.b2SeparationFunctionType={e_unknown:-1,e_points:0,e_faceA:1,e_faceB:2},goog.exportProperty(box2d.b2SeparationFunctionType,"e_unknown",box2d.b2SeparationFunctionType.e_unknown),goog.exportProperty(box2d.b2SeparationFunctionType,"e_points",box2d.b2SeparationFunctionType.e_points),goog.exportProperty(box2d.b2SeparationFunctionType,"e_faceA",box2d.b2SeparationFunctionType.e_faceA),goog.exportProperty(box2d.b2SeparationFunctionType,"e_faceB",box2d.b2SeparationFunctionType.e_faceB),box2d.b2SeparationFunction=function(){this.m_sweepA=new box2d.b2Sweep,this.m_sweepB=new box2d.b2Sweep,this.m_localPoint=new box2d.b2Vec2,this.m_axis=new box2d.b2Vec2},box2d.b2SeparationFunction.prototype.m_proxyA=null,box2d.b2SeparationFunction.prototype.m_proxyB=null,box2d.b2SeparationFunction.prototype.m_sweepA=null,box2d.b2SeparationFunction.prototype.m_sweepB=null,box2d.b2SeparationFunction.prototype.m_type=box2d.b2SeparationFunctionType.e_unknown,box2d.b2SeparationFunction.prototype.m_localPoint=null,box2d.b2SeparationFunction.prototype.m_axis=null,box2d.b2SeparationFunction.prototype.Initialize=function(o,t,e,i,n,s){this.m_proxyA=t,this.m_proxyB=i;var r=o.count;box2d.ENABLE_ASSERTS&&box2d.b2Assert(0<r&&r<3),this.m_sweepA.Copy(e),this.m_sweepB.Copy(n);var b=box2d.b2TimeOfImpact.s_xfA,a=box2d.b2TimeOfImpact.s_xfB;if(this.m_sweepA.GetTransform(b,s),this.m_sweepB.GetTransform(a,s),1===r){this.m_type=box2d.b2SeparationFunctionType.e_points;var d=this.m_proxyA.GetVertex(o.indexA[0]),l=this.m_proxyB.GetVertex(o.indexB[0]),x=box2d.b2MulXV(b,d,box2d.b2TimeOfImpact.s_pointA),p=box2d.b2MulXV(a,l,box2d.b2TimeOfImpact.s_pointB);return box2d.b2SubVV(p,x,this.m_axis),u=this.m_axis.Normalize()}if(o.indexA[0]===o.indexA[1]){this.m_type=box2d.b2SeparationFunctionType.e_faceB;var m=this.m_proxyB.GetVertex(o.indexB[0]),h=this.m_proxyB.GetVertex(o.indexB[1]);box2d.b2CrossVOne(box2d.b2SubVV(h,m,box2d.b2Vec2.s_t0),this.m_axis).SelfNormalize();var _=box2d.b2MulRV(a.q,this.m_axis,box2d.b2TimeOfImpact.s_normal);box2d.b2MidVV(m,h,this.m_localPoint);p=box2d.b2MulXV(a,this.m_localPoint,box2d.b2TimeOfImpact.s_pointB),d=this.m_proxyA.GetVertex(o.indexA[0]),x=box2d.b2MulXV(b,d,box2d.b2TimeOfImpact.s_pointA);return(u=box2d.b2DotVV(box2d.b2SubVV(x,p,box2d.b2Vec2.s_t0),_))<0&&(this.m_axis.SelfNeg(),u=-u),u}this.m_type=box2d.b2SeparationFunctionType.e_faceA;var c=this.m_proxyA.GetVertex(o.indexA[0]),y=this.m_proxyA.GetVertex(o.indexA[1]);box2d.b2CrossVOne(box2d.b2SubVV(y,c,box2d.b2Vec2.s_t0),this.m_axis).SelfNormalize();_=box2d.b2MulRV(b.q,this.m_axis,box2d.b2TimeOfImpact.s_normal);box2d.b2MidVV(c,y,this.m_localPoint);var u;x=box2d.b2MulXV(b,this.m_localPoint,box2d.b2TimeOfImpact.s_pointA),l=this.m_proxyB.GetVertex(o.indexB[0]),p=box2d.b2MulXV(a,l,box2d.b2TimeOfImpact.s_pointB);return(u=box2d.b2DotVV(box2d.b2SubVV(p,x,box2d.b2Vec2.s_t0),_))<0&&(this.m_axis.SelfNeg(),u=-u),u},box2d.b2SeparationFunction.prototype.FindMinSeparation=function(o,t,e){var i=box2d.b2TimeOfImpact.s_xfA,n=box2d.b2TimeOfImpact.s_xfB;switch(this.m_sweepA.GetTransform(i,e),this.m_sweepB.GetTransform(n,e),this.m_type){case box2d.b2SeparationFunctionType.e_points:var s=box2d.b2MulTRV(i.q,this.m_axis,box2d.b2TimeOfImpact.s_axisA),r=box2d.b2MulTRV(n.q,box2d.b2NegV(this.m_axis,box2d.b2Vec2.s_t0),box2d.b2TimeOfImpact.s_axisB);o[0]=this.m_proxyA.GetSupport(s),t[0]=this.m_proxyB.GetSupport(r);var b=this.m_proxyA.GetVertex(o[0]),a=this.m_proxyB.GetVertex(t[0]),d=box2d.b2MulXV(i,b,box2d.b2TimeOfImpact.s_pointA),l=box2d.b2MulXV(n,a,box2d.b2TimeOfImpact.s_pointB);return box2d.b2DotVV(box2d.b2SubVV(l,d,box2d.b2Vec2.s_t0),this.m_axis);case box2d.b2SeparationFunctionType.e_faceA:var x=box2d.b2MulRV(i.q,this.m_axis,box2d.b2TimeOfImpact.s_normal);d=box2d.b2MulXV(i,this.m_localPoint,box2d.b2TimeOfImpact.s_pointA),r=box2d.b2MulTRV(n.q,box2d.b2NegV(x,box2d.b2Vec2.s_t0),box2d.b2TimeOfImpact.s_axisB);o[0]=-1,t[0]=this.m_proxyB.GetSupport(r);a=this.m_proxyB.GetVertex(t[0]),l=box2d.b2MulXV(n,a,box2d.b2TimeOfImpact.s_pointB);return box2d.b2DotVV(box2d.b2SubVV(l,d,box2d.b2Vec2.s_t0),x);case box2d.b2SeparationFunctionType.e_faceB:x=box2d.b2MulRV(n.q,this.m_axis,box2d.b2TimeOfImpact.s_normal),l=box2d.b2MulXV(n,this.m_localPoint,box2d.b2TimeOfImpact.s_pointB),s=box2d.b2MulTRV(i.q,box2d.b2NegV(x,box2d.b2Vec2.s_t0),box2d.b2TimeOfImpact.s_axisA);t[0]=-1,o[0]=this.m_proxyA.GetSupport(s);b=this.m_proxyA.GetVertex(o[0]),d=box2d.b2MulXV(i,b,box2d.b2TimeOfImpact.s_pointA);return box2d.b2DotVV(box2d.b2SubVV(d,l,box2d.b2Vec2.s_t0),x);default:return box2d.ENABLE_ASSERTS&&box2d.b2Assert(!1),o[0]=-1,t[0]=-1,0}},box2d.b2SeparationFunction.prototype.Evaluate=function(o,t,e){var i=box2d.b2TimeOfImpact.s_xfA,n=box2d.b2TimeOfImpact.s_xfB;switch(this.m_sweepA.GetTransform(i,e),this.m_sweepB.GetTransform(n,e),this.m_type){case box2d.b2SeparationFunctionType.e_points:var s=this.m_proxyA.GetVertex(o),r=this.m_proxyB.GetVertex(t),b=box2d.b2MulXV(i,s,box2d.b2TimeOfImpact.s_pointA),a=box2d.b2MulXV(n,r,box2d.b2TimeOfImpact.s_pointB);return box2d.b2DotVV(box2d.b2SubVV(a,b,box2d.b2Vec2.s_t0),this.m_axis);case box2d.b2SeparationFunctionType.e_faceA:var d=box2d.b2MulRV(i.q,this.m_axis,box2d.b2TimeOfImpact.s_normal);b=box2d.b2MulXV(i,this.m_localPoint,box2d.b2TimeOfImpact.s_pointA),r=this.m_proxyB.GetVertex(t),a=box2d.b2MulXV(n,r,box2d.b2TimeOfImpact.s_pointB);return box2d.b2DotVV(box2d.b2SubVV(a,b,box2d.b2Vec2.s_t0),d);case box2d.b2SeparationFunctionType.e_faceB:d=box2d.b2MulRV(n.q,this.m_axis,box2d.b2TimeOfImpact.s_normal),a=box2d.b2MulXV(n,this.m_localPoint,box2d.b2TimeOfImpact.s_pointB),s=this.m_proxyA.GetVertex(o),b=box2d.b2MulXV(i,s,box2d.b2TimeOfImpact.s_pointA);return box2d.b2DotVV(box2d.b2SubVV(b,a,box2d.b2Vec2.s_t0),d);default:return box2d.ENABLE_ASSERTS&&box2d.b2Assert(!1),0}},box2d.b2TimeOfImpact=function(o,t){var e=box2d.b2TimeOfImpact.s_timer.Reset();++box2d.b2_toiCalls,o.state=box2d.b2TOIOutputState.e_unknown,o.t=t.tMax;var i=t.proxyA,n=t.proxyB,s=box2d.b2TimeOfImpact.s_sweepA.Copy(t.sweepA),r=box2d.b2TimeOfImpact.s_sweepB.Copy(t.sweepB);s.Normalize(),r.Normalize();var b=t.tMax,a=i.m_radius+n.m_radius,d=box2d.b2Max(box2d.b2_linearSlop,a-3*box2d.b2_linearSlop),l=.25*box2d.b2_linearSlop;box2d.ENABLE_ASSERTS&&box2d.b2Assert(l<d);var x=0,p=0,m=box2d.b2TimeOfImpact.s_cache;m.count=0;var h=box2d.b2TimeOfImpact.s_distanceInput;for(h.proxyA=t.proxyA,h.proxyB=t.proxyB,h.useRadii=!1;;){var _=box2d.b2TimeOfImpact.s_xfA,c=box2d.b2TimeOfImpact.s_xfB;s.GetTransform(_,x),r.GetTransform(c,x),h.transformA.Copy(_),h.transformB.Copy(c);var y=box2d.b2TimeOfImpact.s_distanceOutput;if(box2d.b2Distance(y,m,h),y.distance<=0){o.state=box2d.b2TOIOutputState.e_overlapped,o.t=0;break}if(y.distance<d+l){o.state=box2d.b2TOIOutputState.e_touching,o.t=x;break}var u=box2d.b2TimeOfImpact.s_fcn;u.Initialize(m,i,s,n,r,x);for(var g=!1,f=b,S=0;;){var A=box2d.b2TimeOfImpact.s_indexA,C=box2d.b2TimeOfImpact.s_indexB,v=u.FindMinSeparation(A,C,f);if(d+l<v){o.state=box2d.b2TOIOutputState.e_separated,o.t=b,g=!0;break}if(d-l<v){x=f;break}var V=u.Evaluate(A[0],C[0],x);if(V<d-l){o.state=box2d.b2TOIOutputState.e_failed,o.t=x,g=!0;break}if(V<=d+l){o.state=box2d.b2TOIOutputState.e_touching,o.t=x,g=!0;break}for(var B=0,w=x,P=f;;){var M=0;M=1&B?w+(d-V)*(P-w)/(v-V):.5*(w+P),++B,++box2d.b2_toiRootIters;var D=u.Evaluate(A[0],C[0],M);if(box2d.b2Abs(D-d)<l){f=M;break}if(d<D?(w=M,V=D):(P=M,v=D),50===B)break}if(box2d.b2_toiMaxRootIters=box2d.b2Max(box2d.b2_toiMaxRootIters,B),++S===box2d.b2_maxPolygonVertices)break}if(++p,++box2d.b2_toiIters,g)break;if(20===p){o.state=box2d.b2TOIOutputState.e_failed,o.t=x;break}}box2d.b2_toiMaxIters=box2d.b2Max(box2d.b2_toiMaxIters,p);var J=e.GetMilliseconds();box2d.b2_toiMaxTime=box2d.b2Max(box2d.b2_toiMaxTime,J),box2d.b2_toiTime+=J},box2d.b2TimeOfImpact.s_timer=new box2d.b2Timer,box2d.b2TimeOfImpact.s_cache=new box2d.b2SimplexCache,box2d.b2TimeOfImpact.s_distanceInput=new box2d.b2DistanceInput,box2d.b2TimeOfImpact.s_distanceOutput=new box2d.b2DistanceOutput,box2d.b2TimeOfImpact.s_xfA=new box2d.b2Transform,box2d.b2TimeOfImpact.s_xfB=new box2d.b2Transform,box2d.b2TimeOfImpact.s_indexA=box2d.b2MakeNumberArray(1),box2d.b2TimeOfImpact.s_indexB=box2d.b2MakeNumberArray(1),box2d.b2TimeOfImpact.s_fcn=new box2d.b2SeparationFunction,box2d.b2TimeOfImpact.s_sweepA=new box2d.b2Sweep,box2d.b2TimeOfImpact.s_sweepB=new box2d.b2Sweep,box2d.b2TimeOfImpact.s_pointA=new box2d.b2Vec2,box2d.b2TimeOfImpact.s_pointB=new box2d.b2Vec2,box2d.b2TimeOfImpact.s_normal=new box2d.b2Vec2,box2d.b2TimeOfImpact.s_axisA=new box2d.b2Vec2,box2d.b2TimeOfImpact.s_axisB=new box2d.b2Vec2,goog.provide("box2d.b2Contact"),goog.require("box2d.b2Settings"),goog.require("box2d.b2Collision"),goog.require("box2d.b2TimeOfImpact"),box2d.b2MixFriction=function(o,t){return box2d.b2Sqrt(o*t)},box2d.b2MixRestitution=function(o,t){return t<o?o:t},box2d.b2ContactEdge=function(){},box2d.b2ContactEdge.prototype.other=null,box2d.b2ContactEdge.prototype.contact=null,box2d.b2ContactEdge.prototype.prev=null,box2d.b2ContactEdge.prototype.next=null,box2d.b2ContactFlag={e_none:0,e_islandFlag:1,e_touchingFlag:2,e_enabledFlag:4,e_filterFlag:8,e_bulletHitFlag:16,e_toiFlag:32},goog.exportProperty(box2d.b2ContactFlag,"e_none",box2d.b2ContactFlag.e_none),goog.exportProperty(box2d.b2ContactFlag,"e_islandFlag",box2d.b2ContactFlag.e_islandFlag),goog.exportProperty(box2d.b2ContactFlag,"e_touchingFlag",box2d.b2ContactFlag.e_touchingFlag),goog.exportProperty(box2d.b2ContactFlag,"e_enabledFlag",box2d.b2ContactFlag.e_enabledFlag),goog.exportProperty(box2d.b2ContactFlag,"e_filterFlag",box2d.b2ContactFlag.e_filterFlag),goog.exportProperty(box2d.b2ContactFlag,"e_bulletHitFlag",box2d.b2ContactFlag.e_bulletHitFlag),goog.exportProperty(box2d.b2ContactFlag,"e_toiFlag",box2d.b2ContactFlag.e_toiFlag),box2d.b2Contact=function(){this.m_nodeA=new box2d.b2ContactEdge,this.m_nodeB=new box2d.b2ContactEdge,this.m_manifold=new box2d.b2Manifold,this.m_oldManifold=new box2d.b2Manifold},box2d.b2Contact.prototype.m_flags=box2d.b2ContactFlag.e_none,box2d.b2Contact.prototype.m_prev=null,box2d.b2Contact.prototype.m_next=null,box2d.b2Contact.prototype.m_nodeA=null,box2d.b2Contact.prototype.m_nodeB=null,box2d.b2Contact.prototype.m_fixtureA=null,box2d.b2Contact.prototype.m_fixtureB=null,box2d.b2Contact.prototype.m_indexA=0,box2d.b2Contact.prototype.m_indexB=0,box2d.b2Contact.prototype.m_manifold=null,box2d.b2Contact.prototype.m_toiCount=0,box2d.b2Contact.prototype.m_toi=0,box2d.b2Contact.prototype.m_friction=0,box2d.b2Contact.prototype.m_restitution=0,box2d.b2Contact.prototype.m_tangentSpeed=0,box2d.b2Contact.prototype.m_oldManifold=null,box2d.b2Contact.prototype.GetManifold=function(){return this.m_manifold},box2d.b2Contact.prototype.GetWorldManifold=function(o){var t=this.m_fixtureA.GetBody(),e=this.m_fixtureB.GetBody(),i=this.m_fixtureA.GetShape(),n=this.m_fixtureB.GetShape();o.Initialize(this.m_manifold,t.GetTransform(),i.m_radius,e.GetTransform(),n.m_radius)},box2d.b2Contact.prototype.IsTouching=function(){return(this.m_flags&box2d.b2ContactFlag.e_touchingFlag)===box2d.b2ContactFlag.e_touchingFlag},box2d.b2Contact.prototype.SetEnabled=function(o){o?this.m_flags|=box2d.b2ContactFlag.e_enabledFlag:this.m_flags&=~box2d.b2ContactFlag.e_enabledFlag},box2d.b2Contact.prototype.IsEnabled=function(){return(this.m_flags&box2d.b2ContactFlag.e_enabledFlag)===box2d.b2ContactFlag.e_enabledFlag},box2d.b2Contact.prototype.GetNext=function(){return this.m_next},box2d.b2Contact.prototype.GetFixtureA=function(){return this.m_fixtureA},box2d.b2Contact.prototype.GetChildIndexA=function(){return this.m_indexA},box2d.b2Contact.prototype.GetFixtureB=function(){return this.m_fixtureB},box2d.b2Contact.prototype.GetChildIndexB=function(){return this.m_indexB},box2d.b2Contact.prototype.Evaluate=function(o,t,e){},box2d.b2Contact.prototype.FlagForFiltering=function(){this.m_flags|=box2d.b2ContactFlag.e_filterFlag},box2d.b2Contact.prototype.SetFriction=function(o){this.m_friction=o},box2d.b2Contact.prototype.GetFriction=function(){return this.m_friction},box2d.b2Contact.prototype.ResetFriction=function(){this.m_friction=box2d.b2MixFriction(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction)},box2d.b2Contact.prototype.SetRestitution=function(o){this.m_restitution=o},box2d.b2Contact.prototype.GetRestitution=function(){return this.m_restitution},box2d.b2Contact.prototype.ResetRestitution=function(){this.m_restitution=box2d.b2MixRestitution(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)},box2d.b2Contact.prototype.SetTangentSpeed=function(o){this.m_tangentSpeed=o},box2d.b2Contact.prototype.GetTangentSpeed=function(){return this.m_tangentSpeed},box2d.b2Contact.prototype.Reset=function(o,t,e,i){this.m_flags=box2d.b2ContactFlag.e_enabledFlag,this.m_fixtureA=o,this.m_fixtureB=e,this.m_indexA=t,this.m_indexB=i,this.m_manifold.pointCount=0,this.m_prev=null,this.m_next=null,this.m_nodeA.contact=null,this.m_nodeA.prev=null,this.m_nodeA.next=null,this.m_nodeA.other=null,this.m_nodeB.contact=null,this.m_nodeB.prev=null,this.m_nodeB.next=null,this.m_nodeB.other=null,this.m_toiCount=0,this.m_friction=box2d.b2MixFriction(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction),this.m_restitution=box2d.b2MixRestitution(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)},box2d.b2Contact.prototype.Update=function(o){var t=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=t,this.m_flags|=box2d.b2ContactFlag.e_enabledFlag;var e=!1,i=(this.m_flags&box2d.b2ContactFlag.e_touchingFlag)===box2d.b2ContactFlag.e_touchingFlag,n=this.m_fixtureA.IsSensor(),s=this.m_fixtureB.IsSensor(),r=n||s,b=this.m_fixtureA.GetBody(),a=this.m_fixtureB.GetBody(),d=b.GetTransform(),l=a.GetTransform();if(r){var x=this.m_fixtureA.GetShape(),p=this.m_fixtureB.GetShape();e=box2d.b2TestOverlapShape(x,this.m_indexA,p,this.m_indexB,d,l),this.m_manifold.pointCount=0}else{this.Evaluate(this.m_manifold,d,l),e=0<this.m_manifold.pointCount;for(var m=0;m<this.m_manifold.pointCount;++m){var h=this.m_manifold.points[m];h.normalImpulse=0,h.tangentImpulse=0;for(var _=h.id,c=0;c<this.m_oldManifold.pointCount;++c){var y=this.m_oldManifold.points[c];if(y.id.key===_.key){h.normalImpulse=y.normalImpulse,h.tangentImpulse=y.tangentImpulse;break}}}e!==i&&(b.SetAwake(!0),a.SetAwake(!0))}e?this.m_flags|=box2d.b2ContactFlag.e_touchingFlag:this.m_flags&=~box2d.b2ContactFlag.e_touchingFlag,!1===i&&!0===e&&o&&o.BeginContact(this),!0===i&&!1===e&&o&&o.EndContact(this),!1===r&&e&&o&&o.PreSolve(this,this.m_oldManifold)},box2d.b2Contact.prototype.ComputeTOI=function(o,t){var e=box2d.b2Contact.prototype.ComputeTOI.s_input;e.proxyA.SetShape(this.m_fixtureA.GetShape(),this.m_indexA),e.proxyB.SetShape(this.m_fixtureB.GetShape(),this.m_indexB),e.sweepA.Copy(o),e.sweepB.Copy(t),e.tMax=box2d.b2_linearSlop;var i=box2d.b2Contact.prototype.ComputeTOI.s_output;return box2d.b2TimeOfImpact(i,e),i.t},box2d.b2Contact.prototype.ComputeTOI.s_input=new box2d.b2TOIInput,box2d.b2Contact.prototype.ComputeTOI.s_output=new box2d.b2TOIOutput,goog.provide("box2d.b2PolygonAndCircleContact"),goog.require("box2d.b2Settings"),goog.require("box2d.b2Contact"),box2d.b2PolygonAndCircleContact=function(){goog.base(this)},goog.inherits(box2d.b2PolygonAndCircleContact,box2d.b2Contact),box2d.b2PolygonAndCircleContact.Create=function(o){return new box2d.b2PolygonAndCircleContact},box2d.b2PolygonAndCircleContact.Destroy=function(o,t){},box2d.b2PolygonAndCircleContact.prototype.Reset=function(o,t,e,i){goog.base(this,"Reset",o,t,e,i),box2d.ENABLE_ASSERTS&&box2d.b2Assert(o.GetType()===box2d.b2ShapeType.e_polygonShape),box2d.ENABLE_ASSERTS&&box2d.b2Assert(e.GetType()===box2d.b2ShapeType.e_circleShape)},box2d.b2PolygonAndCircleContact.prototype.Evaluate=function(o,t,e){var i=this.m_fixtureA.GetShape(),n=this.m_fixtureB.GetShape();box2d.ENABLE_ASSERTS&&box2d.b2Assert(i instanceof box2d.b2PolygonShape),box2d.ENABLE_ASSERTS&&box2d.b2Assert(n instanceof box2d.b2CircleShape),box2d.b2CollidePolygonAndCircle(o,i instanceof box2d.b2PolygonShape?i:null,t,n instanceof box2d.b2CircleShape?n:null,e)},goog.provide("box2d.b2EdgeAndPolygonContact"),goog.require("box2d.b2Settings"),goog.require("box2d.b2Contact"),box2d.b2EdgeAndPolygonContact=function(){goog.base(this)},goog.inherits(box2d.b2EdgeAndPolygonContact,box2d.b2Contact),box2d.b2EdgeAndPolygonContact.Create=function(o){return new box2d.b2EdgeAndPolygonContact},box2d.b2EdgeAndPolygonContact.Destroy=function(o,t){},box2d.b2EdgeAndPolygonContact.prototype.Reset=function(o,t,e,i){goog.base(this,"Reset",o,t,e,i),box2d.ENABLE_ASSERTS&&box2d.b2Assert(o.GetType()===box2d.b2ShapeType.e_edgeShape),box2d.ENABLE_ASSERTS&&box2d.b2Assert(e.GetType()===box2d.b2ShapeType.e_polygonShape)},box2d.b2EdgeAndPolygonContact.prototype.Evaluate=function(o,t,e){var i=this.m_fixtureA.GetShape(),n=this.m_fixtureB.GetShape();box2d.ENABLE_ASSERTS&&box2d.b2Assert(i instanceof box2d.b2EdgeShape),box2d.ENABLE_ASSERTS&&box2d.b2Assert(n instanceof box2d.b2PolygonShape),box2d.b2CollideEdgeAndPolygon(o,i instanceof box2d.b2EdgeShape?i:null,t,n instanceof box2d.b2PolygonShape?n:null,e)},goog.provide("box2d.b2Shape"),goog.require("box2d.b2Settings"),goog.require("box2d.b2Math"),goog.require("box2d.b2Distance"),box2d.b2MassData=function(){this.center=new box2d.b2Vec2(0,0)},box2d.b2MassData.prototype.mass=0,box2d.b2MassData.prototype.center=null,box2d.b2MassData.prototype.I=0,box2d.b2ShapeType={e_unknown:-1,e_circleShape:0,e_edgeShape:1,e_polygonShape:2,e_chainShape:3,e_shapeTypeCount:4},goog.exportProperty(box2d.b2ShapeType,"e_unknown",box2d.b2ShapeType.e_unknown),goog.exportProperty(box2d.b2ShapeType,"e_circleShape",box2d.b2ShapeType.e_circleShape),goog.exportProperty(box2d.b2ShapeType,"e_edgeShape",box2d.b2ShapeType.e_edgeShape),goog.exportProperty(box2d.b2ShapeType,"e_polygonShape",box2d.b2ShapeType.e_polygonShape),goog.exportProperty(box2d.b2ShapeType,"e_chainShape",box2d.b2ShapeType.e_chainShape),goog.exportProperty(box2d.b2ShapeType,"e_shapeTypeCount",box2d.b2ShapeType.e_shapeTypeCount),box2d.b2Shape=function(o,t){this.m_type=o,this.m_radius=t},box2d.b2Shape.prototype.m_type=box2d.b2ShapeType.e_unknown,box2d.b2Shape.prototype.m_radius=0,box2d.b2Shape.prototype.Clone=function(){return box2d.ENABLE_ASSERTS&&box2d.b2Assert(!1),null},box2d.b2Shape.prototype.Copy=function(o){return box2d.ENABLE_ASSERTS&&box2d.b2Assert(this.m_type===o.m_type),this.m_radius=o.m_radius,this},box2d.b2Shape.prototype.GetType=function(){return this.m_type},box2d.b2Shape.prototype.GetChildCount=function(){return box2d.ENABLE_ASSERTS&&box2d.b2Assert(!1,"pure virtual"),0},box2d.b2Shape.prototype.TestPoint=function(o,t){return box2d.ENABLE_ASSERTS&&box2d.b2Assert(!1,"pure virtual"),!1},box2d.b2Shape.prototype.RayCast=function(o,t,e,i){return box2d.ENABLE_ASSERTS&&box2d.b2Assert(!1,"pure virtual"),!1},box2d.b2Shape.prototype.ComputeAABB=function(o,t,e){box2d.ENABLE_ASSERTS&&box2d.b2Assert(!1,"pure virtual")},box2d.b2Shape.prototype.ComputeMass=function(o,t){box2d.ENABLE_ASSERTS&&box2d.b2Assert(!1,"pure virtual")},box2d.b2Shape.prototype.SetupDistanceProxy=function(o,t){box2d.ENABLE_ASSERTS&&box2d.b2Assert(!1,"pure virtual")},box2d.b2Shape.prototype.ComputeSubmergedArea=function(o,t,e,i){return box2d.ENABLE_ASSERTS&&box2d.b2Assert(!1,"pure virtual"),0},box2d.b2Shape.prototype.Dump=function(){box2d.ENABLE_ASSERTS&&box2d.b2Assert(!1,"pure virtual")},goog.provide("box2d.b2PolygonShape"),goog.require("box2d.b2Shape"),box2d.b2PolygonShape=function(){goog.base(this,box2d.b2ShapeType.e_polygonShape,box2d.b2_polygonRadius),this.m_centroid=new box2d.b2Vec2(0,0),this.m_vertices=box2d.b2Vec2.MakeArray(box2d.b2_maxPolygonVertices),this.m_normals=box2d.b2Vec2.MakeArray(box2d.b2_maxPolygonVertices)},goog.inherits(box2d.b2PolygonShape,box2d.b2Shape),box2d.b2PolygonShape.prototype.m_centroid=null,box2d.b2PolygonShape.prototype.m_vertices=null,box2d.b2PolygonShape.prototype.m_normals=null,box2d.b2PolygonShape.prototype.m_count=0,box2d.b2PolygonShape.prototype.Clone=function(){return(new box2d.b2PolygonShape).Copy(this)},box2d.b2PolygonShape.prototype.Copy=function(o){goog.base(this,"Copy",o),box2d.ENABLE_ASSERTS&&box2d.b2Assert(o instanceof box2d.b2PolygonShape),this.m_centroid.Copy(o.m_centroid),this.m_count=o.m_count;for(var t=0,e=this.m_count;t<e;++t)this.m_vertices[t].Copy(o.m_vertices[t]),this.m_normals[t].Copy(o.m_normals[t]);return this},box2d.b2PolygonShape.prototype.SetAsBox=function(o,t){return this.m_count=4,this.m_vertices[0].SetXY(-o,-t),this.m_vertices[1].SetXY(o,-t),this.m_vertices[2].SetXY(o,t),this.m_vertices[3].SetXY(-o,t),this.m_normals[0].SetXY(0,-1),this.m_normals[1].SetXY(1,0),this.m_normals[2].SetXY(0,1),this.m_normals[3].SetXY(-1,0),this.m_centroid.SetZero(),this},box2d.b2PolygonShape.prototype.SetAsOrientedBox=function(o,t,e,i){this.m_count=4,this.m_vertices[0].SetXY(-o,-t),this.m_vertices[1].SetXY(o,-t),this.m_vertices[2].SetXY(o,t),this.m_vertices[3].SetXY(-o,t),this.m_normals[0].SetXY(0,-1),this.m_normals[1].SetXY(1,0),this.m_normals[2].SetXY(0,1),this.m_normals[3].SetXY(-1,0),this.m_centroid.Copy(e);var n=new box2d.b2Transform;n.SetPosition(e),n.SetRotationAngleRadians(i);for(var s=0,r=this.m_count;s<r;++s)box2d.b2MulXV(n,this.m_vertices[s],this.m_vertices[s]),box2d.b2MulRV(n.q,this.m_normals[s],this.m_normals[s]);return this},box2d.b2PolygonShape.prototype.Set=function(o,t){if(void 0===t&&(t=o.length),box2d.ENABLE_ASSERTS&&box2d.b2Assert(3<=t&&t<=box2d.b2_maxPolygonVertices),t<3)return this.SetAsBox(1,1);for(var e=box2d.b2Min(t,box2d.b2_maxPolygonVertices),i=box2d.b2PolygonShape.prototype.Set.s_ps,n=0,s=0;s<e;++s){for(var r=o[s],b=!0,a=0;a<n;++a)if(box2d.b2DistanceSquaredVV(r,i[a])<.5*box2d.b2_linearSlop){b=!1;break}b&&i[n++].Copy(r)}if((e=n)<3)return box2d.ENABLE_ASSERTS&&box2d.b2Assert(!1),this.SetAsBox(1,1);var d=0,l=i[0].x;for(s=1;s<e;++s){var x=i[s].x;(l<x||x===l&&i[s].y<i[d].y)&&(d=s,l=x)}for(var p=box2d.b2PolygonShape.prototype.Set.s_hull,m=0,h=d;;){p[m]=h;var _=0;for(a=1;a<e;++a)if(_!==h){var c=box2d.b2SubVV(i[_],i[p[m]],box2d.b2PolygonShape.prototype.Set.s_r),y=(r=box2d.b2SubVV(i[a],i[p[m]],box2d.b2PolygonShape.prototype.Set.s_v),box2d.b2CrossVV(c,r));y<0&&(_=a),0===y&&r.GetLengthSquared()>c.GetLengthSquared()&&(_=a)}else _=a;if(++m,(h=_)===d)break}this.m_count=m;for(s=0;s<m;++s)this.m_vertices[s].Copy(i[p[s]]);s=0;for(var u=m;s<u;++s){var g=this.m_vertices[s],f=this.m_vertices[(s+1)%u],S=box2d.b2SubVV(f,g,box2d.b2Vec2.s_t0);box2d.ENABLE_ASSERTS&&box2d.b2Assert(S.GetLengthSquared()>box2d.b2_epsilon_sq),box2d.b2CrossVOne(S,this.m_normals[s]).SelfNormalize()}return box2d.b2PolygonShape.ComputeCentroid(this.m_vertices,m,this.m_centroid),this},box2d.b2PolygonShape.prototype.Set.s_ps=box2d.b2Vec2.MakeArray(box2d.b2_maxPolygonVertices),box2d.b2PolygonShape.prototype.Set.s_hull=box2d.b2MakeNumberArray(box2d.b2_maxPolygonVertices),box2d.b2PolygonShape.prototype.Set.s_r=new box2d.b2Vec2,box2d.b2PolygonShape.prototype.Set.s_v=new box2d.b2Vec2,box2d.b2PolygonShape.prototype.SetAsVector=function(o,t){return this.Set(o,t),this},box2d.b2PolygonShape.prototype.SetAsArray=function(o,t){return this.Set(o,t),this},box2d.b2PolygonShape.prototype.GetChildCount=function(){return 1},box2d.b2PolygonShape.prototype.TestPoint=function(o,t){for(var e=box2d.b2MulTXV(o,t,box2d.b2PolygonShape.prototype.TestPoint.s_pLocal),i=0,n=this.m_count;i<n;++i){if(0<box2d.b2DotVV(this.m_normals[i],box2d.b2SubVV(e,this.m_vertices[i],box2d.b2Vec2.s_t0)))return!1}return!0},box2d.b2PolygonShape.prototype.TestPoint.s_pLocal=new box2d.b2Vec2,box2d.b2PolygonShape.prototype.RayCast=function(o,t,e,i){for(var n=box2d.b2MulTXV(e,t.p1,box2d.b2PolygonShape.prototype.RayCast.s_p1),s=box2d.b2MulTXV(e,t.p2,box2d.b2PolygonShape.prototype.RayCast.s_p2),r=box2d.b2SubVV(s,n,box2d.b2PolygonShape.prototype.RayCast.s_d),b=0,a=t.maxFraction,d=-1,l=0,x=this.m_count;l<x;++l){var p=box2d.b2DotVV(this.m_normals[l],box2d.b2SubVV(this.m_vertices[l],n,box2d.b2Vec2.s_t0)),m=box2d.b2DotVV(this.m_normals[l],r);if(0===m){if(p<0)return!1}else m<0&&p<b*m?(b=p/m,d=l):0<m&&p<a*m&&(a=p/m);if(a<b)return!1}return box2d.ENABLE_ASSERTS&&box2d.b2Assert(0<=b&&b<=t.maxFraction),0<=d&&(o.fraction=b,box2d.b2MulRV(e.q,this.m_normals[d],o.normal),!0)},box2d.b2PolygonShape.prototype.RayCast.s_p1=new box2d.b2Vec2,box2d.b2PolygonShape.prototype.RayCast.s_p2=new box2d.b2Vec2,box2d.b2PolygonShape.prototype.RayCast.s_d=new box2d.b2Vec2,box2d.b2PolygonShape.prototype.ComputeAABB=function(o,t,e){for(var i=box2d.b2MulXV(t,this.m_vertices[0],o.lowerBound),n=o.upperBound.Copy(i),s=0,r=this.m_count;s<r;++s){var b=box2d.b2MulXV(t,this.m_vertices[s],box2d.b2PolygonShape.prototype.ComputeAABB.s_v);box2d.b2MinV(b,i,i),box2d.b2MaxV(b,n,n)}var a=this.m_radius;i.SelfSubXY(a,a),n.SelfAddXY(a,a)},box2d.b2PolygonShape.prototype.ComputeAABB.s_v=new box2d.b2Vec2,box2d.b2PolygonShape.prototype.ComputeMass=function(o,t){box2d.ENABLE_ASSERTS&&box2d.b2Assert(3<=this.m_count);for(var e=box2d.b2PolygonShape.prototype.ComputeMass.s_center.SetZero(),i=0,n=0,s=box2d.b2PolygonShape.prototype.ComputeMass.s_s.SetZero(),r=0,b=this.m_count;r<b;++r)s.SelfAdd(this.m_vertices[r]);s.SelfMul(1/this.m_count);for(r=0,b=this.m_count;r<b;++r){var a=box2d.b2SubVV(this.m_vertices[r],s,box2d.b2PolygonShape.prototype.ComputeMass.s_e1),d=box2d.b2SubVV(this.m_vertices[(r+1)%b],s,box2d.b2PolygonShape.prototype.ComputeMass.s_e2),l=box2d.b2CrossVV(a,d),x=.5*l;i+=x,e.SelfAdd(box2d.b2MulSV(x*(1/3),box2d.b2AddVV(a,d,box2d.b2Vec2.s_t0),box2d.b2Vec2.s_t1));var p=a.x,m=a.y,h=d.x,_=d.y;n+=1/3*.25*l*(p*p+h*p+h*h+(m*m+_*m+_*_))}o.mass=t*i,box2d.ENABLE_ASSERTS&&box2d.b2Assert(i>box2d.b2_epsilon),e.SelfMul(1/i),box2d.b2AddVV(e,s,o.center),o.I=t*n,o.I+=o.mass*(box2d.b2DotVV(o.center,o.center)-box2d.b2DotVV(e,e))},box2d.b2PolygonShape.prototype.ComputeMass.s_center=new box2d.b2Vec2,box2d.b2PolygonShape.prototype.ComputeMass.s_s=new box2d.b2Vec2,box2d.b2PolygonShape.prototype.ComputeMass.s_e1=new box2d.b2Vec2,box2d.b2PolygonShape.prototype.ComputeMass.s_e2=new box2d.b2Vec2,box2d.b2PolygonShape.prototype.Validate=function(){for(var o=0;o<this.m_count;++o)for(var t=o,e=(o+1)%this.m_count,i=this.m_vertices[t],n=box2d.b2SubVV(this.m_vertices[e],i,box2d.b2PolygonShape.prototype.Validate.s_e),s=0;s<this.m_count;++s)if(s!==t&&s!==e){var r=box2d.b2SubVV(this.m_vertices[s],i,box2d.b2PolygonShape.prototype.Validate.s_v);if(box2d.b2CrossVV(n,r)<0)return!1}return!0},box2d.b2PolygonShape.prototype.Validate.s_e=new box2d.b2Vec2,box2d.b2PolygonShape.prototype.Validate.s_v=new box2d.b2Vec2,box2d.b2PolygonShape.prototype.SetupDistanceProxy=function(o,t){o.m_vertices=this.m_vertices,o.m_count=this.m_count,o.m_radius=this.m_radius},box2d.b2PolygonShape.prototype.ComputeSubmergedArea=function(o,t,e,i){for(var n=box2d.b2MulTRV(e.q,o,box2d.b2PolygonShape.prototype.ComputeSubmergedArea.s_normalL),s=t-box2d.b2DotVV(o,e.p),r=box2d.b2PolygonShape.prototype.ComputeSubmergedArea.s_depths,b=0,a=-1,d=-1,l=!1,x=0,p=this.m_count;x<p;++x){r[x]=box2d.b2DotVV(n,this.m_vertices[x])-s;var m=r[x]<-box2d.b2_epsilon;0<x&&(m?l||(a=x-1,b++):l&&(d=x-1,b++)),l=m}switch(b){case 0:if(l){var h=box2d.b2PolygonShape.prototype.ComputeSubmergedArea.s_md;return this.ComputeMass(h,1),box2d.b2MulXV(e,h.center,i),h.mass}return 0;case 1:-1===a?a=this.m_count-1:d=this.m_count-1}var _=(a+1)%this.m_count,c=(d+1)%this.m_count,y=(0-r[a])/(r[_]-r[a]),u=(0-r[d])/(r[c]-r[d]),g=box2d.b2PolygonShape.prototype.ComputeSubmergedArea.s_intoVec.SetXY(this.m_vertices[a].x*(1-y)+this.m_vertices[_].x*y,this.m_vertices[a].y*(1-y)+this.m_vertices[_].y*y),f=box2d.b2PolygonShape.prototype.ComputeSubmergedArea.s_outoVec.SetXY(this.m_vertices[d].x*(1-u)+this.m_vertices[c].x*u,this.m_vertices[d].y*(1-u)+this.m_vertices[c].y*u),S=0,A=box2d.b2PolygonShape.prototype.ComputeSubmergedArea.s_center.SetZero(),C=this.m_vertices[_],v=null;for(x=_;x!==c;){v=(x=(x+1)%this.m_count)===c?f:this.m_vertices[x];var V=.5*((C.x-g.x)*(v.y-g.y)-(C.y-g.y)*(v.x-g.x));S+=V,A.x+=V*(g.x+C.x+v.x)/3,A.y+=V*(g.y+C.y+v.y)/3,C=v}return A.SelfMul(1/S),box2d.b2MulXV(e,A,i),S},box2d.b2PolygonShape.prototype.ComputeSubmergedArea.s_normalL=new box2d.b2Vec2,box2d.b2PolygonShape.prototype.ComputeSubmergedArea.s_depths=box2d.b2MakeNumberArray(box2d.b2_maxPolygonVertices),box2d.b2PolygonShape.prototype.ComputeSubmergedArea.s_md=new box2d.b2MassData,box2d.b2PolygonShape.prototype.ComputeSubmergedArea.s_intoVec=new box2d.b2Vec2,box2d.b2PolygonShape.prototype.ComputeSubmergedArea.s_outoVec=new box2d.b2Vec2,box2d.b2PolygonShape.prototype.ComputeSubmergedArea.s_center=new box2d.b2Vec2,box2d.b2PolygonShape.prototype.Dump=function(){box2d.b2Log("    /*box2d.b2PolygonShape*/ var shape = new box2d.b2PolygonShape();\n"),box2d.b2Log("    /*box2d.b2Vec2[]*/ var vs = box2d.b2Vec2.MakeArray(%d);\n",box2d.b2_maxPolygonVertices);for(var o=0;o<this.m_count;++o)box2d.b2Log("    vs[%d].SetXY(%.15f, %.15f);\n",o,this.m_vertices[o].x,this.m_vertices[o].y);box2d.b2Log("    shape.Set(vs, %d);\n",this.m_count)},box2d.b2PolygonShape.ComputeCentroid=function(o,t,e){box2d.ENABLE_ASSERTS&&box2d.b2Assert(3<=t);var i=e;i.SetZero();for(var n=0,s=box2d.b2PolygonShape.ComputeCentroid.s_pRef.SetZero(),r=0;r<t;++r){var b=s,a=o[r],d=o[(r+1)%t],l=box2d.b2SubVV(a,b,box2d.b2PolygonShape.ComputeCentroid.s_e1),x=box2d.b2SubVV(d,b,box2d.b2PolygonShape.ComputeCentroid.s_e2),p=.5*box2d.b2CrossVV(l,x);n+=p,i.x+=p*(1/3)*(b.x+a.x+d.x),i.y+=p*(1/3)*(b.y+a.y+d.y)}return box2d.ENABLE_ASSERTS&&box2d.b2Assert(n>box2d.b2_epsilon),i.SelfMul(1/n),i},box2d.b2PolygonShape.ComputeCentroid.s_pRef=new box2d.b2Vec2,box2d.b2PolygonShape.ComputeCentroid.s_e1=new box2d.b2Vec2,box2d.b2PolygonShape.ComputeCentroid.s_e2=new box2d.b2Vec2,goog.provide("box2d.b2CollideEdge"),goog.require("box2d.b2Collision"),box2d.b2CollideEdgeAndCircle=function(o,t,e,i,n){o.pointCount=0;var s=box2d.b2MulTXV(e,box2d.b2MulXV(n,i.m_p,box2d.b2Vec2.s_t0),box2d.b2CollideEdgeAndCircle.s_Q),r=t.m_vertex1,b=t.m_vertex2,a=box2d.b2SubVV(b,r,box2d.b2CollideEdgeAndCircle.s_e),d=box2d.b2DotVV(a,box2d.b2SubVV(b,s,box2d.b2Vec2.s_t0)),l=box2d.b2DotVV(a,box2d.b2SubVV(s,r,box2d.b2Vec2.s_t0)),x=t.m_radius+i.m_radius,p=box2d.b2CollideEdgeAndCircle.s_id;if(p.cf.indexB=0,p.cf.typeB=box2d.b2ContactFeatureType.e_vertex,l<=0){var m=r,h=box2d.b2SubVV(s,m,box2d.b2CollideEdgeAndCircle.s_d);if(x*x<box2d.b2DotVV(h,h))return;if(t.m_hasVertex0){var _=t.m_vertex0,c=r,y=box2d.b2SubVV(c,_,box2d.b2CollideEdgeAndCircle.s_e1);if(0<box2d.b2DotVV(y,box2d.b2SubVV(c,s,box2d.b2Vec2.s_t0)))return}return p.cf.indexA=0,p.cf.typeA=box2d.b2ContactFeatureType.e_vertex,o.pointCount=1,o.type=box2d.b2ManifoldType.e_circles,o.localNormal.SetZero(),o.localPoint.Copy(m),o.points[0].id.Copy(p),void o.points[0].localPoint.Copy(i.m_p)}if(d<=0){m=b,h=box2d.b2SubVV(s,m,box2d.b2CollideEdgeAndCircle.s_d);if(x*x<box2d.b2DotVV(h,h))return;if(t.m_hasVertex3){var u=t.m_vertex3,g=b,f=box2d.b2SubVV(u,g,box2d.b2CollideEdgeAndCircle.s_e2);if(0<box2d.b2DotVV(f,box2d.b2SubVV(s,g,box2d.b2Vec2.s_t0)))return}return p.cf.indexA=1,p.cf.typeA=box2d.b2ContactFeatureType.e_vertex,o.pointCount=1,o.type=box2d.b2ManifoldType.e_circles,o.localNormal.SetZero(),o.localPoint.Copy(m),o.points[0].id.Copy(p),void o.points[0].localPoint.Copy(i.m_p)}var S=box2d.b2DotVV(a,a);box2d.ENABLE_ASSERTS&&box2d.b2Assert(0<S),(m=box2d.b2CollideEdgeAndCircle.s_P).x=1/S*(d*r.x+l*b.x),m.y=1/S*(d*r.y+l*b.y);h=box2d.b2SubVV(s,m,box2d.b2CollideEdgeAndCircle.s_d);if(!(x*x<box2d.b2DotVV(h,h))){var A=box2d.b2CollideEdgeAndCircle.s_n.SetXY(-a.y,a.x);box2d.b2DotVV(A,box2d.b2SubVV(s,r,box2d.b2Vec2.s_t0))<0&&A.SetXY(-A.x,-A.y),A.Normalize(),p.cf.indexA=0,p.cf.typeA=box2d.b2ContactFeatureType.e_face,o.pointCount=1,o.type=box2d.b2ManifoldType.e_faceA,o.localNormal.Copy(A),o.localPoint.Copy(r),o.points[0].id.Copy(p),o.points[0].localPoint.Copy(i.m_p)}},box2d.b2CollideEdgeAndCircle.s_Q=new box2d.b2Vec2,box2d.b2CollideEdgeAndCircle.s_e=new box2d.b2Vec2,box2d.b2CollideEdgeAndCircle.s_d=new box2d.b2Vec2,box2d.b2CollideEdgeAndCircle.s_e1=new box2d.b2Vec2,box2d.b2CollideEdgeAndCircle.s_e2=new box2d.b2Vec2,box2d.b2CollideEdgeAndCircle.s_P=new box2d.b2Vec2,box2d.b2CollideEdgeAndCircle.s_n=new box2d.b2Vec2,box2d.b2CollideEdgeAndCircle.s_id=new box2d.b2ContactID,box2d.b2EPAxisType={e_unknown:0,e_edgeA:1,e_edgeB:2},goog.exportProperty(box2d.b2EPAxisType,"e_unknown",box2d.b2EPAxisType.e_unknown),goog.exportProperty(box2d.b2EPAxisType,"e_edgeA",box2d.b2EPAxisType.e_edgeA),goog.exportProperty(box2d.b2EPAxisType,"e_edgeB",box2d.b2EPAxisType.e_edgeB),box2d.b2EPAxis=function(){},box2d.b2EPAxis.prototype.type=box2d.b2EPAxisType.e_unknown,box2d.b2EPAxis.prototype.index=0,box2d.b2EPAxis.prototype.separation=0,box2d.b2TempPolygon=function(){this.vertices=box2d.b2Vec2.MakeArray(box2d.b2_maxPolygonVertices),this.normals=box2d.b2Vec2.MakeArray(box2d.b2_maxPolygonVertices),this.count=0},box2d.b2TempPolygon.prototype.vertices=null,box2d.b2TempPolygon.prototype.normals=null,box2d.b2TempPolygon.prototype.count=0,box2d.b2ReferenceFace=function(){this.i1=0,this.i2=0,this.v1=new box2d.b2Vec2,this.v2=new box2d.b2Vec2,this.normal=new box2d.b2Vec2,this.sideNormal1=new box2d.b2Vec2,this.sideOffset1=0,this.sideNormal2=new box2d.b2Vec2,this.sideOffset2=0},box2d.b2ReferenceFace.prototype.i1=0,box2d.b2ReferenceFace.prototype.i2=0,box2d.b2ReferenceFace.prototype.v1=null,box2d.b2ReferenceFace.prototype.v2=null,box2d.b2ReferenceFace.prototype.normal=null,box2d.b2ReferenceFace.prototype.sideNormal1=null,box2d.b2ReferenceFace.prototype.sideOffset1=0,box2d.b2ReferenceFace.prototype.sideNormal2=null,box2d.b2ReferenceFace.prototype.sideOffset2=0,box2d.b2EPColliderVertexType={e_isolated:0,e_concave:1,e_convex:2},goog.exportProperty(box2d.b2EPColliderVertexType,"e_isolated",box2d.b2EPColliderVertexType.e_isolated),goog.exportProperty(box2d.b2EPColliderVertexType,"e_concave",box2d.b2EPColliderVertexType.e_concave),goog.exportProperty(box2d.b2EPColliderVertexType,"e_convex",box2d.b2EPColliderVertexType.e_convex),box2d.b2EPCollider=function(){this.m_polygonB=new box2d.b2TempPolygon,this.m_xf=new box2d.b2Transform,this.m_centroidB=new box2d.b2Vec2,this.m_v0=new box2d.b2Vec2,this.m_v1=new box2d.b2Vec2,this.m_v2=new box2d.b2Vec2,this.m_v3=new box2d.b2Vec2,this.m_normal0=new box2d.b2Vec2,this.m_normal1=new box2d.b2Vec2,this.m_normal2=new box2d.b2Vec2,this.m_normal=new box2d.b2Vec2,this.m_type1=box2d.b2EPColliderVertexType.e_isolated,this.m_type2=box2d.b2EPColliderVertexType.e_isolated,this.m_lowerLimit=new box2d.b2Vec2,this.m_upperLimit=new box2d.b2Vec2,this.m_radius=0,this.m_front=!1},box2d.b2EPCollider.prototype.m_polygonB=null,box2d.b2EPCollider.prototype.m_xf=null,box2d.b2EPCollider.prototype.m_centroidB=null,box2d.b2EPCollider.prototype.m_v0=null,box2d.b2EPCollider.prototype.m_v1=null,box2d.b2EPCollider.prototype.m_v2=null,box2d.b2EPCollider.prototype.m_v3=null,box2d.b2EPCollider.prototype.m_normal0=null,box2d.b2EPCollider.prototype.m_normal1=null,box2d.b2EPCollider.prototype.m_normal2=null,box2d.b2EPCollider.prototype.m_normal=null,box2d.b2EPCollider.prototype.m_type1=box2d.b2EPColliderVertexType.e_isolated,box2d.b2EPCollider.prototype.m_type2=box2d.b2EPColliderVertexType.e_isolated,box2d.b2EPCollider.prototype.m_lowerLimit=null,box2d.b2EPCollider.prototype.m_upperLimit=null,box2d.b2EPCollider.prototype.m_radius=0,box2d.b2EPCollider.prototype.m_front=!1,box2d.b2EPCollider.prototype.Collide=function(o,t,e,i,n){box2d.b2MulTXX(e,n,this.m_xf),box2d.b2MulXV(this.m_xf,i.m_centroid,this.m_centroidB),this.m_v0.Copy(t.m_vertex0),this.m_v1.Copy(t.m_vertex1),this.m_v2.Copy(t.m_vertex2),this.m_v3.Copy(t.m_vertex3);var s=t.m_hasVertex0,r=t.m_hasVertex3,b=box2d.b2SubVV(this.m_v2,this.m_v1,box2d.b2EPCollider.s_edge1);b.Normalize(),this.m_normal1.SetXY(b.y,-b.x);var a=box2d.b2DotVV(this.m_normal1,box2d.b2SubVV(this.m_centroidB,this.m_v1,box2d.b2Vec2.s_t0)),d=0,l=0,x=!1,p=!1;if(s){var m=box2d.b2SubVV(this.m_v1,this.m_v0,box2d.b2EPCollider.s_edge0);m.Normalize(),this.m_normal0.SetXY(m.y,-m.x),x=0<=box2d.b2CrossVV(m,b),d=box2d.b2DotVV(this.m_normal0,box2d.b2SubVV(this.m_centroidB,this.m_v0,box2d.b2Vec2.s_t0))}if(r){var h=box2d.b2SubVV(this.m_v3,this.m_v2,box2d.b2EPCollider.s_edge2);h.Normalize(),this.m_normal2.SetXY(h.y,-h.x),p=0<box2d.b2CrossVV(b,h),l=box2d.b2DotVV(this.m_normal2,box2d.b2SubVV(this.m_centroidB,this.m_v2,box2d.b2Vec2.s_t0))}s&&r?x&&p?(this.m_front=0<=d||0<=a||0<=l,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):x?(this.m_front=0<=d||0<=a&&0<=l,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):p?(this.m_front=0<=l||0<=d&&0<=a,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):(this.m_front=0<=d&&0<=a&&0<=l,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):s?x?(this.m_front=0<=d||0<=a,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1)),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_front=0<=d&&0<=a,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):r?p?(this.m_front=0<=a||0<=l,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1))):(this.m_front=0<=a&&0<=l,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg()),this.m_upperLimit.Copy(this.m_normal1)):(this.m_front=0<=a,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1))),this.m_polygonB.count=i.m_count;for(var _=0,c=i.m_count;_<c;++_)box2d.b2MulXV(this.m_xf,i.m_vertices[_],this.m_polygonB.vertices[_]),box2d.b2MulRV(this.m_xf.q,i.m_normals[_],this.m_polygonB.normals[_]);this.m_radius=2*box2d.b2_polygonRadius,o.pointCount=0;var y=this.ComputeEdgeSeparation(box2d.b2EPCollider.s_edgeAxis);if(y.type!==box2d.b2EPAxisType.e_unknown&&!(y.separation>this.m_radius)){var u=this.ComputePolygonSeparation(box2d.b2EPCollider.s_polygonAxis);if(!(u.type!==box2d.b2EPAxisType.e_unknown&&u.separation>this.m_radius)){var g;g=u.type===box2d.b2EPAxisType.e_unknown?y:u.separation>.98*y.separation+.001?u:y;var f=box2d.b2EPCollider.s_ie,S=box2d.b2EPCollider.s_rf;if(g.type===box2d.b2EPAxisType.e_edgeA){o.type=box2d.b2ManifoldType.e_faceA;var A=0,C=box2d.b2DotVV(this.m_normal,this.m_polygonB.normals[0]);for(_=1,c=this.m_polygonB.count;_<c;++_){var v=box2d.b2DotVV(this.m_normal,this.m_polygonB.normals[_]);v<C&&(C=v,A=_)}var V=A,B=(V+1)%this.m_polygonB.count;(w=f[0]).v.Copy(this.m_polygonB.vertices[V]),w.id.cf.indexA=0,w.id.cf.indexB=V,w.id.cf.typeA=box2d.b2ContactFeatureType.e_face,w.id.cf.typeB=box2d.b2ContactFeatureType.e_vertex,(P=f[1]).v.Copy(this.m_polygonB.vertices[B]),P.id.cf.indexA=0,P.id.cf.indexB=B,P.id.cf.typeA=box2d.b2ContactFeatureType.e_face,P.id.cf.typeB=box2d.b2ContactFeatureType.e_vertex,this.m_front?(S.i1=0,S.i2=1,S.v1.Copy(this.m_v1),S.v2.Copy(this.m_v2),S.normal.Copy(this.m_normal1)):(S.i1=1,S.i2=0,S.v1.Copy(this.m_v2),S.v2.Copy(this.m_v1),S.normal.Copy(this.m_normal1).SelfNeg())}else{var w,P;o.type=box2d.b2ManifoldType.e_faceB,(w=f[0]).v.Copy(this.m_v1),w.id.cf.indexA=0,w.id.cf.indexB=g.index,w.id.cf.typeA=box2d.b2ContactFeatureType.e_vertex,w.id.cf.typeB=box2d.b2ContactFeatureType.e_face,(P=f[1]).v.Copy(this.m_v2),P.id.cf.indexA=0,P.id.cf.indexB=g.index,P.id.cf.typeA=box2d.b2ContactFeatureType.e_vertex,P.id.cf.typeB=box2d.b2ContactFeatureType.e_face,S.i1=g.index,S.i2=(S.i1+1)%this.m_polygonB.count,S.v1.Copy(this.m_polygonB.vertices[S.i1]),S.v2.Copy(this.m_polygonB.vertices[S.i2]),S.normal.Copy(this.m_polygonB.normals[S.i1])}S.sideNormal1.SetXY(S.normal.y,-S.normal.x),S.sideNormal2.Copy(S.sideNormal1).SelfNeg(),S.sideOffset1=box2d.b2DotVV(S.sideNormal1,S.v1),S.sideOffset2=box2d.b2DotVV(S.sideNormal2,S.v2);var M=box2d.b2EPCollider.s_clipPoints1,D=box2d.b2EPCollider.s_clipPoints2;if(!(box2d.b2ClipSegmentToLine(M,f,S.sideNormal1,S.sideOffset1,S.i1)<box2d.b2_maxManifoldPoints||box2d.b2ClipSegmentToLine(D,M,S.sideNormal2,S.sideOffset2,S.i2)<box2d.b2_maxManifoldPoints)){g.type===box2d.b2EPAxisType.e_edgeA?(o.localNormal.Copy(S.normal),o.localPoint.Copy(S.v1)):(o.localNormal.Copy(i.m_normals[S.i1]),o.localPoint.Copy(i.m_vertices[S.i1]));var J=0;for(_=0,c=box2d.b2_maxManifoldPoints;_<c;++_){if(box2d.b2DotVV(S.normal,box2d.b2SubVV(D[_].v,S.v1,box2d.b2Vec2.s_t0))<=this.m_radius){var T=o.points[J];g.type===box2d.b2EPAxisType.e_edgeA?(box2d.b2MulTXV(this.m_xf,D[_].v,T.localPoint),T.id=D[_].id):(T.localPoint.Copy(D[_].v),T.id.cf.typeA=D[_].id.cf.typeB,T.id.cf.typeB=D[_].id.cf.typeA,T.id.cf.indexA=D[_].id.cf.indexB,T.id.cf.indexB=D[_].id.cf.indexA),++J}}o.pointCount=J}}}},box2d.b2EPCollider.s_edge1=new box2d.b2Vec2,box2d.b2EPCollider.s_edge0=new box2d.b2Vec2,box2d.b2EPCollider.s_edge2=new box2d.b2Vec2,box2d.b2EPCollider.s_ie=box2d.b2ClipVertex.MakeArray(2),box2d.b2EPCollider.s_rf=new box2d.b2ReferenceFace,box2d.b2EPCollider.s_clipPoints1=box2d.b2ClipVertex.MakeArray(2),box2d.b2EPCollider.s_clipPoints2=box2d.b2ClipVertex.MakeArray(2),box2d.b2EPCollider.s_edgeAxis=new box2d.b2EPAxis,box2d.b2EPCollider.s_polygonAxis=new box2d.b2EPAxis,box2d.b2EPCollider.prototype.ComputeEdgeSeparation=function(o){var t=o;t.type=box2d.b2EPAxisType.e_edgeA,t.index=this.m_front?0:1,t.separation=box2d.b2_maxFloat;for(var e=0,i=this.m_polygonB.count;e<i;++e){var n=box2d.b2DotVV(this.m_normal,box2d.b2SubVV(this.m_polygonB.vertices[e],this.m_v1,box2d.b2Vec2.s_t0));n<t.separation&&(t.separation=n)}return t},box2d.b2EPCollider.prototype.ComputePolygonSeparation=function(o){var t=o;t.type=box2d.b2EPAxisType.e_unknown,t.index=-1,t.separation=-box2d.b2_maxFloat;for(var e=box2d.b2EPCollider.s_perp.SetXY(-this.m_normal.y,this.m_normal.x),i=0,n=this.m_polygonB.count;i<n;++i){var s=box2d.b2NegV(this.m_polygonB.normals[i],box2d.b2EPCollider.s_n),r=box2d.b2DotVV(s,box2d.b2SubVV(this.m_polygonB.vertices[i],this.m_v1,box2d.b2Vec2.s_t0)),b=box2d.b2DotVV(s,box2d.b2SubVV(this.m_polygonB.vertices[i],this.m_v2,box2d.b2Vec2.s_t0)),a=box2d.b2Min(r,b);if(a>this.m_radius)return t.type=box2d.b2EPAxisType.e_edgeB,t.index=i,t.separation=a,t;if(0<=box2d.b2DotVV(s,e)){if(box2d.b2DotVV(box2d.b2SubVV(s,this.m_upperLimit,box2d.b2Vec2.s_t0),this.m_normal)<-box2d.b2_angularSlop)continue}else if(box2d.b2DotVV(box2d.b2SubVV(s,this.m_lowerLimit,box2d.b2Vec2.s_t0),this.m_normal)<-box2d.b2_angularSlop)continue;a>t.separation&&(t.type=box2d.b2EPAxisType.e_edgeB,t.index=i,t.separation=a)}return t},box2d.b2EPCollider.s_n=new box2d.b2Vec2,box2d.b2EPCollider.s_perp=new box2d.b2Vec2,box2d.b2CollideEdgeAndPolygon=function(o,t,e,i,n){box2d.b2CollideEdgeAndPolygon.s_collider.Collide(o,t,e,i,n)},box2d.b2CollideEdgeAndPolygon.s_collider=new box2d.b2EPCollider,goog.provide("box2d.b2EdgeShape"),goog.require("box2d.b2Shape"),box2d.b2EdgeShape=function(){goog.base(this,box2d.b2ShapeType.e_edgeShape,box2d.b2_polygonRadius),this.m_vertex1=new box2d.b2Vec2,this.m_vertex2=new box2d.b2Vec2,this.m_vertex0=new box2d.b2Vec2,this.m_vertex3=new box2d.b2Vec2},goog.inherits(box2d.b2EdgeShape,box2d.b2Shape),box2d.b2EdgeShape.prototype.m_vertex1=null,box2d.b2EdgeShape.prototype.m_vertex2=null,box2d.b2EdgeShape.prototype.m_vertex0=null,box2d.b2EdgeShape.prototype.m_vertex3=null,box2d.b2EdgeShape.prototype.m_hasVertex0=!1,box2d.b2EdgeShape.prototype.m_hasVertex3=!1,box2d.b2EdgeShape.prototype.Set=function(o,t){return this.m_vertex1.Copy(o),this.m_vertex2.Copy(t),this.m_hasVertex0=!1,this.m_hasVertex3=!1,this},box2d.b2EdgeShape.prototype.SetAsEdge=box2d.b2EdgeShape.prototype.Set,box2d.b2EdgeShape.prototype.Clone=function(){return(new box2d.b2EdgeShape).Copy(this)},box2d.b2EdgeShape.prototype.Copy=function(o){return goog.base(this,"Copy",o),box2d.ENABLE_ASSERTS&&box2d.b2Assert(o instanceof box2d.b2EdgeShape),this.m_vertex1.Copy(o.m_vertex1),this.m_vertex2.Copy(o.m_vertex2),this.m_vertex0.Copy(o.m_vertex0),this.m_vertex3.Copy(o.m_vertex3),this.m_hasVertex0=o.m_hasVertex0,this.m_hasVertex3=o.m_hasVertex3,this},box2d.b2EdgeShape.prototype.GetChildCount=function(){return 1},box2d.b2EdgeShape.prototype.TestPoint=function(o,t){return!1},box2d.b2EdgeShape.prototype.RayCast=function(o,t,e,i){var n=box2d.b2MulTXV(e,t.p1,box2d.b2EdgeShape.prototype.RayCast.s_p1),s=box2d.b2MulTXV(e,t.p2,box2d.b2EdgeShape.prototype.RayCast.s_p2),r=box2d.b2SubVV(s,n,box2d.b2EdgeShape.prototype.RayCast.s_d),b=this.m_vertex1,a=this.m_vertex2,d=box2d.b2SubVV(a,b,box2d.b2EdgeShape.prototype.RayCast.s_e),l=o.normal.SetXY(d.y,-d.x).SelfNormalize(),x=box2d.b2DotVV(l,box2d.b2SubVV(b,n,box2d.b2Vec2.s_t0)),p=box2d.b2DotVV(l,r);if(0===p)return!1;var m=x/p;if(m<0||t.maxFraction<m)return!1;var h=box2d.b2AddVMulSV(n,m,r,box2d.b2EdgeShape.prototype.RayCast.s_q),_=box2d.b2SubVV(a,b,box2d.b2EdgeShape.prototype.RayCast.s_r),c=box2d.b2DotVV(_,_);if(0===c)return!1;var y=box2d.b2DotVV(box2d.b2SubVV(h,b,box2d.b2Vec2.s_t0),_)/c;return!(y<0||1<y)&&(o.fraction=m,box2d.b2MulRV(e.q,o.normal,o.normal),0<x&&o.normal.SelfNeg(),!0)},box2d.b2EdgeShape.prototype.RayCast.s_p1=new box2d.b2Vec2,box2d.b2EdgeShape.prototype.RayCast.s_p2=new box2d.b2Vec2,box2d.b2EdgeShape.prototype.RayCast.s_d=new box2d.b2Vec2,box2d.b2EdgeShape.prototype.RayCast.s_e=new box2d.b2Vec2,box2d.b2EdgeShape.prototype.RayCast.s_q=new box2d.b2Vec2,box2d.b2EdgeShape.prototype.RayCast.s_r=new box2d.b2Vec2,box2d.b2EdgeShape.prototype.ComputeAABB=function(o,t,e){var i=box2d.b2MulXV(t,this.m_vertex1,box2d.b2EdgeShape.prototype.ComputeAABB.s_v1),n=box2d.b2MulXV(t,this.m_vertex2,box2d.b2EdgeShape.prototype.ComputeAABB.s_v2);box2d.b2MinV(i,n,o.lowerBound),box2d.b2MaxV(i,n,o.upperBound);var s=this.m_radius;o.lowerBound.SelfSubXY(s,s),o.upperBound.SelfAddXY(s,s)},box2d.b2EdgeShape.prototype.ComputeAABB.s_v1=new box2d.b2Vec2,box2d.b2EdgeShape.prototype.ComputeAABB.s_v2=new box2d.b2Vec2,box2d.b2EdgeShape.prototype.ComputeMass=function(o,t){o.mass=0,box2d.b2MidVV(this.m_vertex1,this.m_vertex2,o.center),o.I=0},box2d.b2EdgeShape.prototype.SetupDistanceProxy=function(o,t){o.m_vertices=new Array(2),o.m_vertices[0]=this.m_vertex1,o.m_vertices[1]=this.m_vertex2,o.m_count=2,o.m_radius=this.m_radius},box2d.b2EdgeShape.prototype.ComputeSubmergedArea=function(o,t,e,i){return i.SetZero(),0},box2d.b2EdgeShape.prototype.Dump=function(){box2d.b2Log("    /*box2d.b2EdgeShape*/ var shape = new box2d.b2EdgeShape();\n"),box2d.b2Log("    shape.m_radius = %.15f;\n",this.m_radius),box2d.b2Log("    shape.m_vertex0.SetXY(%.15f, %.15f);\n",this.m_vertex0.x,this.m_vertex0.y),box2d.b2Log("    shape.m_vertex1.SetXY(%.15f, %.15f);\n",this.m_vertex1.x,this.m_vertex1.y),box2d.b2Log("    shape.m_vertex2.SetXY(%.15f, %.15f);\n",this.m_vertex2.x,this.m_vertex2.y),box2d.b2Log("    shape.m_vertex3.SetXY(%.15f, %.15f);\n",this.m_vertex3.x,this.m_vertex3.y),box2d.b2Log("    shape.m_hasVertex0 = %s;\n",this.m_hasVertex0),box2d.b2Log("    shape.m_hasVertex3 = %s;\n",this.m_hasVertex3)},goog.provide("box2d.b2ChainShape"),goog.require("box2d.b2Shape"),goog.require("box2d.b2EdgeShape"),box2d.b2ChainShape=function(){goog.base(this,box2d.b2ShapeType.e_chainShape,box2d.b2_polygonRadius),this.m_prevVertex=new box2d.b2Vec2,this.m_nextVertex=new box2d.b2Vec2},goog.inherits(box2d.b2ChainShape,box2d.b2Shape),box2d.b2ChainShape.prototype.m_vertices=null,box2d.b2ChainShape.prototype.m_count=0,box2d.b2ChainShape.prototype.m_prevVertex=null,box2d.b2ChainShape.prototype.m_nextVertex=null,box2d.b2ChainShape.prototype.m_hasPrevVertex=!1,box2d.b2ChainShape.prototype.m_hasNextVertex=!1,box2d.b2ChainShape.prototype.CreateLoop=function(o,t){if(t=t||o.length,box2d.ENABLE_ASSERTS&&box2d.b2Assert(null===this.m_vertices&&0===this.m_count),box2d.ENABLE_ASSERTS&&box2d.b2Assert(3<=t),box2d.ENABLE_ASSERTS)for(var e=1;e<t;++e){var i=o[e-1],n=o[e];box2d.b2Assert(box2d.b2DistanceSquaredVV(i,n)>box2d.b2_linearSlop*box2d.b2_linearSlop)}this.m_count=t+1,this.m_vertices=box2d.b2Vec2.MakeArray(this.m_count);for(e=0;e<t;++e)this.m_vertices[e].Copy(o[e]);return this.m_vertices[t].Copy(this.m_vertices[0]),this.m_prevVertex.Copy(this.m_vertices[this.m_count-2]),this.m_nextVertex.Copy(this.m_vertices[1]),this.m_hasPrevVertex=!0,this.m_hasNextVertex=!0,this},box2d.b2ChainShape.prototype.CreateChain=function(o,t){if(t=t||o.length,box2d.ENABLE_ASSERTS&&box2d.b2Assert(null===this.m_vertices&&0===this.m_count),box2d.ENABLE_ASSERTS&&box2d.b2Assert(2<=t),box2d.ENABLE_ASSERTS)for(var e=1;e<t;++e){var i=o[e-1],n=o[e];box2d.b2Assert(box2d.b2DistanceSquaredVV(i,n)>box2d.b2_linearSlop*box2d.b2_linearSlop)}this.m_count=t,this.m_vertices=box2d.b2Vec2.MakeArray(t);for(e=0;e<t;++e)this.m_vertices[e].Copy(o[e]);return this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1,this.m_prevVertex.SetZero(),this.m_nextVertex.SetZero(),this},box2d.b2ChainShape.prototype.SetPrevVertex=function(o){return this.m_prevVertex.Copy(o),this.m_hasPrevVertex=!0,this},box2d.b2ChainShape.prototype.SetNextVertex=function(o){return this.m_nextVertex.Copy(o),this.m_hasNextVertex=!0,this},box2d.b2ChainShape.prototype.Clone=function(){return(new box2d.b2ChainShape).Copy(this)},box2d.b2ChainShape.prototype.Copy=function(o){return goog.base(this,"Copy",o),box2d.ENABLE_ASSERTS&&box2d.b2Assert(o instanceof box2d.b2ChainShape),this.CreateChain(o.m_vertices,o.m_count),this.m_prevVertex.Copy(o.m_prevVertex),this.m_nextVertex.Copy(o.m_nextVertex),this.m_hasPrevVertex=o.m_hasPrevVertex,this.m_hasNextVertex=o.m_hasNextVertex,this},box2d.b2ChainShape.prototype.GetChildCount=function(){return this.m_count-1},box2d.b2ChainShape.prototype.GetChildEdge=function(o,t){box2d.ENABLE_ASSERTS&&box2d.b2Assert(0<=t&&t<this.m_count-1),o.m_type=box2d.b2ShapeType.e_edgeShape,o.m_radius=this.m_radius,o.m_vertex1.Copy(this.m_vertices[t]),o.m_vertex2.Copy(this.m_vertices[t+1]),o.m_hasVertex0=0<t?(o.m_vertex0.Copy(this.m_vertices[t-1]),!0):(o.m_vertex0.Copy(this.m_prevVertex),this.m_hasPrevVertex),t<this.m_count-2?(o.m_vertex3.Copy(this.m_vertices[t+2]),o.m_hasVertex3=!0):(o.m_vertex3.Copy(this.m_nextVertex),o.m_hasVertex3=this.m_hasNextVertex)},box2d.b2ChainShape.prototype.TestPoint=function(o,t){return!1},box2d.b2ChainShape.prototype.RayCast=function(o,t,e,i){box2d.ENABLE_ASSERTS&&box2d.b2Assert(i<this.m_count);var n=box2d.b2ChainShape.s_edgeShape;return n.m_vertex1.Copy(this.m_vertices[i]),n.m_vertex2.Copy(this.m_vertices[(i+1)%this.m_count]),n.RayCast(o,t,e,0)},box2d.b2ChainShape.s_edgeShape=new box2d.b2EdgeShape,box2d.b2ChainShape.prototype.ComputeAABB=function(o,t,e){box2d.ENABLE_ASSERTS&&box2d.b2Assert(e<this.m_count);var i=this.m_vertices[e],n=this.m_vertices[(e+1)%this.m_count],s=box2d.b2MulXV(t,i,box2d.b2ChainShape.prototype.ComputeAABB.s_v1),r=box2d.b2MulXV(t,n,box2d.b2ChainShape.prototype.ComputeAABB.s_v2);box2d.b2MinV(s,r,o.lowerBound),box2d.b2MaxV(s,r,o.upperBound)},box2d.b2ChainShape.prototype.ComputeAABB.s_v1=new box2d.b2Vec2,box2d.b2ChainShape.prototype.ComputeAABB.s_v2=new box2d.b2Vec2,box2d.b2ChainShape.prototype.ComputeMass=function(o,t){o.mass=0,o.center.SetZero(),o.I=0},box2d.b2ChainShape.prototype.SetupDistanceProxy=function(o,t){box2d.ENABLE_ASSERTS&&box2d.b2Assert(0<=t&&t<this.m_count),o.m_buffer[0].Copy(this.m_vertices[t]),t+1<this.m_count?o.m_buffer[1].Copy(this.m_vertices[t+1]):o.m_buffer[1].Copy(this.m_vertices[0]),o.m_vertices=o.m_buffer,o.m_count=2,o.m_radius=this.m_radius},box2d.b2ChainShape.prototype.ComputeSubmergedArea=function(o,t,e,i){return i.SetZero(),0},box2d.b2ChainShape.prototype.Dump=function(){box2d.b2Log("    /*box2d.b2ChainShape*/ var shape = new box2d.b2ChainShape();\n"),box2d.b2Log("    /*box2d.b2Vec2[]*/ var vs = box2d.b2Vec2.MakeArray(%d);\n",box2d.b2_maxPolygonVertices);for(var o=0;o<this.m_count;++o)box2d.b2Log("    vs[%d].SetXY(%.15f, %.15f);\n",o,this.m_vertices[o].x,this.m_vertices[o].y);box2d.b2Log("    shape.CreateChain(vs, %d);\n",this.m_count),box2d.b2Log("    shape.m_prevVertex.SetXY(%.15f, %.15f);\n",this.m_prevVertex.x,this.m_prevVertex.y),box2d.b2Log("    shape.m_nextVertex.SetXY(%.15f, %.15f);\n",this.m_nextVertex.x,this.m_nextVertex.y),box2d.b2Log("    shape.m_hasPrevVertex = %s;\n",this.m_hasPrevVertex?"true":"false"),box2d.b2Log("    shape.m_hasNextVertex = %s;\n",this.m_hasNextVertex?"true":"false")},goog.provide("box2d.b2ChainAndPolygonContact"),goog.require("box2d.b2Settings"),goog.require("box2d.b2Contact"),goog.require("box2d.b2CollideEdge"),goog.require("box2d.b2ChainShape"),goog.require("box2d.b2PolygonShape"),box2d.b2ChainAndPolygonContact=function(){goog.base(this)},goog.inherits(box2d.b2ChainAndPolygonContact,box2d.b2Contact),box2d.b2ChainAndPolygonContact.Create=function(o){return new box2d.b2ChainAndPolygonContact},box2d.b2ChainAndPolygonContact.Destroy=function(o,t){},box2d.b2ChainAndPolygonContact.prototype.Reset=function(o,t,e,i){goog.base(this,"Reset",o,t,e,i),box2d.ENABLE_ASSERTS&&box2d.b2Assert(o.GetType()===box2d.b2ShapeType.e_chainShape),box2d.ENABLE_ASSERTS&&box2d.b2Assert(e.GetType()===box2d.b2ShapeType.e_polygonShape)},box2d.b2ChainAndPolygonContact.prototype.Evaluate=function(o,t,e){var i=this.m_fixtureA.GetShape(),n=this.m_fixtureB.GetShape();box2d.ENABLE_ASSERTS&&box2d.b2Assert(i instanceof box2d.b2ChainShape),box2d.ENABLE_ASSERTS&&box2d.b2Assert(n instanceof box2d.b2PolygonShape);var s=i instanceof box2d.b2ChainShape?i:null,r=box2d.b2ChainAndPolygonContact.prototype.Evaluate.s_edge;s.GetChildEdge(r,this.m_indexA),box2d.b2CollideEdgeAndPolygon(o,r,t,n instanceof box2d.b2PolygonShape?n:null,e)},box2d.b2ChainAndPolygonContact.prototype.Evaluate.s_edge=new box2d.b2EdgeShape,goog.provide("box2d.b2CollidePolygon"),goog.require("box2d.b2Collision"),box2d.b2FindMaxSeparation=function(o,t,e,i,n){for(var s=t.m_count,r=i.m_count,b=t.m_normals,a=t.m_vertices,d=i.m_vertices,l=box2d.b2MulTXX(n,e,box2d.b2FindMaxSeparation.s_xf),x=0,p=-box2d.b2_maxFloat,m=0;m<s;++m){for(var h=box2d.b2MulRV(l.q,b[m],box2d.b2FindMaxSeparation.s_n),_=box2d.b2MulXV(l,a[m],box2d.b2FindMaxSeparation.s_v1),c=box2d.b2_maxFloat,y=0;y<r;++y){var u=box2d.b2DotVV(h,box2d.b2SubVV(d[y],_,box2d.b2Vec2.s_t0));u<c&&(c=u)}p<c&&(p=c,x=m)}return o[0]=x,p},box2d.b2FindMaxSeparation.s_xf=new box2d.b2Transform,box2d.b2FindMaxSeparation.s_n=new box2d.b2Vec2,box2d.b2FindMaxSeparation.s_v1=new box2d.b2Vec2,box2d.b2FindIncidentEdge=function(o,t,e,i,n,s){var r=t.m_count,b=t.m_normals,a=n.m_count,d=n.m_vertices,l=n.m_normals;box2d.ENABLE_ASSERTS&&box2d.b2Assert(0<=i&&i<r);for(var x=box2d.b2MulTRV(s.q,box2d.b2MulRV(e.q,b[i],box2d.b2Vec2.s_t0),box2d.b2FindIncidentEdge.s_normal1),p=0,m=box2d.b2_maxFloat,h=0;h<a;++h){var _=box2d.b2DotVV(x,l[h]);_<m&&(m=_,p=h)}var c=p,y=(c+1)%a,u=o[0];box2d.b2MulXV(s,d[c],u.v);var g=u.id.cf;g.indexA=i,g.indexB=c,g.typeA=box2d.b2ContactFeatureType.e_face,g.typeB=box2d.b2ContactFeatureType.e_vertex;var f=o[1];box2d.b2MulXV(s,d[y],f.v);var S=f.id.cf;S.indexA=i,S.indexB=y,S.typeA=box2d.b2ContactFeatureType.e_face,S.typeB=box2d.b2ContactFeatureType.e_vertex},box2d.b2FindIncidentEdge.s_normal1=new box2d.b2Vec2,box2d.b2CollidePolygons=function(o,t,e,i,n){o.pointCount=0;var s=t.m_radius+i.m_radius,r=box2d.b2CollidePolygons.s_edgeA;r[0]=0;var b=box2d.b2FindMaxSeparation(r,t,e,i,n);if(!(s<b)){var a=box2d.b2CollidePolygons.s_edgeB;a[0]=0;var d=box2d.b2FindMaxSeparation(a,i,n,t,e);if(!(s<d)){var l,x,p,m,h=0,_=0;_=.98*b+.001<d?(l=i,x=t,p=n,m=e,h=a[0],o.type=box2d.b2ManifoldType.e_faceB,1):(l=t,x=i,p=e,m=n,h=r[0],o.type=box2d.b2ManifoldType.e_faceA,0);var c=box2d.b2CollidePolygons.s_incidentEdge;box2d.b2FindIncidentEdge(c,l,p,h,x,m);var y=l.m_count,u=l.m_vertices,g=h,f=(h+1)%y,S=u[g],A=u[f],C=box2d.b2SubVV(A,S,box2d.b2CollidePolygons.s_localTangent);C.Normalize();var v=box2d.b2CrossVOne(C,box2d.b2CollidePolygons.s_localNormal),V=box2d.b2MidVV(S,A,box2d.b2CollidePolygons.s_planePoint),B=box2d.b2MulRV(p.q,C,box2d.b2CollidePolygons.s_tangent),w=box2d.b2CrossVOne(B,box2d.b2CollidePolygons.s_normal),P=box2d.b2MulXV(p,S,box2d.b2CollidePolygons.s_v11),M=box2d.b2MulXV(p,A,box2d.b2CollidePolygons.s_v12),D=box2d.b2DotVV(w,P),J=-box2d.b2DotVV(B,P)+s,T=box2d.b2DotVV(B,M)+s,R=box2d.b2CollidePolygons.s_clipPoints1,I=box2d.b2CollidePolygons.s_clipPoints2,L=box2d.b2NegV(B,box2d.b2CollidePolygons.s_ntangent);if(!(box2d.b2ClipSegmentToLine(R,c,L,J,g)<2||box2d.b2ClipSegmentToLine(I,R,B,T,f)<2)){o.localNormal.Copy(v),o.localPoint.Copy(V);for(var E=0,F=0;F<box2d.b2_maxManifoldPoints;++F){var G=I[F];if(box2d.b2DotVV(w,G.v)-D<=s){var k=o.points[E];if(box2d.b2MulTXV(m,G.v,k.localPoint),k.id.Copy(G.id),_){var q=k.id.cf;k.id.cf.indexA=q.indexB,k.id.cf.indexB=q.indexA,k.id.cf.typeA=q.typeB,k.id.cf.typeB=q.typeA}++E}}o.pointCount=E}}}},box2d.b2CollidePolygons.s_incidentEdge=box2d.b2ClipVertex.MakeArray(2),box2d.b2CollidePolygons.s_clipPoints1=box2d.b2ClipVertex.MakeArray(2),box2d.b2CollidePolygons.s_clipPoints2=box2d.b2ClipVertex.MakeArray(2),box2d.b2CollidePolygons.s_edgeA=box2d.b2MakeNumberArray(1),box2d.b2CollidePolygons.s_edgeB=box2d.b2MakeNumberArray(1),box2d.b2CollidePolygons.s_localTangent=new box2d.b2Vec2,box2d.b2CollidePolygons.s_localNormal=new box2d.b2Vec2,box2d.b2CollidePolygons.s_planePoint=new box2d.b2Vec2,box2d.b2CollidePolygons.s_normal=new box2d.b2Vec2,box2d.b2CollidePolygons.s_tangent=new box2d.b2Vec2,box2d.b2CollidePolygons.s_ntangent=new box2d.b2Vec2,box2d.b2CollidePolygons.s_v11=new box2d.b2Vec2,box2d.b2CollidePolygons.s_v12=new box2d.b2Vec2,goog.provide("box2d.b2PolygonContact"),goog.require("box2d.b2Settings"),goog.require("box2d.b2Contact"),goog.require("box2d.b2CollidePolygon"),box2d.b2PolygonContact=function(){goog.base(this)},goog.inherits(box2d.b2PolygonContact,box2d.b2Contact),box2d.b2PolygonContact.Create=function(o){return new box2d.b2PolygonContact},box2d.b2PolygonContact.Destroy=function(o,t){},box2d.b2PolygonContact.prototype.Reset=function(o,t,e,i){goog.base(this,"Reset",o,t,e,i)},box2d.b2PolygonContact.prototype.Evaluate=function(o,t,e){var i=this.m_fixtureA.GetShape(),n=this.m_fixtureB.GetShape();box2d.ENABLE_ASSERTS&&box2d.b2Assert(i instanceof box2d.b2PolygonShape),box2d.ENABLE_ASSERTS&&box2d.b2Assert(n instanceof box2d.b2PolygonShape),box2d.b2CollidePolygons(o,i instanceof box2d.b2PolygonShape?i:null,t,n instanceof box2d.b2PolygonShape?n:null,e)},goog.provide("box2d.b2CollideCircle"),goog.require("box2d.b2Collision"),box2d.b2CollideCircles=function(o,t,e,i,n){o.pointCount=0;var s=box2d.b2MulXV(e,t.m_p,box2d.b2CollideCircles.s_pA),r=box2d.b2MulXV(n,i.m_p,box2d.b2CollideCircles.s_pB),b=box2d.b2DistanceSquaredVV(s,r),a=t.m_radius+i.m_radius;a*a<b||(o.type=box2d.b2ManifoldType.e_circles,o.localPoint.Copy(t.m_p),o.localNormal.SetZero(),o.pointCount=1,o.points[0].localPoint.Copy(i.m_p),o.points[0].id.key=0)},box2d.b2CollideCircles.s_pA=new box2d.b2Vec2,box2d.b2CollideCircles.s_pB=new box2d.b2Vec2,box2d.b2CollidePolygonAndCircle=function(o,t,e,i,n){o.pointCount=0;for(var s=box2d.b2MulXV(n,i.m_p,box2d.b2CollidePolygonAndCircle.s_c),r=box2d.b2MulTXV(e,s,box2d.b2CollidePolygonAndCircle.s_cLocal),b=0,a=-box2d.b2_maxFloat,d=t.m_radius+i.m_radius,l=t.m_count,x=t.m_vertices,p=t.m_normals,m=0;m<l;++m){var h=box2d.b2DotVV(p[m],box2d.b2SubVV(r,x[m],box2d.b2Vec2.s_t0));if(d<h)return;a<h&&(a=h,b=m)}var _=b,c=(_+1)%l,y=x[_],u=x[c];if(a<box2d.b2_epsilon)return o.pointCount=1,o.type=box2d.b2ManifoldType.e_faceA,o.localNormal.Copy(p[b]),box2d.b2MidVV(y,u,o.localPoint),o.points[0].localPoint.Copy(i.m_p),void(o.points[0].id.key=0);var g=box2d.b2DotVV(box2d.b2SubVV(r,y,box2d.b2Vec2.s_t0),box2d.b2SubVV(u,y,box2d.b2Vec2.s_t1)),f=box2d.b2DotVV(box2d.b2SubVV(r,u,box2d.b2Vec2.s_t0),box2d.b2SubVV(y,u,box2d.b2Vec2.s_t1));if(g<=0){if(box2d.b2DistanceSquaredVV(r,y)>d*d)return;o.pointCount=1,o.type=box2d.b2ManifoldType.e_faceA,box2d.b2SubVV(r,y,o.localNormal).SelfNormalize(),o.localPoint.Copy(y),o.points[0].localPoint.Copy(i.m_p),o.points[0].id.key=0}else if(f<=0){if(box2d.b2DistanceSquaredVV(r,u)>d*d)return;o.pointCount=1,o.type=box2d.b2ManifoldType.e_faceA,box2d.b2SubVV(r,u,o.localNormal).SelfNormalize(),o.localPoint.Copy(u),o.points[0].localPoint.Copy(i.m_p),o.points[0].id.key=0}else{var S=box2d.b2MidVV(y,u,box2d.b2CollidePolygonAndCircle.s_faceCenter);if(d<(a=box2d.b2DotVV(box2d.b2SubVV(r,S,box2d.b2Vec2.s_t1),p[_])))return;o.pointCount=1,o.type=box2d.b2ManifoldType.e_faceA,o.localNormal.Copy(p[_]).SelfNormalize(),o.localPoint.Copy(S),o.points[0].localPoint.Copy(i.m_p),o.points[0].id.key=0}},box2d.b2CollidePolygonAndCircle.s_c=new box2d.b2Vec2,box2d.b2CollidePolygonAndCircle.s_cLocal=new box2d.b2Vec2,box2d.b2CollidePolygonAndCircle.s_faceCenter=new box2d.b2Vec2,goog.provide("box2d.b2CircleContact"),goog.require("box2d.b2Settings"),goog.require("box2d.b2Contact"),goog.require("box2d.b2CollideCircle"),box2d.b2CircleContact=function(){goog.base(this)},goog.inherits(box2d.b2CircleContact,box2d.b2Contact),box2d.b2CircleContact.Create=function(o){return new box2d.b2CircleContact},box2d.b2CircleContact.Destroy=function(o,t){},box2d.b2CircleContact.prototype.Reset=function(o,t,e,i){goog.base(this,"Reset",o,t,e,i)},box2d.b2CircleContact.prototype.Evaluate=function(o,t,e){var i=this.m_fixtureA.GetShape(),n=this.m_fixtureB.GetShape();box2d.ENABLE_ASSERTS&&box2d.b2Assert(i instanceof box2d.b2CircleShape),box2d.ENABLE_ASSERTS&&box2d.b2Assert(n instanceof box2d.b2CircleShape),box2d.b2CollideCircles(o,i instanceof box2d.b2CircleShape?i:null,t,n instanceof box2d.b2CircleShape?n:null,e)},goog.provide("box2d.b2ChainAndCircleContact"),goog.require("box2d.b2Settings"),goog.require("box2d.b2Contact"),goog.require("box2d.b2CollideEdge"),box2d.b2ChainAndCircleContact=function(){goog.base(this)},goog.inherits(box2d.b2ChainAndCircleContact,box2d.b2Contact),box2d.b2ChainAndCircleContact.Create=function(o){return new box2d.b2ChainAndCircleContact},box2d.b2ChainAndCircleContact.Destroy=function(o,t){},box2d.b2ChainAndCircleContact.prototype.Reset=function(o,t,e,i){goog.base(this,"Reset",o,t,e,i),box2d.ENABLE_ASSERTS&&box2d.b2Assert(o.GetType()===box2d.b2ShapeType.e_chainShape),box2d.ENABLE_ASSERTS&&box2d.b2Assert(e.GetType()===box2d.b2ShapeType.e_circleShape)},box2d.b2ChainAndCircleContact.prototype.Evaluate=function(o,t,e){var i=this.m_fixtureA.GetShape(),n=this.m_fixtureB.GetShape();box2d.ENABLE_ASSERTS&&box2d.b2Assert(i instanceof box2d.b2ChainShape),box2d.ENABLE_ASSERTS&&box2d.b2Assert(n instanceof box2d.b2CircleShape);var s=i instanceof box2d.b2ChainShape?i:null,r=box2d.b2ChainAndCircleContact.prototype.Evaluate.s_edge;s.GetChildEdge(r,this.m_indexA),box2d.b2CollideEdgeAndCircle(o,r,t,n instanceof box2d.b2CircleShape?n:null,e)},box2d.b2ChainAndCircleContact.prototype.Evaluate.s_edge=new box2d.b2EdgeShape,goog.provide("box2d.b2EdgeAndCircleContact"),goog.require("box2d.b2Settings"),goog.require("box2d.b2Contact"),goog.require("box2d.b2CollideEdge"),box2d.b2EdgeAndCircleContact=function(){goog.base(this)},goog.inherits(box2d.b2EdgeAndCircleContact,box2d.b2Contact),box2d.b2EdgeAndCircleContact.Create=function(o){return new box2d.b2EdgeAndCircleContact},box2d.b2EdgeAndCircleContact.Destroy=function(o,t){},box2d.b2EdgeAndCircleContact.prototype.Reset=function(o,t,e,i){goog.base(this,"Reset",o,t,e,i),box2d.ENABLE_ASSERTS&&box2d.b2Assert(o.GetType()===box2d.b2ShapeType.e_edgeShape),box2d.ENABLE_ASSERTS&&box2d.b2Assert(e.GetType()===box2d.b2ShapeType.e_circleShape)},box2d.b2EdgeAndCircleContact.prototype.Evaluate=function(o,t,e){var i=this.m_fixtureA.GetShape(),n=this.m_fixtureB.GetShape();box2d.ENABLE_ASSERTS&&box2d.b2Assert(i instanceof box2d.b2EdgeShape),box2d.ENABLE_ASSERTS&&box2d.b2Assert(n instanceof box2d.b2CircleShape),box2d.b2CollideEdgeAndCircle(o,i instanceof box2d.b2EdgeShape?i:null,t,n instanceof box2d.b2CircleShape?n:null,e)},goog.provide("box2d.b2ContactSolver"),goog.require("box2d.b2Settings"),goog.require("box2d.b2Math"),goog.require("box2d.b2Collision"),goog.require("box2d.b2CircleContact"),goog.require("box2d.b2PolygonAndCircleContact"),goog.require("box2d.b2PolygonContact"),goog.require("box2d.b2EdgeAndCircleContact"),goog.require("box2d.b2EdgeAndPolygonContact"),goog.require("box2d.b2ChainAndCircleContact"),goog.require("box2d.b2ChainAndPolygonContact"),box2d.b2VelocityConstraintPoint=function(){this.rA=new box2d.b2Vec2,this.rB=new box2d.b2Vec2},box2d.b2VelocityConstraintPoint.prototype.rA=null,box2d.b2VelocityConstraintPoint.prototype.rB=null,box2d.b2VelocityConstraintPoint.prototype.normalImpulse=0,box2d.b2VelocityConstraintPoint.prototype.tangentImpulse=0,box2d.b2VelocityConstraintPoint.prototype.normalMass=0,box2d.b2VelocityConstraintPoint.prototype.tangentMass=0,box2d.b2VelocityConstraintPoint.prototype.velocityBias=0,box2d.b2VelocityConstraintPoint.MakeArray=function(o){return box2d.b2MakeArray(o,function(o){return new box2d.b2VelocityConstraintPoint})},box2d.b2ContactVelocityConstraint=function(){this.points=box2d.b2VelocityConstraintPoint.MakeArray(box2d.b2_maxManifoldPoints),this.normal=new box2d.b2Vec2,this.tangent=new box2d.b2Vec2,this.normalMass=new box2d.b2Mat22,this.K=new box2d.b2Mat22},box2d.b2ContactVelocityConstraint.prototype.points=null,box2d.b2ContactVelocityConstraint.prototype.normal=null,box2d.b2ContactVelocityConstraint.prototype.tangent=null,box2d.b2ContactVelocityConstraint.prototype.normalMass=null,box2d.b2ContactVelocityConstraint.prototype.K=null,box2d.b2ContactVelocityConstraint.prototype.indexA=0,box2d.b2ContactVelocityConstraint.prototype.indexB=0,box2d.b2ContactVelocityConstraint.prototype.invMassA=0,box2d.b2ContactVelocityConstraint.prototype.invMassB=0,box2d.b2ContactVelocityConstraint.prototype.invIA=0,box2d.b2ContactVelocityConstraint.prototype.invIB=0,box2d.b2ContactVelocityConstraint.prototype.friction=0,box2d.b2ContactVelocityConstraint.prototype.restitution=0,box2d.b2ContactVelocityConstraint.prototype.tangentSpeed=0,box2d.b2ContactVelocityConstraint.prototype.pointCount=0,box2d.b2ContactVelocityConstraint.prototype.contactIndex=0,box2d.b2ContactVelocityConstraint.MakeArray=function(o){return box2d.b2MakeArray(o,function(o){return new box2d.b2ContactVelocityConstraint})},box2d.b2ContactPositionConstraint=function(){this.localPoints=box2d.b2Vec2.MakeArray(box2d.b2_maxManifoldPoints),this.localNormal=new box2d.b2Vec2,this.localPoint=new box2d.b2Vec2,this.localCenterA=new box2d.b2Vec2,this.localCenterB=new box2d.b2Vec2},box2d.b2ContactPositionConstraint.prototype.localPoints=null,box2d.b2ContactPositionConstraint.prototype.localNormal=null,box2d.b2ContactPositionConstraint.prototype.localPoint=null,box2d.b2ContactPositionConstraint.prototype.indexA=0,box2d.b2ContactPositionConstraint.prototype.indexB=0,box2d.b2ContactPositionConstraint.prototype.invMassA=0,box2d.b2ContactPositionConstraint.prototype.invMassB=0,box2d.b2ContactPositionConstraint.prototype.localCenterA=null,box2d.b2ContactPositionConstraint.prototype.localCenterB=null,box2d.b2ContactPositionConstraint.prototype.invIA=0,box2d.b2ContactPositionConstraint.prototype.invIB=0,box2d.b2ContactPositionConstraint.prototype.type=box2d.b2ManifoldType.e_unknown,box2d.b2ContactPositionConstraint.prototype.radiusA=0,box2d.b2ContactPositionConstraint.prototype.radiusB=0,box2d.b2ContactPositionConstraint.prototype.pointCount=0,box2d.b2ContactPositionConstraint.MakeArray=function(o){return box2d.b2MakeArray(o,function(o){return new box2d.b2ContactPositionConstraint})},box2d.b2ContactSolverDef=function(){this.step=new box2d.b2TimeStep},box2d.b2ContactSolverDef.prototype.step=null,box2d.b2ContactSolverDef.prototype.contacts=null,box2d.b2ContactSolverDef.prototype.count=0,box2d.b2ContactSolverDef.prototype.positions=null,box2d.b2ContactSolverDef.prototype.velocities=null,box2d.b2ContactSolverDef.prototype.allocator=null,box2d.b2ContactSolver=function(){this.m_step=new box2d.b2TimeStep,this.m_positionConstraints=box2d.b2ContactPositionConstraint.MakeArray(1024),this.m_velocityConstraints=box2d.b2ContactVelocityConstraint.MakeArray(1024)},box2d.b2ContactSolver.prototype.m_step=null,box2d.b2ContactSolver.prototype.m_positions=null,box2d.b2ContactSolver.prototype.m_velocities=null,box2d.b2ContactSolver.prototype.m_allocator=null,box2d.b2ContactSolver.prototype.m_positionConstraints=null,box2d.b2ContactSolver.prototype.m_velocityConstraints=null,box2d.b2ContactSolver.prototype.m_contacts=null,box2d.b2ContactSolver.prototype.m_count=0,box2d.b2ContactSolver.prototype.Initialize=function(o){if(this.m_step.Copy(o.step),this.m_allocator=o.allocator,this.m_count=o.count,this.m_positionConstraints.length<this.m_count){var t=box2d.b2Max(2*this.m_positionConstraints.length,this.m_count);for(box2d.DEBUG&&window.console.log("box2d.b2ContactSolver.m_positionConstraints: "+t);this.m_positionConstraints.length<t;)this.m_positionConstraints[this.m_positionConstraints.length]=new box2d.b2ContactPositionConstraint}if(this.m_velocityConstraints.length<this.m_count){t=box2d.b2Max(2*this.m_velocityConstraints.length,this.m_count);for(box2d.DEBUG&&window.console.log("box2d.b2ContactSolver.m_velocityConstraints: "+t);this.m_velocityConstraints.length<t;)this.m_velocityConstraints[this.m_velocityConstraints.length]=new box2d.b2ContactVelocityConstraint}var e,i,n,s,r,b,a,d,l,x,p,m,h,_,c,y,u,g,f;for(this.m_positions=o.positions,this.m_velocities=o.velocities,this.m_contacts=o.contacts,e=0,i=this.m_count;e<i;++e)for(b=(r=this.m_contacts[e]).m_fixtureA,a=r.m_fixtureB,d=b.GetShape(),l=a.GetShape(),x=d.m_radius,p=l.m_radius,m=b.GetBody(),h=a.GetBody(),c=(_=r.GetManifold()).pointCount,box2d.ENABLE_ASSERTS&&box2d.b2Assert(0<c),(y=this.m_velocityConstraints[e]).friction=r.m_friction,y.restitution=r.m_restitution,y.tangentSpeed=r.m_tangentSpeed,y.indexA=m.m_islandIndex,y.indexB=h.m_islandIndex,y.invMassA=m.m_invMass,y.invMassB=h.m_invMass,y.invIA=m.m_invI,y.invIB=h.m_invI,y.contactIndex=e,y.pointCount=c,y.K.SetZero(),y.normalMass.SetZero(),(u=this.m_positionConstraints[e]).indexA=m.m_islandIndex,u.indexB=h.m_islandIndex,u.invMassA=m.m_invMass,u.invMassB=h.m_invMass,u.localCenterA.Copy(m.m_sweep.localCenter),u.localCenterB.Copy(h.m_sweep.localCenter),u.invIA=m.m_invI,u.invIB=h.m_invI,u.localNormal.Copy(_.localNormal),u.localPoint.Copy(_.localPoint),u.pointCount=c,u.radiusA=x,u.radiusB=p,u.type=_.type,n=0,s=c;n<s;++n)g=_.points[n],f=y.points[n],this.m_step.warmStarting?(f.normalImpulse=this.m_step.dtRatio*g.normalImpulse,f.tangentImpulse=this.m_step.dtRatio*g.tangentImpulse):(f.normalImpulse=0,f.tangentImpulse=0),f.rA.SetZero(),f.rB.SetZero(),f.normalMass=0,f.tangentMass=0,f.velocityBias=0,u.localPoints[n].Copy(g.localPoint);return this},box2d.b2ContactSolver.prototype.InitializeVelocityConstraints=function(){var o,t,e,i,n,s,r,b,a,d,l,x,p,m,h,_,c,y,u,g,f,S,A,C,v,V,B,w,P,M,D,J,T,R,I,L,E,F,G,k,q,N,O,W=box2d.b2ContactSolver.prototype.InitializeVelocityConstraints.s_xfA,z=box2d.b2ContactSolver.prototype.InitializeVelocityConstraints.s_xfB,j=box2d.b2ContactSolver.prototype.InitializeVelocityConstraints.s_worldManifold;for(o=0,t=this.m_count;o<t;++o){for(n=this.m_velocityConstraints[o],r=(s=this.m_positionConstraints[o]).radiusA,b=s.radiusB,a=this.m_contacts[n.contactIndex].GetManifold(),d=n.indexA,l=n.indexB,x=n.invMassA,p=n.invMassB,m=n.invIA,h=n.invIB,_=s.localCenterA,c=s.localCenterB,y=this.m_positions[d].c,u=this.m_positions[d].a,g=this.m_velocities[d].v,f=this.m_velocities[d].w,S=this.m_positions[l].c,A=this.m_positions[l].a,C=this.m_velocities[l].v,v=this.m_velocities[l].w,box2d.ENABLE_ASSERTS&&box2d.b2Assert(0<a.pointCount),W.q.SetAngleRadians(u),z.q.SetAngleRadians(A),box2d.b2SubVV(y,box2d.b2MulRV(W.q,_,box2d.b2Vec2.s_t0),W.p),box2d.b2SubVV(S,box2d.b2MulRV(z.q,c,box2d.b2Vec2.s_t0),z.p),j.Initialize(a,W,r,z,b),n.normal.Copy(j.normal),box2d.b2CrossVOne(n.normal,n.tangent),e=0,i=n.pointCount;e<i;++e)V=n.points[e],box2d.b2SubVV(j.points[e],y,V.rA),box2d.b2SubVV(j.points[e],S,V.rB),P=x+p+m*(B=box2d.b2CrossVV(V.rA,n.normal))*B+h*(w=box2d.b2CrossVV(V.rB,n.normal))*w,V.normalMass=0<P?1/P:0,M=n.tangent,T=x+p+m*(D=box2d.b2CrossVV(V.rA,M))*D+h*(J=box2d.b2CrossVV(V.rB,M))*J,V.tangentMass=0<T?1/T:0,V.velocityBias=0,(R=box2d.b2DotVV(n.normal,box2d.b2SubVV(box2d.b2AddVCrossSV(C,v,V.rB,box2d.b2Vec2.s_t0),box2d.b2AddVCrossSV(g,f,V.rA,box2d.b2Vec2.s_t1),box2d.b2Vec2.s_t0)))<-box2d.b2_velocityThreshold&&(V.velocityBias+=-n.restitution*R);2===n.pointCount&&(I=n.points[0],L=n.points[1],(q=x+p+m*(E=box2d.b2CrossVV(I.rA,n.normal))*E+h*(F=box2d.b2CrossVV(I.rB,n.normal))*F)*q<1e3*(q*(N=x+p+m*(G=box2d.b2CrossVV(L.rA,n.normal))*G+h*(k=box2d.b2CrossVV(L.rB,n.normal))*k)-(O=x+p+m*E*G+h*F*k)*O)?(n.K.ex.SetXY(q,O),n.K.ey.SetXY(O,N),n.K.GetInverse(n.normalMass)):n.pointCount=1)}},box2d.b2ContactSolver.prototype.InitializeVelocityConstraints.s_xfA=new box2d.b2Transform,box2d.b2ContactSolver.prototype.InitializeVelocityConstraints.s_xfB=new box2d.b2Transform,box2d.b2ContactSolver.prototype.InitializeVelocityConstraints.s_worldManifold=new box2d.b2WorldManifold,box2d.b2ContactSolver.prototype.WarmStart=function(){var o,t,e,i,n,s,r,b,a,d,l,x,p,m,h,_,c,y,u,g=box2d.b2ContactSolver.prototype.WarmStart.s_P;for(o=0,t=this.m_count;o<t;++o){for(s=(n=this.m_velocityConstraints[o]).indexA,r=n.indexB,b=n.invMassA,a=n.invIA,d=n.invMassB,l=n.invIB,x=n.pointCount,p=this.m_velocities[s].v,m=this.m_velocities[s].w,h=this.m_velocities[r].v,_=this.m_velocities[r].w,c=n.normal,y=n.tangent,e=0,i=x;e<i;++e)u=n.points[e],box2d.b2AddVV(box2d.b2MulSV(u.normalImpulse,c,box2d.b2Vec2.s_t0),box2d.b2MulSV(u.tangentImpulse,y,box2d.b2Vec2.s_t1),g),m-=a*box2d.b2CrossVV(u.rA,g),p.SelfMulSub(b,g),_+=l*box2d.b2CrossVV(u.rB,g),h.SelfMulAdd(d,g);this.m_velocities[s].w=m,this.m_velocities[r].w=_}},box2d.b2ContactSolver.prototype.WarmStart.s_P=new box2d.b2Vec2,box2d.b2ContactSolver.prototype.SolveVelocityConstraints=function(){var o,t,e,i,n,s,r,b,a,d,l,x,p,m,h,_,c,y,u,g,f,S,A,C,v,V,B,w,P,M=box2d.b2ContactSolver.prototype.SolveVelocityConstraints.s_dv,D=box2d.b2ContactSolver.prototype.SolveVelocityConstraints.s_dv1,J=box2d.b2ContactSolver.prototype.SolveVelocityConstraints.s_dv2,T=box2d.b2ContactSolver.prototype.SolveVelocityConstraints.s_P,R=box2d.b2ContactSolver.prototype.SolveVelocityConstraints.s_a,I=box2d.b2ContactSolver.prototype.SolveVelocityConstraints.s_b,L=box2d.b2ContactSolver.prototype.SolveVelocityConstraints.s_x,E=box2d.b2ContactSolver.prototype.SolveVelocityConstraints.s_d,F=box2d.b2ContactSolver.prototype.SolveVelocityConstraints.s_P1,G=box2d.b2ContactSolver.prototype.SolveVelocityConstraints.s_P2,k=box2d.b2ContactSolver.prototype.SolveVelocityConstraints.s_P1P2;for(o=0,t=this.m_count;o<t;++o){for(s=(n=this.m_velocityConstraints[o]).indexA,r=n.indexB,b=n.invMassA,a=n.invIA,d=n.invMassB,l=n.invIB,x=n.pointCount,p=this.m_velocities[s].v,m=this.m_velocities[s].w,h=this.m_velocities[r].v,_=this.m_velocities[r].w,c=n.normal,y=n.tangent,u=n.friction,box2d.ENABLE_ASSERTS&&box2d.b2Assert(1===x||2===x),e=0,i=x;e<i;++e)g=n.points[e],box2d.b2SubVV(box2d.b2AddVCrossSV(h,_,g.rB,box2d.b2Vec2.s_t0),box2d.b2AddVCrossSV(p,m,g.rA,box2d.b2Vec2.s_t1),M),f=box2d.b2DotVV(M,y)-n.tangentSpeed,A=g.tangentMass*-f,C=u*g.normalImpulse,A=(v=box2d.b2Clamp(g.tangentImpulse+A,-C,C))-g.tangentImpulse,g.tangentImpulse=v,box2d.b2MulSV(A,y,T),p.SelfMulSub(b,T),m-=a*box2d.b2CrossVV(g.rA,T),h.SelfMulAdd(d,T),_+=l*box2d.b2CrossVV(g.rB,T);if(1===n.pointCount)g=n.points[0],box2d.b2SubVV(box2d.b2AddVCrossSV(h,_,g.rB,box2d.b2Vec2.s_t0),box2d.b2AddVCrossSV(p,m,g.rA,box2d.b2Vec2.s_t1),M),S=box2d.b2DotVV(M,c),A=-g.normalMass*(S-g.velocityBias),A=(v=box2d.b2Max(g.normalImpulse+A,0))-g.normalImpulse,g.normalImpulse=v,box2d.b2MulSV(A,c,T),p.SelfMulSub(b,T),m-=a*box2d.b2CrossVV(g.rA,T),h.SelfMulAdd(d,T),_+=l*box2d.b2CrossVV(g.rB,T);else for(V=n.points[0],B=n.points[1],R.SetXY(V.normalImpulse,B.normalImpulse),box2d.ENABLE_ASSERTS&&box2d.b2Assert(0<=R.x&&0<=R.y),box2d.b2SubVV(box2d.b2AddVCrossSV(h,_,V.rB,box2d.b2Vec2.s_t0),box2d.b2AddVCrossSV(p,m,V.rA,box2d.b2Vec2.s_t1),D),box2d.b2SubVV(box2d.b2AddVCrossSV(h,_,B.rB,box2d.b2Vec2.s_t0),box2d.b2AddVCrossSV(p,m,B.rA,box2d.b2Vec2.s_t1),J),w=box2d.b2DotVV(D,c),P=box2d.b2DotVV(J,c),I.x=w-V.velocityBias,I.y=P-B.velocityBias,I.SelfSub(box2d.b2MulMV(n.K,R,box2d.b2Vec2.s_t0));;){if(box2d.b2MulMV(n.normalMass,I,L).SelfNeg(),0<=L.x&&0<=L.y){box2d.b2SubVV(L,R,E),box2d.b2MulSV(E.x,c,F),box2d.b2MulSV(E.y,c,G),box2d.b2AddVV(F,G,k),p.SelfMulSub(b,k),m-=a*(box2d.b2CrossVV(V.rA,F)+box2d.b2CrossVV(B.rA,G)),h.SelfMulAdd(d,k),_+=l*(box2d.b2CrossVV(V.rB,F)+box2d.b2CrossVV(B.rB,G)),V.normalImpulse=L.x,B.normalImpulse=L.y;break}if(L.x=-V.normalMass*I.x,w=L.y=0,P=n.K.ex.y*L.x+I.y,0<=L.x&&0<=P){box2d.b2SubVV(L,R,E),box2d.b2MulSV(E.x,c,F),box2d.b2MulSV(E.y,c,G),box2d.b2AddVV(F,G,k),p.SelfMulSub(b,k),m-=a*(box2d.b2CrossVV(V.rA,F)+box2d.b2CrossVV(B.rA,G)),h.SelfMulAdd(d,k),_+=l*(box2d.b2CrossVV(V.rB,F)+box2d.b2CrossVV(B.rB,G)),V.normalImpulse=L.x,B.normalImpulse=L.y;break}if(L.x=0,L.y=-B.normalMass*I.y,w=n.K.ey.x*L.y+I.x,(P=0)<=L.y&&0<=w){box2d.b2SubVV(L,R,E),box2d.b2MulSV(E.x,c,F),box2d.b2MulSV(E.y,c,G),box2d.b2AddVV(F,G,k),p.SelfMulSub(b,k),m-=a*(box2d.b2CrossVV(V.rA,F)+box2d.b2CrossVV(B.rA,G)),h.SelfMulAdd(d,k),_+=l*(box2d.b2CrossVV(V.rB,F)+box2d.b2CrossVV(B.rB,G)),V.normalImpulse=L.x,B.normalImpulse=L.y;break}if(L.x=0,L.y=0,w=I.x,P=I.y,0<=w&&0<=P){box2d.b2SubVV(L,R,E),box2d.b2MulSV(E.x,c,F),box2d.b2MulSV(E.y,c,G),box2d.b2AddVV(F,G,k),p.SelfMulSub(b,k),m-=a*(box2d.b2CrossVV(V.rA,F)+box2d.b2CrossVV(B.rA,G)),h.SelfMulAdd(d,k),_+=l*(box2d.b2CrossVV(V.rB,F)+box2d.b2CrossVV(B.rB,G)),V.normalImpulse=L.x,B.normalImpulse=L.y;break}break}this.m_velocities[s].w=m,this.m_velocities[r].w=_}},box2d.b2ContactSolver.prototype.SolveVelocityConstraints.s_dv=new box2d.b2Vec2,box2d.b2ContactSolver.prototype.SolveVelocityConstraints.s_dv1=new box2d.b2Vec2,box2d.b2ContactSolver.prototype.SolveVelocityConstraints.s_dv2=new box2d.b2Vec2,box2d.b2ContactSolver.prototype.SolveVelocityConstraints.s_P=new box2d.b2Vec2,box2d.b2ContactSolver.prototype.SolveVelocityConstraints.s_a=new box2d.b2Vec2,box2d.b2ContactSolver.prototype.SolveVelocityConstraints.s_b=new box2d.b2Vec2,box2d.b2ContactSolver.prototype.SolveVelocityConstraints.s_x=new box2d.b2Vec2,box2d.b2ContactSolver.prototype.SolveVelocityConstraints.s_d=new box2d.b2Vec2,box2d.b2ContactSolver.prototype.SolveVelocityConstraints.s_P1=new box2d.b2Vec2,box2d.b2ContactSolver.prototype.SolveVelocityConstraints.s_P2=new box2d.b2Vec2,box2d.b2ContactSolver.prototype.SolveVelocityConstraints.s_P1P2=new box2d.b2Vec2,box2d.b2ContactSolver.prototype.StoreImpulses=function(){var o,t,e,i,n,s;for(o=0,t=this.m_count;o<t;++o)for(n=this.m_velocityConstraints[o],s=this.m_contacts[n.contactIndex].GetManifold(),e=0,i=n.pointCount;e<i;++e)s.points[e].normalImpulse=n.points[e].normalImpulse,s.points[e].tangentImpulse=n.points[e].tangentImpulse},box2d.b2PositionSolverManifold=function(){this.normal=new box2d.b2Vec2,this.point=new box2d.b2Vec2},box2d.b2PositionSolverManifold.prototype.normal=null,box2d.b2PositionSolverManifold.prototype.point=null,box2d.b2PositionSolverManifold.prototype.separation=0,box2d.b2PositionSolverManifold.prototype.Initialize=function(o,t,e,i){var n=box2d.b2PositionSolverManifold.prototype.Initialize.s_pointA,s=box2d.b2PositionSolverManifold.prototype.Initialize.s_pointB,r=box2d.b2PositionSolverManifold.prototype.Initialize.s_planePoint,b=box2d.b2PositionSolverManifold.prototype.Initialize.s_clipPoint;switch(box2d.ENABLE_ASSERTS&&box2d.b2Assert(0<o.pointCount),o.type){case box2d.b2ManifoldType.e_circles:box2d.b2MulXV(t,o.localPoint,n),box2d.b2MulXV(e,o.localPoints[0],s),box2d.b2SubVV(s,n,this.normal).SelfNormalize(),box2d.b2MidVV(n,s,this.point),this.separation=box2d.b2DotVV(box2d.b2SubVV(s,n,box2d.b2Vec2.s_t0),this.normal)-o.radiusA-o.radiusB;break;case box2d.b2ManifoldType.e_faceA:box2d.b2MulRV(t.q,o.localNormal,this.normal),box2d.b2MulXV(t,o.localPoint,r),box2d.b2MulXV(e,o.localPoints[i],b),this.separation=box2d.b2DotVV(box2d.b2SubVV(b,r,box2d.b2Vec2.s_t0),this.normal)-o.radiusA-o.radiusB,this.point.Copy(b);break;case box2d.b2ManifoldType.e_faceB:box2d.b2MulRV(e.q,o.localNormal,this.normal),box2d.b2MulXV(e,o.localPoint,r),box2d.b2MulXV(t,o.localPoints[i],b),this.separation=box2d.b2DotVV(box2d.b2SubVV(b,r,box2d.b2Vec2.s_t0),this.normal)-o.radiusA-o.radiusB,this.point.Copy(b),this.normal.SelfNeg()}},box2d.b2PositionSolverManifold.prototype.Initialize.s_pointA=new box2d.b2Vec2,box2d.b2PositionSolverManifold.prototype.Initialize.s_pointB=new box2d.b2Vec2,box2d.b2PositionSolverManifold.prototype.Initialize.s_planePoint=new box2d.b2Vec2,box2d.b2PositionSolverManifold.prototype.Initialize.s_clipPoint=new box2d.b2Vec2,box2d.b2ContactSolver.prototype.SolvePositionConstraints=function(){var o,t,e,i,n,s,r,b,a,d,l,x,p,m,h,_,c,y,u,g,f,S,A,C,v,V,B=box2d.b2ContactSolver.prototype.SolvePositionConstraints.s_xfA,w=box2d.b2ContactSolver.prototype.SolvePositionConstraints.s_xfB,P=box2d.b2ContactSolver.prototype.SolvePositionConstraints.s_psm,M=box2d.b2ContactSolver.prototype.SolvePositionConstraints.s_rA,D=box2d.b2ContactSolver.prototype.SolvePositionConstraints.s_rB,J=box2d.b2ContactSolver.prototype.SolvePositionConstraints.s_P,T=0;for(o=0,t=this.m_count;o<t;++o){for(s=(n=this.m_positionConstraints[o]).indexA,r=n.indexB,b=n.localCenterA,a=n.invMassA,d=n.invIA,l=n.localCenterB,x=n.invMassB,p=n.invIB,m=n.pointCount,h=this.m_positions[s].c,_=this.m_positions[s].a,c=this.m_positions[r].c,y=this.m_positions[r].a,e=0,i=m;e<i;++e)B.q.SetAngleRadians(_),w.q.SetAngleRadians(y),box2d.b2SubVV(h,box2d.b2MulRV(B.q,b,box2d.b2Vec2.s_t0),B.p),box2d.b2SubVV(c,box2d.b2MulRV(w.q,l,box2d.b2Vec2.s_t0),w.p),P.Initialize(n,B,w,e),u=P.normal,g=P.point,f=P.separation,box2d.b2SubVV(g,h,M),box2d.b2SubVV(g,c,D),T=box2d.b2Min(T,f),S=box2d.b2Clamp(box2d.b2_baumgarte*(f+box2d.b2_linearSlop),-box2d.b2_maxLinearCorrection,0),V=0<(v=a+x+d*(A=box2d.b2CrossVV(M,u))*A+p*(C=box2d.b2CrossVV(D,u))*C)?-S/v:0,box2d.b2MulSV(V,u,J),h.SelfMulSub(a,J),_-=d*box2d.b2CrossVV(M,J),c.SelfMulAdd(x,J),y+=p*box2d.b2CrossVV(D,J);this.m_positions[s].a=_,this.m_positions[r].a=y}return T>-3*box2d.b2_linearSlop},box2d.b2ContactSolver.prototype.SolvePositionConstraints.s_xfA=new box2d.b2Transform,box2d.b2ContactSolver.prototype.SolvePositionConstraints.s_xfB=new box2d.b2Transform,box2d.b2ContactSolver.prototype.SolvePositionConstraints.s_psm=new box2d.b2PositionSolverManifold,box2d.b2ContactSolver.prototype.SolvePositionConstraints.s_rA=new box2d.b2Vec2,box2d.b2ContactSolver.prototype.SolvePositionConstraints.s_rB=new box2d.b2Vec2,box2d.b2ContactSolver.prototype.SolvePositionConstraints.s_P=new box2d.b2Vec2,box2d.b2ContactSolver.prototype.SolveTOIPositionConstraints=function(o,t){var e,i,n,s,r,b,a,d,l,x,p,m,h,_,c,y,u,g,f,S,A,C,v,V,B,w,P=box2d.b2ContactSolver.prototype.SolveTOIPositionConstraints.s_xfA,M=box2d.b2ContactSolver.prototype.SolveTOIPositionConstraints.s_xfB,D=box2d.b2ContactSolver.prototype.SolveTOIPositionConstraints.s_psm,J=box2d.b2ContactSolver.prototype.SolveTOIPositionConstraints.s_rA,T=box2d.b2ContactSolver.prototype.SolveTOIPositionConstraints.s_rB,R=box2d.b2ContactSolver.prototype.SolveTOIPositionConstraints.s_P,I=0;for(e=0,i=this.m_count;e<i;++e){for(b=(r=this.m_positionConstraints[e]).indexA,a=r.indexB,d=r.localCenterA,l=r.localCenterB,x=r.pointCount,m=p=0,b!==o&&b!==t||(p=r.invMassA,m=r.invIA),_=h=0,a!==o&&a!==t||(h=r.invMassB,_=r.invIB),c=this.m_positions[b].c,y=this.m_positions[b].a,u=this.m_positions[a].c,g=this.m_positions[a].a,n=0,s=x;n<s;++n)P.q.SetAngleRadians(y),M.q.SetAngleRadians(g),box2d.b2SubVV(c,box2d.b2MulRV(P.q,d,box2d.b2Vec2.s_t0),P.p),box2d.b2SubVV(u,box2d.b2MulRV(M.q,l,box2d.b2Vec2.s_t0),M.p),D.Initialize(r,P,M,n),f=D.normal,S=D.point,A=D.separation,box2d.b2SubVV(S,c,J),box2d.b2SubVV(S,u,T),I=box2d.b2Min(I,A),C=box2d.b2Clamp(box2d.b2_toiBaumgarte*(A+box2d.b2_linearSlop),-box2d.b2_maxLinearCorrection,0),w=0<(B=p+h+m*(v=box2d.b2CrossVV(J,f))*v+_*(V=box2d.b2CrossVV(T,f))*V)?-C/B:0,box2d.b2MulSV(w,f,R),c.SelfMulSub(p,R),y-=m*box2d.b2CrossVV(J,R),u.SelfMulAdd(h,R),g+=_*box2d.b2CrossVV(T,R);this.m_positions[b].a=y,this.m_positions[a].a=g}return I>=-1.5*box2d.b2_linearSlop},box2d.b2ContactSolver.prototype.SolveTOIPositionConstraints.s_xfA=new box2d.b2Transform,box2d.b2ContactSolver.prototype.SolveTOIPositionConstraints.s_xfB=new box2d.b2Transform,box2d.b2ContactSolver.prototype.SolveTOIPositionConstraints.s_psm=new box2d.b2PositionSolverManifold,box2d.b2ContactSolver.prototype.SolveTOIPositionConstraints.s_rA=new box2d.b2Vec2,box2d.b2ContactSolver.prototype.SolveTOIPositionConstraints.s_rB=new box2d.b2Vec2,box2d.b2ContactSolver.prototype.SolveTOIPositionConstraints.s_P=new box2d.b2Vec2,goog.provide("box2d.b2WorldCallbacks"),goog.require("box2d.b2Settings"),box2d.b2DestructionListener=function(){},box2d.b2DestructionListener.prototype.SayGoodbyeJoint=function(o){},box2d.b2DestructionListener.prototype.SayGoodbyeFixture=function(o){},box2d.b2ContactFilter=function(){},box2d.b2ContactFilter.prototype.ShouldCollide=function(o,t){var e=o.GetFilterData(),i=t.GetFilterData();return e.groupIndex===i.groupIndex&&0!==e.groupIndex?0<e.groupIndex:0!=(e.maskBits&i.categoryBits)&&0!=(e.categoryBits&i.maskBits)},box2d.b2ContactFilter.b2_defaultFilter=new box2d.b2ContactFilter,box2d.b2ContactImpulse=function(){this.normalImpulses=box2d.b2MakeNumberArray(box2d.b2_maxManifoldPoints),this.tangentImpulses=box2d.b2MakeNumberArray(box2d.b2_maxManifoldPoints)},box2d.b2ContactImpulse.prototype.normalImpulses=null,box2d.b2ContactImpulse.prototype.tangentImpulses=null,box2d.b2ContactImpulse.prototype.count=0,box2d.b2ContactListener=function(){};box2d.b2ContactListener.prototype.BeginContact=function(o){},box2d.b2ContactListener.prototype.EndContact=function(o){},box2d.b2ContactListener.prototype.PreSolve=function(o,t){},box2d.b2ContactListener.prototype.PostSolve=function(o,t){},box2d.b2ContactListener.b2_defaultListener=new box2d.b2ContactListener,box2d.b2QueryCallback=function(){},box2d.b2QueryCallback.prototype.ReportFixture=function(o){return!0},box2d.b2RayCastCallback=function(){},box2d.b2RayCastCallback.prototype.ReportFixture=function(o,t,e,i){return i},goog.provide("box2d.b2Island"),goog.require("box2d.b2Settings"),goog.require("box2d.b2Timer"),goog.require("box2d.b2TimeStep"),goog.require("box2d.b2WorldCallbacks"),goog.require("box2d.b2ContactSolver"),box2d.b2Island=function(){this.m_bodies=new Array(1024),this.m_contacts=new Array(1024),this.m_joints=new Array(1024),this.m_positions=box2d.b2Position.MakeArray(1024),this.m_velocities=box2d.b2Velocity.MakeArray(1024)},box2d.b2Island.prototype.m_allocator=null,box2d.b2Island.prototype.m_listener=null,box2d.b2Island.prototype.m_bodies=null,box2d.b2Island.prototype.m_contacts=null,box2d.b2Island.prototype.m_joints=null,box2d.b2Island.prototype.m_positions=null,box2d.b2Island.prototype.m_velocities=null,box2d.b2Island.prototype.m_bodyCount=0,box2d.b2Island.prototype.m_jointCount=0,box2d.b2Island.prototype.m_contactCount=0,box2d.b2Island.prototype.m_bodyCapacity=0,box2d.b2Island.prototype.m_contactCapacity=0,box2d.b2Island.prototype.m_jointCapacity=0,box2d.b2Island.prototype.Initialize=function(o,t,e,i,n){for(this.m_bodyCapacity=o,this.m_contactCapacity=t,this.m_jointCapacity=e,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_allocator=i,this.m_listener=n;this.m_bodies.length<o;)this.m_bodies[this.m_bodies.length]=null;for(;this.m_contacts.length<t;)this.m_contacts[this.m_contacts.length]=null;for(;this.m_joints.length<e;)this.m_joints[this.m_joints.length]=null;if(this.m_positions.length<o){var s=box2d.b2Max(2*this.m_positions.length,o);for(box2d.DEBUG&&window.console.log("box2d.b2Island.m_positions: "+s);this.m_positions.length<s;)this.m_positions[this.m_positions.length]=new box2d.b2Position}if(this.m_velocities.length<o){s=box2d.b2Max(2*this.m_velocities.length,o);for(box2d.DEBUG&&window.console.log("box2d.b2Island.m_velocities: "+s);this.m_velocities.length<s;)this.m_velocities[this.m_velocities.length]=new box2d.b2Velocity}},box2d.b2Island.prototype.Clear=function(){this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0},box2d.b2Island.prototype.AddBody=function(o){box2d.ENABLE_ASSERTS&&box2d.b2Assert(this.m_bodyCount<this.m_bodyCapacity),o.m_islandIndex=this.m_bodyCount,this.m_bodies[this.m_bodyCount++]=o},box2d.b2Island.prototype.AddContact=function(o){box2d.ENABLE_ASSERTS&&box2d.b2Assert(this.m_contactCount<this.m_contactCapacity),this.m_contacts[this.m_contactCount++]=o},box2d.b2Island.prototype.AddJoint=function(o){box2d.ENABLE_ASSERTS&&box2d.b2Assert(this.m_jointCount<this.m_jointCapacity),this.m_joints[this.m_jointCount++]=o},box2d.b2Island.prototype.Solve=function(o,t,e,i){for(var n=box2d.b2Island.s_timer.Reset(),s=t.dt,r=0;r<this.m_bodyCount;++r){var b=this.m_bodies[r],a=this.m_positions[r].c.Copy(b.m_sweep.c),d=b.m_sweep.a,l=this.m_velocities[r].v.Copy(b.m_linearVelocity),x=b.m_angularVelocity;b.m_sweep.c0.Copy(b.m_sweep.c),b.m_sweep.a0=b.m_sweep.a,b.m_type===box2d.b2BodyType.b2_dynamicBody&&(l.x+=s*(b.m_gravityScale*e.x+b.m_invMass*b.m_force.x),l.y+=s*(b.m_gravityScale*e.y+b.m_invMass*b.m_force.y),x+=s*b.m_invI*b.m_torque,l.SelfMul(1/(1+s*b.m_linearDamping)),x*=1/(1+s*b.m_angularDamping)),this.m_positions[r].a=d,this.m_velocities[r].w=x}n.Reset();var p=box2d.b2Island.s_solverData;p.step.Copy(t),p.positions=this.m_positions,p.velocities=this.m_velocities;var m=box2d.b2Island.s_contactSolverDef;m.step.Copy(t),m.contacts=this.m_contacts,m.count=this.m_contactCount,m.positions=this.m_positions,m.velocities=this.m_velocities,m.allocator=this.m_allocator;var h=box2d.b2Island.s_contactSolver.Initialize(m);h.InitializeVelocityConstraints(),t.warmStarting&&h.WarmStart();for(r=0;r<this.m_jointCount;++r)this.m_joints[r].InitVelocityConstraints(p);o.solveInit=n.GetMilliseconds(),n.Reset();for(r=0;r<t.velocityIterations;++r){for(var _=0;_<this.m_jointCount;++_)this.m_joints[_].SolveVelocityConstraints(p);h.SolveVelocityConstraints()}h.StoreImpulses(),o.solveVelocity=n.GetMilliseconds();for(r=0;r<this.m_bodyCount;++r){a=this.m_positions[r].c,d=this.m_positions[r].a,l=this.m_velocities[r].v,x=this.m_velocities[r].w;var c=box2d.b2MulSV(s,l,box2d.b2Island.s_translation);if(box2d.b2DotVV(c,c)>box2d.b2_maxTranslationSquared){var y=box2d.b2_maxTranslation/c.GetLength();l.SelfMul(y)}var u=s*x;if(u*u>box2d.b2_maxRotationSquared)x*=y=box2d.b2_maxRotation/box2d.b2Abs(u);a.x+=s*l.x,a.y+=s*l.y,d+=s*x,this.m_positions[r].a=d,this.m_velocities[r].w=x}n.Reset();var g=!1;for(r=0;r<t.positionIterations;++r){var f=h.SolvePositionConstraints(),S=!0;for(_=0;_<this.m_jointCount;++_){var A=this.m_joints[_].SolvePositionConstraints(p);S=S&&A}if(f&&S){g=!0;break}}for(r=0;r<this.m_bodyCount;++r){var C=this.m_bodies[r];C.m_sweep.c.Copy(this.m_positions[r].c),C.m_sweep.a=this.m_positions[r].a,C.m_linearVelocity.Copy(this.m_velocities[r].v),C.m_angularVelocity=this.m_velocities[r].w,C.SynchronizeTransform()}if(o.solvePosition=n.GetMilliseconds(),this.Report(h.m_velocityConstraints),i){var v=box2d.b2_maxFloat,V=box2d.b2_linearSleepTolerance*box2d.b2_linearSleepTolerance,B=box2d.b2_angularSleepTolerance*box2d.b2_angularSleepTolerance;for(r=0;r<this.m_bodyCount;++r){(b=this.m_bodies[r]).GetType()!==box2d.b2BodyType.b2_staticBody&&(v=0==(b.m_flags&box2d.b2BodyFlag.e_autoSleepFlag)||b.m_angularVelocity*b.m_angularVelocity>B||box2d.b2DotVV(b.m_linearVelocity,b.m_linearVelocity)>V?b.m_sleepTime=0:(b.m_sleepTime+=s,box2d.b2Min(v,b.m_sleepTime)))}if(v>=box2d.b2_timeToSleep&&g)for(r=0;r<this.m_bodyCount;++r){(b=this.m_bodies[r]).SetAwake(!1)}}},box2d.b2Island.prototype.SolveTOI=function(o,t,e){box2d.ENABLE_ASSERTS&&box2d.b2Assert(t<this.m_bodyCount),box2d.ENABLE_ASSERTS&&box2d.b2Assert(e<this.m_bodyCount);for(var i=0;i<this.m_bodyCount;++i){var n=this.m_bodies[i];this.m_positions[i].c.Copy(n.m_sweep.c),this.m_positions[i].a=n.m_sweep.a,this.m_velocities[i].v.Copy(n.m_linearVelocity),this.m_velocities[i].w=n.m_angularVelocity}var s=box2d.b2Island.s_contactSolverDef;s.contacts=this.m_contacts,s.count=this.m_contactCount,s.allocator=this.m_allocator,s.step.Copy(o),s.positions=this.m_positions,s.velocities=this.m_velocities;var r=box2d.b2Island.s_contactSolver.Initialize(s);for(i=0;i<o.positionIterations;++i){if(r.SolveTOIPositionConstraints(t,e))break}this.m_bodies[t].m_sweep.c0.Copy(this.m_positions[t].c),this.m_bodies[t].m_sweep.a0=this.m_positions[t].a,this.m_bodies[e].m_sweep.c0.Copy(this.m_positions[e].c),this.m_bodies[e].m_sweep.a0=this.m_positions[e].a,r.InitializeVelocityConstraints();for(i=0;i<o.velocityIterations;++i)r.SolveVelocityConstraints();var b=o.dt;for(i=0;i<this.m_bodyCount;++i){var a=this.m_positions[i].c,d=this.m_positions[i].a,l=this.m_velocities[i].v,x=this.m_velocities[i].w,p=box2d.b2MulSV(b,l,box2d.b2Island.s_translation);if(box2d.b2DotVV(p,p)>box2d.b2_maxTranslationSquared){var m=box2d.b2_maxTranslation/p.GetLength();l.SelfMul(m)}var h=b*x;if(h*h>box2d.b2_maxRotationSquared)x*=m=box2d.b2_maxRotation/box2d.b2Abs(h);a.SelfMulAdd(b,l),d+=b*x,this.m_positions[i].a=d,this.m_velocities[i].w=x;var _=this.m_bodies[i];_.m_sweep.c.Copy(a),_.m_sweep.a=d,_.m_linearVelocity.Copy(l),_.m_angularVelocity=x,_.SynchronizeTransform()}this.Report(r.m_velocityConstraints)},box2d.b2Island.prototype.Report=function(o){if(null!==this.m_listener)for(var t=0;t<this.m_contactCount;++t){var e=this.m_contacts[t];if(e){var i=o[t],n=box2d.b2Island.s_impulse;n.count=i.pointCount;for(var s=0;s<i.pointCount;++s)n.normalImpulses[s]=i.points[s].normalImpulse,n.tangentImpulses[s]=i.points[s].tangentImpulse;this.m_listener.PostSolve(e,n)}}},box2d.b2Island.s_timer=new box2d.b2Timer,box2d.b2Island.s_solverData=new box2d.b2SolverData,box2d.b2Island.s_contactSolverDef=new box2d.b2ContactSolverDef,box2d.b2Island.s_contactSolver=new box2d.b2ContactSolver,box2d.b2Island.s_translation=new box2d.b2Vec2,box2d.b2Island.s_impulse=new box2d.b2ContactImpulse,goog.provide("box2d.b2ContactFactory"),goog.require("box2d.b2Settings"),goog.require("box2d.b2Contact"),box2d.b2ContactRegister=function(){},box2d.b2ContactRegister.prototype.createFcn=null,box2d.b2ContactRegister.prototype.destroyFcn=null,box2d.b2ContactRegister.prototype.primary=!1,box2d.b2ContactFactory=function(o){this.m_allocator=o,this.InitializeRegisters()},box2d.b2ContactFactory.prototype.m_allocator=null,box2d.b2ContactFactory.prototype.AddType=function(t,o,e,i){var n=box2d.b2MakeArray(256,function(o){return t()}),s=function(o){return 0<n.length?n.pop():t(o)},r=function(o,t){n.push(o)};this.m_registers[e][i].pool=n,this.m_registers[e][i].createFcn=s,this.m_registers[e][i].destroyFcn=r,this.m_registers[e][i].primary=!0,e!==i&&(this.m_registers[i][e].pool=n,this.m_registers[i][e].createFcn=s,this.m_registers[i][e].destroyFcn=r,this.m_registers[i][e].primary=!1)},box2d.b2ContactFactory.prototype.InitializeRegisters=function(){this.m_registers=new Array(box2d.b2ShapeType.e_shapeTypeCount);for(var o=0;o<box2d.b2ShapeType.e_shapeTypeCount;o++){this.m_registers[o]=new Array(box2d.b2ShapeType.e_shapeTypeCount);for(var t=0;t<box2d.b2ShapeType.e_shapeTypeCount;t++)this.m_registers[o][t]=new box2d.b2ContactRegister}this.AddType(box2d.b2CircleContact.Create,box2d.b2CircleContact.Destroy,box2d.b2ShapeType.e_circleShape,box2d.b2ShapeType.e_circleShape),this.AddType(box2d.b2PolygonAndCircleContact.Create,box2d.b2PolygonAndCircleContact.Destroy,box2d.b2ShapeType.e_polygonShape,box2d.b2ShapeType.e_circleShape),this.AddType(box2d.b2PolygonContact.Create,box2d.b2PolygonContact.Destroy,box2d.b2ShapeType.e_polygonShape,box2d.b2ShapeType.e_polygonShape),this.AddType(box2d.b2EdgeAndCircleContact.Create,box2d.b2EdgeAndCircleContact.Destroy,box2d.b2ShapeType.e_edgeShape,box2d.b2ShapeType.e_circleShape),this.AddType(box2d.b2EdgeAndPolygonContact.Create,box2d.b2EdgeAndPolygonContact.Destroy,box2d.b2ShapeType.e_edgeShape,box2d.b2ShapeType.e_polygonShape),this.AddType(box2d.b2ChainAndCircleContact.Create,box2d.b2ChainAndCircleContact.Destroy,box2d.b2ShapeType.e_chainShape,box2d.b2ShapeType.e_circleShape),this.AddType(box2d.b2ChainAndPolygonContact.Create,box2d.b2ChainAndPolygonContact.Destroy,box2d.b2ShapeType.e_chainShape,box2d.b2ShapeType.e_polygonShape)},box2d.b2ContactFactory.prototype.Create=function(o,t,e,i){var n=o.GetType(),s=e.GetType();box2d.ENABLE_ASSERTS&&box2d.b2Assert(0<=n&&n<box2d.b2ShapeType.e_shapeTypeCount),box2d.ENABLE_ASSERTS&&box2d.b2Assert(0<=s&&s<box2d.b2ShapeType.e_shapeTypeCount);var r,b=this.m_registers[n][s],a=b.createFcn;return null===a?null:(b.primary?(r=a(this.m_allocator)).Reset(o,t,e,i):(r=a(this.m_allocator)).Reset(e,i,o,t),r)},box2d.b2ContactFactory.prototype.Destroy=function(o){var t=o.m_fixtureA,e=o.m_fixtureB;0<o.m_manifold.pointCount&&!1===t.IsSensor()&&!1===e.IsSensor()&&(t.GetBody().SetAwake(!0),e.GetBody().SetAwake(!0));var i=t.GetType(),n=e.GetType();box2d.ENABLE_ASSERTS&&box2d.b2Assert(0<=i&&n<box2d.b2ShapeType.e_shapeTypeCount),box2d.ENABLE_ASSERTS&&box2d.b2Assert(0<=i&&n<box2d.b2ShapeType.e_shapeTypeCount),(0,this.m_registers[i][n].destroyFcn)(o,this.m_allocator)},goog.provide("box2d.b2GrowableStack"),goog.require("box2d.b2Settings"),box2d.b2GrowableStack=function(o){this.m_stack=new Array(o)},box2d.b2GrowableStack.prototype.m_stack=null,box2d.b2GrowableStack.prototype.m_count=0,box2d.b2GrowableStack.prototype.Reset=function(){return this.m_count=0,this},box2d.b2GrowableStack.prototype.Push=function(o){this.m_stack[this.m_count]=o,++this.m_count},box2d.b2GrowableStack.prototype.Pop=function(){box2d.ENABLE_ASSERTS&&box2d.b2Assert(0<this.m_count),--this.m_count;var o=this.m_stack[this.m_count];return this.m_stack[this.m_count]=null,o},box2d.b2GrowableStack.prototype.GetCount=function(){return this.m_count},goog.provide("box2d.b2DynamicTree"),goog.require("box2d.b2Settings"),goog.require("box2d.b2Collision"),goog.require("box2d.b2GrowableStack"),box2d.b2TreeNode=function(o){this.m_id=o||0,this.aabb=new box2d.b2AABB},box2d.b2TreeNode.prototype.m_id=0,box2d.b2TreeNode.prototype.aabb=null,box2d.b2TreeNode.prototype.userData=null,box2d.b2TreeNode.prototype.parent=null,box2d.b2TreeNode.prototype.child1=null,box2d.b2TreeNode.prototype.child2=null,box2d.b2TreeNode.prototype.height=0,box2d.b2TreeNode.prototype.IsLeaf=function(){return null===this.child1},box2d.b2DynamicTree=function(){},box2d.b2DynamicTree.prototype.m_root=null,box2d.b2DynamicTree.prototype.m_freeList=null,box2d.b2DynamicTree.prototype.m_path=0,box2d.b2DynamicTree.prototype.m_insertionCount=0,box2d.b2DynamicTree.s_stack=new box2d.b2GrowableStack(256),box2d.b2DynamicTree.s_r=new box2d.b2Vec2,box2d.b2DynamicTree.s_v=new box2d.b2Vec2,box2d.b2DynamicTree.s_abs_v=new box2d.b2Vec2,box2d.b2DynamicTree.s_segmentAABB=new box2d.b2AABB,box2d.b2DynamicTree.s_subInput=new box2d.b2RayCastInput,box2d.b2DynamicTree.s_combinedAABB=new box2d.b2AABB,box2d.b2DynamicTree.s_aabb=new box2d.b2AABB,box2d.b2DynamicTree.prototype.GetUserData=function(o){return box2d.ENABLE_ASSERTS&&box2d.b2Assert(null!==o),o.userData},box2d.b2DynamicTree.prototype.GetFatAABB=function(o){return box2d.ENABLE_ASSERTS&&box2d.b2Assert(null!==o),o.aabb},box2d.b2DynamicTree.prototype.Query=function(o,t){if(null!==this.m_root){var e=box2d.b2DynamicTree.s_stack.Reset();for(e.Push(this.m_root);0<e.GetCount();){var i=e.Pop();if(null!==i)if(i.aabb.TestOverlap(t))if(i.IsLeaf()){if(!1===o(i))return}else e.Push(i.child1),e.Push(i.child2)}}},box2d.b2DynamicTree.prototype.RayCast=function(o,t){if(null!==this.m_root){var e=t.p1,i=t.p2,n=box2d.b2SubVV(i,e,box2d.b2DynamicTree.s_r);box2d.ENABLE_ASSERTS&&box2d.b2Assert(0<n.GetLengthSquared()),n.Normalize();var s=box2d.b2CrossOneV(n,box2d.b2DynamicTree.s_v),r=box2d.b2AbsV(s,box2d.b2DynamicTree.s_abs_v),b=t.maxFraction,a=box2d.b2DynamicTree.s_segmentAABB,d=e.x+b*(i.x-e.x),l=e.y+b*(i.y-e.y);a.lowerBound.x=box2d.b2Min(e.x,d),a.lowerBound.y=box2d.b2Min(e.y,l),a.upperBound.x=box2d.b2Max(e.x,d),a.upperBound.y=box2d.b2Max(e.y,l);var x=box2d.b2DynamicTree.s_stack.Reset();for(x.Push(this.m_root);0<x.GetCount();){var p=x.Pop();if(null!==p&&!1!==box2d.b2TestOverlapAABB(p.aabb,a)){var m=p.aabb.GetCenter(),h=p.aabb.GetExtents();if(!(0<box2d.b2Abs(box2d.b2DotVV(s,box2d.b2SubVV(e,m,box2d.b2Vec2.s_t0)))-box2d.b2DotVV(r,h)))if(p.IsLeaf()){var _=box2d.b2DynamicTree.s_subInput;_.p1.Copy(t.p1),_.p2.Copy(t.p2),_.maxFraction=b;var c=o(_,p);if(0===c)return;0<c&&(b=c,d=e.x+b*(i.x-e.x),l=e.y+b*(i.y-e.y),a.lowerBound.x=box2d.b2Min(e.x,d),a.lowerBound.y=box2d.b2Min(e.y,l),a.upperBound.x=box2d.b2Max(e.x,d),a.upperBound.y=box2d.b2Max(e.y,l))}else x.Push(p.child1),x.Push(p.child2)}}}},box2d.b2DynamicTree.prototype.AllocateNode=function(){if(this.m_freeList){var o=this.m_freeList;return this.m_freeList=o.parent,o.parent=null,o.child1=null,o.child2=null,o.height=0,o.userData=null,o}return new box2d.b2TreeNode(box2d.b2DynamicTree.prototype.s_node_id++)},box2d.b2DynamicTree.prototype.s_node_id=0,box2d.b2DynamicTree.prototype.FreeNode=function(o){o.parent=this.m_freeList,o.height=-1,this.m_freeList=o},box2d.b2DynamicTree.prototype.CreateProxy=function(o,t){var e=this.AllocateNode(),i=box2d.b2_aabbExtension,n=box2d.b2_aabbExtension;return e.aabb.lowerBound.x=o.lowerBound.x-i,e.aabb.lowerBound.y=o.lowerBound.y-n,e.aabb.upperBound.x=o.upperBound.x+i,e.aabb.upperBound.y=o.upperBound.y+n,e.userData=t,e.height=0,this.InsertLeaf(e),e},box2d.b2DynamicTree.prototype.DestroyProxy=function(o){box2d.ENABLE_ASSERTS&&box2d.b2Assert(o.IsLeaf()),this.RemoveLeaf(o),this.FreeNode(o)},box2d.b2DynamicTree.prototype.MoveProxy=function(o,t,e){if(box2d.ENABLE_ASSERTS&&box2d.b2Assert(o.IsLeaf()),o.aabb.Contains(t))return!1;this.RemoveLeaf(o);var i=box2d.b2_aabbExtension+box2d.b2_aabbMultiplier*(0<e.x?e.x:-e.x),n=box2d.b2_aabbExtension+box2d.b2_aabbMultiplier*(0<e.y?e.y:-e.y);return o.aabb.lowerBound.x=t.lowerBound.x-i,o.aabb.lowerBound.y=t.lowerBound.y-n,o.aabb.upperBound.x=t.upperBound.x+i,o.aabb.upperBound.y=t.upperBound.y+n,this.InsertLeaf(o),!0},box2d.b2DynamicTree.prototype.InsertLeaf=function(o){if(++this.m_insertionCount,null===this.m_root)return this.m_root=o,void(this.m_root.parent=null);for(var t,e,i=o.aabb,n=(i.GetCenter(),this.m_root);!1===n.IsLeaf();){t=n.child1,e=n.child2;var s=n.aabb.GetPerimeter(),r=box2d.b2DynamicTree.s_combinedAABB;r.Combine2(n.aabb,i);var b,a,d,l=r.GetPerimeter(),x=2*l,p=2*(l-s),m=box2d.b2DynamicTree.s_aabb;if(b=t.IsLeaf()?(m.Combine2(i,t.aabb),m.GetPerimeter()+p):(m.Combine2(i,t.aabb),a=t.aabb.GetPerimeter(),m.GetPerimeter()-a+p),d=e.IsLeaf()?(m.Combine2(i,e.aabb),m.GetPerimeter()+p):(m.Combine2(i,e.aabb),a=e.aabb.GetPerimeter(),m.GetPerimeter()-a+p),x<b&&x<d)break;n=b<d?t:e}var h=n,_=h.parent,c=this.AllocateNode();for(c.parent=_,c.userData=null,c.aabb.Combine2(i,h.aabb),c.height=h.height+1,_?(_.child1===h?_.child1=c:_.child2=c,c.child1=h,c.child2=o,h.parent=c,o.parent=c):(c.child1=h,c.child2=o,h.parent=c,o.parent=c,this.m_root=c),n=o.parent;null!==n;)t=(n=this.Balance(n)).child1,e=n.child2,box2d.ENABLE_ASSERTS&&box2d.b2Assert(null!==t),box2d.ENABLE_ASSERTS&&box2d.b2Assert(null!==e),n.height=1+box2d.b2Max(t.height,e.height),n.aabb.Combine2(t.aabb,e.aabb),n=n.parent},box2d.b2DynamicTree.prototype.RemoveLeaf=function(o){if(o!==this.m_root){var t,e=o.parent,i=e.parent;if(t=e.child1===o?e.child2:e.child1,i){i.child1===e?i.child1=t:i.child2=t,t.parent=i,this.FreeNode(e);for(var n=i;n;){var s=(n=this.Balance(n)).child1,r=n.child2;n.aabb.Combine2(s.aabb,r.aabb),n.height=1+box2d.b2Max(s.height,r.height),n=n.parent}}else(this.m_root=t).parent=null,this.FreeNode(e)}else this.m_root=null},box2d.b2DynamicTree.prototype.Balance=function(o){if(box2d.ENABLE_ASSERTS&&box2d.b2Assert(null!==o),o.IsLeaf()||o.height<2)return o;var t=o.child1,e=o.child2,i=e.height-t.height;if(1<i){var n=e.child1,s=e.child2;return e.child1=o,e.parent=o.parent,null!==(o.parent=e).parent?e.parent.child1===o?e.parent.child1=e:(box2d.ENABLE_ASSERTS&&box2d.b2Assert(e.parent.child2===o),e.parent.child2=e):this.m_root=e,n.height>s.height?(e.child2=n,((o.child2=s).parent=o).aabb.Combine2(t.aabb,s.aabb),e.aabb.Combine2(o.aabb,n.aabb),o.height=1+box2d.b2Max(t.height,s.height),e.height=1+box2d.b2Max(o.height,n.height)):(e.child2=s,((o.child2=n).parent=o).aabb.Combine2(t.aabb,n.aabb),e.aabb.Combine2(o.aabb,s.aabb),o.height=1+box2d.b2Max(t.height,n.height),e.height=1+box2d.b2Max(o.height,s.height)),e}if(i<-1){var r=t.child1,b=t.child2;return t.child1=o,t.parent=o.parent,null!==(o.parent=t).parent?t.parent.child1===o?t.parent.child1=t:(box2d.ENABLE_ASSERTS&&box2d.b2Assert(t.parent.child2===o),t.parent.child2=t):this.m_root=t,r.height>b.height?(t.child2=r,((o.child1=b).parent=o).aabb.Combine2(e.aabb,b.aabb),t.aabb.Combine2(o.aabb,r.aabb),o.height=1+box2d.b2Max(e.height,b.height),t.height=1+box2d.b2Max(o.height,r.height)):(t.child2=b,((o.child1=r).parent=o).aabb.Combine2(e.aabb,r.aabb),t.aabb.Combine2(o.aabb,b.aabb),o.height=1+box2d.b2Max(e.height,r.height),t.height=1+box2d.b2Max(o.height,b.height)),t}return o},box2d.b2DynamicTree.prototype.GetHeight=function(){return null===this.m_root?0:this.m_root.height},box2d.b2DynamicTree.prototype.GetAreaRatio=function(){if(null===this.m_root)return 0;var o=this.m_root.aabb.GetPerimeter(),e=function(o){if(null===o)return 0;if(o.IsLeaf())return 0;var t=o.aabb.GetPerimeter();return t+=e(o.child1),t+=e(o.child2)};return e(this.m_root)/o},box2d.b2DynamicTree.prototype.ComputeHeightNode=function(o){if(o.IsLeaf())return 0;var t=this.ComputeHeightNode(o.child1),e=this.ComputeHeightNode(o.child2);return 1+box2d.b2Max(t,e)},box2d.b2DynamicTree.prototype.ComputeHeight=function(){return this.ComputeHeightNode(this.m_root)},box2d.b2DynamicTree.prototype.ValidateStructure=function(o){if(null!==o){o===this.m_root&&box2d.ENABLE_ASSERTS&&box2d.b2Assert(null===o.parent);var t=o,e=t.child1,i=t.child2;if(t.IsLeaf())return box2d.ENABLE_ASSERTS&&box2d.b2Assert(null===e),box2d.ENABLE_ASSERTS&&box2d.b2Assert(null===i),void(box2d.ENABLE_ASSERTS&&box2d.b2Assert(0===t.height));box2d.ENABLE_ASSERTS&&box2d.b2Assert(e.parent===o),box2d.ENABLE_ASSERTS&&box2d.b2Assert(i.parent===o),this.ValidateStructure(e),this.ValidateStructure(i)}},box2d.b2DynamicTree.prototype.ValidateMetrics=function(o){if(null!==o){var t=o,e=t.child1,i=t.child2;if(t.IsLeaf())return box2d.ENABLE_ASSERTS&&box2d.b2Assert(null===e),box2d.ENABLE_ASSERTS&&box2d.b2Assert(null===i),void(box2d.ENABLE_ASSERTS&&box2d.b2Assert(0===t.height));var n,s=e.height,r=i.height;n=1+box2d.b2Max(s,r),box2d.ENABLE_ASSERTS&&box2d.b2Assert(t.height===n);var b=box2d.b2DynamicTree.s_aabb;b.Combine2(e.aabb,i.aabb),box2d.ENABLE_ASSERTS&&box2d.b2Assert(b.lowerBound===t.aabb.lowerBound),box2d.ENABLE_ASSERTS&&box2d.b2Assert(b.upperBound===t.aabb.upperBound),this.ValidateMetrics(e),this.ValidateMetrics(i)}},box2d.b2DynamicTree.prototype.Validate=function(){this.ValidateStructure(this.m_root),this.ValidateMetrics(this.m_root);for(var o=this.m_freeList;null!==o;)o=o.parent,0;box2d.ENABLE_ASSERTS&&box2d.b2Assert(this.GetHeight()===this.ComputeHeight())},box2d.b2DynamicTree.prototype.GetMaxBalance=function(){return function(o,t){if(null===o)return t;if(o.height<=1)return t;box2d.ENABLE_ASSERTS&&box2d.b2Assert(!1===o.IsLeaf());var e=o.child1,i=o.child2,n=box2d.b2Abs(i.height-e.height);return box2d.b2Max(t,n)}(this.m_root,0)},box2d.b2DynamicTree.prototype.RebuildBottomUp=function(){this.Validate()},box2d.b2DynamicTree.prototype.ShiftOrigin=function(o){var n=function(o,t){if(null!==o&&!(o.height<=1)){box2d.ENABLE_ASSERTS&&box2d.b2Assert(!1===o.IsLeaf());var e=o.child1,i=o.child2;n(e,t),n(i,t),o.aabb.lowerBound.SelfSub(t),o.aabb.upperBound.SelfSub(t)}};n(this.m_root,o)},goog.provide("box2d.b2BroadPhase"),goog.require("box2d.b2Settings"),goog.require("box2d.b2DynamicTree"),box2d.b2Pair=function(){},box2d.b2Pair.prototype.proxyA=null,box2d.b2Pair.prototype.proxyB=null,box2d.b2BroadPhase=function(){this.m_tree=new box2d.b2DynamicTree,this.m_moveBuffer=new Array,this.m_pairBuffer=new Array},box2d.b2BroadPhase.prototype.m_tree=null,box2d.b2BroadPhase.prototype.m_proxyCount=0,box2d.b2BroadPhase.prototype.m_moveCount=0,box2d.b2BroadPhase.prototype.m_moveBuffer=null,box2d.b2BroadPhase.prototype.m_pairCount=0,box2d.b2BroadPhase.prototype.m_pairBuffer=null,box2d.b2BroadPhase.prototype.CreateProxy=function(o,t){var e=this.m_tree.CreateProxy(o,t);return++this.m_proxyCount,this.BufferMove(e),e},box2d.b2BroadPhase.prototype.DestroyProxy=function(o){this.UnBufferMove(o),--this.m_proxyCount,this.m_tree.DestroyProxy(o)},box2d.b2BroadPhase.prototype.MoveProxy=function(o,t,e){this.m_tree.MoveProxy(o,t,e)&&this.BufferMove(o)},box2d.b2BroadPhase.prototype.TouchProxy=function(o){this.BufferMove(o)},box2d.b2BroadPhase.prototype.GetFatAABB=function(o){return this.m_tree.GetFatAABB(o)},box2d.b2BroadPhase.prototype.GetUserData=function(o){return this.m_tree.GetUserData(o)},box2d.b2BroadPhase.prototype.TestOverlap=function(o,t){var e=this.m_tree.GetFatAABB(o),i=this.m_tree.GetFatAABB(t);return box2d.b2TestOverlapAABB(e,i)},box2d.b2BroadPhase.prototype.GetProxyCount=function(){return this.m_proxyCount},box2d.b2BroadPhase.prototype.GetTreeHeight=function(){return this.m_tree.GetHeight()},box2d.b2BroadPhase.prototype.GetTreeBalance=function(){return this.m_tree.GetMaxBalance()},box2d.b2BroadPhase.prototype.GetTreeQuality=function(){return this.m_tree.GetAreaRatio()},box2d.b2BroadPhase.prototype.ShiftOrigin=function(o){this.m_tree.ShiftOrigin(o)},box2d.b2BroadPhase.prototype.UpdatePairs=function(o){for(var t=this.m_pairCount=0;t<this.m_moveCount;++t){var e=this.m_moveBuffer[t];if(null!==e){var i=this,n=this.m_tree.GetFatAABB(e);this.m_tree.Query(function(o){if(o.m_id===e.m_id)return!0;i.m_pairCount===i.m_pairBuffer.length&&(i.m_pairBuffer[i.m_pairCount]=new box2d.b2Pair);var t=i.m_pairBuffer[i.m_pairCount];return o.m_id<e.m_id?(t.proxyA=o,t.proxyB=e):(t.proxyA=e,t.proxyB=o),++i.m_pairCount,!0},n)}}this.m_moveCount=0,this.m_pairBuffer.length=this.m_pairCount,this.m_pairBuffer.sort(box2d.b2PairLessThan);for(t=0;t<this.m_pairCount;){var s=this.m_pairBuffer[t],r=this.m_tree.GetUserData(s.proxyA),b=this.m_tree.GetUserData(s.proxyB);for(o.AddPair(r,b),++t;t<this.m_pairCount;){var a=this.m_pairBuffer[t];if(a.proxyA.m_id!==s.proxyA.m_id||a.proxyB.m_id!==s.proxyB.m_id)break;++t}}},box2d.b2BroadPhase.prototype.Query=function(o,t){this.m_tree.Query(o,t)},box2d.b2BroadPhase.prototype.RayCast=function(o,t){this.m_tree.RayCast(o,t)},box2d.b2BroadPhase.prototype.BufferMove=function(o){this.m_moveBuffer[this.m_moveCount]=o,++this.m_moveCount},box2d.b2BroadPhase.prototype.UnBufferMove=function(o){var t=this.m_moveBuffer.indexOf(o);this.m_moveBuffer[t]=null},box2d.b2PairLessThan=function(o,t){return o.proxyA.m_id===t.proxyA.m_id?o.proxyB.m_id-t.proxyB.m_id:o.proxyA.m_id-t.proxyA.m_id},goog.provide("box2d.b2ContactManager"),goog.require("box2d.b2Settings"),goog.require("box2d.b2Math"),goog.require("box2d.b2Collision"),goog.require("box2d.b2BroadPhase"),goog.require("box2d.b2ContactFactory"),box2d.b2ContactManager=function(){this.m_broadPhase=new box2d.b2BroadPhase,this.m_contactFactory=new box2d.b2ContactFactory(this.m_allocator)},box2d.b2ContactManager.prototype.m_broadPhase=null,box2d.b2ContactManager.prototype.m_contactList=null,box2d.b2ContactManager.prototype.m_contactCount=0,box2d.b2ContactManager.prototype.m_contactFilter=box2d.b2ContactFilter.b2_defaultFilter,box2d.b2ContactManager.prototype.m_contactListener=box2d.b2ContactListener.b2_defaultListener,box2d.b2ContactManager.prototype.m_allocator=null,box2d.b2ContactManager.prototype.m_contactFactory=null,box2d.b2ContactManager.prototype.Destroy=function(o){var t=o.GetFixtureA(),e=o.GetFixtureB(),i=t.GetBody(),n=e.GetBody();this.m_contactListener&&o.IsTouching()&&this.m_contactListener.EndContact(o),o.m_prev&&(o.m_prev.m_next=o.m_next),o.m_next&&(o.m_next.m_prev=o.m_prev),o===this.m_contactList&&(this.m_contactList=o.m_next),o.m_nodeA.prev&&(o.m_nodeA.prev.next=o.m_nodeA.next),o.m_nodeA.next&&(o.m_nodeA.next.prev=o.m_nodeA.prev),o.m_nodeA===i.m_contactList&&(i.m_contactList=o.m_nodeA.next),o.m_nodeB.prev&&(o.m_nodeB.prev.next=o.m_nodeB.next),o.m_nodeB.next&&(o.m_nodeB.next.prev=o.m_nodeB.prev),o.m_nodeB===n.m_contactList&&(n.m_contactList=o.m_nodeB.next),this.m_contactFactory.Destroy(o),--this.m_contactCount},box2d.b2ContactManager.prototype.Collide=function(){for(var o=this.m_contactList;o;){var t=o.GetFixtureA(),e=o.GetFixtureB(),i=o.GetChildIndexA(),n=o.GetChildIndexB(),s=t.GetBody(),r=e.GetBody();if(o.m_flags&box2d.b2ContactFlag.e_filterFlag){if(!1===r.ShouldCollide(s)){var b=o;o=b.m_next,this.Destroy(b);continue}if(this.m_contactFilter&&!1===this.m_contactFilter.ShouldCollide(t,e)){o=(b=o).m_next,this.Destroy(b);continue}o.m_flags&=~box2d.b2ContactFlag.e_filterFlag}var a=s.IsAwake()&&s.m_type!==box2d.b2BodyType.b2_staticBody,d=r.IsAwake()&&r.m_type!==box2d.b2BodyType.b2_staticBody;if(!1!==a||!1!==d){var l=t.m_proxies[i].proxy,x=e.m_proxies[n].proxy;!1!==this.m_broadPhase.TestOverlap(l,x)?(o.Update(this.m_contactListener),o=o.m_next):(o=(b=o).m_next,this.Destroy(b))}else o=o.m_next}},box2d.b2ContactManager.prototype.FindNewContacts=function(){this.m_broadPhase.UpdatePairs(this)},box2d.b2ContactManager.prototype.AddPair=function(o,t){box2d.ENABLE_ASSERTS&&box2d.b2Assert(o instanceof box2d.b2FixtureProxy),box2d.ENABLE_ASSERTS&&box2d.b2Assert(t instanceof box2d.b2FixtureProxy);var e=o,i=t,n=e.fixture,s=i.fixture,r=e.childIndex,b=i.childIndex,a=n.GetBody(),d=s.GetBody();if(a!==d){for(var l=d.GetContactList();l;){if(l.other===a){var x=l.contact.GetFixtureA(),p=l.contact.GetFixtureB(),m=l.contact.GetChildIndexA(),h=l.contact.GetChildIndexB();if(x===n&&p===s&&m===r&&h===b)return;if(x===s&&p===n&&m===b&&h===r)return}l=l.next}if(!1!==d.ShouldCollide(a)&&(!this.m_contactFilter||!1!==this.m_contactFilter.ShouldCollide(n,s))){var _=this.m_contactFactory.Create(n,r,s,b);null!==_&&(n=_.GetFixtureA(),s=_.GetFixtureB(),r=_.GetChildIndexA(),b=_.GetChildIndexB(),a=n.m_body,d=s.m_body,_.m_prev=null,_.m_next=this.m_contactList,null!==this.m_contactList&&(this.m_contactList.m_prev=_),((this.m_contactList=_).m_nodeA.contact=_).m_nodeA.other=d,_.m_nodeA.prev=null,_.m_nodeA.next=a.m_contactList,null!==a.m_contactList&&(a.m_contactList.prev=_.m_nodeA),a.m_contactList=_.m_nodeA,(_.m_nodeB.contact=_).m_nodeB.other=a,_.m_nodeB.prev=null,_.m_nodeB.next=d.m_contactList,null!==d.m_contactList&&(d.m_contactList.prev=_.m_nodeB),d.m_contactList=_.m_nodeB,!1===n.IsSensor()&&!1===s.IsSensor()&&(a.SetAwake(!0),d.SetAwake(!0)),++this.m_contactCount)}}},goog.provide("box2d.b2JointFactory"),goog.require("box2d.b2Settings"),goog.require("box2d.b2Math"),goog.require("box2d.b2Joint"),box2d.b2JointFactory.Create=function(o,t){var e=null;switch(o.type){case box2d.b2JointType.e_distanceJoint:e=new box2d.b2DistanceJoint(o instanceof box2d.b2DistanceJointDef?o:null);break;case box2d.b2JointType.e_mouseJoint:e=new box2d.b2MouseJoint(o instanceof box2d.b2MouseJointDef?o:null);break;case box2d.b2JointType.e_prismaticJoint:e=new box2d.b2PrismaticJoint(o instanceof box2d.b2PrismaticJointDef?o:null);break;case box2d.b2JointType.e_revoluteJoint:e=new box2d.b2RevoluteJoint(o instanceof box2d.b2RevoluteJointDef?o:null);break;case box2d.b2JointType.e_pulleyJoint:e=new box2d.b2PulleyJoint(o instanceof box2d.b2PulleyJointDef?o:null);break;case box2d.b2JointType.e_gearJoint:e=new box2d.b2GearJoint(o instanceof box2d.b2GearJointDef?o:null);break;case box2d.b2JointType.e_wheelJoint:e=new box2d.b2WheelJoint(o instanceof box2d.b2WheelJointDef?o:null);break;case box2d.b2JointType.e_weldJoint:e=new box2d.b2WeldJoint(o instanceof box2d.b2WeldJointDef?o:null);break;case box2d.b2JointType.e_frictionJoint:e=new box2d.b2FrictionJoint(o instanceof box2d.b2FrictionJointDef?o:null);break;case box2d.b2JointType.e_ropeJoint:e=new box2d.b2RopeJoint(o instanceof box2d.b2RopeJointDef?o:null);break;case box2d.b2JointType.e_motorJoint:e=new box2d.b2MotorJoint(o instanceof box2d.b2MotorJointDef?o:null);break;case box2d.b2JointType.e_areaJoint:e=new box2d.b2AreaJoint(o instanceof box2d.b2AreaJointDef?o:null);break;default:box2d.ENABLE_ASSERTS&&box2d.b2Assert(!1)}return e},box2d.b2JointFactory.Destroy=function(o,t){},goog.provide("box2d.b2Draw"),goog.require("box2d.b2Settings"),box2d.b2Color=function(o,t,e){this.r=o,this.g=t,this.b=e},box2d.b2Color.prototype.r=.5,box2d.b2Color.prototype.g=.5,box2d.b2Color.prototype.b=.5,box2d.b2Color.prototype.SetRGB=function(o,t,e){return this.r=o,this.g=t,this.b=e,this},box2d.b2Color.prototype.MakeStyleString=function(o){var t=Math.round(Math.max(0,Math.min(255,255*this.r))),e=Math.round(Math.max(0,Math.min(255,255*this.g))),i=Math.round(Math.max(0,Math.min(255,255*this.b))),n=void 0===o?1:Math.max(0,Math.min(1,o));return box2d.b2Color.MakeStyleString(t,e,i,n)},box2d.b2Color.MakeStyleString=function(o,t,e,i){return i<1?"rgba("+o+","+t+","+e+","+i+")":"rgb("+o+","+t+","+e+")"},box2d.b2Color.RED=new box2d.b2Color(1,0,0),box2d.b2Color.GREEN=new box2d.b2Color(0,1,0),box2d.b2Color.BLUE=new box2d.b2Color(0,0,1),box2d.b2DrawFlags={e_none:0,e_shapeBit:1,e_jointBit:2,e_aabbBit:4,e_pairBit:8,e_centerOfMassBit:16,e_controllerBit:32,e_all:63},goog.exportProperty(box2d.b2DrawFlags,"e_none",box2d.b2DrawFlags.e_none),goog.exportProperty(box2d.b2DrawFlags,"e_shapeBit",box2d.b2DrawFlags.e_shapeBit),goog.exportProperty(box2d.b2DrawFlags,"e_jointBit",box2d.b2DrawFlags.e_jointBit),goog.exportProperty(box2d.b2DrawFlags,"e_aabbBit",box2d.b2DrawFlags.e_aabbBit),goog.exportProperty(box2d.b2DrawFlags,"e_pairBit",box2d.b2DrawFlags.e_pairBit),goog.exportProperty(box2d.b2DrawFlags,"e_centerOfMassBit",box2d.b2DrawFlags.e_centerOfMassBit),goog.exportProperty(box2d.b2DrawFlags,"e_controllerBit",box2d.b2DrawFlags.e_controllerBit),goog.exportProperty(box2d.b2DrawFlags,"e_all",box2d.b2DrawFlags.e_all),box2d.b2Draw=function(){},box2d.b2Draw.prototype.m_drawFlags=box2d.b2DrawFlags.e_none,box2d.b2Draw.prototype.SetFlags=function(o){this.m_drawFlags=o},box2d.b2Draw.prototype.GetFlags=function(){return this.m_drawFlags},box2d.b2Draw.prototype.AppendFlags=function(o){this.m_drawFlags|=o},box2d.b2Draw.prototype.ClearFlags=function(o){this.m_drawFlags&=~o},box2d.b2Draw.prototype.PushTransform=function(o){},box2d.b2Draw.prototype.PopTransform=function(o){},box2d.b2Draw.prototype.DrawPolygon=function(o,t,e){},box2d.b2Draw.prototype.DrawSolidPolygon=function(o,t,e){},box2d.b2Draw.prototype.DrawCircle=function(o,t,e){},box2d.b2Draw.prototype.DrawSolidCircle=function(o,t,e,i){},box2d.b2Draw.prototype.DrawSegment=function(o,t,e){},box2d.b2Draw.prototype.DrawTransform=function(o){},goog.provide("box2d.b2Fixture"),goog.require("box2d.b2Settings"),goog.require("box2d.b2Collision"),goog.require("box2d.b2Shape"),box2d.b2Filter=function(){},box2d.b2Filter.prototype.categoryBits=1,box2d.b2Filter.prototype.maskBits=65535,box2d.b2Filter.prototype.groupIndex=0,box2d.b2Filter.prototype.Clone=function(){return(new box2d.b2Filter).Copy(this)},box2d.b2Filter.prototype.Copy=function(o){return box2d.ENABLE_ASSERTS&&box2d.b2Assert(this!==o),this.categoryBits=o.categoryBits,this.maskBits=o.maskBits,this.groupIndex=o.groupIndex,this},box2d.b2FixtureDef=function(){this.filter=new box2d.b2Filter},box2d.b2FixtureDef.prototype.shape=null,box2d.b2FixtureDef.prototype.userData=null,box2d.b2FixtureDef.prototype.friction=.2,box2d.b2FixtureDef.prototype.restitution=0,box2d.b2FixtureDef.prototype.density=0,box2d.b2FixtureDef.prototype.isSensor=!1,box2d.b2FixtureDef.prototype.filter=null,box2d.b2FixtureProxy=function(){this.aabb=new box2d.b2AABB},box2d.b2FixtureProxy.prototype.aabb=null,box2d.b2FixtureProxy.prototype.fixture=null,box2d.b2FixtureProxy.prototype.childIndex=0,box2d.b2FixtureProxy.prototype.proxy=null,box2d.b2FixtureProxy.MakeArray=function(o){return box2d.b2MakeArray(o,function(o){return new box2d.b2FixtureProxy})},box2d.b2Fixture=function(){this.m_proxyCount=0,this.m_filter=new box2d.b2Filter},box2d.b2Fixture.prototype.m_density=0,box2d.b2Fixture.prototype.m_next=null,box2d.b2Fixture.prototype.m_body=null,box2d.b2Fixture.prototype.m_shape=null,box2d.b2Fixture.prototype.m_friction=0,box2d.b2Fixture.prototype.m_restitution=0,box2d.b2Fixture.prototype.m_proxies=null,box2d.b2Fixture.prototype.m_proxyCount=0,box2d.b2Fixture.prototype.m_filter=null,box2d.b2Fixture.prototype.m_isSensor=!1,box2d.b2Fixture.prototype.m_userData=null,box2d.b2Fixture.prototype.GetType=function(){return this.m_shape.GetType()},box2d.b2Fixture.prototype.GetShape=function(){return this.m_shape},box2d.b2Fixture.prototype.IsSensor=function(){return this.m_isSensor},box2d.b2Fixture.prototype.GetFilterData=function(){return this.m_filter},box2d.b2Fixture.prototype.GetUserData=function(){return this.m_userData},box2d.b2Fixture.prototype.SetUserData=function(o){this.m_userData=o},box2d.b2Fixture.prototype.GetBody=function(){return this.m_body},box2d.b2Fixture.prototype.GetNext=function(){return this.m_next},box2d.b2Fixture.prototype.SetDensity=function(o){this.m_density=o},box2d.b2Fixture.prototype.GetDensity=function(){return this.m_density},box2d.b2Fixture.prototype.GetFriction=function(){return this.m_friction},box2d.b2Fixture.prototype.SetFriction=function(o){this.m_friction=o},box2d.b2Fixture.prototype.GetRestitution=function(){return this.m_restitution},box2d.b2Fixture.prototype.SetRestitution=function(o){this.m_restitution=o},box2d.b2Fixture.prototype.TestPoint=function(o){return this.m_shape.TestPoint(this.m_body.GetTransform(),o)},box2d.b2Fixture.prototype.RayCast=function(o,t,e){return this.m_shape.RayCast(o,t,this.m_body.GetTransform(),e)},box2d.b2Fixture.prototype.GetMassData=function(o){return o=o||new box2d.b2MassData,this.m_shape.ComputeMass(o,this.m_density),o},box2d.b2Fixture.prototype.GetAABB=function(o){return box2d.ENABLE_ASSERTS&&box2d.b2Assert(0<=o&&o<this.m_proxyCount),this.m_proxies[o].aabb},box2d.b2Fixture.prototype.Create=function(o,t){this.m_userData=t.userData,this.m_friction=t.friction,this.m_restitution=t.restitution,this.m_body=o,this.m_next=null,this.m_filter.Copy(t.filter),this.m_isSensor=t.isSensor,this.m_shape=t.shape.Clone(),this.m_proxies=box2d.b2FixtureProxy.MakeArray(this.m_shape.GetChildCount()),this.m_proxyCount=0,this.m_density=t.density},box2d.b2Fixture.prototype.Destroy=function(){box2d.ENABLE_ASSERTS&&box2d.b2Assert(0===this.m_proxyCount),this.m_shape=null},box2d.b2Fixture.prototype.CreateProxies=function(o,t){box2d.ENABLE_ASSERTS&&box2d.b2Assert(0===this.m_proxyCount),this.m_proxyCount=this.m_shape.GetChildCount();for(var e=0;e<this.m_proxyCount;++e){var i=this.m_proxies[e];this.m_shape.ComputeAABB(i.aabb,t,e),i.proxy=o.CreateProxy(i.aabb,i),i.fixture=this,i.childIndex=e}},box2d.b2Fixture.prototype.DestroyProxies=function(o){for(var t=0;t<this.m_proxyCount;++t){var e=this.m_proxies[t];o.DestroyProxy(e.proxy),e.proxy=null}this.m_proxyCount=0},box2d.b2Fixture.prototype.Synchronize=function(o,t,e){if(0!==this.m_proxyCount)for(var i=0;i<this.m_proxyCount;++i){var n=this.m_proxies[i],s=box2d.b2Fixture.prototype.Synchronize.s_aabb1,r=box2d.b2Fixture.prototype.Synchronize.s_aabb2;this.m_shape.ComputeAABB(s,t,i),this.m_shape.ComputeAABB(r,e,i),n.aabb.Combine2(s,r);var b=box2d.b2SubVV(e.p,t.p,box2d.b2Fixture.prototype.Synchronize.s_displacement);o.MoveProxy(n.proxy,n.aabb,b)}},box2d.b2Fixture.prototype.Synchronize.s_aabb1=new box2d.b2AABB,box2d.b2Fixture.prototype.Synchronize.s_aabb2=new box2d.b2AABB,box2d.b2Fixture.prototype.Synchronize.s_displacement=new box2d.b2Vec2,box2d.b2Fixture.prototype.SetFilterData=function(o){this.m_filter.Copy(o),this.Refilter()},box2d.b2Fixture.prototype.Refilter=function(){if(!this.m_body){for(var o=this.m_body.GetContactList();o;){var t=o.contact,e=t.GetFixtureA(),i=t.GetFixtureB();e!==this&&i!==this||t.FlagForFiltering(),o=o.next}var n=this.m_body.GetWorld();if(null!==n)for(var s=n.m_contactManager.m_broadPhase,r=0;r<this.m_proxyCount;++r)s.TouchProxy(this.m_proxies[r].proxy)}},box2d.b2Fixture.prototype.SetSensor=function(o){o!==this.m_isSensor&&(this.m_body.SetAwake(!0),this.m_isSensor=o)},box2d.b2Fixture.prototype.Dump=function(o){box2d.DEBUG&&(box2d.b2Log("    /*box2d.b2FixtureDef*/ var fd = new box2d.b2FixtureDef();\n"),box2d.b2Log("    fd.friction = %.15f;\n",this.m_friction),box2d.b2Log("    fd.restitution = %.15f;\n",this.m_restitution),box2d.b2Log("    fd.density = %.15f;\n",this.m_density),box2d.b2Log("    fd.isSensor = %s;\n",this.m_isSensor?"true":"false"),box2d.b2Log("    fd.filter.categoryBits = %d;\n",this.m_filter.categoryBits),box2d.b2Log("    fd.filter.maskBits = %d;\n",this.m_filter.maskBits),box2d.b2Log("    fd.filter.groupIndex = %d;\n",this.m_filter.groupIndex),this.m_shape.Dump(),box2d.b2Log("\n"),box2d.b2Log("    fd.shape = shape;\n"),box2d.b2Log("\n"),box2d.b2Log("    bodies[%d].CreateFixture(fd);\n",o))},goog.provide("box2d.b2Body"),goog.require("box2d.b2Settings"),goog.require("box2d.b2Math"),goog.require("box2d.b2Fixture"),box2d.b2BodyType={b2_unknown:-1,b2_staticBody:0,b2_kinematicBody:1,b2_dynamicBody:2,b2_bulletBody:3},goog.exportProperty(box2d.b2BodyType,"b2_unknown",box2d.b2BodyType.b2_unknown),goog.exportProperty(box2d.b2BodyType,"b2_staticBody",box2d.b2BodyType.b2_staticBody),goog.exportProperty(box2d.b2BodyType,"b2_kinematicBody",box2d.b2BodyType.b2_kinematicBody),goog.exportProperty(box2d.b2BodyType,"b2_dynamicBody",box2d.b2BodyType.b2_dynamicBody),goog.exportProperty(box2d.b2BodyType,"b2_bulletBody",box2d.b2BodyType.b2_bulletBody),box2d.b2BodyDef=function(){this.position=new box2d.b2Vec2(0,0),this.linearVelocity=new box2d.b2Vec2(0,0)},box2d.b2BodyDef.prototype.type=box2d.b2BodyType.b2_staticBody,box2d.b2BodyDef.prototype.position=null,box2d.b2BodyDef.prototype.angle=0,box2d.b2BodyDef.prototype.linearVelocity=null,box2d.b2BodyDef.prototype.angularVelocity=0,box2d.b2BodyDef.prototype.linearDamping=0,box2d.b2BodyDef.prototype.angularDamping=0,box2d.b2BodyDef.prototype.allowSleep=!0,box2d.b2BodyDef.prototype.awake=!0,box2d.b2BodyDef.prototype.fixedRotation=!1,box2d.b2BodyDef.prototype.bullet=!1,box2d.b2BodyDef.prototype.active=!0,box2d.b2BodyDef.prototype.userData=null,box2d.b2BodyDef.prototype.gravityScale=1,box2d.b2BodyFlag={e_none:0,e_islandFlag:1,e_awakeFlag:2,e_autoSleepFlag:4,e_bulletFlag:8,e_fixedRotationFlag:16,e_activeFlag:32,e_toiFlag:64},goog.exportProperty(box2d.b2BodyFlag,"e_none",box2d.b2BodyFlag.e_none),goog.exportProperty(box2d.b2BodyFlag,"e_islandFlag",box2d.b2BodyFlag.e_islandFlag),goog.exportProperty(box2d.b2BodyFlag,"e_awakeFlag",box2d.b2BodyFlag.e_awakeFlag),goog.exportProperty(box2d.b2BodyFlag,"e_autoSleepFlag",box2d.b2BodyFlag.e_autoSleepFlag),goog.exportProperty(box2d.b2BodyFlag,"e_bulletFlag",box2d.b2BodyFlag.e_bulletFlag),goog.exportProperty(box2d.b2BodyFlag,"e_fixedRotationFlag",box2d.b2BodyFlag.e_fixedRotationFlag),goog.exportProperty(box2d.b2BodyFlag,"e_activeFlag",box2d.b2BodyFlag.e_activeFlag),goog.exportProperty(box2d.b2BodyFlag,"e_toiFlag",box2d.b2BodyFlag.e_toiFlag),box2d.b2Body=function(o,t){this.m_xf=new box2d.b2Transform,this.m_out_xf=new box2d.b2Transform,this.m_sweep=new box2d.b2Sweep,this.m_out_sweep=new box2d.b2Sweep,this.m_linearVelocity=new box2d.b2Vec2,this.m_out_linearVelocity=new box2d.b2Vec2,this.m_force=new box2d.b2Vec2,box2d.ENABLE_ASSERTS&&box2d.b2Assert(o.position.IsValid()),box2d.ENABLE_ASSERTS&&box2d.b2Assert(o.linearVelocity.IsValid()),box2d.ENABLE_ASSERTS&&box2d.b2Assert(box2d.b2IsValid(o.angle)),box2d.ENABLE_ASSERTS&&box2d.b2Assert(box2d.b2IsValid(o.angularVelocity)),box2d.ENABLE_ASSERTS&&box2d.b2Assert(box2d.b2IsValid(o.gravityScale)&&0<=o.gravityScale),box2d.ENABLE_ASSERTS&&box2d.b2Assert(box2d.b2IsValid(o.angularDamping)&&0<=o.angularDamping),box2d.ENABLE_ASSERTS&&box2d.b2Assert(box2d.b2IsValid(o.linearDamping)&&0<=o.linearDamping),this.m_flags=box2d.b2BodyFlag.e_none,o.bullet&&(this.m_flags|=box2d.b2BodyFlag.e_bulletFlag),o.fixedRotation&&(this.m_flags|=box2d.b2BodyFlag.e_fixedRotationFlag),o.allowSleep&&(this.m_flags|=box2d.b2BodyFlag.e_autoSleepFlag),o.awake&&(this.m_flags|=box2d.b2BodyFlag.e_awakeFlag),o.active&&(this.m_flags|=box2d.b2BodyFlag.e_activeFlag),this.m_world=t,this.m_xf.p.Copy(o.position),this.m_xf.q.SetAngleRadians(o.angle),this.m_sweep.localCenter.SetZero(),this.m_sweep.c0.Copy(this.m_xf.p),this.m_sweep.c.Copy(this.m_xf.p),this.m_sweep.a0=o.angle,this.m_sweep.a=o.angle,this.m_sweep.alpha0=0,this.m_linearVelocity.Copy(o.linearVelocity),this.m_angularVelocity=o.angularVelocity,this.m_linearDamping=o.linearDamping,this.m_angularDamping=o.angularDamping,this.m_gravityScale=o.gravityScale,this.m_force.SetZero(),this.m_torque=0,this.m_sleepTime=0,this.m_type=o.type,o.type===box2d.b2BodyType.b2_dynamicBody?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_userData=o.userData,this.m_fixtureList=null,this.m_fixtureCount=0,this.m_controllerList=null,this.m_controllerCount=0},box2d.b2Body.prototype.m_flags=box2d.b2BodyFlag.e_none,box2d.b2Body.prototype.m_islandIndex=0,box2d.b2Body.prototype.m_world=null,box2d.b2Body.prototype.m_xf=null,box2d.b2Body.prototype.m_out_xf=null,box2d.b2Body.prototype.m_sweep=null,box2d.b2Body.prototype.m_out_sweep=null,box2d.b2Body.prototype.m_jointList=null,box2d.b2Body.prototype.m_contactList=null,box2d.b2Body.prototype.m_prev=null,box2d.b2Body.prototype.m_next=null,box2d.b2Body.prototype.m_linearVelocity=null,box2d.b2Body.prototype.m_out_linearVelocity=null,box2d.b2Body.prototype.m_angularVelocity=0,box2d.b2Body.prototype.m_linearDamping=0,box2d.b2Body.prototype.m_angularDamping=0,box2d.b2Body.prototype.m_gravityScale=1,box2d.b2Body.prototype.m_force=null,box2d.b2Body.prototype.m_torque=0,box2d.b2Body.prototype.m_sleepTime=0,box2d.b2Body.prototype.m_type=box2d.b2BodyType.b2_staticBody,box2d.b2Body.prototype.m_mass=1,box2d.b2Body.prototype.m_invMass=1,box2d.b2Body.prototype.m_I=0,box2d.b2Body.prototype.m_invI=0,box2d.b2Body.prototype.m_userData=null,box2d.b2Body.prototype.m_fixtureList=null,box2d.b2Body.prototype.m_fixtureCount=0,box2d.b2Body.prototype.m_controllerList=null,box2d.b2Body.prototype.m_controllerCount=0,box2d.b2Body.prototype.CreateFixture=function(o){if(box2d.ENABLE_ASSERTS&&box2d.b2Assert(!1===this.m_world.IsLocked()),!0===this.m_world.IsLocked())return null;var t=new box2d.b2Fixture;if(t.Create(this,o),this.m_flags&box2d.b2BodyFlag.e_activeFlag){var e=this.m_world.m_contactManager.m_broadPhase;t.CreateProxies(e,this.m_xf)}return t.m_next=this.m_fixtureList,this.m_fixtureList=t,++this.m_fixtureCount,t.m_body=this,0<t.m_density&&this.ResetMassData(),this.m_world.m_flags|=box2d.b2WorldFlag.e_newFixture,t},box2d.b2Body.prototype.CreateFixture2=function(o,t){void 0===t&&(t=0);var e=box2d.b2Body.prototype.CreateFixture2.s_def;return e.shape=o,e.density=t,this.CreateFixture(e)},box2d.b2Body.prototype.CreateFixture2.s_def=new box2d.b2FixtureDef,box2d.b2Body.prototype.DestroyFixture=function(o){if(box2d.ENABLE_ASSERTS&&box2d.b2Assert(!1===this.m_world.IsLocked()),!0!==this.m_world.IsLocked()){box2d.ENABLE_ASSERTS&&box2d.b2Assert(o.m_body===this),box2d.ENABLE_ASSERTS&&box2d.b2Assert(0<this.m_fixtureCount);for(var t=this.m_fixtureList,e=null,i=!1;null!==t;){if(t===o){e?e.m_next=o.m_next:this.m_fixtureList=o.m_next,i=!0;break}t=(e=t).m_next}box2d.ENABLE_ASSERTS&&box2d.b2Assert(i);for(var n=this.m_contactList;n;){var s=n.contact;n=n.next;var r=s.GetFixtureA(),b=s.GetFixtureB();o!==r&&o!==b||this.m_world.m_contactManager.Destroy(s)}if(this.m_flags&box2d.b2BodyFlag.e_activeFlag){var a=this.m_world.m_contactManager.m_broadPhase;o.DestroyProxies(a)}o.Destroy(),o.m_body=null,o.m_next=null,--this.m_fixtureCount,this.ResetMassData()}},box2d.b2Body.prototype.SetTransformVecRadians=function(o,t){this.SetTransformXYRadians(o.x,o.y,t)},box2d.b2Body.prototype.SetTransformXYRadians=function(o,t,e){if(box2d.ENABLE_ASSERTS&&box2d.b2Assert(!1===this.m_world.IsLocked()),!0!==this.m_world.IsLocked()&&(this.m_xf.p.x!==o||this.m_xf.p.y!==t||this.m_xf.q.GetAngleRadians()!==e)){this.m_xf.q.SetAngleRadians(e),this.m_xf.p.SetXY(o,t),box2d.b2MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.a=e,this.m_sweep.c0.Copy(this.m_sweep.c),this.m_sweep.a0=e;for(var i=this.m_world.m_contactManager.m_broadPhase,n=this.m_fixtureList;n;n=n.m_next)n.Synchronize(i,this.m_xf,this.m_xf)}},box2d.b2Body.prototype.SetTransform=function(o){this.SetTransformVecRadians(o.p,o.GetAngleRadians())},box2d.b2Body.prototype.GetTransform=function(o){return(o=o||this.m_out_xf).Copy(this.m_xf)},box2d.b2Body.prototype.GetPosition=function(o){return(o=o||this.m_out_xf.p).Copy(this.m_xf.p)},box2d.b2Body.prototype.SetPosition=function(o){this.SetTransformVecRadians(o,this.GetAngleRadians())},box2d.b2Body.prototype.SetPositionXY=function(o,t){this.SetTransformXYRadians(o,t,this.GetAngleRadians())},box2d.b2Body.prototype.GetAngle=function(){return this.m_sweep.a},box2d.b2Body.prototype.GetAngleRadians=box2d.b2Body.prototype.GetAngle,box2d.b2Body.prototype.GetAngleDegrees=function(){return box2d.b2RadToDeg(this.GetAngle())},box2d.b2Body.prototype.SetAngle=function(o){this.SetTransformVecRadians(this.GetPosition(),o)},box2d.b2Body.prototype.SetAngleRadians=box2d.b2Body.prototype.SetAngle,box2d.b2Body.prototype.SetAngleDegrees=function(o){this.SetAngle(box2d.b2DegToRad(o))},box2d.b2Body.prototype.GetWorldCenter=function(o){return(o=o||this.m_out_sweep.c).Copy(this.m_sweep.c)},box2d.b2Body.prototype.GetLocalCenter=function(o){return(o=o||this.m_out_sweep.localCenter).Copy(this.m_sweep.localCenter)},box2d.b2Body.prototype.SetLinearVelocity=function(o){this.m_type!==box2d.b2BodyType.b2_staticBody&&(0<box2d.b2DotVV(o,o)&&this.SetAwake(!0),this.m_linearVelocity.Copy(o))},box2d.b2Body.prototype.GetLinearVelocity=function(o){return(o=o||this.m_out_linearVelocity).Copy(this.m_linearVelocity)},box2d.b2Body.prototype.SetAngularVelocity=function(o){this.m_type!==box2d.b2BodyType.b2_staticBody&&(0<o*o&&this.SetAwake(!0),this.m_angularVelocity=o)},box2d.b2Body.prototype.GetAngularVelocity=function(){return this.m_angularVelocity},box2d.b2Body.prototype.GetDefinition=function(o){return o.type=this.GetType(),o.allowSleep=(this.m_flags&box2d.b2BodyFlag.e_autoSleepFlag)===box2d.b2BodyFlag.e_autoSleepFlag,o.angle=this.GetAngleRadians(),o.angularDamping=this.m_angularDamping,o.gravityScale=this.m_gravityScale,o.angularVelocity=this.m_angularVelocity,o.fixedRotation=(this.m_flags&box2d.b2BodyFlag.e_fixedRotationFlag)===box2d.b2BodyFlag.e_fixedRotationFlag,o.bullet=(this.m_flags&box2d.b2BodyFlag.e_bulletFlag)===box2d.b2BodyFlag.e_bulletFlag,o.awake=(this.m_flags&box2d.b2BodyFlag.e_awakeFlag)===box2d.b2BodyFlag.e_awakeFlag,o.linearDamping=this.m_linearDamping,o.linearVelocity.Copy(this.GetLinearVelocity()),o.position.Copy(this.GetPosition()),o.userData=this.GetUserData(),o},box2d.b2Body.prototype.ApplyForce=function(o,t,e){e=e||!0,this.m_type===box2d.b2BodyType.b2_dynamicBody&&(e&&0==(this.m_flags&box2d.b2BodyFlag.e_awakeFlag)&&this.SetAwake(!0),this.m_flags&box2d.b2BodyFlag.e_awakeFlag&&(this.m_force.x+=o.x,this.m_force.y+=o.y,this.m_torque+=(t.x-this.m_sweep.c.x)*o.y-(t.y-this.m_sweep.c.y)*o.x))},box2d.b2Body.prototype.ApplyForceToCenter=function(o,t){t=t||!0,this.m_type===box2d.b2BodyType.b2_dynamicBody&&(t&&0==(this.m_flags&box2d.b2BodyFlag.e_awakeFlag)&&this.SetAwake(!0),this.m_flags&box2d.b2BodyFlag.e_awakeFlag&&(this.m_force.x+=o.x,this.m_force.y+=o.y))},box2d.b2Body.prototype.ApplyTorque=function(o,t){t=t||!0,this.m_type===box2d.b2BodyType.b2_dynamicBody&&(t&&0==(this.m_flags&box2d.b2BodyFlag.e_awakeFlag)&&this.SetAwake(!0),this.m_flags&box2d.b2BodyFlag.e_awakeFlag&&(this.m_torque+=o))},box2d.b2Body.prototype.ApplyLinearImpulse=function(o,t,e){e=e||!0,this.m_type===box2d.b2BodyType.b2_dynamicBody&&(e&&0==(this.m_flags&box2d.b2BodyFlag.e_awakeFlag)&&this.SetAwake(!0),this.m_flags&box2d.b2BodyFlag.e_awakeFlag&&(this.m_linearVelocity.x+=this.m_invMass*o.x,this.m_linearVelocity.y+=this.m_invMass*o.y,this.m_angularVelocity+=this.m_invI*((t.x-this.m_sweep.c.x)*o.y-(t.y-this.m_sweep.c.y)*o.x)))},box2d.b2Body.prototype.ApplyAngularImpulse=function(o,t){t=t||!0,this.m_type===box2d.b2BodyType.b2_dynamicBody&&(t&&0==(this.m_flags&box2d.b2BodyFlag.e_awakeFlag)&&this.SetAwake(!0),this.m_flags&box2d.b2BodyFlag.e_awakeFlag&&(this.m_angularVelocity+=this.m_invI*o))},box2d.b2Body.prototype.GetMass=function(){return this.m_mass},box2d.b2Body.prototype.GetInertia=function(){return this.m_I+this.m_mass*box2d.b2DotVV(this.m_sweep.localCenter,this.m_sweep.localCenter)},box2d.b2Body.prototype.GetMassData=function(o){return o.mass=this.m_mass,o.I=this.m_I+this.m_mass*box2d.b2DotVV(this.m_sweep.localCenter,this.m_sweep.localCenter),o.center.Copy(this.m_sweep.localCenter),o},box2d.b2Body.prototype.SetMassData=function(o){if(box2d.ENABLE_ASSERTS&&box2d.b2Assert(!1===this.m_world.IsLocked()),!0!==this.m_world.IsLocked()&&this.m_type===box2d.b2BodyType.b2_dynamicBody){this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=o.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,0<o.I&&0==(this.m_flags&box2d.b2BodyFlag.e_fixedRotationFlag)&&(this.m_I=o.I-this.m_mass*box2d.b2DotVV(o.center,o.center),box2d.ENABLE_ASSERTS&&box2d.b2Assert(0<this.m_I),this.m_invI=1/this.m_I);var t=box2d.b2Body.prototype.SetMassData.s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(o.center),box2d.b2MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.c0.Copy(this.m_sweep.c),box2d.b2AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,box2d.b2SubVV(this.m_sweep.c,t,box2d.b2Vec2.s_t0),this.m_linearVelocity)}},box2d.b2Body.prototype.SetMassData.s_oldCenter=new box2d.b2Vec2,box2d.b2Body.prototype.ResetMassData=function(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.SetZero(),this.m_type===box2d.b2BodyType.b2_staticBody||this.m_type===box2d.b2BodyType.b2_kinematicBody)return this.m_sweep.c0.Copy(this.m_xf.p),this.m_sweep.c.Copy(this.m_xf.p),void(this.m_sweep.a0=this.m_sweep.a);box2d.ENABLE_ASSERTS&&box2d.b2Assert(this.m_type===box2d.b2BodyType.b2_dynamicBody);for(var o=box2d.b2Body.prototype.ResetMassData.s_localCenter.SetZero(),t=this.m_fixtureList;t;t=t.m_next)if(0!==t.m_density){var e=t.GetMassData(box2d.b2Body.prototype.ResetMassData.s_massData);this.m_mass+=e.mass,o.x+=e.center.x*e.mass,o.y+=e.center.y*e.mass,this.m_I+=e.I}0<this.m_mass?(this.m_invMass=1/this.m_mass,o.x*=this.m_invMass,o.y*=this.m_invMass):(this.m_mass=1,this.m_invMass=1),0<this.m_I&&0==(this.m_flags&box2d.b2BodyFlag.e_fixedRotationFlag)?(this.m_I-=this.m_mass*box2d.b2DotVV(o,o),box2d.ENABLE_ASSERTS&&box2d.b2Assert(0<this.m_I),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);var i=box2d.b2Body.prototype.ResetMassData.s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(o),box2d.b2MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.c0.Copy(this.m_sweep.c),box2d.b2AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,box2d.b2SubVV(this.m_sweep.c,i,box2d.b2Vec2.s_t0),this.m_linearVelocity)},box2d.b2Body.prototype.ResetMassData.s_localCenter=new box2d.b2Vec2,box2d.b2Body.prototype.ResetMassData.s_oldCenter=new box2d.b2Vec2,box2d.b2Body.prototype.ResetMassData.s_massData=new box2d.b2MassData,box2d.b2Body.prototype.GetWorldPoint=function(o,t){return box2d.b2MulXV(this.m_xf,o,t)},box2d.b2Body.prototype.GetWorldVector=function(o,t){return box2d.b2MulRV(this.m_xf.q,o,t)},box2d.b2Body.prototype.GetLocalPoint=function(o,t){return box2d.b2MulTXV(this.m_xf,o,t)},box2d.b2Body.prototype.GetLocalVector=function(o,t){return box2d.b2MulTRV(this.m_xf.q,o,t)},box2d.b2Body.prototype.GetLinearVelocityFromWorldPoint=function(o,t){return box2d.b2AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,box2d.b2SubVV(o,this.m_sweep.c,box2d.b2Vec2.s_t0),t)},box2d.b2Body.prototype.GetLinearVelocityFromLocalPoint=function(o,t){return this.GetLinearVelocityFromWorldPoint(this.GetWorldPoint(o,t),t)},box2d.b2Body.prototype.GetLinearDamping=function(){return this.m_linearDamping},box2d.b2Body.prototype.SetLinearDamping=function(o){this.m_linearDamping=o},box2d.b2Body.prototype.GetAngularDamping=function(){return this.m_angularDamping},box2d.b2Body.prototype.SetAngularDamping=function(o){this.m_angularDamping=o},box2d.b2Body.prototype.GetGravityScale=function(){return this.m_gravityScale},box2d.b2Body.prototype.SetGravityScale=function(o){this.m_gravityScale=o},box2d.b2Body.prototype.SetType=function(o){if(box2d.ENABLE_ASSERTS&&box2d.b2Assert(!1===this.m_world.IsLocked()),!0!==this.m_world.IsLocked()&&this.m_type!==o){this.m_type=o,this.ResetMassData(),this.m_type===box2d.b2BodyType.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_sweep.a0=this.m_sweep.a,this.m_sweep.c0.Copy(this.m_sweep.c),this.SynchronizeFixtures()),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0;for(var t=this.m_contactList;t;){var e=t;t=t.next,this.m_world.m_contactManager.Destroy(e.contact)}this.m_contactList=null;for(var i=this.m_world.m_contactManager.m_broadPhase,n=this.m_fixtureList;n;n=n.m_next)for(var s=n.m_proxyCount,r=0;r<s;++r)i.TouchProxy(n.m_proxies[r].proxy)}},box2d.b2Body.prototype.GetType=function(){return this.m_type},box2d.b2Body.prototype.SetBullet=function(o){o?this.m_flags|=box2d.b2BodyFlag.e_bulletFlag:this.m_flags&=~box2d.b2BodyFlag.e_bulletFlag},box2d.b2Body.prototype.IsBullet=function(){return(this.m_flags&box2d.b2BodyFlag.e_bulletFlag)===box2d.b2BodyFlag.e_bulletFlag},box2d.b2Body.prototype.SetSleepingAllowed=function(o){o?this.m_flags|=box2d.b2BodyFlag.e_autoSleepFlag:(this.m_flags&=~box2d.b2BodyFlag.e_autoSleepFlag,this.SetAwake(!0))},box2d.b2Body.prototype.IsSleepingAllowed=function(){return(this.m_flags&box2d.b2BodyFlag.e_autoSleepFlag)===box2d.b2BodyFlag.e_autoSleepFlag},box2d.b2Body.prototype.SetAwake=function(o){o?0==(this.m_flags&box2d.b2BodyFlag.e_awakeFlag)&&(this.m_flags|=box2d.b2BodyFlag.e_awakeFlag,this.m_sleepTime=0):(this.m_flags&=~box2d.b2BodyFlag.e_awakeFlag,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)},box2d.b2Body.prototype.IsAwake=function(){return(this.m_flags&box2d.b2BodyFlag.e_awakeFlag)===box2d.b2BodyFlag.e_awakeFlag},box2d.b2Body.prototype.SetActive=function(o){if(box2d.ENABLE_ASSERTS&&box2d.b2Assert(!1===this.m_world.IsLocked()),o!==this.IsActive())if(o){this.m_flags|=box2d.b2BodyFlag.e_activeFlag;for(var t=this.m_world.m_contactManager.m_broadPhase,e=this.m_fixtureList;e;e=e.m_next)e.CreateProxies(t,this.m_xf)}else{this.m_flags&=~box2d.b2BodyFlag.e_activeFlag;for(t=this.m_world.m_contactManager.m_broadPhase,e=this.m_fixtureList;e;e=e.m_next)e.DestroyProxies(t);for(var i=this.m_contactList;i;){var n=i;i=i.next,this.m_world.m_contactManager.Destroy(n.contact)}this.m_contactList=null}},box2d.b2Body.prototype.IsActive=function(){return(this.m_flags&box2d.b2BodyFlag.e_activeFlag)===box2d.b2BodyFlag.e_activeFlag},box2d.b2Body.prototype.SetFixedRotation=function(o){(this.m_flags&box2d.b2BodyFlag.e_fixedRotationFlag)===box2d.b2BodyFlag.e_fixedRotationFlag!==o&&(o?this.m_flags|=box2d.b2BodyFlag.e_fixedRotationFlag:this.m_flags&=~box2d.b2BodyFlag.e_fixedRotationFlag,this.m_angularVelocity=0,this.ResetMassData())},box2d.b2Body.prototype.IsFixedRotation=function(){return(this.m_flags&box2d.b2BodyFlag.e_fixedRotationFlag)===box2d.b2BodyFlag.e_fixedRotationFlag},box2d.b2Body.prototype.GetFixtureList=function(){return this.m_fixtureList},box2d.b2Body.prototype.GetJointList=function(){return this.m_jointList},box2d.b2Body.prototype.GetContactList=function(){return this.m_contactList},box2d.b2Body.prototype.GetNext=function(){return this.m_next},box2d.b2Body.prototype.GetUserData=function(){return this.m_userData},box2d.b2Body.prototype.SetUserData=function(o){this.m_userData=o},box2d.b2Body.prototype.GetWorld=function(){return this.m_world},box2d.b2Body.prototype.SynchronizeFixtures=function(){var o=box2d.b2Body.prototype.SynchronizeFixtures.s_xf1;o.q.SetAngleRadians(this.m_sweep.a0),box2d.b2MulRV(o.q,this.m_sweep.localCenter,o.p),box2d.b2SubVV(this.m_sweep.c0,o.p,o.p);for(var t=this.m_world.m_contactManager.m_broadPhase,e=this.m_fixtureList;e;e=e.m_next)e.Synchronize(t,o,this.m_xf)},box2d.b2Body.prototype.SynchronizeFixtures.s_xf1=new box2d.b2Transform,box2d.b2Body.prototype.SynchronizeTransform=function(){this.m_xf.q.SetAngleRadians(this.m_sweep.a),box2d.b2MulRV(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p),box2d.b2SubVV(this.m_sweep.c,this.m_xf.p,this.m_xf.p)},box2d.b2Body.prototype.ShouldCollide=function(o){if(this.m_type!==box2d.b2BodyType.b2_dynamicBody&&o.m_type!==box2d.b2BodyType.b2_dynamicBody)return!1;for(var t=this.m_jointList;t;t=t.next)if(t.other===o&&!1===t.joint.m_collideConnected)return!1;return!0},box2d.b2Body.prototype.Advance=function(o){this.m_sweep.Advance(o),this.m_sweep.c.Copy(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.m_xf.q.SetAngleRadians(this.m_sweep.a),box2d.b2MulRV(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p),box2d.b2SubVV(this.m_sweep.c,this.m_xf.p,this.m_xf.p)},box2d.b2Body.prototype.Dump=function(){if(box2d.DEBUG){var o=this.m_islandIndex;box2d.b2Log("if (true)\n"),box2d.b2Log("{\n"),box2d.b2Log("  /*box2d.b2BodyDef*/ var bd = new box2d.b2BodyDef();\n");var t="";switch(this.m_type){case box2d.b2BodyType.b2_staticBody:t="box2d.b2BodyType.b2_staticBody";break;case box2d.b2BodyType.b2_kinematicBody:t="box2d.b2BodyType.b2_kinematicBody";break;case box2d.b2BodyType.b2_dynamicBody:t="box2d.b2BodyType.b2_dynamicBody";break;default:box2d.ENABLE_ASSERTS&&box2d.b2Assert(!1)}box2d.b2Log("  bd.type = %s;\n",t),box2d.b2Log("  bd.position.SetXY(%.15f, %.15f);\n",this.m_xf.p.x,this.m_xf.p.y),box2d.b2Log("  bd.angle = %.15f;\n",this.m_sweep.a),box2d.b2Log("  bd.linearVelocity.SetXY(%.15f, %.15f);\n",this.m_linearVelocity.x,this.m_linearVelocity.y),box2d.b2Log("  bd.angularVelocity = %.15f;\n",this.m_angularVelocity),box2d.b2Log("  bd.linearDamping = %.15f;\n",this.m_linearDamping),box2d.b2Log("  bd.angularDamping = %.15f;\n",this.m_angularDamping),box2d.b2Log("  bd.allowSleep = %s;\n",this.m_flags&box2d.b2BodyFlag.e_autoSleepFlag?"true":"false"),box2d.b2Log("  bd.awake = %s;\n",this.m_flags&box2d.b2BodyFlag.e_awakeFlag?"true":"false"),box2d.b2Log("  bd.fixedRotation = %s;\n",this.m_flags&box2d.b2BodyFlag.e_fixedRotationFlag?"true":"false"),box2d.b2Log("  bd.bullet = %s;\n",this.m_flags&box2d.b2BodyFlag.e_bulletFlag?"true":"false"),box2d.b2Log("  bd.active = %s;\n",this.m_flags&box2d.b2BodyFlag.e_activeFlag?"true":"false"),box2d.b2Log("  bd.gravityScale = %.15f;\n",this.m_gravityScale),box2d.b2Log("\n"),box2d.b2Log("  bodies[%d] = this.m_world.CreateBody(bd);\n",this.m_islandIndex),box2d.b2Log("\n");for(var e=this.m_fixtureList;e;e=e.m_next)box2d.b2Log("  if (true)\n"),box2d.b2Log("  {\n"),e.Dump(o),box2d.b2Log("  }\n");box2d.b2Log("}\n")}},box2d.b2Body.prototype.GetControllerList=function(){return this.m_controllerList},box2d.b2Body.prototype.GetControllerCount=function(){return this.m_controllerCount},goog.provide("box2d.b2World"),goog.require("box2d.b2Settings"),goog.require("box2d.b2Draw"),goog.require("box2d.b2ContactManager"),goog.require("box2d.b2ContactSolver"),goog.require("box2d.b2Island"),goog.require("box2d.b2Body"),goog.require("box2d.b2Math"),goog.require("box2d.b2Collision"),goog.require("box2d.b2TimeStep"),goog.require("box2d.b2WorldCallbacks"),goog.require("box2d.b2JointFactory"),box2d.b2WorldFlag={e_none:0,e_newFixture:1,e_locked:2,e_clearForces:4},goog.exportProperty(box2d.b2WorldFlag,"e_none",box2d.b2WorldFlag.e_none),goog.exportProperty(box2d.b2WorldFlag,"e_newFixture",box2d.b2WorldFlag.e_newFixture),goog.exportProperty(box2d.b2WorldFlag,"e_locked",box2d.b2WorldFlag.e_locked),goog.exportProperty(box2d.b2WorldFlag,"e_clearForces",box2d.b2WorldFlag.e_clearForces),box2d.b2World=function(o){this.m_flags=box2d.b2WorldFlag.e_clearForces,this.m_contactManager=new box2d.b2ContactManager,this.m_gravity=o.Clone(),this.m_out_gravity=new box2d.b2Vec2,this.m_allowSleep=!0,this.m_destructionListener=null,this.m_debugDraw=null,this.m_warmStarting=!0,this.m_continuousPhysics=!0,this.m_subStepping=!1,this.m_stepComplete=!0,this.m_profile=new box2d.b2Profile,this.m_island=new box2d.b2Island,this.s_stack=new Array},box2d.b2World.prototype.m_flags=box2d.b2WorldFlag.e_none,box2d.b2World.prototype.m_contactManager=null,box2d.b2World.prototype.m_bodyList=null,box2d.b2World.prototype.m_jointList=null,box2d.b2World.prototype.m_bodyCount=0,box2d.b2World.prototype.m_jointCount=0,box2d.b2World.prototype.m_gravity=null,box2d.b2World.prototype.m_out_gravity=null,box2d.b2World.prototype.m_allowSleep=!0,box2d.b2World.prototype.m_destructionListener=null,box2d.b2World.prototype.m_debugDraw=null,box2d.b2World.prototype.m_inv_dt0=0,box2d.b2World.prototype.m_warmStarting=!0,box2d.b2World.prototype.m_continuousPhysics=!0,box2d.b2World.prototype.m_subStepping=!1,box2d.b2World.prototype.m_stepComplete=!0,box2d.b2World.prototype.m_profile=null,box2d.b2World.prototype.m_island=null,box2d.b2World.prototype.s_stack=null,box2d.b2World.prototype.m_controllerList=null,box2d.b2World.prototype.m_controllerCount=0,box2d.b2World.prototype.SetAllowSleeping=function(o){if(o!==this.m_allowSleep&&(this.m_allowSleep=o,!1===this.m_allowSleep))for(var t=this.m_bodyList;t;t=t.m_next)t.SetAwake(!0)},box2d.b2World.prototype.GetAllowSleeping=function(){return this.m_allowSleep},box2d.b2World.prototype.SetWarmStarting=function(o){this.m_warmStarting=o},box2d.b2World.prototype.GetWarmStarting=function(){return this.m_warmStarting},box2d.b2World.prototype.SetContinuousPhysics=function(o){this.m_continuousPhysics=o},box2d.b2World.prototype.GetContinuousPhysics=function(){return this.m_continuousPhysics},box2d.b2World.prototype.SetSubStepping=function(o){this.m_subStepping=o},box2d.b2World.prototype.GetSubStepping=function(){return this.m_subStepping},box2d.b2World.prototype.GetBodyList=function(){return this.m_bodyList},box2d.b2World.prototype.GetJointList=function(){return this.m_jointList},box2d.b2World.prototype.GetContactList=function(){return this.m_contactManager.m_contactList},box2d.b2World.prototype.GetBodyCount=function(){return this.m_bodyCount},box2d.b2World.prototype.GetJointCount=function(){return this.m_jointCount},box2d.b2World.prototype.GetContactCount=function(){return this.m_contactManager.m_contactCount},box2d.b2World.prototype.SetGravity=function(o,t){if(t=t||!0,(this.m_gravity.x!==o.x||this.m_gravity.y!==o.y)&&(this.m_gravity.Copy(o),t))for(var e=this.m_bodyList;e;e=e.m_next)e.SetAwake(!0)},box2d.b2World.prototype.GetGravity=function(o){return(o=o||this.m_out_gravity).Copy(this.m_gravity)},box2d.b2World.prototype.IsLocked=function(){return 0<(this.m_flags&box2d.b2WorldFlag.e_locked)},box2d.b2World.prototype.SetAutoClearForces=function(o){o?this.m_flags|=box2d.b2WorldFlag.e_clearForces:this.m_flags&=~box2d.b2WorldFlag.e_clearForces},box2d.b2World.prototype.GetAutoClearForces=function(){return(this.m_flags&box2d.b2WorldFlag.e_clearForces)===box2d.b2WorldFlag.e_clearForces},box2d.b2World.prototype.GetContactManager=function(){return this.m_contactManager},box2d.b2World.prototype.GetProfile=function(){return this.m_profile},box2d.b2World.prototype.SetDestructionListener=function(o){this.m_destructionListener=o},box2d.b2World.prototype.SetContactFilter=function(o){this.m_contactManager.m_contactFilter=o},box2d.b2World.prototype.SetContactListener=function(o){this.m_contactManager.m_contactListener=o},box2d.b2World.prototype.SetDebugDraw=function(o){this.m_debugDraw=o},box2d.b2World.prototype.CreateBody=function(o){if(box2d.ENABLE_ASSERTS&&box2d.b2Assert(!1===this.IsLocked()),this.IsLocked())return null;var t=new box2d.b2Body(o,this);return t.m_prev=null,t.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=t),this.m_bodyList=t,++this.m_bodyCount,t},box2d.b2World.prototype.DestroyBody=function(o){if(box2d.ENABLE_ASSERTS&&box2d.b2Assert(0<this.m_bodyCount),box2d.ENABLE_ASSERTS&&box2d.b2Assert(!1===this.IsLocked()),!this.IsLocked()){for(var t=o.m_jointList;t;){var e=t;t=t.next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(e.joint),this.DestroyJoint(e.joint),o.m_jointList=t}o.m_jointList=null;for(var i=o.m_controllerList;i;){var n=i;i=i.nextController,n.controller.RemoveBody(o)}for(var s=o.m_contactList;s;){var r=s;s=s.next,this.m_contactManager.Destroy(r.contact)}o.m_contactList=null;for(var b=o.m_fixtureList;b;){var a=b;b=b.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(a),a.DestroyProxies(this.m_contactManager.m_broadPhase),a.Destroy(),o.m_fixtureList=b,o.m_fixtureCount-=1}o.m_fixtureList=null,o.m_fixtureCount=0,o.m_prev&&(o.m_prev.m_next=o.m_next),o.m_next&&(o.m_next.m_prev=o.m_prev),o===this.m_bodyList&&(this.m_bodyList=o.m_next),--this.m_bodyCount}},box2d.b2World.prototype.CreateJoint=function(o){if(box2d.ENABLE_ASSERTS&&box2d.b2Assert(!1===this.IsLocked()),this.IsLocked())return null;var t=box2d.b2JointFactory.Create(o,null);t.m_prev=null,t.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=t),this.m_jointList=t,++this.m_jointCount,(t.m_edgeA.joint=t).m_edgeA.other=t.m_bodyB,t.m_edgeA.prev=null,t.m_edgeA.next=t.m_bodyA.m_jointList,t.m_bodyA.m_jointList&&(t.m_bodyA.m_jointList.prev=t.m_edgeA),t.m_bodyA.m_jointList=t.m_edgeA,(t.m_edgeB.joint=t).m_edgeB.other=t.m_bodyA,t.m_edgeB.prev=null,t.m_edgeB.next=t.m_bodyB.m_jointList,t.m_bodyB.m_jointList&&(t.m_bodyB.m_jointList.prev=t.m_edgeB),t.m_bodyB.m_jointList=t.m_edgeB;var e=o.bodyA,i=o.bodyB;if(!1===o.collideConnected)for(var n=i.GetContactList();n;)n.other===e&&n.contact.FlagForFiltering(),n=n.next;return t},box2d.b2World.prototype.DestroyJoint=function(o){if(box2d.ENABLE_ASSERTS&&box2d.b2Assert(!1===this.IsLocked()),!this.IsLocked()){var t=o.m_collideConnected;o.m_prev&&(o.m_prev.m_next=o.m_next),o.m_next&&(o.m_next.m_prev=o.m_prev),o===this.m_jointList&&(this.m_jointList=o.m_next);var e=o.m_bodyA,i=o.m_bodyB;if(e.SetAwake(!0),i.SetAwake(!0),o.m_edgeA.prev&&(o.m_edgeA.prev.next=o.m_edgeA.next),o.m_edgeA.next&&(o.m_edgeA.next.prev=o.m_edgeA.prev),o.m_edgeA===e.m_jointList&&(e.m_jointList=o.m_edgeA.next),o.m_edgeA.prev=null,o.m_edgeA.next=null,o.m_edgeB.prev&&(o.m_edgeB.prev.next=o.m_edgeB.next),o.m_edgeB.next&&(o.m_edgeB.next.prev=o.m_edgeB.prev),o.m_edgeB===i.m_jointList&&(i.m_jointList=o.m_edgeB.next),o.m_edgeB.prev=null,o.m_edgeB.next=null,box2d.b2JointFactory.Destroy(o,null),box2d.ENABLE_ASSERTS&&box2d.b2Assert(0<this.m_jointCount),--this.m_jointCount,!1===t)for(var n=i.GetContactList();n;)n.other===e&&n.contact.FlagForFiltering(),n=n.next}},box2d.b2World.prototype.Solve=function(o){for(var t=this.m_controllerList;t;t=t.m_next)t.Step(o);this.m_profile.solveInit=0,this.m_profile.solveVelocity=0,this.m_profile.solvePosition=0;var e=this.m_island;e.Initialize(this.m_bodyCount,this.m_contactManager.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener);for(var i=this.m_bodyList;i;i=i.m_next)i.m_flags&=~box2d.b2BodyFlag.e_islandFlag;for(var n=this.m_contactManager.m_contactList;n;n=n.m_next)n.m_flags&=~box2d.b2ContactFlag.e_islandFlag;for(var s=this.m_jointList;s;s=s.m_next)s.m_islandFlag=!1;for(var r=this.m_bodyCount,b=this.s_stack,a=this.m_bodyList;a;a=a.m_next)if(!(a.m_flags&box2d.b2BodyFlag.e_islandFlag)&&!1!==a.IsAwake()&&!1!==a.IsActive()&&a.GetType()!==box2d.b2BodyType.b2_staticBody){e.Clear();var d=0;for((b[d++]=a).m_flags|=box2d.b2BodyFlag.e_islandFlag;0<d;){i=b[--d];if(box2d.ENABLE_ASSERTS&&box2d.b2Assert(!0===i.IsActive()),e.AddBody(i),i.SetAwake(!0),i.GetType()!==box2d.b2BodyType.b2_staticBody){for(var l=i.m_contactList;l;l=l.next){var x=l.contact;if(!(x.m_flags&box2d.b2ContactFlag.e_islandFlag)&&(!1!==x.IsEnabled()&&!1!==x.IsTouching())){var p=x.m_fixtureA.m_isSensor,m=x.m_fixtureB.m_isSensor;if(!p&&!m)e.AddContact(x),x.m_flags|=box2d.b2ContactFlag.e_islandFlag,(_=l.other).m_flags&box2d.b2BodyFlag.e_islandFlag||(box2d.ENABLE_ASSERTS&&box2d.b2Assert(d<r),(b[d++]=_).m_flags|=box2d.b2BodyFlag.e_islandFlag)}}for(var h=i.m_jointList;h;h=h.next){var _;if(!0!==h.joint.m_islandFlag)!1!==(_=h.other).IsActive()&&(e.AddJoint(h.joint),h.joint.m_islandFlag=!0,_.m_flags&box2d.b2BodyFlag.e_islandFlag||(box2d.ENABLE_ASSERTS&&box2d.b2Assert(d<r),(b[d++]=_).m_flags|=box2d.b2BodyFlag.e_islandFlag))}}}var c=new box2d.b2Profile;e.Solve(c,o,this.m_gravity,this.m_allowSleep),this.m_profile.solveInit+=c.solveInit,this.m_profile.solveVelocity+=c.solveVelocity,this.m_profile.solvePosition+=c.solvePosition;for(var y=0;y<e.m_bodyCount;++y){(i=e.m_bodies[y]).GetType()===box2d.b2BodyType.b2_staticBody&&(i.m_flags&=~box2d.b2BodyFlag.e_islandFlag)}}for(y=0;y<b.length&&b[y];++y)b[y]=null;var u=new box2d.b2Timer;for(i=this.m_bodyList;i;i=i.m_next)0!=(i.m_flags&box2d.b2BodyFlag.e_islandFlag)&&i.GetType()!==box2d.b2BodyType.b2_staticBody&&i.SynchronizeFixtures();this.m_contactManager.FindNewContacts(),this.m_profile.broadphase=u.GetMilliseconds()},box2d.b2World.prototype.SolveTOI=function(o){var t=this.m_island;if(t.Initialize(2*box2d.b2_maxTOIContacts,box2d.b2_maxTOIContacts,0,null,this.m_contactManager.m_contactListener),this.m_stepComplete){for(var e=this.m_bodyList;e;e=e.m_next)e.m_flags&=~box2d.b2BodyFlag.e_islandFlag,e.m_sweep.alpha0=0;for(var i=this.m_contactManager.m_contactList;i;i=i.m_next)i.m_flags&=~(box2d.b2ContactFlag.e_toiFlag|box2d.b2ContactFlag.e_islandFlag),i.m_toiCount=0,i.m_toi=1}for(;;){var n=null,s=1;for(i=this.m_contactManager.m_contactList;i;i=i.m_next)if(!1!==i.IsEnabled()&&!(i.m_toiCount>box2d.b2_maxSubSteps)){var r=1;if(i.m_flags&box2d.b2ContactFlag.e_toiFlag)r=i.m_toi;else{var b=i.GetFixtureA(),a=i.GetFixtureB();if(b.IsSensor()||a.IsSensor())continue;var d=b.GetBody(),l=a.GetBody(),x=d.m_type,p=l.m_type;box2d.ENABLE_ASSERTS&&box2d.b2Assert(x===box2d.b2BodyType.b2_dynamicBody||p===box2d.b2BodyType.b2_dynamicBody);var m=d.IsAwake()&&x!==box2d.b2BodyType.b2_staticBody,h=l.IsAwake()&&p!==box2d.b2BodyType.b2_staticBody;if(!1===m&&!1===h)continue;var _=d.IsBullet()||x!==box2d.b2BodyType.b2_dynamicBody,c=l.IsBullet()||p!==box2d.b2BodyType.b2_dynamicBody;if(!1===_&&!1===c)continue;var y=d.m_sweep.alpha0;d.m_sweep.alpha0<l.m_sweep.alpha0?(y=l.m_sweep.alpha0,d.m_sweep.Advance(y)):l.m_sweep.alpha0<d.m_sweep.alpha0&&(y=d.m_sweep.alpha0,l.m_sweep.Advance(y)),box2d.ENABLE_ASSERTS&&box2d.b2Assert(y<1);var u=i.GetChildIndexA(),g=i.GetChildIndexB(),f=box2d.b2World.prototype.SolveTOI.s_toi_input;f.proxyA.SetShape(b.GetShape(),u),f.proxyB.SetShape(a.GetShape(),g),f.sweepA.Copy(d.m_sweep),f.sweepB.Copy(l.m_sweep),f.tMax=1;var S=box2d.b2World.prototype.SolveTOI.s_toi_output;box2d.b2TimeOfImpact(S,f);var A=S.t;r=S.state===box2d.b2TOIOutputState.e_touching?box2d.b2Min(y+(1-y)*A,1):1,i.m_toi=r,i.m_flags|=box2d.b2ContactFlag.e_toiFlag}r<s&&(n=i,s=r)}if(null===n||1-10*box2d.b2_epsilon<s){this.m_stepComplete=!0;break}b=n.GetFixtureA(),a=n.GetFixtureB(),d=b.GetBody(),l=a.GetBody();var C=box2d.b2World.prototype.SolveTOI.s_backup1.Copy(d.m_sweep),v=box2d.b2World.prototype.SolveTOI.s_backup2.Copy(l.m_sweep);if(d.Advance(s),l.Advance(s),n.Update(this.m_contactManager.m_contactListener),n.m_flags&=~box2d.b2ContactFlag.e_toiFlag,++n.m_toiCount,!1!==n.IsEnabled()&&!1!==n.IsTouching()){d.SetAwake(!0),l.SetAwake(!0),t.Clear(),t.AddBody(d),t.AddBody(l),t.AddContact(n),d.m_flags|=box2d.b2BodyFlag.e_islandFlag,l.m_flags|=box2d.b2BodyFlag.e_islandFlag,n.m_flags|=box2d.b2ContactFlag.e_islandFlag;for(var V=0;V<2;++V){if((R=0===V?d:l).m_type===box2d.b2BodyType.b2_dynamicBody)for(var B=R.m_contactList;B&&t.m_bodyCount!==t.m_bodyCapacity&&t.m_contactCount!==t.m_contactCapacity;B=B.next){var w=B.contact;if(!(w.m_flags&box2d.b2ContactFlag.e_islandFlag)){var P=B.other;if(P.m_type!==box2d.b2BodyType.b2_dynamicBody||!1!==R.IsBullet()||!1!==P.IsBullet()){var M=w.m_fixtureA.m_isSensor,D=w.m_fixtureB.m_isSensor;if(!M&&!D){var J=box2d.b2World.prototype.SolveTOI.s_backup.Copy(P.m_sweep);0==(P.m_flags&box2d.b2BodyFlag.e_islandFlag)&&P.Advance(s),w.Update(this.m_contactManager.m_contactListener),!1!==w.IsEnabled()&&!1!==w.IsTouching()?(w.m_flags|=box2d.b2ContactFlag.e_islandFlag,t.AddContact(w),P.m_flags&box2d.b2BodyFlag.e_islandFlag||(P.m_flags|=box2d.b2BodyFlag.e_islandFlag,P.m_type!==box2d.b2BodyType.b2_staticBody&&P.SetAwake(!0),t.AddBody(P))):(P.m_sweep.Copy(J),P.SynchronizeTransform())}}}}}var T=box2d.b2World.prototype.SolveTOI.s_subStep;T.dt=(1-s)*o.dt,T.inv_dt=1/T.dt,T.dtRatio=1,T.positionIterations=20,T.velocityIterations=o.velocityIterations,T.warmStarting=!1,t.SolveTOI(T,d.m_islandIndex,l.m_islandIndex);for(V=0;V<t.m_bodyCount;++V){var R;if((R=t.m_bodies[V]).m_flags&=~box2d.b2BodyFlag.e_islandFlag,R.m_type===box2d.b2BodyType.b2_dynamicBody){R.SynchronizeFixtures();for(B=R.m_contactList;B;B=B.next)B.contact.m_flags&=~(box2d.b2ContactFlag.e_toiFlag|box2d.b2ContactFlag.e_islandFlag)}}if(this.m_contactManager.FindNewContacts(),this.m_subStepping){this.m_stepComplete=!1;break}}else n.SetEnabled(!1),d.m_sweep.Copy(C),l.m_sweep.Copy(v),d.SynchronizeTransform(),l.SynchronizeTransform()}},box2d.b2World.prototype.SolveTOI.s_subStep=new box2d.b2TimeStep,box2d.b2World.prototype.SolveTOI.s_backup=new box2d.b2Sweep,box2d.b2World.prototype.SolveTOI.s_backup1=new box2d.b2Sweep,box2d.b2World.prototype.SolveTOI.s_backup2=new box2d.b2Sweep,box2d.b2World.prototype.SolveTOI.s_toi_input=new box2d.b2TOIInput,box2d.b2World.prototype.SolveTOI.s_toi_output=new box2d.b2TOIOutput,box2d.b2World.prototype.Step=function(o,t,e){var i=new box2d.b2Timer;this.m_flags&box2d.b2WorldFlag.e_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_flags&=~box2d.b2WorldFlag.e_newFixture),this.m_flags|=box2d.b2WorldFlag.e_locked;var n=box2d.b2World.prototype.Step.s_step;n.dt=o,n.velocityIterations=t,n.positionIterations=e,n.inv_dt=0<o?1/o:0,n.dtRatio=this.m_inv_dt0*o,n.warmStarting=this.m_warmStarting;var s=new box2d.b2Timer;if(this.m_contactManager.Collide(),this.m_profile.collide=s.GetMilliseconds(),this.m_stepComplete&&0<n.dt){s=new box2d.b2Timer;this.Solve(n),this.m_profile.solve=s.GetMilliseconds()}if(this.m_continuousPhysics&&0<n.dt){s=new box2d.b2Timer;this.SolveTOI(n),this.m_profile.solveTOI=s.GetMilliseconds()}0<n.dt&&(this.m_inv_dt0=n.inv_dt),this.m_flags&box2d.b2WorldFlag.e_clearForces&&this.ClearForces(),this.m_flags&=~box2d.b2WorldFlag.e_locked,this.m_profile.step=i.GetMilliseconds()},box2d.b2World.prototype.Step.s_step=new box2d.b2TimeStep,box2d.b2World.prototype.ClearForces=function(){for(var o=this.m_bodyList;o;o=o.m_next)o.m_force.SetZero(),o.m_torque=0},box2d.b2World.prototype.QueryAABB=function(i,o){var n=this.m_contactManager.m_broadPhase;n.Query(function(o){var t=n.GetUserData(o);box2d.ENABLE_ASSERTS&&box2d.b2Assert(t instanceof box2d.b2FixtureProxy);var e=t.fixture;t.childIndex;return i instanceof box2d.b2QueryCallback?i.ReportFixture(e):i(e)},o)},box2d.b2World.prototype.QueryShape=function(i,n,s){var r=this.m_contactManager.m_broadPhase,o=box2d.b2World.prototype.QueryShape.s_aabb;n.ComputeAABB(o,s,0),r.Query(function(o){var t=r.GetUserData(o);box2d.ENABLE_ASSERTS&&box2d.b2Assert(t instanceof box2d.b2FixtureProxy);var e=t.fixture;t.childIndex;return!box2d.b2TestOverlapShape(n,0,e.GetShape(),0,s,e.GetBody().GetTransform())||(i instanceof box2d.b2QueryCallback?i.ReportFixture(e):i(e))},o)},box2d.b2World.prototype.QueryShape.s_aabb=new box2d.b2AABB,box2d.b2World.prototype.QueryPoint=function(i,n){var s=this.m_contactManager.m_broadPhase,o=box2d.b2World.prototype.QueryPoint.s_aabb;o.lowerBound.SetXY(n.x-box2d.b2_linearSlop,n.y-box2d.b2_linearSlop),o.upperBound.SetXY(n.x+box2d.b2_linearSlop,n.y+box2d.b2_linearSlop),s.Query(function(o){var t=s.GetUserData(o);box2d.ENABLE_ASSERTS&&box2d.b2Assert(t instanceof box2d.b2FixtureProxy);var e=t.fixture;t.childIndex;return!e.TestPoint(n)||(i instanceof box2d.b2QueryCallback?i.ReportFixture(e):i(e))},o)},box2d.b2World.prototype.QueryPoint.s_aabb=new box2d.b2AABB,box2d.b2World.prototype.RayCast=function(a,d,l){var x=this.m_contactManager.m_broadPhase,o=box2d.b2World.prototype.RayCast.s_input;o.maxFraction=1,o.p1.Copy(d),o.p2.Copy(l),x.RayCast(function(o,t){var e=x.GetUserData(t);box2d.ENABLE_ASSERTS&&box2d.b2Assert(e instanceof box2d.b2FixtureProxy);var i=e.fixture,n=e.childIndex,s=box2d.b2World.prototype.RayCast.s_output;if(i.RayCast(s,o,n)){var r=s.fraction,b=box2d.b2World.prototype.RayCast.s_point;return b.SetXY((1-r)*d.x+r*l.x,(1-r)*d.y+r*l.y),a instanceof box2d.b2RayCastCallback?a.ReportFixture(i,b,s.normal,r):a(i,b,s.normal,r)}return o.maxFraction},o)},box2d.b2World.prototype.RayCast.s_input=new box2d.b2RayCastInput,box2d.b2World.prototype.RayCast.s_output=new box2d.b2RayCastOutput,box2d.b2World.prototype.RayCast.s_point=new box2d.b2Vec2,box2d.b2World.prototype.RayCastOne=function(o,t){var n=null,s=1;return this.RayCast(function(o,t,e,i){return i<s&&(s=i,n=o),s},o,t),n},box2d.b2World.prototype.RayCastAll=function(o,t,n){return n.length=0,this.RayCast(function(o,t,e,i){return n.push(o),1},o,t),n},box2d.b2World.prototype.DrawShape=function(o,t){var e=o.GetShape();switch(e.m_type){case box2d.b2ShapeType.e_circleShape:var i=e instanceof box2d.b2CircleShape?e:null,n=i.m_p,s=i.m_radius,r=box2d.b2Vec2.UNITX;this.m_debugDraw.DrawSolidCircle(n,s,r,t);break;case box2d.b2ShapeType.e_edgeShape:var b=e instanceof box2d.b2EdgeShape?e:null,a=b.m_vertex1,d=b.m_vertex2;this.m_debugDraw.DrawSegment(a,d,t);break;case box2d.b2ShapeType.e_chainShape:for(var l=e instanceof box2d.b2ChainShape?e:null,x=l.m_count,p=(a=(_=l.m_vertices)[0],0);p<x;++p){d=_[p];this.m_debugDraw.DrawSegment(a,d,t),this.m_debugDraw.DrawCircle(d,.05,t),a=d}break;case box2d.b2ShapeType.e_polygonShape:var m=e instanceof box2d.b2PolygonShape?e:null,h=m.m_count,_=m.m_vertices;this.m_debugDraw.DrawSolidPolygon(_,h,t)}},box2d.b2World.prototype.DrawJoint=function(o){var t=o.GetBodyA(),e=o.GetBodyB(),i=t.m_xf,n=e.m_xf,s=i.p,r=n.p,b=o.GetAnchorA(box2d.b2World.prototype.DrawJoint.s_p1),a=o.GetAnchorB(box2d.b2World.prototype.DrawJoint.s_p2),d=box2d.b2World.prototype.DrawJoint.s_color.SetRGB(.5,.8,.8);switch(o.m_type){case box2d.b2JointType.e_distanceJoint:this.m_debugDraw.DrawSegment(b,a,d);break;case box2d.b2JointType.e_pulleyJoint:var l=o instanceof box2d.b2PulleyJoint?o:null,x=l.GetGroundAnchorA(box2d.b2World.prototype.DrawJoint.s_s1),p=l.GetGroundAnchorB(box2d.b2World.prototype.DrawJoint.s_s2);this.m_debugDraw.DrawSegment(x,b,d),this.m_debugDraw.DrawSegment(p,a,d),this.m_debugDraw.DrawSegment(x,p,d);break;case box2d.b2JointType.e_mouseJoint:this.m_debugDraw.DrawSegment(b,a,d);break;default:this.m_debugDraw.DrawSegment(s,b,d),this.m_debugDraw.DrawSegment(b,a,d),this.m_debugDraw.DrawSegment(r,a,d)}},box2d.b2World.prototype.DrawJoint.s_p1=new box2d.b2Vec2,box2d.b2World.prototype.DrawJoint.s_p2=new box2d.b2Vec2,box2d.b2World.prototype.DrawJoint.s_color=new box2d.b2Color(.5,.8,.8),box2d.b2World.prototype.DrawJoint.s_s1=new box2d.b2Vec2,box2d.b2World.prototype.DrawJoint.s_s2=new box2d.b2Vec2,box2d.b2World.prototype.DrawDebugData=function(){if(null!==this.m_debugDraw){var o=this.m_debugDraw.GetFlags(),t=box2d.b2World.prototype.DrawDebugData.s_color.SetRGB(0,0,0);if(o&box2d.b2DrawFlags.e_shapeBit)for(var e=this.m_bodyList;e;e=e.m_next){var i=e.m_xf;this.m_debugDraw.PushTransform(i);for(var n=e.GetFixtureList();n;n=n.m_next)!1===e.IsActive()?t.SetRGB(.5,.5,.3):e.GetType()===box2d.b2BodyType.b2_staticBody?t.SetRGB(.5,.9,.5):e.GetType()===box2d.b2BodyType.b2_kinematicBody?t.SetRGB(.5,.5,.9):!1===e.IsAwake()?t.SetRGB(.6,.6,.6):t.SetRGB(.9,.7,.7),this.DrawShape(n,t);this.m_debugDraw.PopTransform(i)}if(o&box2d.b2DrawFlags.e_jointBit)for(var s=this.m_jointList;s;s=s.m_next)this.DrawJoint(s);if(o&box2d.b2DrawFlags.e_aabbBit){t.SetRGB(.9,.3,.9);var r=this.m_contactManager.m_broadPhase,b=box2d.b2World.prototype.DrawDebugData.s_vs;for(e=this.m_bodyList;e;e=e.m_next)if(!1!==e.IsActive())for(n=e.GetFixtureList();n;n=n.m_next)for(var a=0;a<n.m_proxyCount;++a){var d=n.m_proxies[a],l=r.GetFatAABB(d.proxy);b[0].SetXY(l.lowerBound.x,l.lowerBound.y),b[1].SetXY(l.upperBound.x,l.lowerBound.y),b[2].SetXY(l.upperBound.x,l.upperBound.y),b[3].SetXY(l.lowerBound.x,l.upperBound.y),this.m_debugDraw.DrawPolygon(b,4,t)}}if(o&box2d.b2DrawFlags.e_centerOfMassBit)for(e=this.m_bodyList;e;e=e.m_next){(i=box2d.b2World.prototype.DrawDebugData.s_xf).q.Copy(e.m_xf.q),i.p.Copy(e.GetWorldCenter()),this.m_debugDraw.DrawTransform(i)}if(o&box2d.b2DrawFlags.e_controllerBit)for(var x=this.m_controllerList;x;x=x.m_next)x.Draw(this.m_debugDraw)}},box2d.b2World.prototype.DrawDebugData.s_color=new box2d.b2Color(0,0,0),box2d.b2World.prototype.DrawDebugData.s_vs=box2d.b2Vec2.MakeArray(4),box2d.b2World.prototype.DrawDebugData.s_xf=new box2d.b2Transform,box2d.b2World.prototype.SetBroadPhase=function(o){var t=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=o;for(var e=this.m_bodyList;e;e=e.m_next)for(var i=e.m_fixtureList;i;i=i.m_next)i.m_proxy=o.CreateProxy(t.GetFatAABB(i.m_proxy),i)},box2d.b2World.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()},box2d.b2World.prototype.GetTreeHeight=function(){return this.m_contactManager.m_broadPhase.GetTreeHeight()},box2d.b2World.prototype.GetTreeBalance=function(){return this.m_contactManager.m_broadPhase.GetTreeBalance()},box2d.b2World.prototype.GetTreeQuality=function(){return this.m_contactManager.m_broadPhase.GetTreeQuality()},box2d.b2World.prototype.ShiftOrigin=function(o){if(box2d.ENABLE_ASSERTS&&box2d.b2Assert(!1===this.IsLocked()),!this.IsLocked()){for(var t=this.m_bodyList;t;t=t.m_next)t.m_xf.p.SelfSub(o),t.m_sweep.c0.SelfSub(o),t.m_sweep.c.SelfSub(o);for(var e=this.m_jointList;e;e=e.m_next)e.ShiftOrigin(o);this.m_contactManager.m_broadPhase.ShiftOrigin(o)}},box2d.b2World.prototype.Dump=function(){if(box2d.DEBUG){if((this.m_flags&box2d.b2WorldFlag.e_locked)===box2d.b2WorldFlag.e_locked)return;box2d.b2Log("/** @type {box2d.b2Vec2} */ var g = new box2d.b2Vec2(%.15f, %.15f);\n",this.m_gravity.x,this.m_gravity.y),box2d.b2Log("this.m_world.SetGravity(g);\n"),box2d.b2Log("/** @type {Array.<box2d.b2Body>} */ var bodies = new Array(%d);\n",this.m_bodyCount),box2d.b2Log("/** @type {Array.<box2d.b2Joint>} */ var joints = new Array(%d);\n",this.m_jointCount);for(var o=0,t=this.m_bodyList;t;t=t.m_next)t.m_islandIndex=o,t.Dump(),++o;o=0;for(var e=this.m_jointList;e;e=e.m_next)e.m_index=o,++o;for(e=this.m_jointList;e;e=e.m_next)e.m_type!==box2d.b2JointType.e_gearJoint&&(box2d.b2Log("if (true)\n"),box2d.b2Log("{\n"),e.Dump(),box2d.b2Log("}\n"));for(e=this.m_jointList;e;e=e.m_next)e.m_type===box2d.b2JointType.e_gearJoint&&(box2d.b2Log("if (true)\n"),box2d.b2Log("{\n"),e.Dump(),box2d.b2Log("}\n"))}},box2d.b2World.prototype.AddController=function(o){return box2d.ENABLE_ASSERTS&&box2d.b2Assert(null===o.m_world,"Controller can only be a member of one world"),o.m_world=this,o.m_next=this.m_controllerList,o.m_prev=null,this.m_controllerList&&(this.m_controllerList.m_prev=o),this.m_controllerList=o,++this.m_controllerCount,o},box2d.b2World.prototype.RemoveController=function(o){box2d.ENABLE_ASSERTS&&box2d.b2Assert(o.m_world===this,"Controller is not a member of this world"),o.m_prev&&(o.m_prev.m_next=o.m_next),o.m_next&&(o.m_next.m_prev=o.m_prev),this.m_controllerList===o&&(this.m_controllerList=o.m_next),--this.m_controllerCount,o.m_prev=null,o.m_next=null,o.m_world=null},goog.provide("box2d.b2AreaJoint"),goog.require("box2d.b2Settings"),goog.require("box2d.b2Joint"),goog.require("box2d.b2Math"),box2d.b2AreaJointDef=function(){goog.base(this,box2d.b2JointType.e_areaJoint),this.bodies=new Array},goog.inherits(box2d.b2AreaJointDef,box2d.b2JointDef),box2d.b2AreaJointDef.prototype.world=null,box2d.b2AreaJointDef.prototype.bodies=null,box2d.b2AreaJointDef.prototype.frequencyHz=0,box2d.b2AreaJointDef.prototype.dampingRatio=0,box2d.b2AreaJointDef.prototype.AddBody=function(o){this.bodies.push(o),1===this.bodies.length?this.bodyA=o:2===this.bodies.length&&(this.bodyB=o)},box2d.b2AreaJoint=function(o){goog.base(this,o),box2d.ENABLE_ASSERTS&&box2d.b2Assert(3<=o.bodies.length,"You cannot create an area joint with less than three bodies."),this.m_bodies=o.bodies,this.m_frequencyHz=o.frequencyHz,this.m_dampingRatio=o.dampingRatio,this.m_targetLengths=box2d.b2MakeNumberArray(o.bodies.length),this.m_normals=box2d.b2Vec2.MakeArray(o.bodies.length),this.m_joints=new Array(o.bodies.length),this.m_deltas=box2d.b2Vec2.MakeArray(o.bodies.length),this.m_delta=new box2d.b2Vec2;var t=new box2d.b2DistanceJointDef;t.frequencyHz=o.frequencyHz,t.dampingRatio=o.dampingRatio;for(var e=this.m_targetArea=0,i=this.m_bodies.length;e<i;++e){var n=this.m_bodies[e],s=this.m_bodies[(e+1)%i],r=n.GetWorldCenter(),b=s.GetWorldCenter();this.m_targetLengths[e]=box2d.b2DistanceVV(r,b),this.m_targetArea+=box2d.b2CrossVV(r,b),t.Initialize(n,s,r,b),this.m_joints[e]=o.world.CreateJoint(t)}this.m_targetArea*=.5},goog.inherits(box2d.b2AreaJoint,box2d.b2Joint),box2d.b2AreaJoint.prototype.m_bodies=null,box2d.b2AreaJoint.prototype.m_frequencyHz=0,box2d.b2AreaJoint.prototype.m_dampingRatio=0,box2d.b2AreaJoint.prototype.m_impulse=0,box2d.b2AreaJoint.prototype.m_targetLengths=null,box2d.b2AreaJoint.prototype.m_targetArea=0,box2d.b2AreaJoint.prototype.m_normals=null,box2d.b2AreaJoint.prototype.m_joints=null,box2d.b2AreaJoint.prototype.m_deltas=null,box2d.b2AreaJoint.prototype.m_delta=null,box2d.b2AreaJoint.prototype.GetAnchorA=function(o){return o.SetZero()},box2d.b2AreaJoint.prototype.GetAnchorB=function(o){return o.SetZero()},box2d.b2AreaJoint.prototype.GetReactionForce=function(o,t){return t.SetZero()},box2d.b2AreaJoint.prototype.GetReactionTorque=function(o){return 0},box2d.b2AreaJoint.prototype.SetFrequency=function(o){this.m_frequencyHz=o;for(var t=0,e=this.m_joints.length;t<e;++t)this.m_joints[t].SetFrequency(o)},box2d.b2AreaJoint.prototype.GetFrequency=function(){return this.m_frequencyHz},box2d.b2AreaJoint.prototype.SetDampingRatio=function(o){this.m_dampingRatio=o;for(var t=0,e=this.m_joints.length;t<e;++t)this.m_joints[t].SetDampingRatio(o)},box2d.b2AreaJoint.prototype.GetDampingRatio=function(){return this.m_dampingRatio},box2d.b2AreaJoint.prototype.Dump=function(){box2d.DEBUG&&box2d.b2Log("Area joint dumping is not supported.\n")},box2d.b2AreaJoint.prototype.InitVelocityConstraints=function(o){for(var t=0,e=this.m_bodies.length;t<e;++t){var i=this.m_bodies[(t+e-1)%e],n=this.m_bodies[(t+1)%e],s=o.positions[i.m_islandIndex].c,r=o.positions[n.m_islandIndex].c,b=this.m_deltas[t];box2d.b2SubVV(r,s,b)}if(o.step.warmStarting){this.m_impulse*=o.step.dtRatio;for(t=0,e=this.m_bodies.length;t<e;++t){var a=this.m_bodies[t],d=o.velocities[a.m_islandIndex].v;b=this.m_deltas[t];d.x+=a.m_invMass*b.y*.5*this.m_impulse,d.y+=a.m_invMass*-b.x*.5*this.m_impulse}}else this.m_impulse=0},box2d.b2AreaJoint.prototype.SolveVelocityConstraints=function(o){for(var t=0,e=0,i=0,n=this.m_bodies.length;i<n;++i){var s=this.m_bodies[i],r=o.velocities[s.m_islandIndex].v;t+=(a=this.m_deltas[i]).GetLengthSquared()/s.GetMass(),e+=box2d.b2CrossVV(r,a)}var b=-2*e/t;this.m_impulse+=b;for(i=0,n=this.m_bodies.length;i<n;++i){s=this.m_bodies[i],r=o.velocities[s.m_islandIndex].v;var a=this.m_deltas[i];r.x+=s.m_invMass*a.y*.5*b,r.y+=s.m_invMass*-a.x*.5*b}},box2d.b2AreaJoint.prototype.SolvePositionConstraints=function(o){for(var t=0,e=0,i=0,n=this.m_bodies.length;i<n;++i){var s=this.m_bodies[i],r=this.m_bodies[(i+1)%n],b=o.positions[s.m_islandIndex].c,a=o.positions[r.m_islandIndex].c,d=(p=box2d.b2SubVV(a,b,this.m_delta)).GetLength();d<box2d.b2_epsilon&&(d=1),this.m_normals[i].x=p.y/d,this.m_normals[i].y=-p.x/d,t+=d,e+=box2d.b2CrossVV(b,a)}e*=.5;var l=.5*(this.m_targetArea-e)/t,x=!0;for(i=0,n=this.m_bodies.length;i<n;++i){s=this.m_bodies[i],b=o.positions[s.m_islandIndex].c;var p,m=(i+1)%n;(p=box2d.b2AddVV(this.m_normals[i],this.m_normals[m],this.m_delta)).SelfMul(l);var h=p.GetLengthSquared();h>box2d.b2Sq(box2d.b2_maxLinearCorrection)&&p.SelfMul(box2d.b2_maxLinearCorrection/box2d.b2Sqrt(h)),h>box2d.b2Sq(box2d.b2_linearSlop)&&(x=!1),b.x+=p.x,b.y+=p.y}return x},goog.provide("box2d.b2BuoyancyController"),goog.require("box2d.b2Settings"),goog.require("box2d.b2Controller"),goog.require("box2d.b2Math"),goog.require("box2d.b2WorldCallbacks"),box2d.b2BuoyancyController=function(){goog.base(this),this.normal=new box2d.b2Vec2(0,1),this.velocity=new box2d.b2Vec2(0,0),this.gravity=new box2d.b2Vec2(0,0)},goog.inherits(box2d.b2BuoyancyController,box2d.b2Controller),box2d.b2BuoyancyController.prototype.normal=null,box2d.b2BuoyancyController.prototype.offset=0,box2d.b2BuoyancyController.prototype.density=0,box2d.b2BuoyancyController.prototype.velocity=null,box2d.b2BuoyancyController.prototype.linearDrag=0,box2d.b2BuoyancyController.prototype.angularDrag=0,box2d.b2BuoyancyController.prototype.useDensity=!1,box2d.b2BuoyancyController.prototype.useWorldGravity=!0,box2d.b2BuoyancyController.prototype.gravity=null,box2d.b2BuoyancyController.prototype.Step=function(o){if(this.m_bodyList){this.useWorldGravity&&this.gravity.Copy(this.GetWorld().GetGravity());for(var t=this.m_bodyList;t;t=t.nextBody){var e=t.body;if(!1!==e.IsAwake()){for(var i=new box2d.b2Vec2,n=new box2d.b2Vec2,s=0,r=0,b=e.GetFixtureList();b;b=b.m_next){var a=new box2d.b2Vec2,d=b.GetShape().ComputeSubmergedArea(this.normal,this.offset,e.GetTransform(),a);s+=d,i.x+=d*a.x,i.y+=d*a.y;var l=0;r+=d*(l=this.useDensity?b.GetDensity():1),n.x+=d*a.x*l,n.y+=d*a.y*l}if(i.x/=s,i.y/=s,n.x/=r,n.y/=r,!(s<box2d.b2_epsilon)){var x=box2d.b2NegV(this.gravity,new box2d.b2Vec2);x.SelfMul(this.density*s),e.ApplyForce(x,n);var p=e.GetLinearVelocityFromWorldPoint(i,new box2d.b2Vec2);p.SelfSub(this.velocity),p.SelfMul(-this.linearDrag*s),e.ApplyForce(p,i),e.ApplyTorque(-e.GetInertia()/e.GetMass()*s*e.GetAngularVelocity()*this.angularDrag)}}}}},box2d.b2BuoyancyController.prototype.Draw=function(o){var t=new box2d.b2Vec2,e=new box2d.b2Vec2;t.x=this.normal.x*this.offset+100*this.normal.y,t.y=this.normal.y*this.offset-100*this.normal.x,e.x=this.normal.x*this.offset-100*this.normal.y,e.y=this.normal.y*this.offset+100*this.normal.x;var i=new box2d.b2Color(0,0,.8);o.DrawSegment(t,e,i)},goog.provide("box2d.b2TensorDampingController"),goog.require("box2d.b2Settings"),goog.require("box2d.b2Controller"),goog.require("box2d.b2Math"),box2d.b2TensorDampingController=function(){goog.base(this),this.T=new box2d.b2Mat22,this.maxTimestep=0},goog.inherits(box2d.b2TensorDampingController,box2d.b2Controller),box2d.b2TensorDampingController.prototype.T=new box2d.b2Mat22,box2d.b2TensorDampingController.prototype.maxTimestep=0,box2d.b2TensorDampingController.prototype.Step=function(o){var t=o.dt;if(!(t<=box2d.b2_epsilon)){t>this.maxTimestep&&0<this.maxTimestep&&(t=this.maxTimestep);for(var e=this.m_bodyList;e;e=e.nextBody){var i=e.body;if(i.IsAwake()){var n=i.GetWorldVector(box2d.b2MulMV(this.T,i.GetLocalVector(i.GetLinearVelocity(),box2d.b2Vec2.s_t0),box2d.b2Vec2.s_t1),box2d.b2TensorDampingController.prototype.Step.s_damping);i.SetLinearVelocity(box2d.b2AddVV(i.GetLinearVelocity(),box2d.b2MulSV(t,n,box2d.b2Vec2.s_t0),box2d.b2Vec2.s_t1))}}}},box2d.b2TensorDampingController.prototype.Step.s_damping=new box2d.b2Vec2,box2d.b2TensorDampingController.prototype.SetAxisAligned=function(o,t){this.T.ex.x=-o,this.T.ex.y=0,this.T.ey.x=0,this.T.ey.y=-t,this.maxTimestep=0<o||0<t?1/box2d.b2Max(o,t):0},goog.provide("box2d.b2DistanceJoint"),goog.require("box2d.b2Settings"),goog.require("box2d.b2Joint"),goog.require("box2d.b2Math"),box2d.b2DistanceJointDef=function(){goog.base(this,box2d.b2JointType.e_distanceJoint),this.localAnchorA=new box2d.b2Vec2,this.localAnchorB=new box2d.b2Vec2},goog.inherits(box2d.b2DistanceJointDef,box2d.b2JointDef),box2d.b2DistanceJointDef.prototype.localAnchorA=null,box2d.b2DistanceJointDef.prototype.localAnchorB=null,box2d.b2DistanceJointDef.prototype.length=1,box2d.b2DistanceJointDef.prototype.frequencyHz=0,box2d.b2DistanceJointDef.prototype.dampingRatio=0,box2d.b2DistanceJointDef.prototype.Initialize=function(o,t,e,i){this.bodyA=o,this.bodyB=t,this.bodyA.GetLocalPoint(e,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.length=box2d.b2DistanceVV(e,i),this.frequencyHz=0,this.dampingRatio=0},box2d.b2DistanceJoint=function(o){goog.base(this,o),this.m_u=new box2d.b2Vec2,this.m_rA=new box2d.b2Vec2,this.m_rB=new box2d.b2Vec2,this.m_localCenterA=new box2d.b2Vec2,this.m_localCenterB=new box2d.b2Vec2,this.m_qA=new box2d.b2Rot,this.m_qB=new box2d.b2Rot,this.m_lalcA=new box2d.b2Vec2,this.m_lalcB=new box2d.b2Vec2,this.m_frequencyHz=o.frequencyHz,this.m_dampingRatio=o.dampingRatio,this.m_localAnchorA=o.localAnchorA.Clone(),this.m_localAnchorB=o.localAnchorB.Clone(),this.m_length=o.length},goog.inherits(box2d.b2DistanceJoint,box2d.b2Joint),box2d.b2DistanceJoint.prototype.m_frequencyHz=0,box2d.b2DistanceJoint.prototype.m_dampingRatio=0,box2d.b2DistanceJoint.prototype.m_bias=0,box2d.b2DistanceJoint.prototype.m_localAnchorA=null,box2d.b2DistanceJoint.prototype.m_localAnchorB=null,box2d.b2DistanceJoint.prototype.m_gamma=0,box2d.b2DistanceJoint.prototype.m_impulse=0,box2d.b2DistanceJoint.prototype.m_length=0,box2d.b2DistanceJoint.prototype.m_indexA=0,box2d.b2DistanceJoint.prototype.m_indexB=0,box2d.b2DistanceJoint.prototype.m_u=null,box2d.b2DistanceJoint.prototype.m_rA=null,box2d.b2DistanceJoint.prototype.m_rB=null,box2d.b2DistanceJoint.prototype.m_localCenterA=null,box2d.b2DistanceJoint.prototype.m_localCenterB=null,box2d.b2DistanceJoint.prototype.m_invMassA=0,box2d.b2DistanceJoint.prototype.m_invMassB=0,box2d.b2DistanceJoint.prototype.m_invIA=0,box2d.b2DistanceJoint.prototype.m_invIB=0,box2d.b2DistanceJoint.prototype.m_mass=0,box2d.b2DistanceJoint.prototype.m_qA=null,box2d.b2DistanceJoint.prototype.m_qB=null,box2d.b2DistanceJoint.prototype.m_lalcA=null,box2d.b2DistanceJoint.prototype.m_lalcB=null,box2d.b2DistanceJoint.prototype.GetAnchorA=function(o){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,o)},box2d.b2DistanceJoint.prototype.GetAnchorB=function(o){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,o)},box2d.b2DistanceJoint.prototype.GetReactionForce=function(o,t){return t.SetXY(o*this.m_impulse*this.m_u.x,o*this.m_impulse*this.m_u.y)},box2d.b2DistanceJoint.prototype.GetReactionTorque=function(o){return 0},box2d.b2DistanceJoint.prototype.GetLocalAnchorA=function(o){return o.Copy(this.m_localAnchorA)},box2d.b2DistanceJoint.prototype.GetLocalAnchorB=function(o){return o.Copy(this.m_localAnchorB)},box2d.b2DistanceJoint.prototype.SetLength=function(o){this.m_length=o},box2d.b2DistanceJoint.prototype.GetLength=function(){return this.m_length},box2d.b2DistanceJoint.prototype.SetFrequency=function(o){this.m_frequencyHz=o},box2d.b2DistanceJoint.prototype.GetFrequency=function(){return this.m_frequencyHz},box2d.b2DistanceJoint.prototype.SetDampingRatio=function(o){this.m_dampingRatio=o},box2d.b2DistanceJoint.prototype.GetDampingRatio=function(){return this.m_dampingRatio},box2d.b2DistanceJoint.prototype.Dump=function(){if(box2d.DEBUG){var o=this.m_bodyA.m_islandIndex,t=this.m_bodyB.m_islandIndex;box2d.b2Log("  /*box2d.b2DistanceJointDef*/ var jd = new box2d.b2DistanceJointDef();\n"),box2d.b2Log("  jd.bodyA = bodies[%d];\n",o),box2d.b2Log("  jd.bodyB = bodies[%d];\n",t),box2d.b2Log("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),box2d.b2Log("  jd.localAnchorA.SetXY(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),box2d.b2Log("  jd.localAnchorB.SetXY(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),box2d.b2Log("  jd.length = %.15f;\n",this.m_length),box2d.b2Log("  jd.frequencyHz = %.15f;\n",this.m_frequencyHz),box2d.b2Log("  jd.dampingRatio = %.15f;\n",this.m_dampingRatio),box2d.b2Log("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}},box2d.b2DistanceJoint.prototype.InitVelocityConstraints=function(o){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var t=o.positions[this.m_indexA].c,e=o.positions[this.m_indexA].a,i=o.velocities[this.m_indexA].v,n=o.velocities[this.m_indexA].w,s=o.positions[this.m_indexB].c,r=o.positions[this.m_indexB].a,b=o.velocities[this.m_indexB].v,a=o.velocities[this.m_indexB].w,d=this.m_qA.SetAngleRadians(e),l=this.m_qB.SetAngleRadians(r);box2d.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),box2d.b2MulRV(d,this.m_lalcA,this.m_rA),box2d.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),box2d.b2MulRV(l,this.m_lalcB,this.m_rB),this.m_u.x=s.x+this.m_rB.x-t.x-this.m_rA.x,this.m_u.y=s.y+this.m_rB.y-t.y-this.m_rA.y;var x=this.m_u.GetLength();x>box2d.b2_linearSlop?this.m_u.SelfMul(1/x):this.m_u.SetZero();var p=box2d.b2CrossVV(this.m_rA,this.m_u),m=box2d.b2CrossVV(this.m_rB,this.m_u),h=this.m_invMassA+this.m_invIA*p*p+this.m_invMassB+this.m_invIB*m*m;if(this.m_mass=0!==h?1/h:0,0<this.m_frequencyHz){var _=x-this.m_length,c=2*box2d.b2_pi*this.m_frequencyHz,y=2*this.m_mass*this.m_dampingRatio*c,u=this.m_mass*c*c,g=o.step.dt;this.m_gamma=g*(y+g*u),this.m_gamma=0!==this.m_gamma?1/this.m_gamma:0,this.m_bias=_*g*u*this.m_gamma,h+=this.m_gamma,this.m_mass=0!==h?1/h:0}else this.m_gamma=0,this.m_bias=0;if(o.step.warmStarting){this.m_impulse*=o.step.dtRatio;var f=box2d.b2MulSV(this.m_impulse,this.m_u,box2d.b2DistanceJoint.prototype.InitVelocityConstraints.s_P);i.SelfMulSub(this.m_invMassA,f),n-=this.m_invIA*box2d.b2CrossVV(this.m_rA,f),b.SelfMulAdd(this.m_invMassB,f),a+=this.m_invIB*box2d.b2CrossVV(this.m_rB,f)}else this.m_impulse=0;o.velocities[this.m_indexA].w=n,o.velocities[this.m_indexB].w=a},box2d.b2DistanceJoint.prototype.InitVelocityConstraints.s_P=new box2d.b2Vec2,box2d.b2DistanceJoint.prototype.SolveVelocityConstraints=function(o){var t=o.velocities[this.m_indexA].v,e=o.velocities[this.m_indexA].w,i=o.velocities[this.m_indexB].v,n=o.velocities[this.m_indexB].w,s=box2d.b2AddVCrossSV(t,e,this.m_rA,box2d.b2DistanceJoint.prototype.SolveVelocityConstraints.s_vpA),r=box2d.b2AddVCrossSV(i,n,this.m_rB,box2d.b2DistanceJoint.prototype.SolveVelocityConstraints.s_vpB),b=box2d.b2DotVV(this.m_u,box2d.b2SubVV(r,s,box2d.b2Vec2.s_t0)),a=-this.m_mass*(b+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=a;var d=box2d.b2MulSV(a,this.m_u,box2d.b2DistanceJoint.prototype.SolveVelocityConstraints.s_P);t.SelfMulSub(this.m_invMassA,d),e-=this.m_invIA*box2d.b2CrossVV(this.m_rA,d),i.SelfMulAdd(this.m_invMassB,d),n+=this.m_invIB*box2d.b2CrossVV(this.m_rB,d),o.velocities[this.m_indexA].w=e,o.velocities[this.m_indexB].w=n},box2d.b2DistanceJoint.prototype.SolveVelocityConstraints.s_vpA=new box2d.b2Vec2,box2d.b2DistanceJoint.prototype.SolveVelocityConstraints.s_vpB=new box2d.b2Vec2,box2d.b2DistanceJoint.prototype.SolveVelocityConstraints.s_P=new box2d.b2Vec2,box2d.b2DistanceJoint.prototype.SolvePositionConstraints=function(o){if(0<this.m_frequencyHz)return!0;var t=o.positions[this.m_indexA].c,e=o.positions[this.m_indexA].a,i=o.positions[this.m_indexB].c,n=o.positions[this.m_indexB].a,s=(this.m_qA.SetAngleRadians(e),this.m_qB.SetAngleRadians(n),box2d.b2MulRV(this.m_qA,this.m_lalcA,this.m_rA)),r=box2d.b2MulRV(this.m_qB,this.m_lalcB,this.m_rB),b=this.m_u;b.x=i.x+r.x-t.x-s.x,b.y=i.y+r.y-t.y-s.y;var a=this.m_u.Normalize()-this.m_length;a=box2d.b2Clamp(a,-box2d.b2_maxLinearCorrection,box2d.b2_maxLinearCorrection);var d=-this.m_mass*a,l=box2d.b2MulSV(d,b,box2d.b2DistanceJoint.prototype.SolvePositionConstraints.s_P);return t.SelfMulSub(this.m_invMassA,l),e-=this.m_invIA*box2d.b2CrossVV(s,l),i.SelfMulAdd(this.m_invMassB,l),n+=this.m_invIB*box2d.b2CrossVV(r,l),o.positions[this.m_indexA].a=e,o.positions[this.m_indexB].a=n,box2d.b2Abs(a)<box2d.b2_linearSlop},box2d.b2DistanceJoint.prototype.SolvePositionConstraints.s_P=new box2d.b2Vec2,goog.provide("box2d.b2FrictionJoint"),goog.require("box2d.b2Settings"),goog.require("box2d.b2Joint"),goog.require("box2d.b2Math"),box2d.b2FrictionJointDef=function(){goog.base(this,box2d.b2JointType.e_frictionJoint),this.localAnchorA=new box2d.b2Vec2,this.localAnchorB=new box2d.b2Vec2},goog.inherits(box2d.b2FrictionJointDef,box2d.b2JointDef),box2d.b2FrictionJointDef.prototype.localAnchorA=null,box2d.b2FrictionJointDef.prototype.localAnchorB=null,box2d.b2FrictionJointDef.prototype.maxForce=0,box2d.b2FrictionJointDef.prototype.maxTorque=0,box2d.b2FrictionJointDef.prototype.Initialize=function(o,t,e){this.bodyA=o,this.bodyB=t,this.bodyA.GetLocalPoint(e,this.localAnchorA),this.bodyB.GetLocalPoint(e,this.localAnchorB)},box2d.b2FrictionJoint=function(o){goog.base(this,o),this.m_localAnchorA=o.localAnchorA.Clone(),this.m_localAnchorB=o.localAnchorB.Clone(),this.m_linearImpulse=(new box2d.b2Vec2).SetZero(),this.m_maxForce=o.maxForce,this.m_maxTorque=o.maxTorque,this.m_rA=new box2d.b2Vec2,this.m_rB=new box2d.b2Vec2,this.m_localCenterA=new box2d.b2Vec2,this.m_localCenterB=new box2d.b2Vec2,this.m_linearMass=(new box2d.b2Mat22).SetZero(),this.m_qA=new box2d.b2Rot,this.m_qB=new box2d.b2Rot,this.m_lalcA=new box2d.b2Vec2,this.m_lalcB=new box2d.b2Vec2,this.m_K=new box2d.b2Mat22},goog.inherits(box2d.b2FrictionJoint,box2d.b2Joint),box2d.b2FrictionJoint.prototype.m_localAnchorA=null,box2d.b2FrictionJoint.prototype.m_localAnchorB=null,box2d.b2FrictionJoint.prototype.m_linearImpulse=null,box2d.b2FrictionJoint.prototype.m_angularImpulse=0,box2d.b2FrictionJoint.prototype.m_maxForce=0,box2d.b2FrictionJoint.prototype.m_maxTorque=0,box2d.b2FrictionJoint.prototype.m_indexA=0,box2d.b2FrictionJoint.prototype.m_indexB=0,box2d.b2FrictionJoint.prototype.m_rA=null,box2d.b2FrictionJoint.prototype.m_rB=null,box2d.b2FrictionJoint.prototype.m_localCenterA=null,box2d.b2FrictionJoint.prototype.m_localCenterB=null,box2d.b2FrictionJoint.prototype.m_invMassA=0,box2d.b2FrictionJoint.prototype.m_invMassB=0,box2d.b2FrictionJoint.prototype.m_invIA=0,box2d.b2FrictionJoint.prototype.m_invIB=0,box2d.b2FrictionJoint.prototype.m_linearMass=null,box2d.b2FrictionJoint.prototype.m_angularMass=0,box2d.b2FrictionJoint.prototype.m_qA=null,box2d.b2FrictionJoint.prototype.m_qB=null,box2d.b2FrictionJoint.prototype.m_lalcA=null,box2d.b2FrictionJoint.prototype.m_lalcB=null,box2d.b2FrictionJoint.prototype.m_K=null,box2d.b2FrictionJoint.prototype.InitVelocityConstraints=function(o){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var t=o.positions[this.m_indexA].a,e=o.velocities[this.m_indexA].v,i=o.velocities[this.m_indexA].w,n=o.positions[this.m_indexB].a,s=o.velocities[this.m_indexB].v,r=o.velocities[this.m_indexB].w,b=this.m_qA.SetAngleRadians(t),a=this.m_qB.SetAngleRadians(n);box2d.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var d=box2d.b2MulRV(b,this.m_lalcA,this.m_rA);box2d.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var l=box2d.b2MulRV(a,this.m_lalcB,this.m_rB),x=this.m_invMassA,p=this.m_invMassB,m=this.m_invIA,h=this.m_invIB,_=this.m_K;if(_.ex.x=x+p+m*d.y*d.y+h*l.y*l.y,_.ex.y=-m*d.x*d.y-h*l.x*l.y,_.ey.x=_.ex.y,_.ey.y=x+p+m*d.x*d.x+h*l.x*l.x,_.GetInverse(this.m_linearMass),this.m_angularMass=m+h,0<this.m_angularMass&&(this.m_angularMass=1/this.m_angularMass),o.step.warmStarting){this.m_linearImpulse.SelfMul(o.step.dtRatio),this.m_angularImpulse*=o.step.dtRatio;var c=this.m_linearImpulse;e.SelfMulSub(x,c),i-=m*(box2d.b2CrossVV(this.m_rA,c)+this.m_angularImpulse),s.SelfMulAdd(p,c),r+=h*(box2d.b2CrossVV(this.m_rB,c)+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0;o.velocities[this.m_indexA].w=i,o.velocities[this.m_indexB].w=r},box2d.b2FrictionJoint.prototype.SolveVelocityConstraints=function(o){var t=o.velocities[this.m_indexA].v,e=o.velocities[this.m_indexA].w,i=o.velocities[this.m_indexB].v,n=o.velocities[this.m_indexB].w,s=this.m_invMassA,r=this.m_invMassB,b=this.m_invIA,a=this.m_invIB,d=o.step.dt,l=n-e,x=-this.m_angularMass*l,p=this.m_angularImpulse,m=d*this.m_maxTorque;this.m_angularImpulse=box2d.b2Clamp(this.m_angularImpulse+x,-m,m),e-=b*(x=this.m_angularImpulse-p),n+=a*x;l=box2d.b2SubVV(box2d.b2AddVCrossSV(i,n,this.m_rB,box2d.b2Vec2.s_t0),box2d.b2AddVCrossSV(t,e,this.m_rA,box2d.b2Vec2.s_t1),box2d.b2FrictionJoint.prototype.SolveVelocityConstraints.s_Cdot);var h=box2d.b2MulMV(this.m_linearMass,l,box2d.b2FrictionJoint.prototype.SolveVelocityConstraints.s_impulseV).SelfNeg(),_=box2d.b2FrictionJoint.prototype.SolveVelocityConstraints.s_oldImpulseV.Copy(this.m_linearImpulse);this.m_linearImpulse.SelfAdd(h);m=d*this.m_maxForce;this.m_linearImpulse.GetLengthSquared()>m*m&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.SelfMul(m)),box2d.b2SubVV(this.m_linearImpulse,_,h),t.SelfMulSub(s,h),e-=b*box2d.b2CrossVV(this.m_rA,h),i.SelfMulAdd(r,h),n+=a*box2d.b2CrossVV(this.m_rB,h),o.velocities[this.m_indexA].w=e,o.velocities[this.m_indexB].w=n},box2d.b2FrictionJoint.prototype.SolveVelocityConstraints.s_Cdot=new box2d.b2Vec2,box2d.b2FrictionJoint.prototype.SolveVelocityConstraints.s_impulseV=new box2d.b2Vec2,box2d.b2FrictionJoint.prototype.SolveVelocityConstraints.s_oldImpulseV=new box2d.b2Vec2,box2d.b2FrictionJoint.prototype.SolvePositionConstraints=function(o){return!0},box2d.b2FrictionJoint.prototype.GetAnchorA=function(o){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,o)},box2d.b2FrictionJoint.prototype.GetAnchorB=function(o){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,o)},box2d.b2FrictionJoint.prototype.GetReactionForce=function(o,t){return t.SetXY(o*this.m_linearImpulse.x,o*this.m_linearImpulse.y)},box2d.b2FrictionJoint.prototype.GetReactionTorque=function(o){return o*this.m_angularImpulse},box2d.b2FrictionJoint.prototype.GetLocalAnchorA=function(o){return o.Copy(this.m_localAnchorA)},box2d.b2FrictionJoint.prototype.GetLocalAnchorB=function(o){return o.Copy(this.m_localAnchorB)},box2d.b2FrictionJoint.prototype.SetMaxForce=function(o){this.m_maxForce=o},box2d.b2FrictionJoint.prototype.GetMaxForce=function(){return this.m_maxForce},box2d.b2FrictionJoint.prototype.SetMaxTorque=function(o){this.m_maxTorque=o},box2d.b2FrictionJoint.prototype.GetMaxTorque=function(){return this.m_maxTorque},box2d.b2FrictionJoint.prototype.Dump=function(){if(box2d.DEBUG){var o=this.m_bodyA.m_islandIndex,t=this.m_bodyB.m_islandIndex;box2d.b2Log("  /*box2d.b2FrictionJointDef*/ var jd = new box2d.b2FrictionJointDef();\n"),box2d.b2Log("  jd.bodyA = bodies[%d];\n",o),box2d.b2Log("  jd.bodyB = bodies[%d];\n",t),box2d.b2Log("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),box2d.b2Log("  jd.localAnchorA.SetXY(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),box2d.b2Log("  jd.localAnchorB.SetXY(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),box2d.b2Log("  jd.maxForce = %.15f;\n",this.m_maxForce),box2d.b2Log("  jd.maxTorque = %.15f;\n",this.m_maxTorque),box2d.b2Log("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}},goog.provide("box2d.b2MouseJoint"),goog.require("box2d.b2Settings"),goog.require("box2d.b2Joint"),goog.require("box2d.b2Math"),box2d.b2MouseJointDef=function(){goog.base(this,box2d.b2JointType.e_mouseJoint),this.target=new box2d.b2Vec2},goog.inherits(box2d.b2MouseJointDef,box2d.b2JointDef),box2d.b2MouseJointDef.prototype.target=null,box2d.b2MouseJointDef.prototype.maxForce=0,box2d.b2MouseJointDef.prototype.frequencyHz=5,box2d.b2MouseJointDef.prototype.dampingRatio=.7,box2d.b2MouseJoint=function(o){goog.base(this,o),this.m_localAnchorB=new box2d.b2Vec2,this.m_targetA=new box2d.b2Vec2,this.m_impulse=new box2d.b2Vec2,this.m_rB=new box2d.b2Vec2,this.m_localCenterB=new box2d.b2Vec2,this.m_mass=new box2d.b2Mat22,this.m_C=new box2d.b2Vec2,this.m_qB=new box2d.b2Rot,this.m_lalcB=new box2d.b2Vec2,this.m_K=new box2d.b2Mat22,box2d.ENABLE_ASSERTS&&box2d.b2Assert(o.target.IsValid()),box2d.ENABLE_ASSERTS&&box2d.b2Assert(box2d.b2IsValid(o.maxForce)&&0<=o.maxForce),box2d.ENABLE_ASSERTS&&box2d.b2Assert(box2d.b2IsValid(o.frequencyHz)&&0<=o.frequencyHz),box2d.ENABLE_ASSERTS&&box2d.b2Assert(box2d.b2IsValid(o.dampingRatio)&&0<=o.dampingRatio),this.m_targetA.Copy(o.target),box2d.b2MulTXV(this.m_bodyB.GetTransform(),this.m_targetA,this.m_localAnchorB),this.m_maxForce=o.maxForce,this.m_impulse.SetZero(),this.m_frequencyHz=o.frequencyHz,this.m_dampingRatio=o.dampingRatio,this.m_beta=0,this.m_gamma=0},goog.inherits(box2d.b2MouseJoint,box2d.b2Joint),box2d.b2MouseJoint.prototype.m_localAnchorB=null,box2d.b2MouseJoint.prototype.m_targetA=null,box2d.b2MouseJoint.prototype.m_frequencyHz=0,box2d.b2MouseJoint.prototype.m_dampingRatio=0,box2d.b2MouseJoint.prototype.m_beta=0,box2d.b2MouseJoint.prototype.m_impulse=null,box2d.b2MouseJoint.prototype.m_maxForce=0,box2d.b2MouseJoint.prototype.m_gamma=0,box2d.b2MouseJoint.prototype.m_indexA=0,box2d.b2MouseJoint.prototype.m_indexB=0,box2d.b2MouseJoint.prototype.m_rB=null,box2d.b2MouseJoint.prototype.m_localCenterB=null,box2d.b2MouseJoint.prototype.m_invMassB=0,box2d.b2MouseJoint.prototype.m_invIB=0,box2d.b2MouseJoint.prototype.m_mass=null,box2d.b2MouseJoint.prototype.m_C=null,box2d.b2MouseJoint.prototype.m_qB=null,box2d.b2MouseJoint.prototype.m_lalcB=null,box2d.b2MouseJoint.prototype.m_K=null,box2d.b2MouseJoint.prototype.SetTarget=function(o){!1===this.m_bodyB.IsAwake()&&this.m_bodyB.SetAwake(!0),this.m_targetA.Copy(o)},box2d.b2MouseJoint.prototype.GetTarget=function(o){return o.Copy(this.m_targetA)},box2d.b2MouseJoint.prototype.SetMaxForce=function(o){this.m_maxForce=o},box2d.b2MouseJoint.prototype.GetMaxForce=function(){return this.m_maxForce},box2d.b2MouseJoint.prototype.SetFrequency=function(o){this.m_frequencyHz=o},box2d.b2MouseJoint.prototype.GetFrequency=function(){return this.m_frequencyHz},box2d.b2MouseJoint.prototype.SetDampingRatio=function(o){this.m_dampingRatio=o},box2d.b2MouseJoint.prototype.GetDampingRatio=function(){return this.m_dampingRatio},box2d.b2MouseJoint.prototype.InitVelocityConstraints=function(o){this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIB=this.m_bodyB.m_invI;var t=o.positions[this.m_indexB].c,e=o.positions[this.m_indexB].a,i=o.velocities[this.m_indexB].v,n=o.velocities[this.m_indexB].w,s=this.m_qB.SetAngleRadians(e),r=this.m_bodyB.GetMass(),b=2*box2d.b2_pi*this.m_frequencyHz,a=2*r*this.m_dampingRatio*b,d=r*(b*b),l=o.step.dt;box2d.ENABLE_ASSERTS&&box2d.b2Assert(a+l*d>box2d.b2_epsilon),this.m_gamma=l*(a+l*d),0!==this.m_gamma&&(this.m_gamma=1/this.m_gamma),this.m_beta=l*d*this.m_gamma,box2d.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),box2d.b2MulRV(s,this.m_lalcB,this.m_rB);var x=this.m_K;x.ex.x=this.m_invMassB+this.m_invIB*this.m_rB.y*this.m_rB.y+this.m_gamma,x.ex.y=-this.m_invIB*this.m_rB.x*this.m_rB.y,x.ey.x=x.ex.y,x.ey.y=this.m_invMassB+this.m_invIB*this.m_rB.x*this.m_rB.x+this.m_gamma,x.GetInverse(this.m_mass),this.m_C.x=t.x+this.m_rB.x-this.m_targetA.x,this.m_C.y=t.y+this.m_rB.y-this.m_targetA.y,this.m_C.SelfMul(this.m_beta),n*=.98,o.step.warmStarting?(this.m_impulse.SelfMul(o.step.dtRatio),i.x+=this.m_invMassB*this.m_impulse.x,i.y+=this.m_invMassB*this.m_impulse.y,n+=this.m_invIB*box2d.b2CrossVV(this.m_rB,this.m_impulse)):this.m_impulse.SetZero(),o.velocities[this.m_indexB].w=n},box2d.b2MouseJoint.prototype.SolveVelocityConstraints=function(o){var t=o.velocities[this.m_indexB].v,e=o.velocities[this.m_indexB].w,i=box2d.b2AddVCrossSV(t,e,this.m_rB,box2d.b2MouseJoint.prototype.SolveVelocityConstraints.s_Cdot),n=box2d.b2MulMV(this.m_mass,box2d.b2AddVV(i,box2d.b2AddVV(this.m_C,box2d.b2MulSV(this.m_gamma,this.m_impulse,box2d.b2Vec2.s_t0),box2d.b2Vec2.s_t0),box2d.b2Vec2.s_t0).SelfNeg(),box2d.b2MouseJoint.prototype.SolveVelocityConstraints.s_impulse),s=box2d.b2MouseJoint.prototype.SolveVelocityConstraints.s_oldImpulse.Copy(this.m_impulse);this.m_impulse.SelfAdd(n);var r=o.step.dt*this.m_maxForce;this.m_impulse.GetLengthSquared()>r*r&&this.m_impulse.SelfMul(r/this.m_impulse.GetLength()),box2d.b2SubVV(this.m_impulse,s,n),t.SelfMulAdd(this.m_invMassB,n),e+=this.m_invIB*box2d.b2CrossVV(this.m_rB,n),o.velocities[this.m_indexB].w=e},box2d.b2MouseJoint.prototype.SolveVelocityConstraints.s_Cdot=new box2d.b2Vec2,box2d.b2MouseJoint.prototype.SolveVelocityConstraints.s_impulse=new box2d.b2Vec2,box2d.b2MouseJoint.prototype.SolveVelocityConstraints.s_oldImpulse=new box2d.b2Vec2,box2d.b2MouseJoint.prototype.SolvePositionConstraints=function(o){return!0},box2d.b2MouseJoint.prototype.GetAnchorA=function(o){return o.Copy(this.m_targetA)},box2d.b2MouseJoint.prototype.GetAnchorB=function(o){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,o)},box2d.b2MouseJoint.prototype.GetReactionForce=function(o,t){return box2d.b2MulSV(o,this.m_impulse,t)},box2d.b2MouseJoint.prototype.GetReactionTorque=function(o){return 0},box2d.b2MouseJoint.prototype.Dump=function(){box2d.DEBUG&&box2d.b2Log("Mouse joint dumping is not supported.\n")},box2d.b2MouseJoint.prototype.ShiftOrigin=function(o){this.m_targetA.SelfSub(o)},goog.provide("box2d.b2ConstantForceController"),goog.require("box2d.b2Settings"),goog.require("box2d.b2Controller"),goog.require("box2d.b2Math"),box2d.b2ConstantForceController=function(){goog.base(this),this.F=new box2d.b2Vec2(0,0)},goog.inherits(box2d.b2ConstantForceController,box2d.b2Controller),box2d.b2ConstantAccelController.prototype.F=null,box2d.b2ConstantForceController.prototype.Step=function(o){for(var t=this.m_bodyList;t;t=t.nextBody){var e=t.body;e.IsAwake()&&e.ApplyForce(this.F,e.GetWorldCenter())}},goog.provide("box2d.b2PulleyJoint"),goog.require("box2d.b2Settings"),goog.require("box2d.b2Joint"),goog.require("box2d.b2Math"),box2d.b2_minPulleyLength=2,box2d.b2PulleyJointDef=function(){goog.base(this,box2d.b2JointType.e_pulleyJoint),this.collideConnected=!0,this.groundAnchorA=new box2d.b2Vec2(-1,1),this.groundAnchorB=new box2d.b2Vec2(1,1),this.localAnchorA=new box2d.b2Vec2(-1,0),this.localAnchorB=new box2d.b2Vec2(1,0)},goog.inherits(box2d.b2PulleyJointDef,box2d.b2JointDef),box2d.b2PulleyJointDef.prototype.groundAnchorA=null,box2d.b2PulleyJointDef.prototype.groundAnchorB=null,box2d.b2PulleyJointDef.prototype.localAnchorA=null,box2d.b2PulleyJointDef.prototype.localAnchorB=null,box2d.b2PulleyJointDef.prototype.lengthA=0,box2d.b2PulleyJointDef.prototype.lengthB=0,box2d.b2PulleyJointDef.prototype.ratio=1,box2d.b2PulleyJointDef.prototype.Initialize=function(o,t,e,i,n,s,r){this.bodyA=o,this.bodyB=t,this.groundAnchorA.Copy(e),this.groundAnchorB.Copy(i),this.bodyA.GetLocalPoint(n,this.localAnchorA),this.bodyB.GetLocalPoint(s,this.localAnchorB),this.lengthA=box2d.b2DistanceVV(n,e),this.lengthB=box2d.b2DistanceVV(s,i),this.ratio=r,box2d.ENABLE_ASSERTS&&box2d.b2Assert(this.ratio>box2d.b2_epsilon)},box2d.b2PulleyJoint=function(o){goog.base(this,o),this.m_groundAnchorA=new box2d.b2Vec2,this.m_groundAnchorB=new box2d.b2Vec2,this.m_localAnchorA=new box2d.b2Vec2,this.m_localAnchorB=new box2d.b2Vec2,this.m_uA=new box2d.b2Vec2,this.m_uB=new box2d.b2Vec2,this.m_rA=new box2d.b2Vec2,this.m_rB=new box2d.b2Vec2,this.m_localCenterA=new box2d.b2Vec2,this.m_localCenterB=new box2d.b2Vec2,this.m_qA=new box2d.b2Rot,this.m_qB=new box2d.b2Rot,this.m_lalcA=new box2d.b2Vec2,this.m_lalcB=new box2d.b2Vec2,this.m_groundAnchorA.Copy(o.groundAnchorA),this.m_groundAnchorB.Copy(o.groundAnchorB),this.m_localAnchorA.Copy(o.localAnchorA),this.m_localAnchorB.Copy(o.localAnchorB),this.m_lengthA=o.lengthA,this.m_lengthB=o.lengthB,box2d.ENABLE_ASSERTS&&box2d.b2Assert(0!==o.ratio),this.m_ratio=o.ratio,this.m_constant=o.lengthA+this.m_ratio*o.lengthB,this.m_impulse=0},goog.inherits(box2d.b2PulleyJoint,box2d.b2Joint),box2d.b2PulleyJoint.prototype.m_groundAnchorA=null,box2d.b2PulleyJoint.prototype.m_groundAnchorB=null,box2d.b2PulleyJoint.prototype.m_lengthA=0,box2d.b2PulleyJoint.prototype.m_lengthB=0,box2d.b2PulleyJoint.prototype.m_localAnchorA=null,box2d.b2PulleyJoint.prototype.m_localAnchorB=null,box2d.b2PulleyJoint.prototype.m_constant=0,box2d.b2PulleyJoint.prototype.m_ratio=0,box2d.b2PulleyJoint.prototype.m_impulse=0,box2d.b2PulleyJoint.prototype.m_indexA=0,box2d.b2PulleyJoint.prototype.m_indexB=0,box2d.b2PulleyJoint.prototype.m_uA=null,box2d.b2PulleyJoint.prototype.m_uB=null,box2d.b2PulleyJoint.prototype.m_rA=null,box2d.b2PulleyJoint.prototype.m_rB=null,box2d.b2PulleyJoint.prototype.m_localCenterA=null,box2d.b2PulleyJoint.prototype.m_localCenterB=null,box2d.b2PulleyJoint.prototype.m_invMassA=0,box2d.b2PulleyJoint.prototype.m_invMassB=0,box2d.b2PulleyJoint.prototype.m_invIA=0,box2d.b2PulleyJoint.prototype.m_invIB=0,box2d.b2PulleyJoint.prototype.m_mass=0,box2d.b2PulleyJoint.prototype.m_qA=null,box2d.b2PulleyJoint.prototype.m_qB=null,box2d.b2PulleyJoint.prototype.m_lalcA=null,box2d.b2PulleyJoint.prototype.m_lalcB=null;box2d.b2PulleyJoint.prototype.InitVelocityConstraints=function(o){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var t=o.positions[this.m_indexA].c,e=o.positions[this.m_indexA].a,i=o.velocities[this.m_indexA].v,n=o.velocities[this.m_indexA].w,s=o.positions[this.m_indexB].c,r=o.positions[this.m_indexB].a,b=o.velocities[this.m_indexB].v,a=o.velocities[this.m_indexB].w,d=this.m_qA.SetAngleRadians(e),l=this.m_qB.SetAngleRadians(r);box2d.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),box2d.b2MulRV(d,this.m_lalcA,this.m_rA),box2d.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),box2d.b2MulRV(l,this.m_lalcB,this.m_rB),this.m_uA.Copy(t).SelfAdd(this.m_rA).SelfSub(this.m_groundAnchorA),this.m_uB.Copy(s).SelfAdd(this.m_rB).SelfSub(this.m_groundAnchorB);var x=this.m_uA.GetLength(),p=this.m_uB.GetLength();x>10*box2d.b2_linearSlop?this.m_uA.SelfMul(1/x):this.m_uA.SetZero(),p>10*box2d.b2_linearSlop?this.m_uB.SelfMul(1/p):this.m_uB.SetZero();var m=box2d.b2CrossVV(this.m_rA,this.m_uA),h=box2d.b2CrossVV(this.m_rB,this.m_uB),_=this.m_invMassA+this.m_invIA*m*m,c=this.m_invMassB+this.m_invIB*h*h;if(this.m_mass=_+this.m_ratio*this.m_ratio*c,0<this.m_mass&&(this.m_mass=1/this.m_mass),o.step.warmStarting){this.m_impulse*=o.step.dtRatio;var y=box2d.b2MulSV(-this.m_impulse,this.m_uA,box2d.b2PulleyJoint.prototype.InitVelocityConstraints.s_PA),u=box2d.b2MulSV(-this.m_ratio*this.m_impulse,this.m_uB,box2d.b2PulleyJoint.prototype.InitVelocityConstraints.s_PB);i.SelfMulAdd(this.m_invMassA,y),n+=this.m_invIA*box2d.b2CrossVV(this.m_rA,y),b.SelfMulAdd(this.m_invMassB,u),a+=this.m_invIB*box2d.b2CrossVV(this.m_rB,u)}else this.m_impulse=0;o.velocities[this.m_indexA].w=n,o.velocities[this.m_indexB].w=a},box2d.b2PulleyJoint.prototype.InitVelocityConstraints.s_PA=new box2d.b2Vec2,box2d.b2PulleyJoint.prototype.InitVelocityConstraints.s_PB=new box2d.b2Vec2,box2d.b2PulleyJoint.prototype.SolveVelocityConstraints=function(o){var t=o.velocities[this.m_indexA].v,e=o.velocities[this.m_indexA].w,i=o.velocities[this.m_indexB].v,n=o.velocities[this.m_indexB].w,s=box2d.b2AddVCrossSV(t,e,this.m_rA,box2d.b2PulleyJoint.prototype.SolveVelocityConstraints.s_vpA),r=box2d.b2AddVCrossSV(i,n,this.m_rB,box2d.b2PulleyJoint.prototype.SolveVelocityConstraints.s_vpB),b=-box2d.b2DotVV(this.m_uA,s)-this.m_ratio*box2d.b2DotVV(this.m_uB,r),a=-this.m_mass*b;this.m_impulse+=a;var d=box2d.b2MulSV(-a,this.m_uA,box2d.b2PulleyJoint.prototype.SolveVelocityConstraints.s_PA),l=box2d.b2MulSV(-this.m_ratio*a,this.m_uB,box2d.b2PulleyJoint.prototype.SolveVelocityConstraints.s_PB);t.SelfMulAdd(this.m_invMassA,d),e+=this.m_invIA*box2d.b2CrossVV(this.m_rA,d),i.SelfMulAdd(this.m_invMassB,l),n+=this.m_invIB*box2d.b2CrossVV(this.m_rB,l),o.velocities[this.m_indexA].w=e,o.velocities[this.m_indexB].w=n},box2d.b2PulleyJoint.prototype.SolveVelocityConstraints.s_vpA=new box2d.b2Vec2,box2d.b2PulleyJoint.prototype.SolveVelocityConstraints.s_vpB=new box2d.b2Vec2,box2d.b2PulleyJoint.prototype.SolveVelocityConstraints.s_PA=new box2d.b2Vec2,box2d.b2PulleyJoint.prototype.SolveVelocityConstraints.s_PB=new box2d.b2Vec2,box2d.b2PulleyJoint.prototype.SolvePositionConstraints=function(o){var t=o.positions[this.m_indexA].c,e=o.positions[this.m_indexA].a,i=o.positions[this.m_indexB].c,n=o.positions[this.m_indexB].a,s=this.m_qA.SetAngleRadians(e),r=this.m_qB.SetAngleRadians(n);box2d.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var b=box2d.b2MulRV(s,this.m_lalcA,this.m_rA);box2d.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var a=box2d.b2MulRV(r,this.m_lalcB,this.m_rB),d=this.m_uA.Copy(t).SelfAdd(b).SelfSub(this.m_groundAnchorA),l=this.m_uB.Copy(i).SelfAdd(a).SelfSub(this.m_groundAnchorB),x=d.GetLength(),p=l.GetLength();x>10*box2d.b2_linearSlop?d.SelfMul(1/x):d.SetZero(),p>10*box2d.b2_linearSlop?l.SelfMul(1/p):l.SetZero();var m=box2d.b2CrossVV(b,d),h=box2d.b2CrossVV(a,l),_=this.m_invMassA+this.m_invIA*m*m,c=this.m_invMassB+this.m_invIB*h*h,y=_+this.m_ratio*this.m_ratio*c;0<y&&(y=1/y);var u=this.m_constant-x-this.m_ratio*p,g=box2d.b2Abs(u),f=-y*u,S=box2d.b2MulSV(-f,d,box2d.b2PulleyJoint.prototype.SolvePositionConstraints.s_PA),A=box2d.b2MulSV(-this.m_ratio*f,l,box2d.b2PulleyJoint.prototype.SolvePositionConstraints.s_PB);return t.SelfMulAdd(this.m_invMassA,S),e+=this.m_invIA*box2d.b2CrossVV(b,S),i.SelfMulAdd(this.m_invMassB,A),n+=this.m_invIB*box2d.b2CrossVV(a,A),o.positions[this.m_indexA].a=e,o.positions[this.m_indexB].a=n,g<box2d.b2_linearSlop},box2d.b2PulleyJoint.prototype.SolvePositionConstraints.s_PA=new box2d.b2Vec2,box2d.b2PulleyJoint.prototype.SolvePositionConstraints.s_PB=new box2d.b2Vec2,box2d.b2PulleyJoint.prototype.GetAnchorA=function(o){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,o)},box2d.b2PulleyJoint.prototype.GetAnchorB=function(o){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,o)},box2d.b2PulleyJoint.prototype.GetReactionForce=function(o,t){return t.SetXY(o*this.m_impulse*this.m_uB.x,o*this.m_impulse*this.m_uB.y)},box2d.b2PulleyJoint.prototype.GetReactionTorque=function(o){return 0},box2d.b2PulleyJoint.prototype.GetGroundAnchorA=function(o){return o.Copy(this.m_groundAnchorA)},box2d.b2PulleyJoint.prototype.GetGroundAnchorB=function(o){return o.Copy(this.m_groundAnchorB)},box2d.b2PulleyJoint.prototype.GetLengthA=function(){return this.m_lengthA},box2d.b2PulleyJoint.prototype.GetLengthB=function(){return this.m_lengthB},box2d.b2PulleyJoint.prototype.GetRatio=function(){return this.m_ratio},box2d.b2PulleyJoint.prototype.GetCurrentLengthA=function(){var o=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,box2d.b2PulleyJoint.prototype.GetCurrentLengthA.s_p),t=this.m_groundAnchorA;return box2d.b2DistanceVV(o,t)},box2d.b2PulleyJoint.prototype.GetCurrentLengthA.s_p=new box2d.b2Vec2,box2d.b2PulleyJoint.prototype.GetCurrentLengthB=function(){var o=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,box2d.b2PulleyJoint.prototype.GetCurrentLengthB.s_p),t=this.m_groundAnchorB;return box2d.b2DistanceVV(o,t)},box2d.b2PulleyJoint.prototype.GetCurrentLengthB.s_p=new box2d.b2Vec2,box2d.b2PulleyJoint.prototype.Dump=function(){if(box2d.DEBUG){var o=this.m_bodyA.m_islandIndex,t=this.m_bodyB.m_islandIndex;box2d.b2Log("  /*box2d.b2PulleyJointDef*/ var jd = new box2d.b2PulleyJointDef();\n"),box2d.b2Log("  jd.bodyA = bodies[%d];\n",o),box2d.b2Log("  jd.bodyB = bodies[%d];\n",t),box2d.b2Log("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),box2d.b2Log("  jd.groundAnchorA.SetXY(%.15f, %.15f);\n",this.m_groundAnchorA.x,this.m_groundAnchorA.y),box2d.b2Log("  jd.groundAnchorB.SetXY(%.15f, %.15f);\n",this.m_groundAnchorB.x,this.m_groundAnchorB.y),box2d.b2Log("  jd.localAnchorA.SetXY(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),box2d.b2Log("  jd.localAnchorB.SetXY(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),box2d.b2Log("  jd.lengthA = %.15f;\n",this.m_lengthA),box2d.b2Log("  jd.lengthB = %.15f;\n",this.m_lengthB),box2d.b2Log("  jd.ratio = %.15f;\n",this.m_ratio),box2d.b2Log("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}},box2d.b2PulleyJoint.prototype.ShiftOrigin=function(o){this.m_groundAnchorA.SelfSub(o),this.m_groundAnchorB.SelfSub(o)},goog.provide("box2d.b2CircleShape"),goog.require("box2d.b2Shape"),box2d.b2CircleShape=function(o){goog.base(this,box2d.b2ShapeType.e_circleShape,o||0),this.m_p=new box2d.b2Vec2},goog.inherits(box2d.b2CircleShape,box2d.b2Shape),box2d.b2CircleShape.prototype.m_p=null,box2d.b2CircleShape.prototype.Clone=function(){return(new box2d.b2CircleShape).Copy(this)},box2d.b2CircleShape.prototype.Copy=function(o){return goog.base(this,"Copy",o),box2d.ENABLE_ASSERTS&&box2d.b2Assert(o instanceof box2d.b2CircleShape),this.m_p.Copy(o.m_p),this},box2d.b2CircleShape.prototype.GetChildCount=function(){return 1},box2d.b2CircleShape.prototype.TestPoint=function(o,t){var e=box2d.b2MulXV(o,this.m_p,box2d.b2CircleShape.prototype.TestPoint.s_center),i=box2d.b2SubVV(t,e,box2d.b2CircleShape.prototype.TestPoint.s_d);return box2d.b2DotVV(i,i)<=box2d.b2Sq(this.m_radius)},box2d.b2CircleShape.prototype.TestPoint.s_center=new box2d.b2Vec2,box2d.b2CircleShape.prototype.TestPoint.s_d=new box2d.b2Vec2,box2d.b2CircleShape.prototype.RayCast=function(o,t,e,i){var n=box2d.b2MulXV(e,this.m_p,box2d.b2CircleShape.prototype.RayCast.s_position),s=box2d.b2SubVV(t.p1,n,box2d.b2CircleShape.prototype.RayCast.s_s),r=box2d.b2DotVV(s,s)-box2d.b2Sq(this.m_radius),b=box2d.b2SubVV(t.p2,t.p1,box2d.b2CircleShape.prototype.RayCast.s_r),a=box2d.b2DotVV(s,b),d=box2d.b2DotVV(b,b),l=a*a-d*r;if(l<0||d<box2d.b2_epsilon)return!1;var x=-(a+box2d.b2Sqrt(l));return 0<=x&&x<=t.maxFraction*d&&(x/=d,o.fraction=x,box2d.b2AddVMulSV(s,x,b,o.normal).SelfNormalize(),!0)},box2d.b2CircleShape.prototype.RayCast.s_position=new box2d.b2Vec2,box2d.b2CircleShape.prototype.RayCast.s_s=new box2d.b2Vec2,box2d.b2CircleShape.prototype.RayCast.s_r=new box2d.b2Vec2,box2d.b2CircleShape.prototype.ComputeAABB=function(o,t,e){var i=box2d.b2MulXV(t,this.m_p,box2d.b2CircleShape.prototype.ComputeAABB.s_p);o.lowerBound.SetXY(i.x-this.m_radius,i.y-this.m_radius),o.upperBound.SetXY(i.x+this.m_radius,i.y+this.m_radius)},box2d.b2CircleShape.prototype.ComputeAABB.s_p=new box2d.b2Vec2,box2d.b2CircleShape.prototype.ComputeMass=function(o,t){var e=box2d.b2Sq(this.m_radius);o.mass=t*box2d.b2_pi*e,o.center.Copy(this.m_p),o.I=o.mass*(.5*e+box2d.b2DotVV(this.m_p,this.m_p))},box2d.b2CircleShape.prototype.SetupDistanceProxy=function(o,t){o.m_vertices=new Array(1,!0),o.m_vertices[0]=this.m_p,o.m_count=1,o.m_radius=this.m_radius},box2d.b2CircleShape.prototype.ComputeSubmergedArea=function(o,t,e,i){var n=box2d.b2MulXV(e,this.m_p,new box2d.b2Vec2),s=-(box2d.b2DotVV(o,n)-t);if(s<-this.m_radius+box2d.b2_epsilon)return 0;if(s>this.m_radius)return i.Copy(n),box2d.b2_pi*this.m_radius*this.m_radius;var r=this.m_radius*this.m_radius,b=s*s,a=r*(box2d.b2Asin(s/this.m_radius)+box2d.b2_pi/2)+s*box2d.b2Sqrt(r-b),d=-2/3*box2d.b2Pow(r-b,1.5)/a;return i.x=n.x+o.x*d,i.y=n.y+o.y*d,a},box2d.b2CircleShape.prototype.Dump=function(){box2d.b2Log("    /*box2d.b2CircleShape*/ var shape = new box2d.b2CircleShape();\n"),box2d.b2Log("    shape.m_radius = %.15f;\n",this.m_radius),box2d.b2Log("    shape.m_p.SetXY(%.15f, %.15f);\n",this.m_p.x,this.m_p.y)},goog.provide("box2d.b2Rope"),goog.require("box2d.b2Math"),goog.require("box2d.b2Draw"),box2d.b2RopeDef=function(){this.vertices=new Array,this.masses=new Array,this.gravity=new box2d.b2Vec2},box2d.b2RopeDef.prototype.vertices=null,box2d.b2RopeDef.prototype.count=0,box2d.b2RopeDef.prototype.masses=null,box2d.b2RopeDef.prototype.gravity=null,box2d.b2RopeDef.prototype.damping=.1,box2d.b2RopeDef.prototype.k2=.9,box2d.b2RopeDef.prototype.k3=.1,box2d.b2Rope=function(){this.m_gravity=new box2d.b2Vec2},box2d.b2Rope.prototype.m_count=0,box2d.b2Rope.prototype.m_ps=null,box2d.b2Rope.prototype.m_p0s=null,box2d.b2Rope.prototype.m_vs=null,box2d.b2Rope.prototype.m_ims=null,box2d.b2Rope.prototype.m_Ls=null,box2d.b2Rope.prototype.m_as=null,box2d.b2Rope.prototype.m_gravity=null,box2d.b2Rope.prototype.m_damping=0,box2d.b2Rope.prototype.m_k2=1,box2d.b2Rope.prototype.m_k3=.1,box2d.b2Rope.prototype.GetVertexCount=function(){return this.m_count},box2d.b2Rope.prototype.GetVertices=function(){return this.m_ps},box2d.b2Rope.prototype.Initialize=function(o){box2d.ENABLE_ASSERTS&&box2d.b2Assert(3<=o.count),this.m_count=o.count,this.m_ps=box2d.b2Vec2.MakeArray(this.m_count),this.m_p0s=box2d.b2Vec2.MakeArray(this.m_count),this.m_vs=box2d.b2Vec2.MakeArray(this.m_count),this.m_ims=box2d.b2MakeNumberArray(this.m_count);for(var t=0;t<this.m_count;++t){this.m_ps[t].Copy(o.vertices[t]),this.m_p0s[t].Copy(o.vertices[t]),this.m_vs[t].SetZero();var e=o.masses[t];this.m_ims[t]=0<e?1/e:0}var i=this.m_count-1,n=this.m_count-2;this.m_Ls=box2d.b2MakeNumberArray(i),this.m_as=box2d.b2MakeNumberArray(n);for(t=0;t<i;++t){var s=this.m_ps[t],r=this.m_ps[t+1];this.m_Ls[t]=box2d.b2DistanceVV(s,r)}for(t=0;t<n;++t){s=this.m_ps[t],r=this.m_ps[t+1];var b=this.m_ps[t+2],a=box2d.b2SubVV(r,s,box2d.b2Vec2.s_t0),d=box2d.b2SubVV(b,r,box2d.b2Vec2.s_t1),l=box2d.b2CrossVV(a,d),x=box2d.b2DotVV(a,d);this.m_as[t]=box2d.b2Atan2(l,x)}this.m_gravity.Copy(o.gravity),this.m_damping=o.damping,this.m_k2=o.k2,this.m_k3=o.k3},box2d.b2Rope.prototype.Step=function(o,t){if(0!==o){for(var e=Math.exp(-o*this.m_damping),i=0;i<this.m_count;++i)this.m_p0s[i].Copy(this.m_ps[i]),0<this.m_ims[i]&&this.m_vs[i].SelfMulAdd(o,this.m_gravity),this.m_vs[i].SelfMul(e),this.m_ps[i].SelfMulAdd(o,this.m_vs[i]);for(i=0;i<t;++i)this.SolveC2(),this.SolveC3(),this.SolveC2();var n=1/o;for(i=0;i<this.m_count;++i)box2d.b2MulSV(n,box2d.b2SubVV(this.m_ps[i],this.m_p0s[i],box2d.b2Vec2.s_t0),this.m_vs[i])}},box2d.b2Rope.prototype.SolveC2=function(){for(var o=this.m_count-1,t=0;t<o;++t){var e=this.m_ps[t],i=this.m_ps[t+1],n=box2d.b2SubVV(i,e,box2d.b2Rope.s_d),s=n.Normalize(),r=this.m_ims[t],b=this.m_ims[t+1];if(r+b!==0){var a=r/(r+b),d=b/(r+b);e.SelfMulSub(this.m_k2*a*(this.m_Ls[t]-s),n),i.SelfMulAdd(this.m_k2*d*(this.m_Ls[t]-s),n)}}},box2d.b2Rope.s_d=new box2d.b2Vec2,box2d.b2Rope.prototype.SetAngleRadians=function(o){for(var t=this.m_count-2,e=0;e<t;++e)this.m_as[e]=o},box2d.b2Rope.prototype.SolveC3=function(){for(var o=this.m_count-2,t=0;t<o;++t){var e=this.m_ps[t],i=this.m_ps[t+1],n=this.m_ps[t+2],s=this.m_ims[t],r=this.m_ims[t+1],b=this.m_ims[t+2],a=box2d.b2SubVV(i,e,box2d.b2Rope.s_d1),d=box2d.b2SubVV(n,i,box2d.b2Rope.s_d2),l=a.GetLengthSquared(),x=d.GetLengthSquared();if(l*x!=0){var p=box2d.b2CrossVV(a,d),m=box2d.b2DotVV(a,d),h=box2d.b2Atan2(p,m),_=box2d.b2MulSV(-1/l,a.SelfSkew(),box2d.b2Rope.s_Jd1),c=box2d.b2MulSV(1/x,d.SelfSkew(),box2d.b2Rope.s_Jd2),y=box2d.b2NegV(_,box2d.b2Rope.s_J1),u=box2d.b2SubVV(_,c,box2d.b2Rope.s_J2),g=c,f=s*box2d.b2DotVV(y,y)+r*box2d.b2DotVV(u,u)+b*box2d.b2DotVV(g,g);if(0!==f){f=1/f;for(var S=h-this.m_as[t];S>box2d.b2_pi;)S=(h-=2*box2d.b2_pi)-this.m_as[t];for(;S<-box2d.b2_pi;)S=(h+=2*box2d.b2_pi)-this.m_as[t];var A=-this.m_k3*f*S;e.SelfMulAdd(s*A,y),i.SelfMulAdd(r*A,u),n.SelfMulAdd(b*A,g)}}}},box2d.b2Rope.s_d1=new box2d.b2Vec2,box2d.b2Rope.s_d2=new box2d.b2Vec2,box2d.b2Rope.s_Jd1=new box2d.b2Vec2,box2d.b2Rope.s_Jd2=new box2d.b2Vec2,box2d.b2Rope.s_J1=new box2d.b2Vec2,box2d.b2Rope.s_J2=new box2d.b2Vec2,box2d.b2Rope.prototype.Draw=function(o){for(var t=new box2d.b2Color(.4,.5,.7),e=0;e<this.m_count-1;++e)o.DrawSegment(this.m_ps[e],this.m_ps[e+1],t)},goog.provide("box2d.b2WheelJoint"),goog.require("box2d.b2Settings"),goog.require("box2d.b2Math"),box2d.b2WheelJointDef=function(){goog.base(this,box2d.b2JointType.e_wheelJoint),this.localAnchorA=new box2d.b2Vec2(0,0),this.localAnchorB=new box2d.b2Vec2(0,0),this.localAxisA=new box2d.b2Vec2(1,0)},goog.inherits(box2d.b2WheelJointDef,box2d.b2JointDef),box2d.b2WheelJointDef.prototype.localAnchorA=null,box2d.b2WheelJointDef.prototype.localAnchorB=null,box2d.b2WheelJointDef.prototype.localAxisA=null,box2d.b2WheelJointDef.prototype.enableMotor=!1,box2d.b2WheelJointDef.prototype.maxMotorTorque=0,box2d.b2WheelJointDef.prototype.motorSpeed=0,box2d.b2WheelJointDef.prototype.frequencyHz=2,box2d.b2WheelJointDef.prototype.dampingRatio=.7,box2d.b2WheelJointDef.prototype.Initialize=function(o,t,e,i){this.bodyA=o,this.bodyB=t,this.bodyA.GetLocalPoint(e,this.localAnchorA),this.bodyB.GetLocalPoint(e,this.localAnchorB),this.bodyA.GetLocalVector(i,this.localAxisA)},box2d.b2WheelJoint=function(o){goog.base(this,o),this.m_frequencyHz=o.frequencyHz,this.m_dampingRatio=o.dampingRatio,this.m_localAnchorA=o.localAnchorA.Clone(),this.m_localAnchorB=o.localAnchorB.Clone(),this.m_localXAxisA=o.localAxisA.Clone(),this.m_localYAxisA=box2d.b2CrossOneV(this.m_localXAxisA,new box2d.b2Vec2),this.m_maxMotorTorque=o.maxMotorTorque,this.m_motorSpeed=o.motorSpeed,this.m_enableMotor=o.enableMotor,this.m_localCenterA=new box2d.b2Vec2,this.m_localCenterB=new box2d.b2Vec2,this.m_ax=new box2d.b2Vec2,this.m_ay=new box2d.b2Vec2,this.m_qA=new box2d.b2Rot,this.m_qB=new box2d.b2Rot,this.m_lalcA=new box2d.b2Vec2,this.m_lalcB=new box2d.b2Vec2,this.m_rA=new box2d.b2Vec2,this.m_rB=new box2d.b2Vec2,this.m_ax.SetZero(),this.m_ay.SetZero()},goog.inherits(box2d.b2WheelJoint,box2d.b2Joint),box2d.b2WheelJoint.prototype.m_frequencyHz=0,box2d.b2WheelJoint.prototype.m_dampingRatio=0,box2d.b2WheelJoint.prototype.m_localAnchorA=null,box2d.b2WheelJoint.prototype.m_localAnchorB=null,box2d.b2WheelJoint.prototype.m_localXAxisA=null,box2d.b2WheelJoint.prototype.m_localYAxisA=null,box2d.b2WheelJoint.prototype.m_impulse=0,box2d.b2WheelJoint.prototype.m_motorImpulse=0,box2d.b2WheelJoint.prototype.m_springImpulse=0,box2d.b2WheelJoint.prototype.m_maxMotorTorque=0,box2d.b2WheelJoint.prototype.m_motorSpeed=0,box2d.b2WheelJoint.prototype.m_enableMotor=!1,box2d.b2WheelJoint.prototype.m_indexA=0,box2d.b2WheelJoint.prototype.m_indexB=0,box2d.b2WheelJoint.prototype.m_localCenterA=null,box2d.b2WheelJoint.prototype.m_localCenterB=null,box2d.b2WheelJoint.prototype.m_invMassA=0,box2d.b2WheelJoint.prototype.m_invMassB=0,box2d.b2WheelJoint.prototype.m_invIA=0,box2d.b2WheelJoint.prototype.m_invIB=0,box2d.b2WheelJoint.prototype.m_ax=null,box2d.b2WheelJoint.prototype.m_ay=null,box2d.b2WheelJoint.prototype.m_sAx=0,box2d.b2WheelJoint.prototype.m_sBx=0,box2d.b2WheelJoint.prototype.m_sAy=0,box2d.b2WheelJoint.prototype.m_sBy=0,box2d.b2WheelJoint.prototype.m_mass=0,box2d.b2WheelJoint.prototype.m_motorMass=0,box2d.b2WheelJoint.prototype.m_springMass=0,box2d.b2WheelJoint.prototype.m_bias=0,box2d.b2WheelJoint.prototype.m_gamma=0,box2d.b2WheelJoint.prototype.m_qA=null,box2d.b2WheelJoint.prototype.m_qB=null,box2d.b2WheelJoint.prototype.m_lalcA=null,box2d.b2WheelJoint.prototype.m_lalcB=null,box2d.b2WheelJoint.prototype.m_rA=null,box2d.b2WheelJoint.prototype.m_rB=null,box2d.b2WheelJoint.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},box2d.b2WheelJoint.prototype.GetMaxMotorTorque=function(){return this.m_maxMotorTorque},box2d.b2WheelJoint.prototype.SetSpringFrequencyHz=function(o){this.m_frequencyHz=o},box2d.b2WheelJoint.prototype.GetSpringFrequencyHz=function(){return this.m_frequencyHz},box2d.b2WheelJoint.prototype.SetSpringDampingRatio=function(o){this.m_dampingRatio=o},box2d.b2WheelJoint.prototype.GetSpringDampingRatio=function(){return this.m_dampingRatio},box2d.b2WheelJoint.prototype.InitVelocityConstraints=function(o){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var t=this.m_invMassA,e=this.m_invMassB,i=this.m_invIA,n=this.m_invIB,s=o.positions[this.m_indexA].c,r=o.positions[this.m_indexA].a,b=o.velocities[this.m_indexA].v,a=o.velocities[this.m_indexA].w,d=o.positions[this.m_indexB].c,l=o.positions[this.m_indexB].a,x=o.velocities[this.m_indexB].v,p=o.velocities[this.m_indexB].w,m=this.m_qA.SetAngleRadians(r),h=this.m_qB.SetAngleRadians(l);box2d.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var _=box2d.b2MulRV(m,this.m_lalcA,this.m_rA);box2d.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var c=box2d.b2MulRV(h,this.m_lalcB,this.m_rB),y=box2d.b2SubVV(box2d.b2AddVV(d,c,box2d.b2Vec2.s_t0),box2d.b2AddVV(s,_,box2d.b2Vec2.s_t1),box2d.b2WheelJoint.prototype.InitVelocityConstraints.s_d);if(box2d.b2MulRV(m,this.m_localYAxisA,this.m_ay),this.m_sAy=box2d.b2CrossVV(box2d.b2AddVV(y,_,box2d.b2Vec2.s_t0),this.m_ay),this.m_sBy=box2d.b2CrossVV(c,this.m_ay),this.m_mass=t+e+i*this.m_sAy*this.m_sAy+n*this.m_sBy*this.m_sBy,0<this.m_mass&&(this.m_mass=1/this.m_mass),this.m_springMass=0,this.m_bias=0,(this.m_gamma=0)<this.m_frequencyHz){box2d.b2MulRV(m,this.m_localXAxisA,this.m_ax),this.m_sAx=box2d.b2CrossVV(box2d.b2AddVV(y,_,box2d.b2Vec2.s_t0),this.m_ax),this.m_sBx=box2d.b2CrossVV(c,this.m_ax);var u=t+e+i*this.m_sAx*this.m_sAx+n*this.m_sBx*this.m_sBx;if(0<u){this.m_springMass=1/u;var g=box2d.b2DotVV(y,this.m_ax),f=2*box2d.b2_pi*this.m_frequencyHz,S=2*this.m_springMass*this.m_dampingRatio*f,A=this.m_springMass*f*f,C=o.step.dt;this.m_gamma=C*(S+C*A),0<this.m_gamma&&(this.m_gamma=1/this.m_gamma),this.m_bias=g*C*A*this.m_gamma,this.m_springMass=u+this.m_gamma,0<this.m_springMass&&(this.m_springMass=1/this.m_springMass)}}else this.m_springImpulse=0;if(this.m_enableMotor?(this.m_motorMass=i+n,0<this.m_motorMass&&(this.m_motorMass=1/this.m_motorMass)):(this.m_motorMass=0,this.m_motorImpulse=0),o.step.warmStarting){this.m_impulse*=o.step.dtRatio,this.m_springImpulse*=o.step.dtRatio,this.m_motorImpulse*=o.step.dtRatio;var v=box2d.b2AddVV(box2d.b2MulSV(this.m_impulse,this.m_ay,box2d.b2Vec2.s_t0),box2d.b2MulSV(this.m_springImpulse,this.m_ax,box2d.b2Vec2.s_t1),box2d.b2WheelJoint.prototype.InitVelocityConstraints.s_P),V=this.m_impulse*this.m_sAy+this.m_springImpulse*this.m_sAx+this.m_motorImpulse,B=this.m_impulse*this.m_sBy+this.m_springImpulse*this.m_sBx+this.m_motorImpulse;b.SelfMulSub(this.m_invMassA,v),a-=this.m_invIA*V,x.SelfMulAdd(this.m_invMassB,v),p+=this.m_invIB*B}else this.m_impulse=0,this.m_springImpulse=0,this.m_motorImpulse=0;o.velocities[this.m_indexA].w=a,o.velocities[this.m_indexB].w=p},box2d.b2WheelJoint.prototype.InitVelocityConstraints.s_d=new box2d.b2Vec2,box2d.b2WheelJoint.prototype.InitVelocityConstraints.s_P=new box2d.b2Vec2,box2d.b2WheelJoint.prototype.SolveVelocityConstraints=function(o){var t=this.m_invMassA,e=this.m_invMassB,i=this.m_invIA,n=this.m_invIB,s=o.velocities[this.m_indexA].v,r=o.velocities[this.m_indexA].w,b=o.velocities[this.m_indexB].v,a=o.velocities[this.m_indexB].w,d=box2d.b2DotVV(this.m_ax,box2d.b2SubVV(b,s,box2d.b2Vec2.s_t0))+this.m_sBx*a-this.m_sAx*r,l=-this.m_springMass*(d+this.m_bias+this.m_gamma*this.m_springImpulse);this.m_springImpulse+=l;var x=box2d.b2MulSV(l,this.m_ax,box2d.b2WheelJoint.prototype.SolveVelocityConstraints.s_P),p=l*this.m_sAx,m=l*this.m_sBx;s.SelfMulSub(t,x),r-=i*p,b.SelfMulAdd(e,x);d=(a+=n*m)-r-this.m_motorSpeed,l=-this.m_motorMass*d;var h=this.m_motorImpulse,_=o.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=box2d.b2Clamp(this.m_motorImpulse+l,-_,_),r-=i*(l=this.m_motorImpulse-h),a+=n*l;d=box2d.b2DotVV(this.m_ay,box2d.b2SubVV(b,s,box2d.b2Vec2.s_t0))+this.m_sBy*a-this.m_sAy*r,l=-this.m_mass*d;this.m_impulse+=l;x=box2d.b2MulSV(l,this.m_ay,box2d.b2WheelJoint.prototype.SolveVelocityConstraints.s_P),p=l*this.m_sAy,m=l*this.m_sBy;s.SelfMulSub(t,x),r-=i*p,b.SelfMulAdd(e,x),a+=n*m,o.velocities[this.m_indexA].w=r,o.velocities[this.m_indexB].w=a},box2d.b2WheelJoint.prototype.SolveVelocityConstraints.s_P=new box2d.b2Vec2,box2d.b2WheelJoint.prototype.SolvePositionConstraints=function(o){var t=o.positions[this.m_indexA].c,e=o.positions[this.m_indexA].a,i=o.positions[this.m_indexB].c,n=o.positions[this.m_indexB].a,s=this.m_qA.SetAngleRadians(e),r=this.m_qB.SetAngleRadians(n);box2d.b2SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var b=box2d.b2MulRV(s,this.m_lalcA,this.m_rA);box2d.b2SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var a,d=box2d.b2MulRV(r,this.m_lalcB,this.m_rB),l=box2d.b2AddVV(box2d.b2SubVV(i,t,box2d.b2Vec2.s_t0),box2d.b2SubVV(d,b,box2d.b2Vec2.s_t1),box2d.b2WheelJoint.prototype.SolvePositionConstraints.s_d),x=box2d.b2MulRV(s,this.m_localYAxisA,this.m_ay),p=box2d.b2CrossVV(box2d.b2AddVV(l,b,box2d.b2Vec2.s_t0),x),m=box2d.b2CrossVV(d,x),h=box2d.b2DotVV(l,this.m_ay),_=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_sAy*this.m_sAy+this.m_invIB*this.m_sBy*this.m_sBy;a=0!==_?-h/_:0;var c=box2d.b2MulSV(a,x,box2d.b2WheelJoint.prototype.SolvePositionConstraints.s_P),y=a*p,u=a*m;return t.SelfMulSub(this.m_invMassA,c),e-=this.m_invIA*y,i.SelfMulAdd(this.m_invMassB,c),n+=this.m_invIB*u,o.positions[this.m_indexA].a=e,o.positions[this.m_indexB].a=n,box2d.b2Abs(h)<=box2d.b2_linearSlop},box2d.b2WheelJoint.prototype.SolvePositionConstraints.s_d=new box2d.b2Vec2,box2d.b2WheelJoint.prototype.SolvePositionConstraints.s_P=new box2d.b2Vec2,box2d.b2WheelJoint.prototype.GetDefinition=function(o){return box2d.ENABLE_ASSERTS&&box2d.b2Assert(!1),o},box2d.b2WheelJoint.prototype.GetAnchorA=function(o){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,o)},box2d.b2WheelJoint.prototype.GetAnchorB=function(o){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,o)},box2d.b2WheelJoint.prototype.GetReactionForce=function(o,t){return t.x=o*(this.m_impulse*this.m_ay.x+this.m_springImpulse*this.m_ax.x),t.y=o*(this.m_impulse*this.m_ay.y+this.m_springImpulse*this.m_ax.y),t},box2d.b2WheelJoint.prototype.GetReactionTorque=function(o){return o*this.m_motorImpulse},box2d.b2WheelJoint.prototype.GetLocalAnchorA=function(o){return o.Copy(this.m_localAnchorA)},box2d.b2WheelJoint.prototype.GetLocalAnchorB=function(o){return o.Copy(this.m_localAnchorB)},box2d.b2WheelJoint.prototype.GetLocalAxisA=function(o){return o.Copy(this.m_localXAxisA)},box2d.b2WheelJoint.prototype.GetJointTranslation=function(){var o=this.m_bodyA,t=this.m_bodyB,e=o.GetWorldPoint(this.m_localAnchorA,new box2d.b2Vec2),i=t.GetWorldPoint(this.m_localAnchorB,new box2d.b2Vec2),n=box2d.b2SubVV(i,e,new box2d.b2Vec2),s=o.GetWorldVector(this.m_localXAxisA,new box2d.b2Vec2);return box2d.b2DotVV(n,s)},box2d.b2WheelJoint.prototype.GetJointSpeed=function(){var o=this.m_bodyA.m_angularVelocity;return this.m_bodyB.m_angularVelocity-o},box2d.b2WheelJoint.prototype.IsMotorEnabled=function(){return this.m_enableMotor},box2d.b2WheelJoint.prototype.EnableMotor=function(o){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=o},box2d.b2WheelJoint.prototype.SetMotorSpeed=function(o){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=o},box2d.b2WheelJoint.prototype.SetMaxMotorTorque=function(o){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorTorque=o},box2d.b2WheelJoint.prototype.GetMotorTorque=function(o){return o*this.m_motorImpulse},box2d.b2WheelJoint.prototype.Dump=function(){if(box2d.DEBUG){var o=this.m_bodyA.m_islandIndex,t=this.m_bodyB.m_islandIndex;box2d.b2Log("  /*box2d.b2WheelJointDef*/ var jd = new box2d.b2WheelJointDef();\n"),box2d.b2Log("  jd.bodyA = bodies[%d];\n",o),box2d.b2Log("  jd.bodyB = bodies[%d];\n",t),box2d.b2Log("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),box2d.b2Log("  jd.localAnchorA.SetXY(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),box2d.b2Log("  jd.localAnchorB.SetXY(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),box2d.b2Log("  jd.localAxisA.Set(%.15f, %.15f);\n",this.m_localXAxisA.x,this.m_localXAxisA.y),box2d.b2Log("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),box2d.b2Log("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),box2d.b2Log("  jd.maxMotorTorque = %.15f;\n",this.m_maxMotorTorque),box2d.b2Log("  jd.frequencyHz = %.15f;\n",this.m_frequencyHz),box2d.b2Log("  jd.dampingRatio = %.15f;\n",this.m_dampingRatio),box2d.b2Log("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}},goog.provide("box2d.b2MotorJoint"),goog.require("box2d.b2Settings"),goog.require("box2d.b2Math"),box2d.b2MotorJointDef=function(){goog.base(this,box2d.b2JointType.e_motorJoint),this.linearOffset=new box2d.b2Vec2(0,0)},goog.inherits(box2d.b2MotorJointDef,box2d.b2JointDef),box2d.b2MotorJointDef.prototype.linearOffset=null,box2d.b2MotorJointDef.prototype.angularOffset=0,box2d.b2MotorJointDef.prototype.maxForce=1,box2d.b2MotorJointDef.prototype.maxTorque=1,box2d.b2MotorJointDef.prototype.correctionFactor=.3,box2d.b2MotorJointDef.prototype.Initialize=function(o,t){this.bodyA=o,this.bodyB=t,this.bodyA.GetLocalPoint(this.bodyB.GetPosition(),this.linearOffset);var e=this.bodyA.GetAngleRadians(),i=this.bodyB.GetAngleRadians();this.angularOffset=i-e},box2d.b2MotorJoint=function(o){goog.base(this,o),this.m_linearOffset=o.linearOffset.Clone(),this.m_linearImpulse=new box2d.b2Vec2(0,0),this.m_maxForce=o.maxForce,this.m_maxTorque=o.maxTorque,this.m_correctionFactor=o.correctionFactor,this.m_rA=new box2d.b2Vec2(0,0),this.m_rB=new box2d.b2Vec2(0,0),this.m_localCenterA=new box2d.b2Vec2(0,0),this.m_localCenterB=new box2d.b2Vec2(0,0),this.m_linearError=new box2d.b2Vec2(0,0),this.m_linearMass=new box2d.b2Mat22,this.m_qA=new box2d.b2Rot,this.m_qB=new box2d.b2Rot,this.m_K=new box2d.b2Mat22},goog.inherits(box2d.b2MotorJoint,box2d.b2Joint),box2d.b2MotorJoint.prototype.m_linearOffset=null,box2d.b2MotorJoint.prototype.m_angularOffset=0,box2d.b2MotorJoint.prototype.m_linearImpulse=null,box2d.b2MotorJoint.prototype.m_angularImpulse=0,box2d.b2MotorJoint.prototype.m_maxForce=0,box2d.b2MotorJoint.prototype.m_maxTorque=0,box2d.b2MotorJoint.prototype.m_correctionFactor=.3,box2d.b2MotorJoint.prototype.m_indexA=0,box2d.b2MotorJoint.prototype.m_indexB=0,box2d.b2MotorJoint.prototype.m_rA=null,box2d.b2MotorJoint.prototype.m_rB=null,box2d.b2MotorJoint.prototype.m_localCenterA=null,box2d.b2MotorJoint.prototype.m_localCenterB=null,box2d.b2MotorJoint.prototype.m_linearError=null,box2d.b2MotorJoint.prototype.m_angularError=0,box2d.b2MotorJoint.prototype.m_invMassA=0,box2d.b2MotorJoint.prototype.m_invMassB=0,box2d.b2MotorJoint.prototype.m_invIA=0,box2d.b2MotorJoint.prototype.m_invIB=0,box2d.b2MotorJoint.prototype.m_linearMass=null,box2d.b2MotorJoint.prototype.m_angularMass=0,box2d.b2MotorJoint.prototype.m_qA=null,box2d.b2MotorJoint.prototype.m_qB=null,box2d.b2MotorJoint.prototype.m_K=null,box2d.b2MotorJoint.prototype.GetAnchorA=function(o){return this.m_bodyA.GetPosition(o)},box2d.b2MotorJoint.prototype.GetAnchorB=function(o){return this.m_bodyB.GetPosition(o)},box2d.b2MotorJoint.prototype.GetReactionForce=function(o,t){return box2d.b2MulSV(o,this.m_linearImpulse,t)},box2d.b2MotorJoint.prototype.GetReactionTorque=function(o){return o*this.m_angularImpulse},box2d.b2MotorJoint.prototype.SetCorrectionFactor=function(o){box2d.ENABLE_ASSERTS&&box2d.b2Assert(box2d.b2IsValid(o)&&0<=o&&o<=1),this._correctionFactor=o},box2d.b2MotorJoint.prototype.GetCorrectionFactor=function(){return this.m_correctionFactor},box2d.b2MotorJoint.prototype.SetLinearOffset=function(o){box2d.b2IsEqualToV(o,this.m_linearOffset)||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_linearOffset.Copy(o))},box2d.b2MotorJoint.prototype.GetLinearOffset=function(o){return o.Copy(this.m_linearOffset)},box2d.b2MotorJoint.prototype.SetAngularOffset=function(o){o!==this.m_angularOffset&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_angularOffset=o)},box2d.b2MotorJoint.prototype.GetAngularOffset=function(){return this.m_angularOffset},box2d.b2MotorJoint.prototype.SetMaxForce=function(o){box2d.ENABLE_ASSERTS&&box2d.b2Assert(box2d.b2IsValid(o)&&0<=o),this.m_maxForce=o},box2d.b2MotorJoint.prototype.GetMaxForce=function(){return this.m_maxForce},box2d.b2MotorJoint.prototype.SetMaxTorque=function(o){box2d.ENABLE_ASSERTS&&box2d.b2Assert(box2d.b2IsValid(o)&&0<=o),this.m_maxTorque=o},box2d.b2MotorJoint.prototype.GetMaxTorque=function(){return this.m_maxTorque},box2d.b2MotorJoint.prototype.InitVelocityConstraints=function(o){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var t=o.positions[this.m_indexA].c,e=o.positions[this.m_indexA].a,i=o.velocities[this.m_indexA].v,n=o.velocities[this.m_indexA].w,s=o.positions[this.m_indexB].c,r=o.positions[this.m_indexB].a,b=o.velocities[this.m_indexB].v,a=o.velocities[this.m_indexB].w,d=this.m_qA.SetAngleRadians(e),l=this.m_qB.SetAngleRadians(r),x=box2d.b2MulRV(d,box2d.b2NegV(this.m_localCenterA,box2d.b2Vec2.s_t0),this.m_rA),p=box2d.b2MulRV(l,box2d.b2NegV(this.m_localCenterB,box2d.b2Vec2.s_t0),this.m_rB),m=this.m_invMassA,h=this.m_invMassB,_=this.m_invIA,c=this.m_invIB,y=this.m_K;if(y.ex.x=m+h+_*x.y*x.y+c*p.y*p.y,y.ex.y=-_*x.x*x.y-c*p.x*p.y,y.ey.x=y.ex.y,y.ey.y=m+h+_*x.x*x.x+c*p.x*p.x,y.GetInverse(this.m_linearMass),this.m_angularMass=_+c,0<this.m_angularMass&&(this.m_angularMass=1/this.m_angularMass),box2d.b2SubVV(box2d.b2SubVV(box2d.b2AddVV(s,p,box2d.b2Vec2.s_t0),box2d.b2AddVV(t,x,box2d.b2Vec2.s_t1),box2d.b2Vec2.s_t2),box2d.b2MulRV(d,this.m_linearOffset,box2d.b2Vec2.s_t3),this.m_linearError),this.m_angularError=r-e-this.m_angularOffset,o.step.warmStarting){this.m_linearImpulse.SelfMul(o.step.dtRatio),this.m_angularImpulse*=o.step.dtRatio;var u=this.m_linearImpulse;i.SelfMulSub(m,u),n-=_*(box2d.b2CrossVV(x,u)+this.m_angularImpulse),b.SelfMulAdd(h,u),a+=c*(box2d.b2CrossVV(p,u)+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0;o.velocities[this.m_indexA].w=n,o.velocities[this.m_indexB].w=a},box2d.b2MotorJoint.prototype.SolveVelocityConstraints=function(o){var t=o.velocities[this.m_indexA].v,e=o.velocities[this.m_indexA].w,i=o.velocities[this.m_indexB].v,n=o.velocities[this.m_indexB].w,s=this.m_invMassA,r=this.m_invMassB,b=this.m_invIA,a=this.m_invIB,d=o.step.dt,l=o.step.inv_dt,x=n-e+l*this.m_correctionFactor*this.m_angularError,p=-this.m_angularMass*x,m=this.m_angularImpulse,h=d*this.m_maxTorque;this.m_angularImpulse=box2d.b2Clamp(this.m_angularImpulse+p,-h,h),e-=b*(p=this.m_angularImpulse-m),n+=a*p;var _=this.m_rA,c=this.m_rB;x=box2d.b2AddVV(box2d.b2SubVV(box2d.b2AddVV(i,box2d.b2CrossSV(n,c,box2d.b2Vec2.s_t0),box2d.b2Vec2.s_t0),box2d.b2AddVV(t,box2d.b2CrossSV(e,_,box2d.b2Vec2.s_t1),box2d.b2Vec2.s_t1),box2d.b2Vec2.s_t2),box2d.b2MulSV(l*this.m_correctionFactor,this.m_linearError,box2d.b2Vec2.s_t3),box2d.b2MotorJoint.prototype.SolveVelocityConstraints.s_Cdot),p=box2d.b2MulMV(this.m_linearMass,x,box2d.b2MotorJoint.prototype.SolveVelocityConstraints.s_impulse).SelfNeg(),m=box2d.b2MotorJoint.prototype.SolveVelocityConstraints.s_oldImpulse.Copy(this.m_linearImpulse);this.m_linearImpulse.SelfAdd(p);h=d*this.m_maxForce;this.m_linearImpulse.GetLengthSquared()>h*h&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.SelfMul(h)),box2d.b2SubVV(this.m_linearImpulse,m,p),t.SelfMulSub(s,p),e-=b*box2d.b2CrossVV(_,p),i.SelfMulAdd(r,p),n+=a*box2d.b2CrossVV(c,p),o.velocities[this.m_indexA].w=e,o.velocities[this.m_indexB].w=n},box2d.b2MotorJoint.prototype.SolveVelocityConstraints.s_Cdot=new box2d.b2Vec2,box2d.b2MotorJoint.prototype.SolveVelocityConstraints.s_impulse=new box2d.b2Vec2,box2d.b2MotorJoint.prototype.SolveVelocityConstraints.s_oldImpulse=new box2d.b2Vec2,box2d.b2MotorJoint.prototype.SolvePositionConstraints=function(o){return!0},box2d.b2MotorJoint.prototype.Dump=function(){if(box2d.DEBUG){var o=this.m_bodyA.m_islandIndex,t=this.m_bodyB.m_islandIndex;box2d.b2Log("  /*box2d.b2MotorJointDef*/ var jd = new box2d.b2MotorJointDef();\n"),box2d.b2Log("  jd.bodyA = bodies[%d];\n",o),box2d.b2Log("  jd.bodyB = bodies[%d];\n",t),box2d.b2Log("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),box2d.b2Log("  jd.linearOffset.SetXY(%.15f, %.15f);\n",this.m_linearOffset.x,this.m_linearOffset.y),box2d.b2Log("  jd.angularOffset = %.15f;\n",this.m_angularOffset),box2d.b2Log("  jd.maxForce = %.15f;\n",this.m_maxForce),box2d.b2Log("  jd.maxTorque = %.15f;\n",this.m_maxTorque),box2d.b2Log("  jd.correctionFactor = %.15f;\n",this.m_correctionFactor),box2d.b2Log("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)}},goog.provide("box2d"),goog.require("box2d.b2Settings"),goog.require("box2d.b2Draw"),goog.require("box2d.b2Timer"),goog.require("box2d.b2CircleShape"),goog.require("box2d.b2EdgeShape"),goog.require("box2d.b2ChainShape"),goog.require("box2d.b2PolygonShape"),goog.require("box2d.b2BroadPhase"),goog.require("box2d.b2Distance"),goog.require("box2d.b2DynamicTree"),goog.require("box2d.b2TimeOfImpact"),goog.require("box2d.b2Body"),goog.require("box2d.b2Fixture"),goog.require("box2d.b2WorldCallbacks"),goog.require("box2d.b2TimeStep"),goog.require("box2d.b2World"),goog.require("box2d.b2Contact"),goog.require("box2d.b2AreaJoint"),goog.require("box2d.b2DistanceJoint"),goog.require("box2d.b2FrictionJoint"),goog.require("box2d.b2GearJoint"),goog.require("box2d.b2MotorJoint"),goog.require("box2d.b2MouseJoint"),goog.require("box2d.b2PrismaticJoint"),goog.require("box2d.b2PulleyJoint"),goog.require("box2d.b2RevoluteJoint"),goog.require("box2d.b2RopeJoint"),goog.require("box2d.b2WeldJoint"),goog.require("box2d.b2WheelJoint"),goog.require("box2d.b2Rope"),goog.require("box2d.b2BuoyancyController"),goog.require("box2d.b2ConstantAccelController"),goog.require("box2d.b2ConstantForceController"),goog.require("box2d.b2GravityController"),goog.require("box2d.b2TensorDampingController"),Phaser.Physics.Box2D=function(o,t){this.game=o,this.version="1.0.2",this.ptmRatio=50,this.world=new box2d.b2World(new box2d.b2Vec2(0,0)),this.debugDraw=new Phaser.Physics.Box2D.DefaultDebugDraw(this.mpx(1)),this.world.SetDebugDraw(this.debugDraw),this.contactListener=new Phaser.Physics.Box2D.DefaultContactListener,this.world.SetContactListener(this.contactListener),this.nextBodyId=0,this.nextFixtureId=0,this.gravity=new Phaser.Physics.Box2D.PointProxy(this,this.world,this.world.GetGravity,this.world.SetGravity),this.friction=.2,this.restitution=0,this.density=1,this.frameRate=1/60,this.velocityIterations=8,this.positionIterations=3,this.useElapsedTime=!1,this.paused=!1,this.particleSystem=null;var e=new box2d.b2BodyDef;this.mouseJointBody=this.world.CreateBody(e),this.mouseJoint=null,t.hasOwnProperty("mpx")&&t.hasOwnProperty("pxm")&&(this.mpx=t.mpx,this.pxm=t.pxm),this.walls={left:null,right:null,top:null,bottom:null},this.onBodyAdded=new Phaser.Signal,this.onBodyRemoved=new Phaser.Signal,this._toRemove=[]},Phaser.Physics.Box2D.worldBoundsFilterCategory=32768,Phaser.Physics.Box2D.prototype={getNextBodyId:function(){var o=this.nextBodyId;return this.nextBodyId+=1,o},getNextFixtureId:function(){var o=this.nextFixtureId;return this.nextFixtureId+=1,o},removeBodyNextStep:function(o){this._toRemove.push(o)},preUpdate:function(){for(var o=this._toRemove.length;o--;)this.removeBody(this._toRemove[o]);this._toRemove.length=0},enable:function(o,t){void 0===t&&(t=!0);var e=1;if(Array.isArray(o))for(e=o.length;e--;)o[e]instanceof Phaser.Group?this.enable(o[e].children,t):(this.enableBody(o[e]),t&&o[e].hasOwnProperty("children")&&0<o[e].children.length&&this.enable(o[e],!0));else o instanceof Phaser.Group?this.enable(o.children,t):(this.enableBody(o),t&&o.hasOwnProperty("children")&&0<o.children.length&&this.enable(o.children,!0))},enableBody:function(o){o.hasOwnProperty("body")&&null===o.body&&(o.body=new Phaser.Physics.Box2D.Body(this.game,o,o.x,o.y,2),o.anchor.set(.5))},setBoundsToWorld:function(o,t,e,i,n,s){void 0===o&&(o=!0),void 0===t&&(t=!0),void 0===e&&(e=!0),void 0===i&&(i=!0),void 0===n&&(n=1),void 0===s&&(n=4294967295),this.setBounds(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,o,t,e,i,n,s)},setBounds:function(o,t,e,i,n,s,r,b,a,d){void 0===n&&(n=!0),void 0===s&&(s=!0),void 0===r&&(r=!0),void 0===b&&(b=!0),void 0===a&&(a=1),void 0===d&&(d=4294967295),this.walls.left&&this.removeBody(this.walls.left),this.walls.right&&this.removeBody(this.walls.right),this.walls.top&&this.removeBody(this.walls.top),this.walls.bottom&&this.removeBody(this.walls.bottom);var l=new box2d.b2PolygonShape,x=new box2d.b2FixtureDef;x.shape=l,x.filter.categoryBits=Phaser.Physics.Box2D.worldBoundsFilterCategory,x.filter.maskBits=65535;var p=this.pxm(100),m=this.game.world.bounds;n&&(this.walls.left=this.createBody(0,0,0),l.SetAsOrientedBox(p,this.pxm(m.height)+p,new box2d.b2Vec2(p,0),0),this.walls.left.data.CreateFixture(x).id=this.getNextFixtureId());s&&(this.walls.right=this.createBody(0,0,0),l.SetAsOrientedBox(p,this.pxm(m.height)+p,new box2d.b2Vec2(this.pxm(-m.width)-p,0),0),this.walls.right.data.CreateFixture(x).id=this.getNextFixtureId());r&&(this.walls.top=this.createBody(0,0,0),l.SetAsOrientedBox(this.pxm(m.width)+p,p,new box2d.b2Vec2(0,p),0),this.walls.top.data.CreateFixture(x).id=this.getNextFixtureId());b&&(this.walls.bottom=this.createBody(0,0,0),l.SetAsOrientedBox(this.pxm(m.width)+p,p,new box2d.b2Vec2(0,this.pxm(-m.height)-p),0),this.walls.bottom.data.CreateFixture(x).id=this.getNextFixtureId())},pause:function(){this.paused=!0},resume:function(){this.paused=!1},update:function(){this.paused||(this.useElapsedTime?this.world.Step(this.game.time.physicsElapsed,this.velocityIterations,this.positionIterations):this.world.Step(this.frameRate,this.velocityIterations,this.positionIterations))},reset:function(){this.clear()},clear:function(){var o=this.world.GetGravity().Clone();this.world=new box2d.b2World(o),this.world.SetDebugDraw(this.debugDraw),this.world.SetContactListener(this.contactListener),this._toRemove=[]},destroy:function(){this.clear(),this.gravity=null,this.world=null,this.game=null},createBody:function(o,t,e){return new Phaser.Physics.Box2D.Body(this.game,null,o,t,e,this)},createCircle:function(o,t,e,i,n){return this.createBody(o,t,2).setCircle(e,i,n)},createRectangle:function(o,t,e,i,n,s,r){return this.createBody(o,t,2).setRectangle(e,i,n,s,r)},createPolygon:function(o,t,e,i,n){return this.createBody(o,t,2).setPolygon(e,i,n)},addBody:function(o){return!o.data.world&&(o.data=this.world.CreateBody(o.bodyDef),o.data.world=this.world,o.data.parent=o,this.onBodyAdded.dispatch(o),!0)},removeBody:function(o){return o.data.world==this.world&&(this.world.DestroyBody(o.data),this.onBodyRemoved.dispatch(o)),o},getBodies:function(){for(var o=[],t=this.world.GetBodyList();t;t=t.GetNext())o.push(t);return o},getBody:function(o){return o instanceof box2d.b2Body?o:o instanceof Phaser.Physics.Box2D.Body?o.data:o.body&&o.body.type===Phaser.Physics.BOX2D?o.body.data:null},toJSON:function(){return this.world.toJSON()},mpx:function(o){return o*this.ptmRatio},pxm:function(o){return o/this.ptmRatio},renderDebugDraw:function(o){if(this.game.physics.box2d){var t=this.game.physics.box2d;t.debugDraw.start(o),t.world.DrawDebugData(),t.debugDraw.stop()}},renderBodyInfo:function(o,t){o.line("Position: x: "+t.x.toFixed(3)+" y: "+t.y.toFixed(3)),o.line("Rotation: "+t.rotation.toFixed(3)+" degrees"),o.line("Velocity: x: "+t.velocity.x.toFixed(3)+" y: "+t.velocity.y.toFixed(3)),o.line("Angular velocity: "+t.angularVelocity.toFixed(3)+" degrees/sec")},getFixturesAtPoint:function(o,t,e,i){void 0===e&&(e=!1),void 0===i&&(i=!1);var n=this.pxm(-o),s=this.pxm(-t),r=new box2d.b2Vec2(n,s),b=new box2d.b2AABB,a=new box2d.b2Vec2;a.SetXY(.001,.001),box2d.b2SubVV(r,a,b.lowerBound),box2d.b2AddVV(r,a,b.upperBound);var d=[];return this.world.QueryAABB(function(o){return!(!i||o.GetBody().GetType()===box2d.b2BodyType.b2_dynamicBody)||!o.TestPoint(r)||(d.push(o),!e)},b),d},getBodiesAtPoint:function(o,t,e,i){void 0===e&&(e=!1),void 0===i&&(i=!1);var n=this.getFixturesAtPoint(o,t,e,i);if(n.length<1)return n;for(var s=[],r=0;r<n.length;r++)s.push(n[r].GetBody().parent);return s.filter(function(o,t){return s.indexOf(o)===t}),s},mouseDragStart:function(o){this.mouseDragEnd();var t=this.getFixturesAtPoint(o.x,o.y,!0,!0);if(!(t.length<1)){var e=this.pxm(-o.x),i=this.pxm(-o.y),n=new box2d.b2Vec2(e,i),s=new box2d.b2MouseJointDef;s.bodyA=this.mouseJointBody,s.bodyB=t[0].GetBody(),s.target.Copy(n),s.maxForce=1e3*s.bodyB.GetMass(),this.mouseJoint=this.world.CreateJoint(s),s.bodyB.SetAwake(!0)}},mouseDragMove:function(o){if(this.mouseJoint){var t=this.pxm(-o.x),e=this.pxm(-o.y),i=new box2d.b2Vec2(t,e);this.mouseJoint.SetTarget(i)}},mouseDragEnd:function(){this.mouseJoint&&(this.world.DestroyJoint(this.mouseJoint),this.mouseJoint=null)},distanceJoint:function(o,t,e,i,n,s,r,b,a){void 0===i&&(i=0),void 0===n&&(n=0),void 0===s&&(s=0),void 0===r&&(r=0),void 0===b&&(b=0),void 0===a&&(a=0),i=this.pxm(-i),n=this.pxm(-n),s=this.pxm(-s),r=this.pxm(-r),o.body&&(o=o.body),t.body&&(t=t.body);var d=new box2d.b2DistanceJointDef;if(d.bodyA=o.data,d.bodyB=t.data,d.localAnchorA.SetXY(i,n),d.localAnchorB.SetXY(s,r),null==e){var l=new box2d.b2Vec2,x=new box2d.b2Vec2;d.bodyA.GetWorldPoint(d.localAnchorA,l),d.bodyB.GetWorldPoint(d.localAnchorB,x),l.SelfSub(x),e=l.Length()}else e=this.pxm(e);return d.length=e,d.frequencyHz=b,d.dampingRatio=a,this.world.CreateJoint(d)},ropeJoint:function(o,t,e,i,n,s,r){void 0===i&&(i=0),void 0===n&&(n=0),void 0===s&&(s=0),void 0===r&&(r=0),i=this.pxm(-i),n=this.pxm(-n),s=this.pxm(-s),r=this.pxm(-r),o.body&&(o=o.body),t.body&&(t=t.body);var b=new box2d.b2RopeJointDef;if(b.bodyA=o.data,b.bodyB=t.data,b.localAnchorA.SetXY(i,n),b.localAnchorB.SetXY(s,r),null==e){var a=new box2d.b2Vec2,d=new box2d.b2Vec2;b.bodyA.GetWorldPoint(b.localAnchorA,a),b.bodyB.GetWorldPoint(b.localAnchorB,d),a.SelfSub(d),e=a.Length()}else e=this.pxm(e);return b.maxLength=e,this.world.CreateJoint(b)},revoluteJoint:function(o,t,e,i,n,s,r,b,a,d,l,x){void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===s&&(s=0),void 0===r&&(r=0),void 0===b&&(b=0),void 0===a&&(a=!1),void 0===d&&(d=0),void 0===l&&(l=0),void 0===x&&(x=!1),e=this.pxm(-e),i=this.pxm(-i),n=this.pxm(-n),s=this.pxm(-s),o.body&&(o=o.body),t.body&&(t=t.body);var p=new box2d.b2RevoluteJointDef;return p.bodyA=o.data,p.bodyB=t.data,p.localAnchorA.SetXY(e,i),p.localAnchorB.SetXY(n,s),p.motorSpeed=Phaser.Math.degToRad(-r),p.maxMotorTorque=b,p.enableMotor=a,p.lowerAngle=Phaser.Math.degToRad(d),p.upperAngle=Phaser.Math.degToRad(l),p.enableLimit=x,this.world.CreateJoint(p)},prismaticJoint:function(o,t,e,i,n,s,r,b,a,d,l,x,p,m,h){void 0===e&&(e=1),void 0===i&&(i=0),void 0===n&&(n=0),void 0===s&&(s=0),void 0===r&&(r=0),void 0===b&&(b=0),void 0===a&&(a=0),void 0===d&&(d=0),void 0===x&&(x=0),void 0===p&&(p=0),void 0===m&&(m=!1),void 0===l&&(l=!1),void 0===h&&(h=0),e*=-1,i*=-1,n=this.pxm(-n),s=this.pxm(-s),r=this.pxm(-r),b=this.pxm(-b),a=this.pxm(a),x=this.pxm(x),p=this.pxm(p),o.body&&(o=o.body),t.body&&(t=t.body);var _=new box2d.b2PrismaticJointDef;return _.bodyA=o.data,_.bodyB=t.data,_.localAxisA.SetXY(e,i),_.localAnchorA.SetXY(n,s),_.localAnchorB.SetXY(r,b),_.motorSpeed=a,_.maxMotorForce=d,_.enableMotor=l,_.lowerTranslation=x,_.upperTranslation=p,_.enableLimit=m,_.referenceAngle=Phaser.Math.degToRad(-h),this.world.CreateJoint(_)},frictionJoint:function(o,t,e,i,n,s,r,b){void 0===n&&(n=0),void 0===s&&(s=0),void 0===r&&(r=0),void 0===b&&(b=0),void 0===e&&(e=0),void 0===i&&(i=0),n=this.pxm(-n),s=this.pxm(-s),r=this.pxm(-r),b=this.pxm(-b),o.body&&(o=o.body),t.body&&(t=t.body);var a=new box2d.b2FrictionJointDef;return a.bodyA=o.data,a.bodyB=t.data,a.localAnchorA.SetXY(n,s),a.localAnchorB.SetXY(r,b),a.maxForce=e,a.maxTorque=i,this.world.CreateJoint(a)},weldJoint:function(o,t,e,i,n,s,r,b){void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===s&&(s=0),void 0===r&&(r=0),void 0===b&&(b=0),e=this.pxm(-e),i=this.pxm(-i),n=this.pxm(-n),s=this.pxm(-s),o.body&&(o=o.body),t.body&&(t=t.body);var a=new box2d.b2WeldJointDef;return a.bodyA=o.data,a.bodyB=t.data,a.localAnchorA.SetXY(e,i),a.localAnchorB.SetXY(n,s),a.frequencyHz=r,a.dampingRatio=b,this.world.CreateJoint(a)},motorJoint:function(o,t,e,i,n,s,r,b){void 0===s&&(s=0),void 0===r&&(r=0),void 0===b&&(b=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=1),s=this.pxm(-s),r=this.pxm(-r),o.body&&(o=o.body),t.body&&(t=t.body);var a=new box2d.b2MotorJointDef;return a.bodyA=o.data,a.bodyB=t.data,a.linearOffset.SetXY(s,r),a.maxForce=e,a.maxTorque=i,a.angularOffset=Phaser.Math.degToRad(-b),a.correctionFactor=n,this.world.CreateJoint(a)},wheelJoint:function(o,t,e,i,n,s,r,b,a,d,l,x,p){void 0===r&&(r=0),void 0===b&&(b=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===s&&(s=0),void 0===l&&(l=0),void 0===x&&(x=0),void 0===p&&(p=!1),void 0===a&&(a=0),void 0===d&&(d=0),r*=-1,b*=-1,e=this.pxm(-e),i=this.pxm(-i),n=this.pxm(-n),s=this.pxm(-s),o.body&&(o=o.body),t.body&&(t=t.body);var m=new box2d.b2WheelJointDef;return m.bodyA=o.data,m.bodyB=t.data,m.localAxisA.SetXY(r,b),m.localAnchorA.SetXY(e,i),m.localAnchorB.SetXY(n,s),m.motorSpeed=Phaser.Math.degToRad(-l),m.maxMotorTorque=x,m.enableMotor=p,m.frequencyHz=a,m.dampingRatio=d,this.world.CreateJoint(m)},pulleyJoint:function(o,t,e,i,n,s,r,b,a,d,l,x,p){void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),void 0===s&&(s=0),void 0===r&&(r=0),void 0===b&&(b=0),void 0===a&&(a=0),void 0===d&&(d=0),void 0===l&&(l=1),void 0===x&&(x=100),void 0===p&&(p=100),e=this.pxm(-e),i=this.pxm(-i),n=this.pxm(-n),s=this.pxm(-s),r=this.pxm(-r),b=this.pxm(-b),a=this.pxm(-a),d=this.pxm(-d),x=this.pxm(x),p=this.pxm(p),o.body&&(o=o.body),t.body&&(t=t.body);var m=new box2d.b2PulleyJointDef;return m.bodyA=o.data,m.bodyB=t.data,m.localAnchorA.SetXY(e,i),m.localAnchorB.SetXY(n,s),m.groundAnchorA.SetXY(r,b),m.groundAnchorB.SetXY(a,d),m.lengthA=x,m.lengthB=p,m.ratio=l,this.world.CreateJoint(m)},gearJoint:function(o,t,e){void 0===e&&(e=1);var i=new box2d.b2GearJointDef;return i.joint1=o,i.joint2=t,i.ratio=-e,i.bodyA=o.GetBodyA(),i.bodyB=t.GetBodyB(),this.world.CreateJoint(i)},clearTilemapLayerBodies:function(o,t){t=o.getLayer(t);for(var e=o.layers[t].bodies.length;e--;)o.layers[t].bodies[e].destroy();o.layers[t].bodies.length=0},convertTilemap:function(o,t,e,i){t=o.getLayer(t),void 0===e&&(e=!0),void 0===i&&(i=!0),this.clearTilemapLayerBodies(o,t);for(var n=0,s=0,r=0,b=0,a=o.layers[t].height;b<a;b++)for(var d=n=0,l=o.layers[t].width;d<l;d++){var x=o.layers[t].data[b][d];if(x&&-1<x.index&&x.collides)if(i){var p=o.getTileRight(t,d,b);if(0===n&&(s=x.x*x.width,r=x.y*x.height,n=x.width),p&&p.collides)n+=x.width;else(m=new Phaser.Physics.Box2D.Body(this.game,null,s,r,0)).addRectangle(n,x.height,n/2,x.height/2,0),e&&this.addBody(m),o.layers[t].bodies.push(m),n=0}else{var m;(m=this.createBody(x.x*x.width,x.y*x.height,0,!1)).addRectangle(x.width,x.height,x.width/2,x.height/2,0),e&&this.addBody(m),o.layers[t].bodies.push(m)}}return o.layers[t].bodies},raycast:function(o,t,e,i,n,s){void 0===n&&(n=!0),void 0===s&&(s=null),o=this.pxm(-o),t=this.pxm(-t),e=this.pxm(-e),i=this.pxm(-i);var r=new box2d.b2Vec2(o,t),b=new box2d.b2Vec2(e,i),a=[],d=new Phaser.Physics.Box2D.RayCastCallback(this,n,s);this.world.RayCast(d,r,b);for(var l=0;l<d.hits.length;l++){var x=d.hits[l];x.point={x:this.mpx(-x.point.x),y:this.mpx(-x.point.y)},x.normal={x:-x.normal.x,y:-x.normal.y},a.push(x)}return a},queryAABB:function(o,t,e,i){o=this.pxm(-o),t=this.pxm(-t),e=this.pxm(e),i=this.pxm(i);var n=new box2d.b2AABB;n.lowerBound.SetXY(o-e,t-i),n.upperBound.SetXY(o,t);var s=new Phaser.Physics.Box2D.QueryCallback(this);return this.world.QueryAABB(s,n),s.hits},queryFixture:function(o){var t=new Phaser.Physics.Box2D.QueryCallback(this);return this.world.QueryShape(t,o.GetShape(),o.GetBody().GetTransform()),t.hits},setPTMRatio:function(o){this.ptmRatio=o,this.debugDraw=new Phaser.Physics.Box2D.DefaultDebugDraw(this.ptmRatio),this.world.SetDebugDraw(this.debugDraw)}},Phaser.Physics.Box2D.RayCastCallback=function(o,t,e){this.world=o,this.closestHitOnly=t,this.filterFunction=e,this.hits=[]},goog.inherits(Phaser.Physics.Box2D.RayCastCallback,box2d.b2RayCastCallback),Phaser.Physics.Box2D.RayCastCallback.prototype.ReportFixture=function(o,t,e,i){if(null!==this.filterFunction){var n={x:this.world.mpx(-t.x),y:this.world.mpx(-t.y)},s={x:-e.x,y:-e.y},r=o.GetBody().parent;if(!this.filterFunction.call(this,r,o,n,s))return-1}this.closestHitOnly&&(this.hits=[]);var b={};return b.body=o.GetBody().parent,b.fixture=o,b.point={x:t.x,y:t.y},b.normal={x:e.x,y:e.y},this.hits.push(b),this.closestHitOnly?i:1},Phaser.Physics.Box2D.QueryCallback=function(o){this.world=o,this.hits=[]},goog.inherits(Phaser.Physics.Box2D.QueryCallback,box2d.b2QueryCallback),Phaser.Physics.Box2D.QueryCallback.prototype.ReportFixture=function(o){var t={};return t.body=o.GetBody().parent,t.fixture=o,this.hits.push(t),!0},Phaser.Physics.Box2D.renderBody=function(o,t,e,i){e=e||"rgb(255,255,255)",void 0===i&&(i=!0);var n=t.data,s=n.GetTransform(),r=t.world;s.p.x+=-t.game.camera.x/r.ptmRatio,s.p.y-=-t.game.camera.y/r.ptmRatio,r.debugDraw.start(o),r.debugDraw.PushTransform(s);var b=Phaser.Color.webToColor(e),a=r.debugDraw.color;a.r=b.r/255,a.g=b.g/255,a.b=b.b/255;for(var d=n.GetFixtureList();d;d=d.GetNext())r.world.DrawShape(d,a);r.debugDraw.PopTransform(),r.debugDraw.stop()},Phaser.Physics.Box2D.Body=function(o,t,e,i,n,s){void 0===t&&(t=null),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=2),void 0===s&&(s=o.physics.box2d),this.game=o,this.world=s,this.id=this.world.getNextBodyId(),this.sprite=t,this.type=Phaser.Physics.BOX2D,this.offset=new Phaser.Point,this.bodyDef=new box2d.b2BodyDef,this.bodyDef.position.SetXY(-this.world.pxm(e),-this.world.pxm(i)),0===n?this.bodyDef.type=box2d.b2BodyType.b2_staticBody:1===n?this.bodyDef.type=box2d.b2BodyType.b2_kinematicBody:2===n?this.bodyDef.type=box2d.b2BodyType.b2_dynamicBody:3===n&&(this.bodyDef.type=box2d.b2BodyType.b2_bulletBody),this.data=this.world.world.CreateBody(this.bodyDef),this.data.world=this.world.world,(this.data.parent=this).velocity=new Phaser.Physics.Box2D.PointProxy(this.world,this.data,this.data.GetLinearVelocity,this.data.SetLinearVelocity),this.removeNextStep=!1,this._fixtureContactCallbacks={},this._fixtureContactCallbackContext={},this._bodyContactCallbacks={},this._bodyContactCallbackContext={},this._categoryContactCallbacks={},this._categoryContactCallbackContext={},this._fixturePresolveCallbacks={},this._fixturePresolveCallbackContext={},this._bodyPresolveCallbacks={},this._bodyPresolveCallbackContext={},this._categoryPresolveCallbacks={},this._categoryPresolveCallbackContext={},this._fixturePostsolveCallbacks={},this._fixturePostsolveCallbackContext={},this._bodyPostsolveCallbacks={},this._bodyPostsolveCallbackContext={},this._categoryPostsolveCallbacks={},this._categoryPostsolveCallbackContext={},t&&this.setRectangleFromSprite(t)},Phaser.Physics.Box2D.Body.prototype={setBodyContactCallback:function(o,t,e){var i=-1;o.id?i=o.id:o.body&&(i=o.body.id),-1<i&&(null===t?(delete this._bodyContactCallbacks[i],delete this._bodyContactCallbackContext[i]):(this._bodyContactCallbacks[i]=t,this._bodyContactCallbackContext[i]=e))},setFixtureContactCallback:function(o,t,e){var i=o.id;-1<i&&(null===t?(delete this._fixtureContactCallbacks[i],delete this._fixtureContactCallbackContext[i]):(this._fixtureContactCallbacks[i]=t,this._fixtureContactCallbackContext[i]=e))},setCategoryContactCallback:function(o,t,e){null===t?(delete this._categoryContactCallbacks[o],delete this._categoryContactCallbacksContext[o]):(this._categoryContactCallbacks[o]=t,this._categoryContactCallbackContext[o]=e)},setBodyPresolveCallback:function(o,t,e){var i=-1;o.id?i=o.id:o.body&&(i=o.body.id),-1<i&&(null===t?(delete this._bodyPresolveCallbacks[i],delete this._bodyPresolveCallbackContext[i]):(this._bodyPresolveCallbacks[i]=t,this._bodyPresolveCallbackContext[i]=e))},setFixturePresolveCallback:function(o,t,e){var i=o.id;-1<i&&(null===t?(delete this._fixturePresolveCallbacks[i],delete this._fixturePresolveCallbackContext[i]):(this._fixturePresolveCallbacks[i]=t,this._fixturePresolveCallbackContext[i]=e))},setCategoryPresolveCallback:function(o,t,e){null===t?(delete this._categoryPresolveCallbacks[o],delete this._categoryPresolveCallbacksContext[o]):(this._categoryPresolveCallbacks[o]=t,this._categoryPresolveCallbackContext[o]=e)},setBodyPostsolveCallback:function(o,t,e){var i=-1;o.id?i=o.id:o.body&&(i=o.body.id),-1<i&&(null===t?(delete this._bodyPostsolveCallbacks[i],delete this._bodyPostsolveCallbackContext[i]):(this._bodyPostsolveCallbacks[i]=t,this._bodyPostsolveCallbackContext[i]=e))},setFixturePostsolveCallback:function(o,t,e){var i=o.id;-1<i&&(null===t?(delete this._fixturePostsolveCallbacks[i],delete this._fixturePostsolveCallbackContext[i]):(this._fixturePostsolveCallbacks[i]=t,this._fixturePostsolveCallbackContext[i]=e))},setCategoryPostsolveCallback:function(o,t,e){null===t?(delete this._categoryPostsolveCallbacks[o],delete this._categoryPostsolveCallbacksContext[o]):(this._categoryPostsolveCallbacks[o]=t,this._categoryPostsolveCallbackContext[o]=e)},setCollisionCategory:function(o,t){if(void 0===t)for(var e=this.data.GetFixtureList();e;e=e.GetNext()){e.GetFilterData().categoryBits=o}else t.GetFilterData().categoryBits=o},setCollisionMask:function(o,t){if(void 0===t)for(var e=this.data.GetFixtureList();e;e=e.GetNext()){e.GetFilterData().maskBits=o}else t.GetFilterData().maskBits=o},applyForce:function(o,t){this.data.ApplyForce(new box2d.b2Vec2(-o,-t),this.data.GetWorldCenter(),!0)},setZeroRotation:function(){this.data.SetAngularVelocity(0)},setZeroVelocity:function(){this.data.SetLinearVelocity(box2d.b2Vec2.ZERO)},setZeroDamping:function(){this.data.SetLinearDamping(0),this.data.SetAngularDamping(0)},toLocalPoint:function(o,t){return o.x=this.world.pxm(-t.x),o.y=this.world.pxm(-t.y),this.data.GetLocalPoint(o,o),o.x=this.world.mpx(-o.x),o.y=this.world.mpx(-o.y),o},toWorldPoint:function(o,t){return o.x=this.world.pxm(-t.x),o.y=this.world.pxm(-t.y),this.data.GetWorldPoint(o,o),o.x=this.world.mpx(-o.x),o.y=this.world.mpx(-o.y),o},toLocalVector:function(o,t){return o.x=this.world.pxm(-t.x),o.y=this.world.pxm(-t.y),this.data.GetLocalVector(o,o),o.x=this.world.mpx(-o.x),o.y=this.world.mpx(-o.y),o},toWorldVector:function(o,t){o.x=this.world.pxm(-t.x),o.y=this.world.pxm(-t.y),this.data.GetWorldVector(o,o),o.x=this.world.mpx(-o.x),o.y=this.world.mpx(-o.y)},rotateLeft:function(o){this.data.SetAngularVelocity(this.world.pxm(-o))},rotateRight:function(o){this.data.SetAngularVelocity(this.world.pxm(o))},moveForward:function(o){var t=this.world.pxm(o),e=new box2d.b2Vec2;this.toWorldVector(e,{x:0,y:t}),this.data.SetLinearVelocity(e)},moveBackward:function(o){var t=this.world.pxm(-o),e=new box2d.b2Vec2;this.toWorldVector(e,{x:0,y:t}),this.data.SetLinearVelocity(e)},thrust:function(o){var t=this.world.pxm(o)*this.data.GetMass(),e=new box2d.b2Vec2;this.toWorldVector(e,{x:0,y:t}),this.data.ApplyForce(e,this.data.GetWorldCenter(),!0)},reverse:function(o){var t=-this.world.pxm(o)*this.data.GetMass(),e=new box2d.b2Vec2;this.toWorldVector(e,{x:0,y:t}),this.data.ApplyForce(e,this.data.GetWorldCenter(),!0)},moveLeft:function(o){this.velocity.x=-o},moveRight:function(o){this.velocity.x=o},moveUp:function(o){this.velocity.y=-o},moveDown:function(o){this.velocity.y=o},preUpdate:function(){this.removeNextStep&&(this.removeFromWorld(),this.removeNextStep=!1)},postUpdate:function(){this.sprite&&(this.sprite.x=this.world.mpx(-this.data.GetPosition().x),this.sprite.y=this.world.mpx(-this.data.GetPosition().y),this.sprite.rotation=this.data.GetAngle())},kill:function(){this.data.SetActive(!1)},reset:function(o,t){this.data.SetPositionXY(this.world.pxm(-o),this.world.pxm(-t)),this.data.SetActive(!0)},removeFromWorld:function(){this.data.world===this.game.physics.box2d.world&&this.game.physics.box2d.removeBodyNextStep(this)},destroy:function(){this.removeFromWorld(),this._bodyCallbacks={},this._bodyCallbackContext={},this._categoryCallbacks={},this._categoryCallbackContext={},this.sprite=null},clearFixtures:function(){for(var o=[],t=this.data.GetFixtureList();t;t=t.GetNext())o.push(t);for(var e=o.length;e--;)this.data.DestroyFixture(o[e])},addCircle:function(o,t,e){var i=new box2d.b2CircleShape(this.world.pxm(o));i.m_p.SetXY(this.world.pxm(-t),this.world.pxm(-e));var n=new box2d.b2FixtureDef;n.shape=i,n.friction=this.world.friction,n.restitution=this.world.restitution,n.density=this.world.density;var s=this.data.CreateFixture(n);return s.id=this.world.getNextFixtureId(),s},addRectangle:function(o,t,e,i,n){void 0===o&&(o=16),void 0===t&&(t=16),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n=0),o=this.world.pxm(o),t=this.world.pxm(t);var s=new box2d.b2PolygonShape;s.SetAsOrientedBox(.5*o,.5*t,new box2d.b2Vec2(this.world.pxm(-e),this.world.pxm(-i)),n);var r=new box2d.b2FixtureDef;r.shape=s,r.friction=this.world.friction,r.restitution=this.world.restitution,r.density=this.world.density;var b=this.data.CreateFixture(r);return b.id=this.world.getNextFixtureId(),b},addEdge:function(o,t,e,i){var n=new box2d.b2EdgeShape;n.Set(new box2d.b2Vec2(this.world.pxm(-o),this.world.pxm(-t)),new box2d.b2Vec2(this.world.pxm(-e),this.world.pxm(-i)));var s=new box2d.b2FixtureDef;s.shape=n,s.friction=this.world.friction,s.restitution=this.world.restitution,s.density=this.world.density;var r=this.data.CreateFixture(s);return r.id=this.world.getNextFixtureId(),r},addChain:function(o,t,e,i){if(void 0===o)return null;if(o.length<4)return null;void 0===t&&(t=0),void 0===e&&(e=(o.length-t)/2);for(var n=[],s=t;s<t+e;s++)n.push(new box2d.b2Vec2(this.world.pxm(-o[2*s]),this.world.pxm(-o[2*s+1])));var r=new box2d.b2ChainShape;i?r.CreateLoop(n,n.length):r.CreateChain(n,n.length);var b=new box2d.b2FixtureDef;b.shape=r,b.friction=this.world.friction,b.restitution=this.world.restitution,b.density=this.world.density;var a=this.data.CreateFixture(b);return a.id=this.world.getNextFixtureId(),a},addLoop:function(o,t,e){return this.addChain(o,t,e,!0)},addPolygon:function(o,t,e){if(void 0===o)return null;if(o.length<6)return null;void 0===t&&(t=0),void 0===e&&(e=(o.length-t)/2);for(var i=[],n=t;n<t+e;n++)i.push({x:this.world.pxm(-o[2*n]),y:this.world.pxm(-o[2*n+1])});var s=new Phaser.Physics.Box2D.Polygon;s.setFromXYObjects(i);var r=s.decompose(i),b=null;for(n=0;n<r.length;n++){var a=new box2d.b2PolygonShape;a.Set(r[n],r[n].length);var d=new box2d.b2FixtureDef;d.shape=a,d.friction=this.world.friction,d.restitution=this.world.restitution,d.density=this.world.density,(b=this.data.CreateFixture(d)).id=this.world.getNextFixtureId()}return b},removeFixture:function(o){return o.GetBody()==this.data&&(this.data.DestroyFixture(o),!0)},setCircle:function(o,t,e){return void 0===o&&(o=32),void 0===t&&(t=0),void 0===e&&(e=0),this.clearFixtures(),this.addCircle(o,t,e)},setRectangle:function(o,t,e,i,n){return this.clearFixtures(),this.addRectangle(o,t,e,i,n)},setRectangleFromSprite:function(o){return void 0===o&&(o=this.sprite),this.clearFixtures(),this.addRectangle(o.width,o.height,0,0,o.rotation)},setEdge:function(o,t,e,i){return void 0===o&&(o=0),void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),this.clearFixtures(),this.addEdge(o,t,e,i)},setChain:function(o,t,e,i){return void 0===o?null:o.length<4?null:(void 0===t&&(t=0),void 0===e&&(e=(o.length-t)/2),this.clearFixtures(),this.addChain(o,t,e,i))},setLoop:function(o,t,e){return this.setChain(o,t,e,!0)},setPolygon:function(o,t,e){return void 0===o?null:o.length<4?null:(void 0===t&&(t=0),void 0===e&&(e=(o.length-t)/2),this.clearFixtures(),this.addPolygon(o,t,e))},loadPolygon:function(o,t,e){void 0===e&&(e=null);for(var i=this.game.cache.getPhysicsData(o,t),n=0;n<i.length;n++){for(var s=[],r=0;r<i[n].shape.length;r+=2)s.push(new box2d.b2Vec2(this.world.pxm(-i[n].shape[r]),this.world.pxm(-i[n].shape[r+1])));if(e)for(var b=this.world.pxm(-.5*e.width),a=this.world.pxm(-.5*e.height),d=0;d<s.length;d++)s[d].x-=b,s[d].y-=a;var l=new box2d.b2PolygonShape;l.Set(s,s.length);var x=new box2d.b2FixtureDef;x.shape=l,x.friction=i[n].friction,x.restitution=i[n].bounce,x.density=i[n].density,x.filter.categoryBits=i[n].filter.categoryBits,x.filter.maskBits=i[n].filter.maskBits,this.data.CreateFixture(x).id=this.world.getNextFixtureId()}return!0},containsPoint:function(o){for(var t=this.world.pxm(-o.x),e=this.world.pxm(-o.y),i=new box2d.b2Vec2(t,e),n=this.data.GetFixtureList();n;n=n.GetNext())if(n.TestPoint(i))return!0;return!1}},Phaser.Physics.Box2D.Body.prototype.constructor=Phaser.Physics.Box2D.Body,Object.defineProperty(Phaser.Physics.Box2D.Body.prototype,"static",{get:function(){return this.data.GetType()===box2d.b2BodyType.b2_staticBody},set:function(o){o&&this.data.GetType()!==box2d.b2BodyType.b2_staticBody?this.data.SetType(box2d.b2BodyType.b2_staticBody):o||this.data.GetType()!==box2d.b2BodyType.b2_staticBody||this.data.SetType(box2d.b2BodyType.b2_dynamicBody)}}),Object.defineProperty(Phaser.Physics.Box2D.Body.prototype,"dynamic",{get:function(){return this.data.GetType()===box2d.b2BodyType.b2_dynamicBody},set:function(o){o&&this.data.GetType()!==box2d.b2BodyType.b2_dynamicBody?this.data.SetType(box2d.b2BodyType.b2_dynamicBody):o||this.data.GetType()!==box2d.b2BodyType.b2_dynamicBody||this.data.SetType(box2d.b2BodyType.b2_staticBody)}}),Object.defineProperty(Phaser.Physics.Box2D.Body.prototype,"kinematic",{get:function(){return this.data.GetType()===box2d.b2BodyType.b2_kinematicBody},set:function(o){o&&this.data.GetType()!==box2d.b2BodyType.b2_kinematicBody?this.data.SetType(box2d.b2BodyType.b2_kinematicBody):o||this.data.GetType()!==box2d.b2BodyType.b2_kinematicBody||this.data.SetType(box2d.b2BodyType.b2_staticBody)}}),Object.defineProperty(Phaser.Physics.Box2D.Body.prototype,"angle",{get:function(){return Phaser.Math.wrapAngle(Phaser.Math.radToDeg(this.data.GetAngle()))},set:function(o){this.data.SetAngle(Phaser.Math.degToRad(Phaser.Math.wrapAngle(o)))}}),Object.defineProperty(Phaser.Physics.Box2D.Body.prototype,"linearDamping",{get:function(){return this.data.GetLinearDamping()},set:function(o){this.data.SetLinearDamping(o)}}),Object.defineProperty(Phaser.Physics.Box2D.Body.prototype,"angularDamping",{get:function(){return this.data.GetAngularDamping()},set:function(o){this.data.SetAngularDamping(o)}}),Object.defineProperty(Phaser.Physics.Box2D.Body.prototype,"angularVelocity",{get:function(){return this.data.GetAngularVelocity()},set:function(o){this.data.SetAngularVelocity(o)}}),Object.defineProperty(Phaser.Physics.Box2D.Body.prototype,"fixedRotation",{get:function(){return this.data.IsFixedRotation()},set:function(o){this.data.SetFixedRotation(o)}}),Object.defineProperty(Phaser.Physics.Box2D.Body.prototype,"gravityScale",{get:function(){return this.data.GetGravityScale()},set:function(o){this.data.SetGravityScale(o)}}),Object.defineProperty(Phaser.Physics.Box2D.Body.prototype,"friction",{get:function(){var o=this.data.GetFixtureList();return o?o.GetFriction():0},set:function(o){for(var t=this.data.GetFixtureList();t;t=t.GetNext())t.SetFriction(o),t.Refilter()}}),Object.defineProperty(Phaser.Physics.Box2D.Body.prototype,"restitution",{get:function(){var o=this.data.GetFixtureList();return o?o.GetRestitution():0},set:function(o){for(var t=this.data.GetFixtureList();t;t=t.GetNext())t.SetRestitution(o),t.Refilter()}}),Object.defineProperty(Phaser.Physics.Box2D.Body.prototype,"sensor",{get:function(){var o=this.data.GetFixtureList();return o?o.IsSensor():0},set:function(o){for(var t=this.data.GetFixtureList();t;t=t.GetNext())t.SetSensor(o),t.Refilter()}}),Object.defineProperty(Phaser.Physics.Box2D.Body.prototype,"bullet",{get:function(){return this.data.IsBullet()},set:function(o){this.data.SetBullet(o)}}),Object.defineProperty(Phaser.Physics.Box2D.Body.prototype,"mass",{get:function(){return this.data.GetMass()},set:function(o){if(0===o)this.data.SetType(box2d.b2BodyType.b2_staticBody);else{this.data.GetType()!==box2d.b2BodyType.b2_dynamicBody&&this.data.SetType(box2d.b2BodyType.b2_dynamicBody);for(var t=o/this.data.GetMass(),e=this.data.GetFixtureList();e;e=e.GetNext()){var i=e.GetDensity();e.SetDensity(i*t)}this.data.ResetMassData()}}}),Object.defineProperty(Phaser.Physics.Box2D.Body.prototype,"rotation",{get:function(){return this.data.GetAngle()},set:function(o){this.data.SetAngle(o)}}),Object.defineProperty(Phaser.Physics.Box2D.Body.prototype,"x",{get:function(){return this.world.mpx(-this.data.GetPosition().x)},set:function(o){this.data.SetPositionXY(this.world.pxm(-o),this.data.GetPosition().y)}}),Object.defineProperty(Phaser.Physics.Box2D.Body.prototype,"y",{get:function(){return this.world.mpx(-this.data.GetPosition().y)},set:function(o){this.data.SetPositionXY(this.data.GetPosition().x,this.world.pxm(-o))}}),Object.defineProperty(Phaser.Physics.Box2D.Body.prototype,"collideWorldBounds",{get:function(){for(var o=this.data.GetFixtureList();o;o=o.GetNext()){if(o.GetFilterData().maskBits&Phaser.Physics.Box2D.worldBoundsFilterCategory)return!0}return!1},set:function(o){for(var t=this.data.GetFixtureList();t;t=t.GetNext()){var e=t.GetFilterData();o?e.maskBits|=Phaser.Physics.Box2D.worldBoundsFilterCategory:e.maskBits&=~Phaser.Physics.Box2D.worldBoundsFilterCategory}}}),Phaser.Physics.Box2D.PointProxy=function(o,t,e,i){this.world=o,this.object=t,this.gettor=e,this.settor=i},Phaser.Physics.Box2D.PointProxy.prototype.constructor=Phaser.Physics.Box2D.PointProxy,Object.defineProperty(Phaser.Physics.Box2D.PointProxy.prototype,"x",{get:function(){return this.world.mpx(-this.gettor.call(this.object).x)},set:function(o){var t=this.gettor.call(this.object);t.x=this.world.pxm(-o),this.settor.call(this.object,t)}}),Object.defineProperty(Phaser.Physics.Box2D.PointProxy.prototype,"y",{get:function(){return this.world.mpx(-this.gettor.call(this.object).y)},set:function(o){var t=this.gettor.call(this.object);t.y=this.world.pxm(-o),this.settor.call(this.object,t)}}),Phaser.Physics.Box2D.DefaultDebugDraw=function(o){this.context=null,this.pixelsPerMeter=o,this.flags=box2d.b2DrawFlags.e_shapeBit},Phaser.Physics.Box2D.DefaultDebugDraw.prototype.color=new box2d.b2Color(1,1,1),Phaser.Physics.Box2D.DefaultDebugDraw.prototype.SetFlags=function(o){this.flags=o},Phaser.Physics.Box2D.DefaultDebugDraw.prototype.GetFlags=function(){return this.flags},Phaser.Physics.Box2D.DefaultDebugDraw.prototype.start=function(o){this.context=o,this.context.save(),this.context.scale(-1,-1),this.context.scale(this.pixelsPerMeter,this.pixelsPerMeter)},Phaser.Physics.Box2D.DefaultDebugDraw.prototype.stop=function(){this.context.restore()},Phaser.Physics.Box2D.DefaultDebugDraw.prototype.PushTransform=function(o){var t=this.context;t.save(),t.translate(o.p.x,o.p.y),t.rotate(o.q.GetAngleRadians())},Phaser.Physics.Box2D.DefaultDebugDraw.prototype.PopTransform=function(){this.context.restore()},Phaser.Physics.Box2D.DefaultDebugDraw.prototype.DrawPolygon=function(o,t,e){if(t){var i=this.context;i.lineWidth=1/this.pixelsPerMeter,i.beginPath(),i.moveTo(o[0].x,o[0].y);for(var n=1;n<t;n++)i.lineTo(o[n].x,o[n].y);i.closePath(),i.strokeStyle=e.MakeStyleString(1),i.stroke()}},Phaser.Physics.Box2D.DefaultDebugDraw.prototype.DrawSolidPolygon=function(o,t,e){if(t){var i=this.context;i.lineWidth=1/this.pixelsPerMeter,i.beginPath(),i.moveTo(o[0].x,o[0].y);for(var n=1;n<t;n++)i.lineTo(o[n].x,o[n].y);i.closePath(),i.fillStyle=e.MakeStyleString(.5),i.fill(),i.strokeStyle=e.MakeStyleString(1),i.stroke()}},Phaser.Physics.Box2D.DefaultDebugDraw.prototype.DrawCircle=function(o,t,e){if(t){var i=this.context;i.beginPath(),i.arc(o.x,o.y,t,0,2*Math.PI,!0),i.strokeStyle=e.MakeStyleString(1),i.stroke()}},Phaser.Physics.Box2D.DefaultDebugDraw.prototype.DrawSolidCircle=function(o,t,e,i){if(t){var n=this.context;n.lineWidth=1/this.pixelsPerMeter;var s=o.x,r=o.y;n.beginPath(),n.arc(s,r,t,0,2*Math.PI,!0),n.moveTo(s,r),n.lineTo(s+e.x*t,r+e.y*t),n.fillStyle=i.MakeStyleString(.5),n.fill(),n.strokeStyle=i.MakeStyleString(1),n.stroke()}},Phaser.Physics.Box2D.DefaultDebugDraw.prototype.DrawSegment=function(o,t,e){var i=this.context;i.lineWidth=1/this.pixelsPerMeter,i.beginPath(),i.moveTo(o.x,o.y),i.lineTo(t.x,t.y),i.strokeStyle=e.MakeStyleString(1),i.stroke()},Phaser.Physics.Box2D.DefaultDebugDraw.prototype.DrawTransform=function(o){var t=this.context;t.lineWidth=1/this.pixelsPerMeter,this.PushTransform(o),t.beginPath(),t.moveTo(0,0),t.lineTo(1,0),t.strokeStyle=box2d.b2Color.RED.MakeStyleString(1),t.stroke(),t.beginPath(),t.moveTo(0,0),t.lineTo(0,1),t.strokeStyle=box2d.b2Color.GREEN.MakeStyleString(1),t.stroke(),this.PopTransform(o)},Phaser.Physics.Box2D.DefaultDebugDraw.prototype.DrawPoint=function(o,t,e){var i=this.context;i.fillStyle=e.MakeStyleString();var n=t/2;i.fillRect(o.x-n,o.y-n,t,t)},Phaser.Physics.Box2D.DefaultDebugDraw.prototype.DrawAABB=function(o,t){var e=this.context;e.strokeStyle=t.MakeStyleString();var i=o.lowerBound.x,n=o.lowerBound.y,s=o.upperBound.x-o.lowerBound.x,r=o.upperBound.y-o.lowerBound.y;e.strokeRect(i,n,s,r)},Object.defineProperty(Phaser.Physics.Box2D.DefaultDebugDraw.prototype,"shapes",{get:function(){return this.flags&box2d.b2DrawFlags.e_shapeBit},set:function(o){o?this.flags|=box2d.b2DrawFlags.e_shapeBit:this.flags&=~box2d.b2DrawFlags.e_shapeBit}}),Object.defineProperty(Phaser.Physics.Box2D.DefaultDebugDraw.prototype,"joints",{get:function(){return this.flags&box2d.b2DrawFlags.e_jointBit},set:function(o){o?this.flags|=box2d.b2DrawFlags.e_jointBit:this.flags&=~box2d.b2DrawFlags.e_jointBit}}),Object.defineProperty(Phaser.Physics.Box2D.DefaultDebugDraw.prototype,"aabbs",{get:function(){return this.flags&box2d.b2DrawFlags.e_aabbBit},set:function(o){o?this.flags|=box2d.b2DrawFlags.e_aabbBit:this.flags&=~box2d.b2DrawFlags.e_aabbBit}}),Object.defineProperty(Phaser.Physics.Box2D.DefaultDebugDraw.prototype,"pairs",{get:function(){return this.flags&box2d.b2DrawFlags.e_pairBit},set:function(o){o?this.flags|=box2d.b2DrawFlags.e_pairBit:this.flags&=~box2d.b2DrawFlags.e_pairBit}}),Object.defineProperty(Phaser.Physics.Box2D.DefaultDebugDraw.prototype,"centerOfMass",{get:function(){return this.flags&box2d.b2DrawFlags.e_centerOfMassBit},set:function(o){o?this.flags|=box2d.b2DrawFlags.e_centerOfMassBit:this.flags&=~box2d.b2DrawFlags.e_centerOfMassBit}}),Phaser.Physics.Box2D.DefaultContactListener=function(){},Phaser.Physics.Box2D.DefaultContactListener.prototype.BeginContact=function(o){this.handleContactBeginOrEnd(o,!0)},Phaser.Physics.Box2D.DefaultContactListener.prototype.EndContact=function(o){this.handleContactBeginOrEnd(o,!1)},Phaser.Physics.Box2D.DefaultContactListener.prototype.handleContactBeginOrEnd=function(o,t){var e=o.GetFixtureA(),i=o.GetFixtureB(),n=e.GetBody(),s=i.GetBody(),r=e.GetFilterData().categoryBits,b=i.GetFilterData().categoryBits,a=n.parent,d=s.parent;if(void 0!==a&&void 0!==d){var l=a.id,x=d.id;a._bodyContactCallbacks[x]&&a._bodyContactCallbacks[x].call(a._bodyContactCallbackContext[x],a,d,e,i,t,o),d._bodyContactCallbacks[l]&&d._bodyContactCallbacks[l].call(d._bodyContactCallbackContext[l],d,a,i,e,t,o),a._fixtureContactCallbacks[i.id]&&a._fixtureContactCallbacks[i.id].call(a._fixtureContactCallbackContext[i.id],a,d,e,i,t,o),d._fixtureContactCallbacks[e.id]&&d._fixtureContactCallbacks[e.id].call(d._fixtureContactCallbackContext[e.id],d,a,i,e,t,o),a._fixtureContactCallbacks[e.id]&&a._fixtureContactCallbacks[e.id].call(a._fixtureContactCallbackContext[e.id],a,d,e,i,t,o),d._fixtureContactCallbacks[i.id]&&d._fixtureContactCallbacks[i.id].call(d._fixtureContactCallbackContext[i.id],d,a,i,e,t,o),a._categoryContactCallbacks[b]&&a._categoryContactCallbacks[b].call(a._categoryContactCallbackContext[b],a,d,e,i,t,o),d._categoryContactCallbacks[r]&&d._categoryContactCallbacks[r].call(d._categoryContactCallbackContext[r],d,a,i,e,t,o),a._categoryContactCallbacks[r]&&a._categoryContactCallbacks[r].call(a._categoryContactCallbackContext[r],a,d,e,i,t,o),d._categoryContactCallbacks[b]&&d._categoryContactCallbacks[b].call(d._categoryContactCallbackContext[b],d,a,i,e,t,o)}},Phaser.Physics.Box2D.DefaultContactListener.prototype.PreSolve=function(o,t){var e=o.GetFixtureA(),i=o.GetFixtureB(),n=e.GetBody(),s=i.GetBody(),r=e.GetFilterData().categoryBits,b=i.GetFilterData().categoryBits,a=n.parent,d=s.parent;if(void 0!==a&&void 0!==d){var l=a.id,x=d.id;a._bodyPresolveCallbacks[x]&&a._bodyPresolveCallbacks[x].call(a._bodyPresolveCallbackContext[x],a,d,e,i,o,t),d._bodyPresolveCallbacks[l]&&d._bodyPresolveCallbacks[l].call(d._bodyPresolveCallbackContext[l],d,a,i,e,o,t),a._fixturePresolveCallbacks[i.id]&&a._fixturePresolveCallbacks[i.id].call(a._fixturePresolveCallbackContext[i.id],a,d,e,i,o,t),d._fixturePresolveCallbacks[e.id]&&d._fixturePresolveCallbacks[e.id].call(d._fixturePresolveCallbackContext[e.id],d,a,i,e,o,t),a._categoryPresolveCallbacks[b]&&a._categoryPresolveCallbacks[b].call(a._categoryPresolveCallbackContext[b],a,d,e,i,o,t),d._categoryPresolveCallbacks[r]&&d._categoryPresolveCallbacks[r].call(d._categoryPresolveCallbackContext[r],d,a,i,e,o,t)}},Phaser.Physics.Box2D.DefaultContactListener.prototype.PostSolve=function(o,t){var e=o.GetFixtureA(),i=o.GetFixtureB(),n=e.GetBody(),s=i.GetBody(),r=e.GetFilterData().categoryBits,b=i.GetFilterData().categoryBits,a=n.parent,d=s.parent;if(void 0!==a&&void 0!==d){var l=a.id,x=d.id;a._bodyPostsolveCallbacks[x]&&a._bodyPostsolveCallbacks[x].call(a._bodyPostsolveCallbackContext[x],a,d,e,i,o,t),d._bodyPostsolveCallbacks[l]&&d._bodyPostsolveCallbacks[l].call(d._bodyPostsolveCallbackContext[l],d,a,i,e,o,t),a._fixturePostsolveCallbacks[i.id]&&a._fixturePostsolveCallbacks[i.id].call(a._fixturePostsolveCallbackContext[i.id],a,d,e,i,o,t),d._fixturePostsolveCallbacks[e.id]&&d._fixturePostsolveCallbacks[e.id].call(d._fixturePostsolveCallbackContext[e.id],d,a,i,e,o,t),a._categoryPostsolveCallbacks[b]&&a._categoryPostsolveCallbacks[b].call(a._categoryPostsolveCallbackContext[b],a,d,e,i,o,t),d._categoryPostsolveCallbacks[r]&&d._categoryPostsolveCallbacks[r].call(d._categoryPostsolveCallbackContext[r],d,a,i,e,o,t)}},Phaser.Physics.Box2D.Polygon=function(){this.vertices=[]},Phaser.Physics.Box2D.Polygon.prototype.setFromFlatXYCoords=function(o){this.vertices=[];for(var t=0;t<o.length/2;t++)this.vertices.push({x:o[2*t],y:o[2*t+1]})},Phaser.Physics.Box2D.Polygon.prototype.setFromXYObjects=function(o){this.vertices=o.concat()},Phaser.Physics.Box2D.Polygon.prototype.addVertex=function(o){this.vertices.push(o)},Phaser.Physics.Box2D.Polygon.prototype.at=function(o){var t=this.vertices.length;return this.vertices[o<0?o%t+t:o%t]},Phaser.Physics.Box2D.Polygon.prototype.indicesAreAdjacent=function(o,t){if((o%=this.vertices.length)==(t%=this.vertices.length))return!0;var e=Math.abs(o-t);return e<2||e==this.vertices.length-1},Phaser.Physics.Box2D.Polygon.prototype.areaInTriangle=function(o,t,e){return o=this.at(o),t=this.at(t),e=this.at(e),.5*((t.x-o.x)*(e.y-o.y)-(e.x-o.x)*(t.y-o.y))},Phaser.Physics.Box2D.Polygon.prototype.left=function(o,t,e){return 0<this.areaInTriangle(o,t,e)},Phaser.Physics.Box2D.Polygon.prototype.leftOn=function(o,t,e){return 0<=this.areaInTriangle(o,t,e)},Phaser.Physics.Box2D.Polygon.prototype.right=function(o,t,e){return this.areaInTriangle(o,t,e)<0},Phaser.Physics.Box2D.Polygon.prototype.rightOn=function(o,t,e){return this.areaInTriangle(o,t,e)<=0},Phaser.Physics.Box2D.Polygon.sqdist=function(o,t){var e=t.x-o.x,i=t.y-o.y;return e*e+i*i},Phaser.Physics.Box2D.Polygon.prototype.makeCCW=function(){for(var o=0,t=1,e=this.vertices.length;t<e;t++)(this.at(t).y<this.at(o).y||this.at(t).y===this.at(o).y&&this.at(t).x>this.at(o).x)&&(o=t);return!this.left(o-1,o,o+1)&&(this.vertices.reverse(),!0)},Phaser.Physics.Box2D.Polygon.prototype.isConvex=function(){for(var o=!1,t=!1,e=0,i=this.vertices.length;e<i;e++){var n=e,s=(e+1)%i,r=(e+2)%i;0<this.areaInTriangle(this.vertices[n],this.vertices[s],this.vertices[r])?o=!0:t=!0}return t^o},Phaser.Physics.Box2D.Polygon.prototype.isReflex=function(o){return this.right(o-1,o,o+1)},Phaser.Physics.Box2D.Polygon.areVecsEqual=function(o,t){return o.x==t.x&&o.y==t.y},Phaser.Physics.Box2D.Polygon.linesCross=function(o,t,e,i){if(Phaser.Physics.Box2D.Polygon.areVecsEqual(t,e)||Phaser.Physics.Box2D.Polygon.areVecsEqual(o,e)||Phaser.Physics.Box2D.Polygon.areVecsEqual(t,i)||Phaser.Physics.Box2D.Polygon.areVecsEqual(o,i))return null;var n={};box2d.b2SubVV(t,o,n),box2d.b2CrossVS(n,1,n);var s=box2d.b2DotVV(n,o),r=box2d.b2DotVV(n,e),b=box2d.b2DotVV(n,i);if(s<r&&s<b)return null;if(r<s&&b<s)return null;var a={};box2d.b2SubVV(i,e,a),box2d.b2CrossVS(a,1,a);r=box2d.b2DotVV(a,e),s=box2d.b2DotVV(a,o);var d=box2d.b2DotVV(a,t);if(r<s&&r<d)return null;if(s<r&&d<r)return null;var l=(r-s)/(d-s);return{x:o.x+l*(t.x-o.x),y:o.y+l*(t.y-o.y)}},Phaser.Physics.Box2D.Polygon.prototype.canSee=function(o,t){if(this.indicesAreAdjacent(o,t))return!1;if(this.leftOn(o+1,o,t)&&this.rightOn(o-1,o,t))return!1;for(var e=0;e<this.vertices.length;++e)if((e+1)%this.vertices.length!=o&&e!=o&&this.leftOn(o,t,e+1)&&this.rightOn(o,t,e)&&Phaser.Physics.Box2D.Polygon.linesCross(this.at(o),this.at(t),this.at(e),this.at(e+1)))return!1;return!0},Phaser.Physics.Box2D.Polygon.prototype.subPolygon=function(o,t){var e=new Phaser.Physics.Box2D.Polygon;if(o<t)for(var i=o;i<t+1;i++)e.addVertex(this.at(i));else{for(i=o;i<this.vertices.length;i++)e.addVertex(this.at(i));for(i=0;i<t+1;i++)e.addVertex(this.at(i))}return e},Phaser.Physics.Box2D.Polygon.prototype.decomposeOptimal=function(o){if(void 0===o&&(o=0),1<o)return this.vertices;this.makeCCW();for(var t=[],e=[],i=[],n=Number.MAX_VALUE,s=0;s<this.vertices.length;s++)if(this.isReflex(s))for(var r=0;r<this.vertices.length;r++)this.canSee(s,r)&&(e=this.subPolygon(s,r).decompose(o+1),i=this.subPolygon(r,s).decompose(o+1),e.length+i.length<n&&(n=(t=e.concat(i)).length));return 0===t.length&&t.push(this.vertices),t},Phaser.Physics.Box2D.Polygon.prototype.decompose=function(o){void 0===o&&(o=0),this.makeCCW();for(var t,e,i=[],n=Number.MAX_VALUE,s=!1,r=0;r<this.vertices.length;r++)if(this.isReflex(r)){s=!0;for(var b=this.at(r),a=0;a<this.vertices.length;a++)if(this.canSee(r,a)){var d=this.at(a),l=d.x-b.x,x=d.y-b.y,p=l*l*(x*x);p<n&&(t=r,e=a,n=p)}}if(!s&&8<this.vertices.length&&(t=0,e=Math.floor(this.vertices.length/2),s=!0),s){var m=this.subPolygon(t,e).decompose(o+1),h=this.subPolygon(e,t).decompose(o+1);i=m.concat(h)}return 0===i.length&&i.push(this.vertices),i};